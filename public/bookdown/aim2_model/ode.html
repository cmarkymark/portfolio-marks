<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 ODE Functions | Aim #2: Mathematical Model</title>
  <meta name="description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 ODE Functions | Aim #2: Mathematical Model" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 ODE Functions | Aim #2: Mathematical Model" />
  
  <meta name="twitter:description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation" />
  

<meta name="author" content="Charles Marks" />


<meta name="date" content="2021-04-22" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="start.html"/>
<link rel="next" href="calibration.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> In This Book</a></li>
<li class="chapter" data-level="2" data-path="dataset.html"><a href="dataset.html"><i class="fa fa-check"></i><b>2</b> Generating the Initial Dataset</a>
<ul>
<li class="chapter" data-level="2.1" data-path="dataset.html"><a href="dataset.html#participants"><i class="fa fa-check"></i><b>2.1</b> Participants</a></li>
<li class="chapter" data-level="2.2" data-path="dataset.html"><a href="dataset.html#defining-variables-we-wish-to-capture"><i class="fa fa-check"></i><b>2.2</b> Defining Variables We Wish to Capture</a></li>
<li class="chapter" data-level="2.3" data-path="dataset.html"><a href="dataset.html#loading-the-necessary-datasets"><i class="fa fa-check"></i><b>2.3</b> Loading the Necessary Datasets</a></li>
<li class="chapter" data-level="2.4" data-path="dataset.html"><a href="dataset.html#iterating-through-the-datasets"><i class="fa fa-check"></i><b>2.4</b> Iterating Through the Datasets</a></li>
<li class="chapter" data-level="2.5" data-path="dataset.html"><a href="dataset.html#factoring-the-data"><i class="fa fa-check"></i><b>2.5</b> Factoring the Data</a></li>
<li class="chapter" data-level="2.6" data-path="dataset.html"><a href="dataset.html#adding-the-weights-and-replicate-weights-to-the-study"><i class="fa fa-check"></i><b>2.6</b> Adding the Weights and Replicate Weights to the Study</a></li>
<li class="chapter" data-level="2.7" data-path="dataset.html"><a href="dataset.html#save-the-data-frame-for-future-use"><i class="fa fa-check"></i><b>2.7</b> Save the Data Frame for Future Use</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="imputation.html"><a href="imputation.html"><i class="fa fa-check"></i><b>3</b> Data Imputation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="imputation.html"><a href="imputation.html#loading-libraries-and-the-data"><i class="fa fa-check"></i><b>3.1</b> Loading Libraries and the Data</a></li>
<li class="chapter" data-level="3.2" data-path="imputation.html"><a href="imputation.html#heuristic-imputation-of-income"><i class="fa fa-check"></i><b>3.2</b> Heuristic Imputation of Income</a></li>
<li class="chapter" data-level="3.3" data-path="imputation.html"><a href="imputation.html#heuristic-imputation-of-former-cige-cig-use"><i class="fa fa-check"></i><b>3.3</b> Heuristic Imputation of Former Cig/E-Cig Use</a></li>
<li class="chapter" data-level="3.4" data-path="imputation.html"><a href="imputation.html#imputation-with-mice"><i class="fa fa-check"></i><b>3.4</b> Imputation with <em>mice()</em></a></li>
<li class="chapter" data-level="3.5" data-path="imputation.html"><a href="imputation.html#generating-some-additional-variables"><i class="fa fa-check"></i><b>3.5</b> Generating Some Additional Variables</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="imputation.html"><a href="imputation.html#cateogry-cigarette-and-e-cigarette-use"><i class="fa fa-check"></i><b>3.5.1</b> 3-Cateogry Cigarette and E-Cigarette Use</a></li>
<li class="chapter" data-level="3.5.2" data-path="imputation.html"><a href="imputation.html#income-change-from-waves-1---2"><i class="fa fa-check"></i><b>3.5.2</b> Income Change from Waves 1 - 2</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="imputation.html"><a href="imputation.html#output-the-imputed-dataset"><i class="fa fa-check"></i><b>3.6</b> Output the Imputed Dataset</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="paramset.html"><a href="paramset.html"><i class="fa fa-check"></i><b>4</b> Generate Parameter Set</a>
<ul>
<li class="chapter" data-level="4.1" data-path="paramset.html"><a href="paramset.html#loading-necessary-packages-and-helper-functions"><i class="fa fa-check"></i><b>4.1</b> Loading Necessary Packages and Helper Functions</a></li>
<li class="chapter" data-level="4.2" data-path="paramset.html"><a href="paramset.html#set-some-hyperparamets-to-customize-parameter-set"><i class="fa fa-check"></i><b>4.2</b> Set Some Hyperparamets to Customize Parameter Set</a></li>
<li class="chapter" data-level="4.3" data-path="paramset.html"><a href="paramset.html#loading-our-dataset-and-defining-some-variables"><i class="fa fa-check"></i><b>4.3</b> Loading Our Dataset and Defining Some Variables</a></li>
<li class="chapter" data-level="4.4" data-path="paramset.html"><a href="paramset.html#defining-absolute-age-specific-income-transition-totals"><i class="fa fa-check"></i><b>4.4</b> Defining Absolute Age-Specific Income Transition Totals</a></li>
<li class="chapter" data-level="4.5" data-path="paramset.html"><a href="paramset.html#defining-cigarette-use-transitions"><i class="fa fa-check"></i><b>4.5</b> Defining Cigarette Use Transitions</a></li>
<li class="chapter" data-level="4.6" data-path="paramset.html"><a href="paramset.html#defining-e-cigarette-transitions"><i class="fa fa-check"></i><b>4.6</b> Defining E-Cigarette Transitions</a></li>
<li class="chapter" data-level="4.7" data-path="paramset.html"><a href="paramset.html#running-regression-analyses-to-extract-log-relative-risks"><i class="fa fa-check"></i><b>4.7</b> Running Regression Analyses to Extract Log-Relative Risks</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="paramset.html"><a href="paramset.html#defining-income-change-variable"><i class="fa fa-check"></i><b>4.7.1</b> Defining Income Change Variable</a></li>
<li class="chapter" data-level="4.7.2" data-path="paramset.html"><a href="paramset.html#cigarette-initiation-model"><i class="fa fa-check"></i><b>4.7.2</b> Cigarette Initiation Model</a></li>
<li class="chapter" data-level="4.7.3" data-path="paramset.html"><a href="paramset.html#cigarette-cessation-model"><i class="fa fa-check"></i><b>4.7.3</b> Cigarette Cessation Model</a></li>
<li class="chapter" data-level="4.7.4" data-path="paramset.html"><a href="paramset.html#cigarette-re-instatement-model"><i class="fa fa-check"></i><b>4.7.4</b> Cigarette Re-Instatement Model</a></li>
<li class="chapter" data-level="4.7.5" data-path="paramset.html"><a href="paramset.html#e-cigarette-initiation-model"><i class="fa fa-check"></i><b>4.7.5</b> E-Cigarette Initiation Model</a></li>
<li class="chapter" data-level="4.7.6" data-path="paramset.html"><a href="paramset.html#e-cigarette-cessation-model"><i class="fa fa-check"></i><b>4.7.6</b> E-Cigarette Cessation Model</a></li>
<li class="chapter" data-level="4.7.7" data-path="paramset.html"><a href="paramset.html#e-cigarette-reinstatement-model"><i class="fa fa-check"></i><b>4.7.7</b> E-Cigarette Reinstatement Model</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="paramset.html"><a href="paramset.html#drawing-our-parameter-set-samples"><i class="fa fa-check"></i><b>4.8</b> Drawing Our Parameter Set Samples</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="paramset.html"><a href="paramset.html#income-transitions-sample"><i class="fa fa-check"></i><b>4.8.1</b> Income Transitions Sample</a></li>
<li class="chapter" data-level="4.8.2" data-path="paramset.html"><a href="paramset.html#cigarette-transitions-sample"><i class="fa fa-check"></i><b>4.8.2</b> Cigarette Transitions Sample</a></li>
<li class="chapter" data-level="4.8.3" data-path="paramset.html"><a href="paramset.html#e-cigarette-transitions-sample"><i class="fa fa-check"></i><b>4.8.3</b> E-Cigarette Transitions Sample</a></li>
<li class="chapter" data-level="4.8.4" data-path="paramset.html"><a href="paramset.html#sampling-relative-risks"><i class="fa fa-check"></i><b>4.8.4</b> Sampling Relative Risks</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="paramset.html"><a href="paramset.html#generating-the-final-parameter-set-sampling"><i class="fa fa-check"></i><b>4.9</b> Generating the Final Parameter Set Sampling</a></li>
<li class="chapter" data-level="4.10" data-path="paramset.html"><a href="paramset.html#output-the-results"><i class="fa fa-check"></i><b>4.10</b> Output the Results</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="start.html"><a href="start.html"><i class="fa fa-check"></i><b>5</b> Initial Start State</a>
<ul>
<li class="chapter" data-level="5.1" data-path="start.html"><a href="start.html#stratifying-by-sex-and-age"><i class="fa fa-check"></i><b>5.1</b> Stratifying by Sex and Age</a></li>
<li class="chapter" data-level="5.2" data-path="start.html"><a href="start.html#stratifying-the-population-by-income-level"><i class="fa fa-check"></i><b>5.2</b> Stratifying the Population by Income Level</a></li>
<li class="chapter" data-level="5.3" data-path="start.html"><a href="start.html#distributing-cigarette-use"><i class="fa fa-check"></i><b>5.3</b> Distributing Cigarette Use</a></li>
<li class="chapter" data-level="5.4" data-path="start.html"><a href="start.html#distributing-e-cigarette-use"><i class="fa fa-check"></i><b>5.4</b> Distributing E-Cigarette Use</a></li>
<li class="chapter" data-level="5.5" data-path="start.html"><a href="start.html#saving-the-states"><i class="fa fa-check"></i><b>5.5</b> Saving the States</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="ode.html"><a href="ode.html"><i class="fa fa-check"></i><b>6</b> ODE Functions</a>
<ul>
<li class="chapter" data-level="6.1" data-path="ode.html"><a href="ode.html#ode-function"><i class="fa fa-check"></i><b>6.1</b> ODE Function</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="calibration.html"><a href="calibration.html"><i class="fa fa-check"></i><b>7</b> Calibration</a>
<ul>
<li class="chapter" data-level="7.1" data-path="calibration.html"><a href="calibration.html#load-the-necessary-libraries"><i class="fa fa-check"></i><b>7.1</b> Load the Necessary Libraries</a></li>
<li class="chapter" data-level="7.2" data-path="calibration.html"><a href="calibration.html#define-our-calibration-function"><i class="fa fa-check"></i><b>7.2</b> Define Our Calibration Function</a></li>
<li class="chapter" data-level="7.3" data-path="calibration.html"><a href="calibration.html#run-the-calibration"><i class="fa fa-check"></i><b>7.3</b> Run the Calibration</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="ref.html"><a href="ref.html"><i class="fa fa-check"></i><b>8</b> Run Primary Model and Income Scenario Analysis</a>
<ul>
<li class="chapter" data-level="8.1" data-path="ref.html"><a href="ref.html#run-primary-model"><i class="fa fa-check"></i><b>8.1</b> Run Primary Model</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="ref.html"><a href="ref.html#load-the-needed-libraries-and-functions"><i class="fa fa-check"></i><b>8.1.1</b> Load the Needed Libraries and Functions</a></li>
<li class="chapter" data-level="8.1.2" data-path="ref.html"><a href="ref.html#initialize-the-start-state-and-entry-object"><i class="fa fa-check"></i><b>8.1.2</b> Initialize the Start State and Entry Object</a></li>
<li class="chapter" data-level="8.1.3" data-path="ref.html"><a href="ref.html#load-appropraite-parameters"><i class="fa fa-check"></i><b>8.1.3</b> Load Appropraite Parameters</a></li>
<li class="chapter" data-level="8.1.4" data-path="ref.html"><a href="ref.html#actually-run-the-model"><i class="fa fa-check"></i><b>8.1.4</b> Actually Run the Model</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="ref.html"><a href="ref.html#run-high-income-scenario-analysis"><i class="fa fa-check"></i><b>8.2</b> Run High-Income Scenario Analysis</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="results.html"><a href="results.html"><i class="fa fa-check"></i><b>9</b> Results</a>
<ul>
<li class="chapter" data-level="9.1" data-path="results.html"><a href="results.html#calibration-confirmation"><i class="fa fa-check"></i><b>9.1</b> Calibration Confirmation</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="results.html"><a href="results.html#population-growth"><i class="fa fa-check"></i><b>9.1.1</b> Population Growth</a></li>
<li class="chapter" data-level="9.1.2" data-path="results.html"><a href="results.html#current-cigarette-use"><i class="fa fa-check"></i><b>9.1.2</b> Current Cigarette Use</a></li>
<li class="chapter" data-level="9.1.3" data-path="results.html"><a href="results.html#former-cigarette-use"><i class="fa fa-check"></i><b>9.1.3</b> Former Cigarette Use</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="results.html"><a href="results.html#scenario-analysis-results"><i class="fa fa-check"></i><b>9.2</b> Scenario Analysis Results</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="results.html"><a href="results.html#cigarette-prevalence"><i class="fa fa-check"></i><b>9.2.1</b> Cigarette Prevalence</a></li>
<li class="chapter" data-level="9.2.2" data-path="results.html"><a href="results.html#population-attributable-fraction"><i class="fa fa-check"></i><b>9.2.2</b> Population Attributable Fraction</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aim #2: Mathematical Model</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ode" class="section level1" number="6">
<h1><span class="header-section-number">Chapter 6</span> ODE Functions</h1>
<p>Prior to the next steps, we need to define the ODE (ordinary differential equations) solver for our model. This function is what we will call to run the model. So we need to define it prior to both the calibration and simulations steps. While the model is described in full detail in the manuscript, the main thing is that this model stratifies the population across 5 factors: age, sex, cigarette use status, e-cigarette use status, and household income.</p>
<p>A few notes on the implementation of the model:</p>
<ul>
<li>We use a dimensional coding strategy</li>
<li>We only permit transitions across one strata at a time</li>
<li>To improve runtime, the function is sex specific
<ul>
<li>No transitions are permitted across sex so can run separately</li>
<li>As shall be shown in the calibration and simulation stages, we will parallelize the running of the model across sex to improve runtime</li>
</ul></li>
<li>Finally, the function is intended to be run for initial never, current, and former smokers
<ul>
<li>By stratifying model runs, we are able to explore the impact of income on cigarette use amongst specific sub-populations</li>
</ul></li>
<li>Lastly, R is not the fastest language for coding ODE models
<ul>
<li>While R has many excellent features, speed is not one of them</li>
<li>In particular, R has a hard time with for loops and if-else statements</li>
<li>R runs faster when objects are vectorized (as opposed to running loops)</li>
<li>As such, we have minimized the number of loops (some are necessary)</li>
<li>And we have included no if-else statements in the code
<ul>
<li>Instead we frequently use boolean vectors which have 0s and 1s and use multiplication to get the same results as if-else statements without sacrificing runtime</li>
</ul></li>
</ul></li>
</ul>
<div id="ode-function" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> ODE Function</h2>
<p>The ODE function is included below. Because it is a single function, it must be presented within one code chunk. Comments in the code are provided to clarify how the model functions:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="ode.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb39-2"><a href="ode.html#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="do">## To be in alignment with the functionality of the deSolve package which runs the ODE</span></span>
<span id="cb39-3"><a href="ode.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="do">## We have 3 arguments fed into the function: t for time, states, and parameters</span></span>
<span id="cb39-4"><a href="ode.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="do">## For this model, we largely ignore the t argument, as model doesn&#39;t behave differently at different times</span></span>
<span id="cb39-5"><a href="ode.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb39-6"><a href="ode.html#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="ode.html#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb39-8"><a href="ode.html#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="do">## An additional note, this model is intended to be run for men and women separately and to be run separately for </span></span>
<span id="cb39-9"><a href="ode.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="do">## never smokers, current smokers, and former smokers at t = 0.</span></span>
<span id="cb39-10"><a href="ode.html#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="do">## The code can be modified to be run on the whole population, but the current approach provides two benefits:</span></span>
<span id="cb39-11"><a href="ode.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="do">##    1) We can parallelize the code to have it run faster</span></span>
<span id="cb39-12"><a href="ode.html#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="do">##    2) We can compare the impact of income among people who are never, current, and former smokers at the start.</span></span>
<span id="cb39-13"><a href="ode.html#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="do">##       This is cool because we are curious if say income drives initiation, cessation, and reinstatement at different rates</span></span>
<span id="cb39-14"><a href="ode.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="do">##</span></span>
<span id="cb39-15"><a href="ode.html#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="ode.html#cb39-16" aria-hidden="true" tabindex="-1"></a>ODE_function <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb39-17"><a href="ode.html#cb39-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-18"><a href="ode.html#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="do">## First we convert the states vector into an array</span></span>
<span id="cb39-19"><a href="ode.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="do">## In this format, states is a 5-D array such that states[age,sex,cig,e-cig,income] corresponds to a compartment in the model</span></span>
<span id="cb39-20"><a href="ode.html#cb39-20" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb39-21"><a href="ode.html#cb39-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-22"><a href="ode.html#cb39-22" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb39-23"><a href="ode.html#cb39-23" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For ease of reading and practical purposes, we highlight the number of categories for each strata</span></span>
<span id="cb39-24"><a href="ode.html#cb39-24" aria-hidden="true" tabindex="-1"></a>  <span class="do">## And we, in the comments, highlight which values correspond with which levels</span></span>
<span id="cb39-25"><a href="ode.html#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Keeping this handy can help with navigating what each step is doing</span></span>
<span id="cb39-26"><a href="ode.html#cb39-26" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb39-27"><a href="ode.html#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb39-28"><a href="ode.html#cb39-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-29"><a href="ode.html#cb39-29" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb39-30"><a href="ode.html#cb39-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb39-31"><a href="ode.html#cb39-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-32"><a href="ode.html#cb39-32" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb39-33"><a href="ode.html#cb39-33" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb39-34"><a href="ode.html#cb39-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-35"><a href="ode.html#cb39-35" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb39-36"><a href="ode.html#cb39-36" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb39-37"><a href="ode.html#cb39-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-38"><a href="ode.html#cb39-38" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb39-39"><a href="ode.html#cb39-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb39-40"><a href="ode.html#cb39-40" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb39-41"><a href="ode.html#cb39-41" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb39-42"><a href="ode.html#cb39-42" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb39-43"><a href="ode.html#cb39-43" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb39-44"><a href="ode.html#cb39-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-45"><a href="ode.html#cb39-45" aria-hidden="true" tabindex="-1"></a>  <span class="do">## While we sampled transition rates for cig use, e-cig use, and income</span></span>
<span id="cb39-46"><a href="ode.html#cb39-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We can hard code age transitions because age has a discrete relationship with time</span></span>
<span id="cb39-47"><a href="ode.html#cb39-47" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Thus, the transition is 1/(time spent in compartment)</span></span>
<span id="cb39-48"><a href="ode.html#cb39-48" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For example, an 18 year old would spend 7 years in the 18-24 year old compartment</span></span>
<span id="cb39-49"><a href="ode.html#cb39-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Thus the transition rate is 1/7</span></span>
<span id="cb39-50"><a href="ode.html#cb39-50" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb39-51"><a href="ode.html#cb39-51" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-52"><a href="ode.html#cb39-52" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This vector was created to avoid the use of an if-statement. It&#39;s application is detailed later.</span></span>
<span id="cb39-53"><a href="ode.html#cb39-53" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb39-54"><a href="ode.html#cb39-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-55"><a href="ode.html#cb39-55" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For calculating transitions between income compartments</span></span>
<span id="cb39-56"><a href="ode.html#cb39-56" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We need to know, first, which income compartmens feed into a given compartment</span></span>
<span id="cb39-57"><a href="ode.html#cb39-57" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This list provides vectors which correspond to which compartments can feed the given compartment</span></span>
<span id="cb39-58"><a href="ode.html#cb39-58" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For example, income_transition_sources[8] indicates that a person can transition from compartments 4, 5, 9, 12, or 13 into compartment 8</span></span>
<span id="cb39-59"><a href="ode.html#cb39-59" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb39-60"><a href="ode.html#cb39-60" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb39-61"><a href="ode.html#cb39-61" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb39-62"><a href="ode.html#cb39-62" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb39-63"><a href="ode.html#cb39-63" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb39-64"><a href="ode.html#cb39-64" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb39-65"><a href="ode.html#cb39-65" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb39-66"><a href="ode.html#cb39-66" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb39-67"><a href="ode.html#cb39-67" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb39-68"><a href="ode.html#cb39-68" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb39-69"><a href="ode.html#cb39-69" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb39-70"><a href="ode.html#cb39-70" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb39-71"><a href="ode.html#cb39-71" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb39-72"><a href="ode.html#cb39-72" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-73"><a href="ode.html#cb39-73" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Second, we need to know which income compartments a person can transition to from their current one</span></span>
<span id="cb39-74"><a href="ode.html#cb39-74" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For example, income_transition_landings[8] indicates that a person can transition from compartment8 to compartments 3, 6, 7, 12, or 13 </span></span>
<span id="cb39-75"><a href="ode.html#cb39-75" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb39-76"><a href="ode.html#cb39-76" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb39-77"><a href="ode.html#cb39-77" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb39-78"><a href="ode.html#cb39-78" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb39-79"><a href="ode.html#cb39-79" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb39-80"><a href="ode.html#cb39-80" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb39-81"><a href="ode.html#cb39-81" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb39-82"><a href="ode.html#cb39-82" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb39-83"><a href="ode.html#cb39-83" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb39-84"><a href="ode.html#cb39-84" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb39-85"><a href="ode.html#cb39-85" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb39-86"><a href="ode.html#cb39-86" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb39-87"><a href="ode.html#cb39-87" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb39-88"><a href="ode.html#cb39-88" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-89"><a href="ode.html#cb39-89" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb39-90"><a href="ode.html#cb39-90" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb39-91"><a href="ode.html#cb39-91" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb39-92"><a href="ode.html#cb39-92" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb39-93"><a href="ode.html#cb39-93" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-94"><a href="ode.html#cb39-94" aria-hidden="true" tabindex="-1"></a>  <span class="do">## These are the income transition rates that were sampled and fed into the function along with the parameters</span></span>
<span id="cb39-95"><a href="ode.html#cb39-95" aria-hidden="true" tabindex="-1"></a>  <span class="do">## They only correspond to transitions between the 5 income levels, the ODE solver will handle identifying which specific compartments the transitions occur between</span></span>
<span id="cb39-96"><a href="ode.html#cb39-96" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb39-97"><a href="ode.html#cb39-97" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-98"><a href="ode.html#cb39-98" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the transitionary compartments assuming that they stay at the same income</span></span>
<span id="cb39-99"><a href="ode.html#cb39-99" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For this modeling project, the value is hard-coded at zero -- however, we leave this here so that future efforts may easily modify this value if desired.</span></span>
<span id="cb39-100"><a href="ode.html#cb39-100" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb39-101"><a href="ode.html#cb39-101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-102"><a href="ode.html#cb39-102" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We then get the sampled cigarette and e-cigarette transition rates from the parameters</span></span>
<span id="cb39-103"><a href="ode.html#cb39-103" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb39-104"><a href="ode.html#cb39-104" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb39-105"><a href="ode.html#cb39-105" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-106"><a href="ode.html#cb39-106" aria-hidden="true" tabindex="-1"></a>  <span class="do">## While we extracted the abolsute transition rates for cigarette use from the PATH data,</span></span>
<span id="cb39-107"><a href="ode.html#cb39-107" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We believe that these absolute rates may be biased in ways that the weighting strategy did not control for</span></span>
<span id="cb39-108"><a href="ode.html#cb39-108" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The initiation modifier and cessation modifier are applied to calibrate the cigarette initiation and cessation absolute rates</span></span>
<span id="cb39-109"><a href="ode.html#cb39-109" aria-hidden="true" tabindex="-1"></a>  <span class="do">## so that the model accurately projects historical cigarette use data</span></span>
<span id="cb39-110"><a href="ode.html#cb39-110" aria-hidden="true" tabindex="-1"></a>  <span class="do">## As a reminder, this model is initialized for the year 2014 and we have cigarette data through 2019 (as of writing this)</span></span>
<span id="cb39-111"><a href="ode.html#cb39-111" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Therefore, we want to ensure that our model accurately projects the cigarette use prevalence and former cigarette use prevalence of the overall population over that 5 year period</span></span>
<span id="cb39-112"><a href="ode.html#cb39-112" aria-hidden="true" tabindex="-1"></a>  initiation_mod <span class="ot">&lt;-</span> parameters[<span class="dv">3061</span>]</span>
<span id="cb39-113"><a href="ode.html#cb39-113" aria-hidden="true" tabindex="-1"></a>  cessation_mod <span class="ot">&lt;-</span> parameters[<span class="dv">3062</span>]</span>
<span id="cb39-114"><a href="ode.html#cb39-114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-115"><a href="ode.html#cb39-115" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Apply the initiation modifier</span></span>
<span id="cb39-116"><a href="ode.html#cb39-116" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>initiation_mod</span>
<span id="cb39-117"><a href="ode.html#cb39-117" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-118"><a href="ode.html#cb39-118" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Apply the cessation modifier</span></span>
<span id="cb39-119"><a href="ode.html#cb39-119" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>cessation_mod</span>
<span id="cb39-120"><a href="ode.html#cb39-120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-121"><a href="ode.html#cb39-121" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Next we want to identify our sampled relative risks, these will be applied to modify transitions between comaprtments</span></span>
<span id="cb39-122"><a href="ode.html#cb39-122" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-123"><a href="ode.html#cb39-123" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-124"><a href="ode.html#cb39-124" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-125"><a href="ode.html#cb39-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-126"><a href="ode.html#cb39-126" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-127"><a href="ode.html#cb39-127" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-128"><a href="ode.html#cb39-128" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-129"><a href="ode.html#cb39-129" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-130"><a href="ode.html#cb39-130" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This rr_e_cigarette transitions object was created to avoid the use of a series of if-statements</span></span>
<span id="cb39-131"><a href="ode.html#cb39-131" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Depending on which e-cigarette value the model is currently considering, this array can be called to get the appropriate RR without needing to use an if-else series</span></span>
<span id="cb39-132"><a href="ode.html#cb39-132" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb39-133"><a href="ode.html#cb39-133" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb39-134"><a href="ode.html#cb39-134" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb39-135"><a href="ode.html#cb39-135" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb39-136"><a href="ode.html#cb39-136" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-137"><a href="ode.html#cb39-137" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Similarly, this vector is to avoid the use of an if-statement</span></span>
<span id="cb39-138"><a href="ode.html#cb39-138" aria-hidden="true" tabindex="-1"></a>  <span class="do">## cig_out[x] = the compartment that one can get to from x</span></span>
<span id="cb39-139"><a href="ode.html#cb39-139" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = never, 2 = current, 3 = former so we see that </span></span>
<span id="cb39-140"><a href="ode.html#cb39-140" aria-hidden="true" tabindex="-1"></a>  <span class="do">## cig_ou[1] = 2 means that the only cigarette transition from never use is to current use</span></span>
<span id="cb39-141"><a href="ode.html#cb39-141" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb39-142"><a href="ode.html#cb39-142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-143"><a href="ode.html#cb39-143" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Similarly, this list of vectors represents which compartments transitions can occur from</span></span>
<span id="cb39-144"><a href="ode.html#cb39-144" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For example, no compartments feed the never smoker compartment</span></span>
<span id="cb39-145"><a href="ode.html#cb39-145" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the current smoker compartment can be fed by never smoker and former smoker</span></span>
<span id="cb39-146"><a href="ode.html#cb39-146" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb39-147"><a href="ode.html#cb39-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-148"><a href="ode.html#cb39-148" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb39-149"><a href="ode.html#cb39-149" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Finally need death parameters</span></span>
<span id="cb39-150"><a href="ode.html#cb39-150" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Will use CDC life tables to get death https://www.cdc.gov/nchs/products/life_tables.htm</span></span>
<span id="cb39-151"><a href="ode.html#cb39-151" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Will stratify death rates by age and sex</span></span>
<span id="cb39-152"><a href="ode.html#cb39-152" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Death rate is computed as follows:</span></span>
<span id="cb39-153"><a href="ode.html#cb39-153" aria-hidden="true" tabindex="-1"></a>  <span class="do">## First, the probability of death between ages X and X+1 were extracted from the lifetable</span></span>
<span id="cb39-154"><a href="ode.html#cb39-154" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For each age range, the median probability was sampled</span></span>
<span id="cb39-155"><a href="ode.html#cb39-155" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the over 65 group, we exlcuded the &gt;100 category because the probability of death was 100%</span></span>
<span id="cb39-156"><a href="ode.html#cb39-156" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The probabilities were then converted into rates using the formula: rate = -ln(1 - probability)</span></span>
<span id="cb39-157"><a href="ode.html#cb39-157" aria-hidden="true" tabindex="-1"></a>  death_rates <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,sex_types<span class="sc">*</span>age_types), <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types))</span>
<span id="cb39-158"><a href="ode.html#cb39-158" aria-hidden="true" tabindex="-1"></a>  death_rates[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.001286</span>, <span class="fl">0.001835</span>, <span class="fl">0.002426</span>, <span class="fl">0.004763</span>, <span class="fl">0.011045</span>, <span class="fl">0.069452</span>))</span>
<span id="cb39-159"><a href="ode.html#cb39-159" aria-hidden="true" tabindex="-1"></a>  death_rates[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.000471</span>, <span class="fl">0.000801</span>, <span class="fl">0.001373</span>, <span class="fl">0.002971</span>, <span class="fl">0.006655</span>, <span class="fl">0.051681</span>))</span>
<span id="cb39-160"><a href="ode.html#cb39-160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-161"><a href="ode.html#cb39-161" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb39-162"><a href="ode.html#cb39-162" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We also need excess mortality related to cigarette use</span></span>
<span id="cb39-163"><a href="ode.html#cb39-163" aria-hidden="true" tabindex="-1"></a>  <span class="do">## These RRs were extracted from DOI: </span></span>
<span id="cb39-164"><a href="ode.html#cb39-164" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,sex_types<span class="sc">*</span>cigarette_types), <span class="at">dim =</span> <span class="fu">c</span>(sex_types,cigarette_types))</span>
<span id="cb39-165"><a href="ode.html#cb39-165" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-166"><a href="ode.html#cb39-166" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.24</span>,<span class="fl">1.30</span>) </span>
<span id="cb39-167"><a href="ode.html#cb39-167" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.29</span>,<span class="fl">1.35</span>)</span>
<span id="cb39-168"><a href="ode.html#cb39-168" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-169"><a href="ode.html#cb39-169" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Entries Multiplier is used to avoid the use of an if-statement</span></span>
<span id="cb39-170"><a href="ode.html#cb39-170" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We only want entries to occur for the 18-24 group</span></span>
<span id="cb39-171"><a href="ode.html#cb39-171" aria-hidden="true" tabindex="-1"></a>  <span class="do">## so we use entries[age] to get the appropriate multiplier</span></span>
<span id="cb39-172"><a href="ode.html#cb39-172" aria-hidden="true" tabindex="-1"></a>  <span class="do">## we return 1 for 18-24 and 0 for all other ages</span></span>
<span id="cb39-173"><a href="ode.html#cb39-173" aria-hidden="true" tabindex="-1"></a>  entries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb39-174"><a href="ode.html#cb39-174" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-175"><a href="ode.html#cb39-175" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for entries, we need the population growth rate</span></span>
<span id="cb39-176"><a href="ode.html#cb39-176" aria-hidden="true" tabindex="-1"></a>  <span class="do">## we will apply this growth rate to the entry totals in the younglings object to calibrate to the correct population growth from 2014-2019 </span></span>
<span id="cb39-177"><a href="ode.html#cb39-177" aria-hidden="true" tabindex="-1"></a>  growth_rate <span class="ot">&lt;-</span> parameters[<span class="dv">3060</span>]</span>
<span id="cb39-178"><a href="ode.html#cb39-178" aria-hidden="true" tabindex="-1"></a>  carrying_capacity <span class="ot">&lt;-</span> parameters[<span class="dv">3063</span>]</span>
<span id="cb39-179"><a href="ode.html#cb39-179" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-180"><a href="ode.html#cb39-180" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The younglings object is also to account for an issue raised with parellizing the model</span></span>
<span id="cb39-181"><a href="ode.html#cb39-181" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This then allows us to feed the correct number of entries into each cell of the model regardless of the fact that the model is split into 6 sub-models</span></span>
<span id="cb39-182"><a href="ode.html#cb39-182" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Essentially, a primary issue is that the the use of tobacco products is drastically changing among youth starting with the widespread adoption of e-cigs</span></span>
<span id="cb39-183"><a href="ode.html#cb39-183" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This change began to occur during the study period. Recent estimates have indicated that in 2019 that only 5% of high schoolers smoker but over 20% use e-cigs (https://jamanetwork.com/journals/jama/fullarticle/2755265#:~:text=In%202019%2C%20an%20estimated%2027.5,use%20of%20any%20tobacco%20product.)</span></span>
<span id="cb39-184"><a href="ode.html#cb39-184" aria-hidden="true" tabindex="-1"></a>  <span class="do">## As such, we created the younglings object to represent the number of compartment entries into the model</span></span>
<span id="cb39-185"><a href="ode.html#cb39-185" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The younglings object assumes a greater prevalence of e-cig use than cigarette use</span></span>
<span id="cb39-186"><a href="ode.html#cb39-186" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Data also indicates that the 18-24 year old smoking prevalence declined from around 17% in 2014 to only 8% in 2019</span></span>
<span id="cb39-187"><a href="ode.html#cb39-187" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Further, the number of former smokers has not changed much despite a drop in current cigarette users</span></span>
<span id="cb39-188"><a href="ode.html#cb39-188" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This phenomenon appears to be explained by the lower rates of cigarette use among youth</span></span>
<span id="cb39-189"><a href="ode.html#cb39-189" aria-hidden="true" tabindex="-1"></a>  younglings <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2979</span><span class="sc">:</span><span class="dv">3056</span>], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">13</span>))</span>
<span id="cb39-190"><a href="ode.html#cb39-190" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-191"><a href="ode.html#cb39-191" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We apply the growth rate here to ensure the population growth is calibrated appropriately.</span></span>
<span id="cb39-192"><a href="ode.html#cb39-192" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Technically, the US population has been declining for several years</span></span>
<span id="cb39-193"><a href="ode.html#cb39-193" aria-hidden="true" tabindex="-1"></a>  <span class="do">## So we also want to apply a decay function so that the trajectory of the population increase is declining</span></span>
<span id="cb39-194"><a href="ode.html#cb39-194" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The exponentiated term should result in the growth rate having diminished impact over time</span></span>
<span id="cb39-195"><a href="ode.html#cb39-195" aria-hidden="true" tabindex="-1"></a>  younglings <span class="ot">&lt;-</span> younglings<span class="sc">*</span>(growth_rate)<span class="sc">*</span>((carrying_capacity <span class="sc">-</span> <span class="fu">sum</span>(<span class="fu">toVector</span>(states)))<span class="sc">/</span>carrying_capacity)</span>
<span id="cb39-196"><a href="ode.html#cb39-196" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-197"><a href="ode.html#cb39-197" aria-hidden="true" tabindex="-1"></a>  <span class="do">## To avoid an if-statement, this is used to indicate if the model is for never smokers at t = 0, current, or former.</span></span>
<span id="cb39-198"><a href="ode.html#cb39-198" aria-hidden="true" tabindex="-1"></a>  youngling_mult <span class="ot">&lt;-</span> parameters[<span class="dv">3057</span><span class="sc">:</span><span class="dv">3059</span>]</span>
<span id="cb39-199"><a href="ode.html#cb39-199" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-200"><a href="ode.html#cb39-200" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the transition values</span></span>
<span id="cb39-201"><a href="ode.html#cb39-201" aria-hidden="true" tabindex="-1"></a>  <span class="do">## If states is where the model starts at a given time step, then ODEs is where we land</span></span>
<span id="cb39-202"><a href="ode.html#cb39-202" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb39-203"><a href="ode.html#cb39-203" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object we we will return at the end</span></span>
<span id="cb39-204"><a href="ode.html#cb39-204" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb39-205"><a href="ode.html#cb39-205" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-206"><a href="ode.html#cb39-206" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Finally, since the model is run on one sex, which we extract here</span></span>
<span id="cb39-207"><a href="ode.html#cb39-207" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> parameters[<span class="dv">2978</span>]</span>
<span id="cb39-208"><a href="ode.html#cb39-208" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-209"><a href="ode.html#cb39-209" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This allows us to identify which sex we are not currently modeling</span></span>
<span id="cb39-210"><a href="ode.html#cb39-210" aria-hidden="true" tabindex="-1"></a>  not_sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-211"><a href="ode.html#cb39-211" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sex <span class="sc">==</span> <span class="dv">1</span>){not_sex <span class="ot">&lt;-</span> <span class="dv">2</span>}</span>
<span id="cb39-212"><a href="ode.html#cb39-212" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-213"><a href="ode.html#cb39-213" aria-hidden="true" tabindex="-1"></a>  <span class="do">## And we can assign all ODE results for the opposite sex equal to 0</span></span>
<span id="cb39-214"><a href="ode.html#cb39-214" aria-hidden="true" tabindex="-1"></a>  ODEs[not_sex,,,,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-215"><a href="ode.html#cb39-215" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-216"><a href="ode.html#cb39-216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-217"><a href="ode.html#cb39-217" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb39-218"><a href="ode.html#cb39-218" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Now we are ready to loop through our compartments and update transitions</span></span>
<span id="cb39-219"><a href="ode.html#cb39-219" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We are going to loop through income, e_cigarette, and age categories</span></span>
<span id="cb39-220"><a href="ode.html#cb39-220" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We don&#39;t need to loop through sex because the model is run separately based on sex</span></span>
<span id="cb39-221"><a href="ode.html#cb39-221" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Instead of looping through cigarette use, we essentially write all of our transition statements in relation to each cigarette status</span></span>
<span id="cb39-222"><a href="ode.html#cb39-222" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Thus, while we loop through each of the other strata, we write 3 specific transition equations, one for the never smoker category, one for current, and one for former</span></span>
<span id="cb39-223"><a href="ode.html#cb39-223" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is referred to as dimensional coding, though I have seen few to no sources that go into the practice</span></span>
<span id="cb39-224"><a href="ode.html#cb39-224" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-225"><a href="ode.html#cb39-225" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We have income as the outermost loop to dimish the number of times we need to call the sources and landings list (lists go slow, arrays go fast)</span></span>
<span id="cb39-226"><a href="ode.html#cb39-226" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We loop through each income compartment number</span></span>
<span id="cb39-227"><a href="ode.html#cb39-227" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb39-228"><a href="ode.html#cb39-228" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-229"><a href="ode.html#cb39-229" aria-hidden="true" tabindex="-1"></a>    <span class="do">## We extract the sources and landings for this income compartment outside of the other loops to improve runtime</span></span>
<span id="cb39-230"><a href="ode.html#cb39-230" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb39-231"><a href="ode.html#cb39-231" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb39-232"><a href="ode.html#cb39-232" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-233"><a href="ode.html#cb39-233" aria-hidden="true" tabindex="-1"></a>    <span class="do">## Next we loop through e_cigarette status (minimize number of times we call the cig_in list)</span></span>
<span id="cb39-234"><a href="ode.html#cb39-234" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb39-235"><a href="ode.html#cb39-235" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-236"><a href="ode.html#cb39-236" aria-hidden="true" tabindex="-1"></a>      <span class="do">## We extract the transition source values outside the next loop to improve runtime</span></span>
<span id="cb39-237"><a href="ode.html#cb39-237" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb39-238"><a href="ode.html#cb39-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-239"><a href="ode.html#cb39-239" aria-hidden="true" tabindex="-1"></a>      <span class="do">## Finally we loop through age</span></span>
<span id="cb39-240"><a href="ode.html#cb39-240" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb39-241"><a href="ode.html#cb39-241" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-242"><a href="ode.html#cb39-242" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-243"><a href="ode.html#cb39-243" aria-hidden="true" tabindex="-1"></a>        <span class="do">## As noted, 3 equations will be defined total, one for each of the three cigarette states. </span></span>
<span id="cb39-244"><a href="ode.html#cb39-244" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Prior to defining these equations we need to define the number of people moving into or out of the given compartment based on each strata</span></span>
<span id="cb39-245"><a href="ode.html#cb39-245" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-246"><a href="ode.html#cb39-246" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-247"><a href="ode.html#cb39-247" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb39-248"><a href="ode.html#cb39-248" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-249"><a href="ode.html#cb39-249" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-250"><a href="ode.html#cb39-250" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb39-251"><a href="ode.html#cb39-251" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people aging into the compartment is defined by two terms. </span></span>
<span id="cb39-252"><a href="ode.html#cb39-252" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The first term is intended to capture the number of people who age out of the income group one below into the current one</span></span>
<span id="cb39-253"><a href="ode.html#cb39-253" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The c(0,age_transitions)[age] shifts the age_transitions appropriately such that no people in the model are able to age into the 18-24 group</span></span>
<span id="cb39-254"><a href="ode.html#cb39-254" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The second term is intended to capture the number of entries into the compartment (i.e. people aging from 17 to 18)</span></span>
<span id="cb39-255"><a href="ode.html#cb39-255" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The entries[age] ensures that entries are only added to the 18-24 compartments and the youngling_mult ensures that only the appropriate</span></span>
<span id="cb39-256"><a href="ode.html#cb39-256" aria-hidden="true" tabindex="-1"></a>        <span class="do">## starting cigarette state is allowed to enter. For example, if we are running the model on never smokers, then we only want to allow model entries</span></span>
<span id="cb39-257"><a href="ode.html#cb39-257" aria-hidden="true" tabindex="-1"></a>        <span class="do">## into the never smoking compartments. Entries to other compartments will be handled by other iterations of the model</span></span>
<span id="cb39-258"><a href="ode.html#cb39-258" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age] <span class="sc">+</span> entries[age]<span class="sc">*</span>younglings[sex,e_cigarette,income]<span class="sc">*</span>youngling_mult[<span class="dv">1</span>]</span>
<span id="cb39-259"><a href="ode.html#cb39-259" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-260"><a href="ode.html#cb39-260" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb39-261"><a href="ode.html#cb39-261" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the number of people in the compartment times</span></span>
<span id="cb39-262"><a href="ode.html#cb39-262" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb39-263"><a href="ode.html#cb39-263" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb39-264"><a href="ode.html#cb39-264" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-265"><a href="ode.html#cb39-265" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb39-266"><a href="ode.html#cb39-266" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-267"><a href="ode.html#cb39-267" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb39-268"><a href="ode.html#cb39-268" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb39-269"><a href="ode.html#cb39-269" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb39-270"><a href="ode.html#cb39-270" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb39-271"><a href="ode.html#cb39-271" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb39-272"><a href="ode.html#cb39-272" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-273"><a href="ode.html#cb39-273" aria-hidden="true" tabindex="-1"></a>        <span class="do">## We start by creating a variable to store the number of income transitions into the current compartment</span></span>
<span id="cb39-274"><a href="ode.html#cb39-274" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-275"><a href="ode.html#cb39-275" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-276"><a href="ode.html#cb39-276" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb39-277"><a href="ode.html#cb39-277" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb39-278"><a href="ode.html#cb39-278" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb39-279"><a href="ode.html#cb39-279" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb39-280"><a href="ode.html#cb39-280" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-281"><a href="ode.html#cb39-281" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb39-282"><a href="ode.html#cb39-282" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb39-283"><a href="ode.html#cb39-283" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb39-284"><a href="ode.html#cb39-284" aria-hidden="true" tabindex="-1"></a>          <span class="do">## We have commented out the staging modifier code, however, because for this model we aren&#39;t using it</span></span>
<span id="cb39-285"><a href="ode.html#cb39-285" aria-hidden="true" tabindex="-1"></a>          <span class="do">## and the if statement slows downrun time. </span></span>
<span id="cb39-286"><a href="ode.html#cb39-286" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-287"><a href="ode.html#cb39-287" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-288"><a href="ode.html#cb39-288" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Uncomment the following lines of code if you wish to use the staging compartment</span></span>
<span id="cb39-289"><a href="ode.html#cb39-289" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb39-290"><a href="ode.html#cb39-290" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb39-291"><a href="ode.html#cb39-291" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb39-292"><a href="ode.html#cb39-292" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-293"><a href="ode.html#cb39-293" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb39-294"><a href="ode.html#cb39-294" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb39-295"><a href="ode.html#cb39-295" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb39-296"><a href="ode.html#cb39-296" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb39-297"><a href="ode.html#cb39-297" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-298"><a href="ode.html#cb39-298" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-299"><a href="ode.html#cb39-299" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-300"><a href="ode.html#cb39-300" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb39-301"><a href="ode.html#cb39-301" aria-hidden="true" tabindex="-1"></a>        <span class="do">## We again need to account for the set of income compartments people in the current compartment can transition to</span></span>
<span id="cb39-302"><a href="ode.html#cb39-302" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-303"><a href="ode.html#cb39-303" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-304"><a href="ode.html#cb39-304" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb39-305"><a href="ode.html#cb39-305" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb39-306"><a href="ode.html#cb39-306" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-307"><a href="ode.html#cb39-307" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb39-308"><a href="ode.html#cb39-308" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-309"><a href="ode.html#cb39-309" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-310"><a href="ode.html#cb39-310" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-311"><a href="ode.html#cb39-311" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If you wish to use the staging modifier variable, uncomment this code</span></span>
<span id="cb39-312"><a href="ode.html#cb39-312" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb39-313"><a href="ode.html#cb39-313" aria-hidden="true" tabindex="-1"></a>          <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb39-314"><a href="ode.html#cb39-314" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb39-315"><a href="ode.html#cb39-315" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-316"><a href="ode.html#cb39-316" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For a given landing, the income transition is calculated via the income transition rates</span></span>
<span id="cb39-317"><a href="ode.html#cb39-317" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb39-318"><a href="ode.html#cb39-318" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-319"><a href="ode.html#cb39-319" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-320"><a href="ode.html#cb39-320" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-321"><a href="ode.html#cb39-321" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb39-322"><a href="ode.html#cb39-322" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-323"><a href="ode.html#cb39-323" aria-hidden="true" tabindex="-1"></a>        <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb39-324"><a href="ode.html#cb39-324" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-325"><a href="ode.html#cb39-325" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb39-326"><a href="ode.html#cb39-326" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-327"><a href="ode.html#cb39-327" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb39-328"><a href="ode.html#cb39-328" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Here the number of initiations is the cigarette initiation rate times the appropriate relative risk</span></span>
<span id="cb39-329"><a href="ode.html#cb39-329" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb39-330"><a href="ode.html#cb39-330" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-331"><a href="ode.html#cb39-331" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb39-332"><a href="ode.html#cb39-332" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-333"><a href="ode.html#cb39-333" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette In</span></span>
<span id="cb39-334"><a href="ode.html#cb39-334" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The following line of code was developed to avoid the use of a costly if-else sequence</span></span>
<span id="cb39-335"><a href="ode.html#cb39-335" aria-hidden="true" tabindex="-1"></a>        <span class="do">## We calculate the proportion of people who would transition from every potential e-cig category to the current compartment</span></span>
<span id="cb39-336"><a href="ode.html#cb39-336" aria-hidden="true" tabindex="-1"></a>        <span class="do">## But we use the e_cig_in object to make sure we only add the one that we want</span></span>
<span id="cb39-337"><a href="ode.html#cb39-337" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Avoiding if-else statements has made this a slightly challenging bit of code to parse</span></span>
<span id="cb39-338"><a href="ode.html#cb39-338" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Mapping out each potential e-cig value on paper can help display the appropriateness</span></span>
<span id="cb39-339"><a href="ode.html#cb39-339" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb39-340"><a href="ode.html#cb39-340" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb39-341"><a href="ode.html#cb39-341" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb39-342"><a href="ode.html#cb39-342" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-343"><a href="ode.html#cb39-343" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-344"><a href="ode.html#cb39-344" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Out </span></span>
<span id="cb39-345"><a href="ode.html#cb39-345" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This is more straightforward as only one out pathway is possible from each compartment</span></span>
<span id="cb39-346"><a href="ode.html#cb39-346" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Take the number of people in the current compartment and apply the appropriate e_cigarette rate and RRs</span></span>
<span id="cb39-347"><a href="ode.html#cb39-347" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb39-348"><a href="ode.html#cb39-348" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-349"><a href="ode.html#cb39-349" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Finally, we must account for death in the model</span></span>
<span id="cb39-350"><a href="ode.html#cb39-350" aria-hidden="true" tabindex="-1"></a>        <span class="do">## We apply the death rates and excess death rates due to cigarette use to get the number of deaths</span></span>
<span id="cb39-351"><a href="ode.html#cb39-351" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">1</span>] </span>
<span id="cb39-352"><a href="ode.html#cb39-352" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-353"><a href="ode.html#cb39-353" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 1</span></span>
<span id="cb39-354"><a href="ode.html#cb39-354" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Finally, we define our full equation for this compartment</span></span>
<span id="cb39-355"><a href="ode.html#cb39-355" aria-hidden="true" tabindex="-1"></a>        <span class="do">## We store this value into the ODEs object which we will return</span></span>
<span id="cb39-356"><a href="ode.html#cb39-356" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb39-357"><a href="ode.html#cb39-357" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-358"><a href="ode.html#cb39-358" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-359"><a href="ode.html#cb39-359" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The following two equations are defined in a nearly identical fashion, with adjustments made based upon the cigarette compartment</span></span>
<span id="cb39-360"><a href="ode.html#cb39-360" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Given similarities, comments throughout are minimal and earlier comments should be referenced.</span></span>
<span id="cb39-361"><a href="ode.html#cb39-361" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-362"><a href="ode.html#cb39-362" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-363"><a href="ode.html#cb39-363" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-364"><a href="ode.html#cb39-364" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb39-365"><a href="ode.html#cb39-365" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-366"><a href="ode.html#cb39-366" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-367"><a href="ode.html#cb39-367" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb39-368"><a href="ode.html#cb39-368" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age] <span class="sc">+</span> entries[age]<span class="sc">*</span>younglings[sex,e_cigarette,income]<span class="sc">*</span>youngling_mult[<span class="dv">2</span>]</span>
<span id="cb39-369"><a href="ode.html#cb39-369" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-370"><a href="ode.html#cb39-370" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb39-371"><a href="ode.html#cb39-371" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb39-372"><a href="ode.html#cb39-372" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb39-373"><a href="ode.html#cb39-373" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb39-374"><a href="ode.html#cb39-374" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-375"><a href="ode.html#cb39-375" aria-hidden="true" tabindex="-1"></a>       </span>
<span id="cb39-376"><a href="ode.html#cb39-376" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb39-377"><a href="ode.html#cb39-377" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-378"><a href="ode.html#cb39-378" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-379"><a href="ode.html#cb39-379" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Uncomment next lines if wish to use staging modifier variable</span></span>
<span id="cb39-380"><a href="ode.html#cb39-380" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb39-381"><a href="ode.html#cb39-381" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb39-382"><a href="ode.html#cb39-382" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb39-383"><a href="ode.html#cb39-383" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb39-384"><a href="ode.html#cb39-384" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb39-385"><a href="ode.html#cb39-385" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-386"><a href="ode.html#cb39-386" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-387"><a href="ode.html#cb39-387" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb39-388"><a href="ode.html#cb39-388" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-389"><a href="ode.html#cb39-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-390"><a href="ode.html#cb39-390" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb39-391"><a href="ode.html#cb39-391" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-392"><a href="ode.html#cb39-392" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-393"><a href="ode.html#cb39-393" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-394"><a href="ode.html#cb39-394" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Uncomment these lines if wish to use staging modifier variable</span></span>
<span id="cb39-395"><a href="ode.html#cb39-395" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb39-396"><a href="ode.html#cb39-396" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb39-397"><a href="ode.html#cb39-397" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb39-398"><a href="ode.html#cb39-398" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-399"><a href="ode.html#cb39-399" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb39-400"><a href="ode.html#cb39-400" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-401"><a href="ode.html#cb39-401" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-402"><a href="ode.html#cb39-402" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-403"><a href="ode.html#cb39-403" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb39-404"><a href="ode.html#cb39-404" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-405"><a href="ode.html#cb39-405" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Since this is a current smoker compartment, we can have transitions from initiation and reinstatement</span></span>
<span id="cb39-406"><a href="ode.html#cb39-406" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-407"><a href="ode.html#cb39-407" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-408"><a href="ode.html#cb39-408" aria-hidden="true" tabindex="-1"></a>        <span class="do">## First we add the number of people who initiation cigarette smoking by applying transition rate and RRs to the appropriate compartment</span></span>
<span id="cb39-409"><a href="ode.html#cb39-409" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb39-410"><a href="ode.html#cb39-410" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-411"><a href="ode.html#cb39-411" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Then we do the same for the former smokers reinstating</span></span>
<span id="cb39-412"><a href="ode.html#cb39-412" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb39-413"><a href="ode.html#cb39-413" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-414"><a href="ode.html#cb39-414" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette Out</span></span>
<span id="cb39-415"><a href="ode.html#cb39-415" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-416"><a href="ode.html#cb39-416" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb39-417"><a href="ode.html#cb39-417" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb39-418"><a href="ode.html#cb39-418" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-419"><a href="ode.html#cb39-419" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb39-420"><a href="ode.html#cb39-420" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-421"><a href="ode.html#cb39-421" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette In</span></span>
<span id="cb39-422"><a href="ode.html#cb39-422" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb39-423"><a href="ode.html#cb39-423" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb39-424"><a href="ode.html#cb39-424" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb39-425"><a href="ode.html#cb39-425" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-426"><a href="ode.html#cb39-426" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb39-427"><a href="ode.html#cb39-427" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Out</span></span>
<span id="cb39-428"><a href="ode.html#cb39-428" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb39-429"><a href="ode.html#cb39-429" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-430"><a href="ode.html#cb39-430" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb39-431"><a href="ode.html#cb39-431" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">2</span>]</span>
<span id="cb39-432"><a href="ode.html#cb39-432" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-433"><a href="ode.html#cb39-433" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 2</span></span>
<span id="cb39-434"><a href="ode.html#cb39-434" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb39-435"><a href="ode.html#cb39-435" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-436"><a href="ode.html#cb39-436" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-437"><a href="ode.html#cb39-437" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb39-438"><a href="ode.html#cb39-438" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb39-439"><a href="ode.html#cb39-439" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-440"><a href="ode.html#cb39-440" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb39-441"><a href="ode.html#cb39-441" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age] <span class="sc">+</span> entries[age]<span class="sc">*</span>younglings[sex,e_cigarette,income]<span class="sc">*</span>youngling_mult[<span class="dv">3</span>]</span>
<span id="cb39-442"><a href="ode.html#cb39-442" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-443"><a href="ode.html#cb39-443" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb39-444"><a href="ode.html#cb39-444" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb39-445"><a href="ode.html#cb39-445" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-446"><a href="ode.html#cb39-446" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-447"><a href="ode.html#cb39-447" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb39-448"><a href="ode.html#cb39-448" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-449"><a href="ode.html#cb39-449" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-450"><a href="ode.html#cb39-450" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb39-451"><a href="ode.html#cb39-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-452"><a href="ode.html#cb39-452" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-453"><a href="ode.html#cb39-453" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-454"><a href="ode.html#cb39-454" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Uncomment if wish to use staging modifier variable</span></span>
<span id="cb39-455"><a href="ode.html#cb39-455" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb39-456"><a href="ode.html#cb39-456" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb39-457"><a href="ode.html#cb39-457" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb39-458"><a href="ode.html#cb39-458" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-459"><a href="ode.html#cb39-459" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb39-460"><a href="ode.html#cb39-460" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-461"><a href="ode.html#cb39-461" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-462"><a href="ode.html#cb39-462" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb39-463"><a href="ode.html#cb39-463" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-464"><a href="ode.html#cb39-464" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-465"><a href="ode.html#cb39-465" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb39-466"><a href="ode.html#cb39-466" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-467"><a href="ode.html#cb39-467" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb39-468"><a href="ode.html#cb39-468" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-469"><a href="ode.html#cb39-469" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Uncomment if wish to use staging modifier</span></span>
<span id="cb39-470"><a href="ode.html#cb39-470" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb39-471"><a href="ode.html#cb39-471" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb39-472"><a href="ode.html#cb39-472" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb39-473"><a href="ode.html#cb39-473" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb39-474"><a href="ode.html#cb39-474" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb39-475"><a href="ode.html#cb39-475" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb39-476"><a href="ode.html#cb39-476" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-477"><a href="ode.html#cb39-477" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb39-478"><a href="ode.html#cb39-478" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb39-479"><a href="ode.html#cb39-479" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-480"><a href="ode.html#cb39-480" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for cessation</span></span>
<span id="cb39-481"><a href="ode.html#cb39-481" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb39-482"><a href="ode.html#cb39-482" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-483"><a href="ode.html#cb39-483" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb39-484"><a href="ode.html#cb39-484" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-485"><a href="ode.html#cb39-485" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb39-486"><a href="ode.html#cb39-486" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb39-487"><a href="ode.html#cb39-487" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-488"><a href="ode.html#cb39-488" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb39-489"><a href="ode.html#cb39-489" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-490"><a href="ode.html#cb39-490" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette In</span></span>
<span id="cb39-491"><a href="ode.html#cb39-491" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb39-492"><a href="ode.html#cb39-492" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb39-493"><a href="ode.html#cb39-493" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb39-494"><a href="ode.html#cb39-494" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-495"><a href="ode.html#cb39-495" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Out</span></span>
<span id="cb39-496"><a href="ode.html#cb39-496" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb39-497"><a href="ode.html#cb39-497" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-498"><a href="ode.html#cb39-498" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb39-499"><a href="ode.html#cb39-499" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">3</span>]</span>
<span id="cb39-500"><a href="ode.html#cb39-500" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb39-501"><a href="ode.html#cb39-501" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 3</span></span>
<span id="cb39-502"><a href="ode.html#cb39-502" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb39-503"><a href="ode.html#cb39-503" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb39-504"><a href="ode.html#cb39-504" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb39-505"><a href="ode.html#cb39-505" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-506"><a href="ode.html#cb39-506" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-507"><a href="ode.html#cb39-507" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb39-508"><a href="ode.html#cb39-508" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="start.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="calibration.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": null,
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection",
"scroll_highlight": true
},
"toolbar": {
"position": "fixed"
},
"search": true
});
});
</script>

</body>

</html>
