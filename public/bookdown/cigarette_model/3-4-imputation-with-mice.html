<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="3.4 Imputation with mice() | Aim #2: Mathematical Model" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation" />


<meta name="author" content="Charles Marks" />

<meta name="date" content="2021-04-12" />


<meta name="description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation">

<title>3.4 Imputation with mice() | Aim #2: Mathematical Model</title>

<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#in-this-book"><span class="toc-section-number">1</span> In This Book</a></li>
<li><a href="2-dataset.html#dataset"><span class="toc-section-number">2</span> Generating the Initial Dataset</a>
<ul>
<li><a href="2-1-participants.html#participants"><span class="toc-section-number">2.1</span> Participants</a></li>
<li><a href="2-2-defining-variables-we-wish-to-capture.html#defining-variables-we-wish-to-capture"><span class="toc-section-number">2.2</span> Defining Variables We Wish to Capture</a></li>
<li><a href="2-3-loading-the-necessary-datasets.html#loading-the-necessary-datasets"><span class="toc-section-number">2.3</span> Loading the Necessary Datasets</a></li>
<li><a href="2-4-iterating-through-the-datasets.html#iterating-through-the-datasets"><span class="toc-section-number">2.4</span> Iterating Through the Datasets</a></li>
<li><a href="2-5-factoring-the-data.html#factoring-the-data"><span class="toc-section-number">2.5</span> Factoring the Data</a></li>
<li><a href="2-6-adding-the-weights-and-replicate-weights-to-the-study.html#adding-the-weights-and-replicate-weights-to-the-study"><span class="toc-section-number">2.6</span> Adding the Weights and Replicate Weights to the Study</a></li>
<li><a href="2-7-save-the-data-frame-for-future-use.html#save-the-data-frame-for-future-use"><span class="toc-section-number">2.7</span> Save the Data Frame for Future Use</a></li>
</ul></li>
<li><a href="3-imputation.html#imputation"><span class="toc-section-number">3</span> Data Imputation</a>
<ul>
<li><a href="3-1-loading-libraries-and-the-data.html#loading-libraries-and-the-data"><span class="toc-section-number">3.1</span> Loading Libraries and the Data</a></li>
<li><a href="3-2-heuristic-imputation-of-income.html#heuristic-imputation-of-income"><span class="toc-section-number">3.2</span> Heuristic Imputation of Income</a></li>
<li><a href="3-3-heuristic-imputation-of-former-cige-cig-use.html#heuristic-imputation-of-former-cige-cig-use"><span class="toc-section-number">3.3</span> Heuristic Imputation of Former Cig/E-Cig Use</a></li>
<li><a href="3-4-imputation-with-mice.html#imputation-with-mice"><span class="toc-section-number">3.4</span> Imputation with <em>mice()</em></a></li>
<li><a href="3-5-generating-some-additional-variables.html#generating-some-additional-variables"><span class="toc-section-number">3.5</span> Generating Some Additional Variables</a>
<ul>
<li><a href="3-5-generating-some-additional-variables.html#cateogry-cigarette-and-e-cigarette-use"><span class="toc-section-number">3.5.1</span> 3-Cateogry Cigarette and E-Cigarette Use</a></li>
<li><a href="3-5-generating-some-additional-variables.html#income-change-from-waves-1---2"><span class="toc-section-number">3.5.2</span> Income Change from Waves 1 - 2</a></li>
</ul></li>
<li><a href="3-6-output-the-imputed-dataset.html#output-the-imputed-dataset"><span class="toc-section-number">3.6</span> Output the Imputed Dataset</a></li>
</ul></li>
<li><a href="4-paramset.html#paramset"><span class="toc-section-number">4</span> Generate Parameter Set</a></li>
<li><a href="5-ode.html#ode"><span class="toc-section-number">5</span> ODE Functions</a>
<ul>
<li><a href="5-1-helper-functions.html#helper-functions"><span class="toc-section-number">5.1</span> Helper Functions</a></li>
</ul></li>
<li><a href="6-calibration.html#calibration"><span class="toc-section-number">6</span> Calibration</a></li>
<li><a href="7-start.html#start"><span class="toc-section-number">7</span> Initial Start State</a>
<ul>
<li><a href="7-1-stratifying-by-sex-and-age.html#stratifying-by-sex-and-age"><span class="toc-section-number">7.1</span> Stratifying by Sex and Age</a></li>
<li><a href="7-2-stratifying-the-population-by-income-level.html#stratifying-the-population-by-income-level"><span class="toc-section-number">7.2</span> Stratifying the Population by Income Level</a></li>
<li><a href="7-3-distributing-cigarette-use.html#distributing-cigarette-use"><span class="toc-section-number">7.3</span> Distributing Cigarette Use</a></li>
<li><a href="7-4-distributing-e-cigarette-use.html#distributing-e-cigarette-use"><span class="toc-section-number">7.4</span> Distributing E-Cigarette Use</a></li>
<li><a href="7-5-outputting-states-to-confirm.html#outputting-states-to-confirm"><span class="toc-section-number">7.5</span> Outputting States to Confirm</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="imputation-with-mice" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Imputation with <em>mice()</em></h2>
<p>Now that we have imputed many of the missing income and former use variables, we want to impute all the remaining missing values. We will use the mice (Multivariate Imputation by Chained Equations) package to do so. The mice package can be used to generate multiple imputed datasets. By doing so, we are able to run the analyses on each imputed dataset and then pool the results. This allows us to account for uncertainty introduced by the imputation process. We have opted to create 15 such imputed datasets.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="3-4-imputation-with-mice.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">## First we create a temporary data frame with just the variables we wish to impute</span></span>
<span id="cb11-2"><a href="3-4-imputation-with-mice.html#cb11-2" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> data[,<span class="fu">c</span>(<span class="st">&quot;wave2_age&quot;</span>,</span>
<span id="cb11-3"><a href="3-4-imputation-with-mice.html#cb11-3" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;gender&quot;</span>, <span class="st">&quot;race&quot;</span>,<span class="st">&quot;hispanic&quot;</span>,</span>
<span id="cb11-4"><a href="3-4-imputation-with-mice.html#cb11-4" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;wave1_income&quot;</span>,<span class="st">&quot;wave2_income&quot;</span>,<span class="st">&quot;wave3_income&quot;</span>,</span>
<span id="cb11-5"><a href="3-4-imputation-with-mice.html#cb11-5" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;wave2_smoker&quot;</span>,<span class="st">&quot;wave2_former_smoker&quot;</span>,</span>
<span id="cb11-6"><a href="3-4-imputation-with-mice.html#cb11-6" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;wave2_e_smoker&quot;</span>,<span class="st">&quot;wave2_former_e_smoker&quot;</span>,</span>
<span id="cb11-7"><a href="3-4-imputation-with-mice.html#cb11-7" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;wave3_smoker&quot;</span>,<span class="st">&quot;wave3_former_smoker&quot;</span>,</span>
<span id="cb11-8"><a href="3-4-imputation-with-mice.html#cb11-8" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;wave3_e_smoker&quot;</span>,<span class="st">&quot;wave3_former_e_smoker&quot;</span>)]</span>
<span id="cb11-9"><a href="3-4-imputation-with-mice.html#cb11-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-10"><a href="3-4-imputation-with-mice.html#cb11-10" aria-hidden="true" tabindex="-1"></a><span class="do">## While our variables are all categorical, some of them are ordered. It is important to let the mice() function know which categorical variables are ordered. We use the ordered function to do so.</span></span>
<span id="cb11-11"><a href="3-4-imputation-with-mice.html#cb11-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-12"><a href="3-4-imputation-with-mice.html#cb11-12" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>wave2_age <span class="ot">&lt;-</span> <span class="fu">ordered</span>(temp<span class="sc">$</span>wave2_age, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;18-24&quot;</span>,<span class="st">&quot;25-34&quot;</span>,<span class="st">&quot;35-44&quot;</span>,<span class="st">&quot;45-54&quot;</span>,<span class="st">&quot;55-64&quot;</span>,<span class="st">&quot;&gt;65&quot;</span>))</span>
<span id="cb11-13"><a href="3-4-imputation-with-mice.html#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="3-4-imputation-with-mice.html#cb11-14" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>wave1_income <span class="ot">&lt;-</span> <span class="fu">ordered</span>(temp<span class="sc">$</span>wave1_income, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;$10k&quot;</span>,<span class="st">&quot;$10-25k&quot;</span>,<span class="st">&quot;$25-50k&quot;</span>,<span class="st">&quot;$50k-100k&quot;</span>,<span class="st">&quot;&gt;=$100k&quot;</span>))</span>
<span id="cb11-15"><a href="3-4-imputation-with-mice.html#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="3-4-imputation-with-mice.html#cb11-16" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>wave2_income <span class="ot">&lt;-</span> <span class="fu">ordered</span>(temp<span class="sc">$</span>wave2_income, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;$10k&quot;</span>,<span class="st">&quot;$10-25k&quot;</span>,<span class="st">&quot;$25-50k&quot;</span>,<span class="st">&quot;$50k-100k&quot;</span>,<span class="st">&quot;&gt;=$100k&quot;</span>))</span>
<span id="cb11-17"><a href="3-4-imputation-with-mice.html#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="3-4-imputation-with-mice.html#cb11-18" aria-hidden="true" tabindex="-1"></a>temp<span class="sc">$</span>wave3_income <span class="ot">&lt;-</span> <span class="fu">ordered</span>(temp<span class="sc">$</span>wave3_income, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;&lt;$10k&quot;</span>,<span class="st">&quot;$10-25k&quot;</span>,<span class="st">&quot;$25-50k&quot;</span>,<span class="st">&quot;$50k-100k&quot;</span>,<span class="st">&quot;&gt;=$100k&quot;</span>))</span>
<span id="cb11-19"><a href="3-4-imputation-with-mice.html#cb11-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-20"><a href="3-4-imputation-with-mice.html#cb11-20" aria-hidden="true" tabindex="-1"></a><span class="do">## Once variables are in correct format, we run the mice function.</span></span>
<span id="cb11-21"><a href="3-4-imputation-with-mice.html#cb11-21" aria-hidden="true" tabindex="-1"></a><span class="do">## We run it 15 times (m = 15)</span></span>
<span id="cb11-22"><a href="3-4-imputation-with-mice.html#cb11-22" aria-hidden="true" tabindex="-1"></a><span class="do">## We set a seed as well so that the results are replicable</span></span>
<span id="cb11-23"><a href="3-4-imputation-with-mice.html#cb11-23" aria-hidden="true" tabindex="-1"></a>temp <span class="ot">&lt;-</span> <span class="fu">mice</span>(temp, <span class="at">m =</span> <span class="dv">15</span>, <span class="at">seed =</span> <span class="dv">123</span>)</span>
<span id="cb11-24"><a href="3-4-imputation-with-mice.html#cb11-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-25"><a href="3-4-imputation-with-mice.html#cb11-25" aria-hidden="true" tabindex="-1"></a><span class="do">## We then extract the results in long format</span></span>
<span id="cb11-26"><a href="3-4-imputation-with-mice.html#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="do">## The com dataset is thus 15 imputed datasets on top of each other</span></span>
<span id="cb11-27"><a href="3-4-imputation-with-mice.html#cb11-27" aria-hidden="true" tabindex="-1"></a><span class="do">## The .imp variable for each observation corresponds to which imputation a given observation belongs to</span></span>
<span id="cb11-28"><a href="3-4-imputation-with-mice.html#cb11-28" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">complete</span>(temp, <span class="at">action=</span><span class="st">&quot;long&quot;</span>)</span>
<span id="cb11-29"><a href="3-4-imputation-with-mice.html#cb11-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-30"><a href="3-4-imputation-with-mice.html#cb11-30" aria-hidden="true" tabindex="-1"></a><span class="do">## We then want to add the weights and replicate weights back to the dataset</span></span>
<span id="cb11-31"><a href="3-4-imputation-with-mice.html#cb11-31" aria-hidden="true" tabindex="-1"></a><span class="do">## These weights are contained in columns 38 - 138 of the original dataset</span></span>
<span id="cb11-32"><a href="3-4-imputation-with-mice.html#cb11-32" aria-hidden="true" tabindex="-1"></a><span class="do">## The com dataset is 15 times as long as the data data.frame </span></span>
<span id="cb11-33"><a href="3-4-imputation-with-mice.html#cb11-33" aria-hidden="true" tabindex="-1"></a><span class="do">## The cbind function nicley repeats the weights, such that they are correctly applied to each imputed dataset</span></span>
<span id="cb11-34"><a href="3-4-imputation-with-mice.html#cb11-34" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> <span class="fu">cbind</span>(com, data[,<span class="fu">c</span>(<span class="dv">37</span><span class="sc">:</span><span class="dv">137</span>)])</span></code></pre></div>
</div>
<p style="text-align: center;">
<a href="3-3-heuristic-imputation-of-former-cige-cig-use.html"><button class="btn btn-default">Previous</button></a>
<a href="3-5-generating-some-additional-variables.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
