<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<meta property="og:title" content="5.1 Helper Functions | Aim #2: Mathematical Model" />
<meta property="og:type" content="book" />


<meta property="og:description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation" />


<meta name="author" content="Charles Marks" />

<meta name="date" content="2021-04-12" />


<meta name="description" content="This book contains the analyses for the mathematical model for Aim #2 of Charlie’s dissertation">

<title>5.1 Helper Functions | Aim #2: Mathematical Model</title>

<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
</style>
</head>

<body>

<div class="container-fluid main-container">


<div class="row">
<div class="col-sm-12">
<div id="TOC">
<ul>
<li><a href="index.html#in-this-book"><span class="toc-section-number">1</span> In This Book</a></li>
<li><a href="2-dataset.html#dataset"><span class="toc-section-number">2</span> Generating the Initial Dataset</a>
<ul>
<li><a href="2-1-participants.html#participants"><span class="toc-section-number">2.1</span> Participants</a></li>
<li><a href="2-2-defining-variables-we-wish-to-capture.html#defining-variables-we-wish-to-capture"><span class="toc-section-number">2.2</span> Defining Variables We Wish to Capture</a></li>
<li><a href="2-3-loading-the-necessary-datasets.html#loading-the-necessary-datasets"><span class="toc-section-number">2.3</span> Loading the Necessary Datasets</a></li>
<li><a href="2-4-iterating-through-the-datasets.html#iterating-through-the-datasets"><span class="toc-section-number">2.4</span> Iterating Through the Datasets</a></li>
<li><a href="2-5-factoring-the-data.html#factoring-the-data"><span class="toc-section-number">2.5</span> Factoring the Data</a></li>
<li><a href="2-6-adding-the-weights-and-replicate-weights-to-the-study.html#adding-the-weights-and-replicate-weights-to-the-study"><span class="toc-section-number">2.6</span> Adding the Weights and Replicate Weights to the Study</a></li>
<li><a href="2-7-save-the-data-frame-for-future-use.html#save-the-data-frame-for-future-use"><span class="toc-section-number">2.7</span> Save the Data Frame for Future Use</a></li>
</ul></li>
<li><a href="3-imputation.html#imputation"><span class="toc-section-number">3</span> Data Imputation</a>
<ul>
<li><a href="3-1-loading-libraries-and-the-data.html#loading-libraries-and-the-data"><span class="toc-section-number">3.1</span> Loading Libraries and the Data</a></li>
<li><a href="3-2-heuristic-imputation-of-income.html#heuristic-imputation-of-income"><span class="toc-section-number">3.2</span> Heuristic Imputation of Income</a></li>
<li><a href="3-3-heuristic-imputation-of-former-cige-cig-use.html#heuristic-imputation-of-former-cige-cig-use"><span class="toc-section-number">3.3</span> Heuristic Imputation of Former Cig/E-Cig Use</a></li>
<li><a href="3-4-imputation-with-mice.html#imputation-with-mice"><span class="toc-section-number">3.4</span> Imputation with <em>mice()</em></a></li>
<li><a href="3-5-generating-some-additional-variables.html#generating-some-additional-variables"><span class="toc-section-number">3.5</span> Generating Some Additional Variables</a>
<ul>
<li><a href="3-5-generating-some-additional-variables.html#cateogry-cigarette-and-e-cigarette-use"><span class="toc-section-number">3.5.1</span> 3-Cateogry Cigarette and E-Cigarette Use</a></li>
<li><a href="3-5-generating-some-additional-variables.html#income-change-from-waves-1---2"><span class="toc-section-number">3.5.2</span> Income Change from Waves 1 - 2</a></li>
</ul></li>
<li><a href="3-6-output-the-imputed-dataset.html#output-the-imputed-dataset"><span class="toc-section-number">3.6</span> Output the Imputed Dataset</a></li>
</ul></li>
<li><a href="4-paramset.html#paramset"><span class="toc-section-number">4</span> Generate Parameter Set</a></li>
<li><a href="5-ode.html#ode"><span class="toc-section-number">5</span> ODE Functions</a>
<ul>
<li><a href="5-1-helper-functions.html#helper-functions"><span class="toc-section-number">5.1</span> Helper Functions</a></li>
</ul></li>
<li><a href="6-calibration.html#calibration"><span class="toc-section-number">6</span> Calibration</a></li>
<li><a href="7-start.html#start"><span class="toc-section-number">7</span> Initial Start State</a>
<ul>
<li><a href="7-1-stratifying-by-sex-and-age.html#stratifying-by-sex-and-age"><span class="toc-section-number">7.1</span> Stratifying by Sex and Age</a></li>
<li><a href="7-2-stratifying-the-population-by-income-level.html#stratifying-the-population-by-income-level"><span class="toc-section-number">7.2</span> Stratifying the Population by Income Level</a></li>
<li><a href="7-3-distributing-cigarette-use.html#distributing-cigarette-use"><span class="toc-section-number">7.3</span> Distributing Cigarette Use</a></li>
<li><a href="7-4-distributing-e-cigarette-use.html#distributing-e-cigarette-use"><span class="toc-section-number">7.4</span> Distributing E-Cigarette Use</a></li>
<li><a href="7-5-outputting-states-to-confirm.html#outputting-states-to-confirm"><span class="toc-section-number">7.5</span> Outputting States to Confirm</a></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div class="row">
<div class="col-sm-12">
<div id="helper-functions" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Helper Functions</h2>
<p>The ODE function is included below. Comments in the code are provided to clarify how the model functions:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="5-1-helper-functions.html#cb16-1" aria-hidden="true" tabindex="-1"></a>toArray <span class="ot">&lt;-</span> <span class="cf">function</span>(vector, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">13</span>)){</span>
<span id="cb16-2"><a href="5-1-helper-functions.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3"><a href="5-1-helper-functions.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  array_structure <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> dim)</span>
<span id="cb16-4"><a href="5-1-helper-functions.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5"><a href="5-1-helper-functions.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">replace</span>(array_structure, <span class="cn">TRUE</span>, vector))</span>
<span id="cb16-6"><a href="5-1-helper-functions.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-7"><a href="5-1-helper-functions.html#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-8"><a href="5-1-helper-functions.html#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="5-1-helper-functions.html#cb16-9" aria-hidden="true" tabindex="-1"></a>toVector <span class="ot">&lt;-</span> <span class="cf">function</span>(array){</span>
<span id="cb16-10"><a href="5-1-helper-functions.html#cb16-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-11"><a href="5-1-helper-functions.html#cb16-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">c</span>(array))</span>
<span id="cb16-12"><a href="5-1-helper-functions.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-13"><a href="5-1-helper-functions.html#cb16-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-14"><a href="5-1-helper-functions.html#cb16-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-15"><a href="5-1-helper-functions.html#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="5-1-helper-functions.html#cb16-16" aria-hidden="true" tabindex="-1"></a>de_fun <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-17"><a href="5-1-helper-functions.html#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">as.list</span>(<span class="fu">c</span>(states,parameters)),</span>
<span id="cb16-18"><a href="5-1-helper-functions.html#cb16-18" aria-hidden="true" tabindex="-1"></a>       {</span>
<span id="cb16-19"><a href="5-1-helper-functions.html#cb16-19" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-20"><a href="5-1-helper-functions.html#cb16-20" aria-hidden="true" tabindex="-1"></a>         states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-21"><a href="5-1-helper-functions.html#cb16-21" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-22"><a href="5-1-helper-functions.html#cb16-22" aria-hidden="true" tabindex="-1"></a>         sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-23"><a href="5-1-helper-functions.html#cb16-23" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-24"><a href="5-1-helper-functions.html#cb16-24" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-25"><a href="5-1-helper-functions.html#cb16-25" aria-hidden="true" tabindex="-1"></a>         age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-26"><a href="5-1-helper-functions.html#cb16-26" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-27"><a href="5-1-helper-functions.html#cb16-27" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-28"><a href="5-1-helper-functions.html#cb16-28" aria-hidden="true" tabindex="-1"></a>         cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-29"><a href="5-1-helper-functions.html#cb16-29" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-30"><a href="5-1-helper-functions.html#cb16-30" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-31"><a href="5-1-helper-functions.html#cb16-31" aria-hidden="true" tabindex="-1"></a>         e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-32"><a href="5-1-helper-functions.html#cb16-32" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-33"><a href="5-1-helper-functions.html#cb16-33" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-34"><a href="5-1-helper-functions.html#cb16-34" aria-hidden="true" tabindex="-1"></a>         income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-35"><a href="5-1-helper-functions.html#cb16-35" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-36"><a href="5-1-helper-functions.html#cb16-36" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-37"><a href="5-1-helper-functions.html#cb16-37" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-38"><a href="5-1-helper-functions.html#cb16-38" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-39"><a href="5-1-helper-functions.html#cb16-39" aria-hidden="true" tabindex="-1"></a>         <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-40"><a href="5-1-helper-functions.html#cb16-40" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-41"><a href="5-1-helper-functions.html#cb16-41" aria-hidden="true" tabindex="-1"></a>         age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-42"><a href="5-1-helper-functions.html#cb16-42" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-43"><a href="5-1-helper-functions.html#cb16-43" aria-hidden="true" tabindex="-1"></a>         income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-44"><a href="5-1-helper-functions.html#cb16-44" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-45"><a href="5-1-helper-functions.html#cb16-45" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-46"><a href="5-1-helper-functions.html#cb16-46" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-47"><a href="5-1-helper-functions.html#cb16-47" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-48"><a href="5-1-helper-functions.html#cb16-48" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-49"><a href="5-1-helper-functions.html#cb16-49" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-50"><a href="5-1-helper-functions.html#cb16-50" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-51"><a href="5-1-helper-functions.html#cb16-51" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-52"><a href="5-1-helper-functions.html#cb16-52" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-53"><a href="5-1-helper-functions.html#cb16-53" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-54"><a href="5-1-helper-functions.html#cb16-54" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-55"><a href="5-1-helper-functions.html#cb16-55" aria-hidden="true" tabindex="-1"></a>                                           <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-56"><a href="5-1-helper-functions.html#cb16-56" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-57"><a href="5-1-helper-functions.html#cb16-57" aria-hidden="true" tabindex="-1"></a>         income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-58"><a href="5-1-helper-functions.html#cb16-58" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-59"><a href="5-1-helper-functions.html#cb16-59" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-60"><a href="5-1-helper-functions.html#cb16-60" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-61"><a href="5-1-helper-functions.html#cb16-61" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-62"><a href="5-1-helper-functions.html#cb16-62" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-63"><a href="5-1-helper-functions.html#cb16-63" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-64"><a href="5-1-helper-functions.html#cb16-64" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-65"><a href="5-1-helper-functions.html#cb16-65" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-66"><a href="5-1-helper-functions.html#cb16-66" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-67"><a href="5-1-helper-functions.html#cb16-67" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-68"><a href="5-1-helper-functions.html#cb16-68" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-69"><a href="5-1-helper-functions.html#cb16-69" aria-hidden="true" tabindex="-1"></a>                                            <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-70"><a href="5-1-helper-functions.html#cb16-70" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-71"><a href="5-1-helper-functions.html#cb16-71" aria-hidden="true" tabindex="-1"></a>         <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-72"><a href="5-1-helper-functions.html#cb16-72" aria-hidden="true" tabindex="-1"></a>         <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-73"><a href="5-1-helper-functions.html#cb16-73" aria-hidden="true" tabindex="-1"></a>         <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-74"><a href="5-1-helper-functions.html#cb16-74" aria-hidden="true" tabindex="-1"></a>         income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-75"><a href="5-1-helper-functions.html#cb16-75" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-76"><a href="5-1-helper-functions.html#cb16-76" aria-hidden="true" tabindex="-1"></a>         <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-77"><a href="5-1-helper-functions.html#cb16-77" aria-hidden="true" tabindex="-1"></a>         <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-78"><a href="5-1-helper-functions.html#cb16-78" aria-hidden="true" tabindex="-1"></a>         income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-79"><a href="5-1-helper-functions.html#cb16-79" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-80"><a href="5-1-helper-functions.html#cb16-80" aria-hidden="true" tabindex="-1"></a>         <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-81"><a href="5-1-helper-functions.html#cb16-81" aria-hidden="true" tabindex="-1"></a>         staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-82"><a href="5-1-helper-functions.html#cb16-82" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-83"><a href="5-1-helper-functions.html#cb16-83" aria-hidden="true" tabindex="-1"></a>         <span class="do">##</span></span>
<span id="cb16-84"><a href="5-1-helper-functions.html#cb16-84" aria-hidden="true" tabindex="-1"></a>         <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-85"><a href="5-1-helper-functions.html#cb16-85" aria-hidden="true" tabindex="-1"></a>         cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-86"><a href="5-1-helper-functions.html#cb16-86" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-87"><a href="5-1-helper-functions.html#cb16-87" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-88"><a href="5-1-helper-functions.html#cb16-88" aria-hidden="true" tabindex="-1"></a>         e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-89"><a href="5-1-helper-functions.html#cb16-89" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-90"><a href="5-1-helper-functions.html#cb16-90" aria-hidden="true" tabindex="-1"></a>         <span class="do">##</span></span>
<span id="cb16-91"><a href="5-1-helper-functions.html#cb16-91" aria-hidden="true" tabindex="-1"></a>         <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-92"><a href="5-1-helper-functions.html#cb16-92" aria-hidden="true" tabindex="-1"></a>         <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-93"><a href="5-1-helper-functions.html#cb16-93" aria-hidden="true" tabindex="-1"></a>         <span class="do">##</span></span>
<span id="cb16-94"><a href="5-1-helper-functions.html#cb16-94" aria-hidden="true" tabindex="-1"></a>         rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-95"><a href="5-1-helper-functions.html#cb16-95" aria-hidden="true" tabindex="-1"></a>         rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-96"><a href="5-1-helper-functions.html#cb16-96" aria-hidden="true" tabindex="-1"></a>         rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-97"><a href="5-1-helper-functions.html#cb16-97" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-98"><a href="5-1-helper-functions.html#cb16-98" aria-hidden="true" tabindex="-1"></a>         rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-99"><a href="5-1-helper-functions.html#cb16-99" aria-hidden="true" tabindex="-1"></a>         rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-100"><a href="5-1-helper-functions.html#cb16-100" aria-hidden="true" tabindex="-1"></a>         rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-101"><a href="5-1-helper-functions.html#cb16-101" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-102"><a href="5-1-helper-functions.html#cb16-102" aria-hidden="true" tabindex="-1"></a>         <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-103"><a href="5-1-helper-functions.html#cb16-103" aria-hidden="true" tabindex="-1"></a>         <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-104"><a href="5-1-helper-functions.html#cb16-104" aria-hidden="true" tabindex="-1"></a>         ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-105"><a href="5-1-helper-functions.html#cb16-105" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-106"><a href="5-1-helper-functions.html#cb16-106" aria-hidden="true" tabindex="-1"></a>         <span class="cf">for</span>(sex <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>sex_types){</span>
<span id="cb16-107"><a href="5-1-helper-functions.html#cb16-107" aria-hidden="true" tabindex="-1"></a>           <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-108"><a href="5-1-helper-functions.html#cb16-108" aria-hidden="true" tabindex="-1"></a>             <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-109"><a href="5-1-helper-functions.html#cb16-109" aria-hidden="true" tabindex="-1"></a>               <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-110"><a href="5-1-helper-functions.html#cb16-110" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-111"><a href="5-1-helper-functions.html#cb16-111" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-112"><a href="5-1-helper-functions.html#cb16-112" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-113"><a href="5-1-helper-functions.html#cb16-113" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-114"><a href="5-1-helper-functions.html#cb16-114" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-115"><a href="5-1-helper-functions.html#cb16-115" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-116"><a href="5-1-helper-functions.html#cb16-116" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-117"><a href="5-1-helper-functions.html#cb16-117" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-118"><a href="5-1-helper-functions.html#cb16-118" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-119"><a href="5-1-helper-functions.html#cb16-119" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Age In</span></span>
<span id="cb16-120"><a href="5-1-helper-functions.html#cb16-120" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-121"><a href="5-1-helper-functions.html#cb16-121" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-122"><a href="5-1-helper-functions.html#cb16-122" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-123"><a href="5-1-helper-functions.html#cb16-123" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-124"><a href="5-1-helper-functions.html#cb16-124" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## All other age groups</span></span>
<span id="cb16-125"><a href="5-1-helper-functions.html#cb16-125" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-126"><a href="5-1-helper-functions.html#cb16-126" aria-hidden="true" tabindex="-1"></a>                 ageIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-127"><a href="5-1-helper-functions.html#cb16-127" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-128"><a href="5-1-helper-functions.html#cb16-128" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(age <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb16-129"><a href="5-1-helper-functions.html#cb16-129" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-130"><a href="5-1-helper-functions.html#cb16-130" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## times the proportion of people who will age out</span></span>
<span id="cb16-131"><a href="5-1-helper-functions.html#cb16-131" aria-hidden="true" tabindex="-1"></a>                   ageIn <span class="ot">&lt;-</span> states[sex,age <span class="sc">-</span> <span class="dv">1</span>,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb16-132"><a href="5-1-helper-functions.html#cb16-132" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(age <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-133"><a href="5-1-helper-functions.html#cb16-133" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-134"><a href="5-1-helper-functions.html#cb16-134" aria-hidden="true" tabindex="-1"></a>                   <span class="do">##</span></span>
<span id="cb16-135"><a href="5-1-helper-functions.html#cb16-135" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-136"><a href="5-1-helper-functions.html#cb16-136" aria-hidden="true" tabindex="-1"></a>                   <span class="do">##</span></span>
<span id="cb16-137"><a href="5-1-helper-functions.html#cb16-137" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-138"><a href="5-1-helper-functions.html#cb16-138" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-139"><a href="5-1-helper-functions.html#cb16-139" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-140"><a href="5-1-helper-functions.html#cb16-140" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Age Out</span></span>
<span id="cb16-141"><a href="5-1-helper-functions.html#cb16-141" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-142"><a href="5-1-helper-functions.html#cb16-142" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-143"><a href="5-1-helper-functions.html#cb16-143" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-144"><a href="5-1-helper-functions.html#cb16-144" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-145"><a href="5-1-helper-functions.html#cb16-145" aria-hidden="true" tabindex="-1"></a>                 ageOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-146"><a href="5-1-helper-functions.html#cb16-146" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(age <span class="sc">&lt;</span> <span class="dv">6</span>){</span>
<span id="cb16-147"><a href="5-1-helper-functions.html#cb16-147" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-148"><a href="5-1-helper-functions.html#cb16-148" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-149"><a href="5-1-helper-functions.html#cb16-149" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-150"><a href="5-1-helper-functions.html#cb16-150" aria-hidden="true" tabindex="-1"></a>                   ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-151"><a href="5-1-helper-functions.html#cb16-151" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-152"><a href="5-1-helper-functions.html#cb16-152" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-153"><a href="5-1-helper-functions.html#cb16-153" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Income In</span></span>
<span id="cb16-154"><a href="5-1-helper-functions.html#cb16-154" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-155"><a href="5-1-helper-functions.html#cb16-155" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-156"><a href="5-1-helper-functions.html#cb16-156" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-157"><a href="5-1-helper-functions.html#cb16-157" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-158"><a href="5-1-helper-functions.html#cb16-158" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-159"><a href="5-1-helper-functions.html#cb16-159" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## can transition into X from</span></span>
<span id="cb16-160"><a href="5-1-helper-functions.html#cb16-160" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-161"><a href="5-1-helper-functions.html#cb16-161" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-162"><a href="5-1-helper-functions.html#cb16-162" aria-hidden="true" tabindex="-1"></a>                 incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-163"><a href="5-1-helper-functions.html#cb16-163" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-164"><a href="5-1-helper-functions.html#cb16-164" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-165"><a href="5-1-helper-functions.html#cb16-165" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-166"><a href="5-1-helper-functions.html#cb16-166" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-167"><a href="5-1-helper-functions.html#cb16-167" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-168"><a href="5-1-helper-functions.html#cb16-168" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-169"><a href="5-1-helper-functions.html#cb16-169" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-170"><a href="5-1-helper-functions.html#cb16-170" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-171"><a href="5-1-helper-functions.html#cb16-171" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-172"><a href="5-1-helper-functions.html#cb16-172" aria-hidden="true" tabindex="-1"></a>                   mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-173"><a href="5-1-helper-functions.html#cb16-173" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-174"><a href="5-1-helper-functions.html#cb16-174" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-175"><a href="5-1-helper-functions.html#cb16-175" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## is the same</span></span>
<span id="cb16-176"><a href="5-1-helper-functions.html#cb16-176" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span>(income_level <span class="sc">!=</span> income_5_cat[income_level] <span class="sc">&amp;&amp;</span> income <span class="sc">==</span> income_5_cat[income_level]){</span>
<span id="cb16-177"><a href="5-1-helper-functions.html#cb16-177" aria-hidden="true" tabindex="-1"></a>                     mod <span class="ot">&lt;-</span> staging_modifier</span>
<span id="cb16-178"><a href="5-1-helper-functions.html#cb16-178" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb16-179"><a href="5-1-helper-functions.html#cb16-179" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-180"><a href="5-1-helper-functions.html#cb16-180" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-181"><a href="5-1-helper-functions.html#cb16-181" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-182"><a href="5-1-helper-functions.html#cb16-182" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-183"><a href="5-1-helper-functions.html#cb16-183" aria-hidden="true" tabindex="-1"></a>                   incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-184"><a href="5-1-helper-functions.html#cb16-184" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-185"><a href="5-1-helper-functions.html#cb16-185" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-186"><a href="5-1-helper-functions.html#cb16-186" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-187"><a href="5-1-helper-functions.html#cb16-187" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Income Out</span></span>
<span id="cb16-188"><a href="5-1-helper-functions.html#cb16-188" aria-hidden="true" tabindex="-1"></a>                 incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-189"><a href="5-1-helper-functions.html#cb16-189" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-190"><a href="5-1-helper-functions.html#cb16-190" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-191"><a href="5-1-helper-functions.html#cb16-191" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-192"><a href="5-1-helper-functions.html#cb16-192" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-193"><a href="5-1-helper-functions.html#cb16-193" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-194"><a href="5-1-helper-functions.html#cb16-194" aria-hidden="true" tabindex="-1"></a>                   mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-195"><a href="5-1-helper-functions.html#cb16-195" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-196"><a href="5-1-helper-functions.html#cb16-196" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span>(income <span class="sc">!=</span> income_5_cat[income] <span class="sc">&amp;&amp;</span> income_level <span class="sc">==</span> income_5_cat[income]){</span>
<span id="cb16-197"><a href="5-1-helper-functions.html#cb16-197" aria-hidden="true" tabindex="-1"></a>                     mod <span class="ot">&lt;-</span> staging_modifier</span>
<span id="cb16-198"><a href="5-1-helper-functions.html#cb16-198" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb16-199"><a href="5-1-helper-functions.html#cb16-199" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-200"><a href="5-1-helper-functions.html#cb16-200" aria-hidden="true" tabindex="-1"></a>                   incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-201"><a href="5-1-helper-functions.html#cb16-201" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-202"><a href="5-1-helper-functions.html#cb16-202" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-203"><a href="5-1-helper-functions.html#cb16-203" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-204"><a href="5-1-helper-functions.html#cb16-204" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-205"><a href="5-1-helper-functions.html#cb16-205" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-206"><a href="5-1-helper-functions.html#cb16-206" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-207"><a href="5-1-helper-functions.html#cb16-207" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-208"><a href="5-1-helper-functions.html#cb16-208" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-209"><a href="5-1-helper-functions.html#cb16-209" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># }else{</span></span>
<span id="cb16-210"><a href="5-1-helper-functions.html#cb16-210" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-211"><a href="5-1-helper-functions.html#cb16-211" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-212"><a href="5-1-helper-functions.html#cb16-212" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-213"><a href="5-1-helper-functions.html#cb16-213" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-214"><a href="5-1-helper-functions.html#cb16-214" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-215"><a href="5-1-helper-functions.html#cb16-215" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-216"><a href="5-1-helper-functions.html#cb16-216" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-217"><a href="5-1-helper-functions.html#cb16-217" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-218"><a href="5-1-helper-functions.html#cb16-218" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Income level changes</span></span>
<span id="cb16-219"><a href="5-1-helper-functions.html#cb16-219" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-220"><a href="5-1-helper-functions.html#cb16-220" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-221"><a href="5-1-helper-functions.html#cb16-221" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-222"><a href="5-1-helper-functions.html#cb16-222" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-223"><a href="5-1-helper-functions.html#cb16-223" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-224"><a href="5-1-helper-functions.html#cb16-224" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-225"><a href="5-1-helper-functions.html#cb16-225" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-226"><a href="5-1-helper-functions.html#cb16-226" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-227"><a href="5-1-helper-functions.html#cb16-227" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-228"><a href="5-1-helper-functions.html#cb16-228" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-229"><a href="5-1-helper-functions.html#cb16-229" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-230"><a href="5-1-helper-functions.html#cb16-230" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-231"><a href="5-1-helper-functions.html#cb16-231" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-232"><a href="5-1-helper-functions.html#cb16-232" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># }</span></span>
<span id="cb16-233"><a href="5-1-helper-functions.html#cb16-233" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-234"><a href="5-1-helper-functions.html#cb16-234" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette In</span></span>
<span id="cb16-235"><a href="5-1-helper-functions.html#cb16-235" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-236"><a href="5-1-helper-functions.html#cb16-236" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-237"><a href="5-1-helper-functions.html#cb16-237" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-238"><a href="5-1-helper-functions.html#cb16-238" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## cigarette Out</span></span>
<span id="cb16-239"><a href="5-1-helper-functions.html#cb16-239" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-240"><a href="5-1-helper-functions.html#cb16-240" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-241"><a href="5-1-helper-functions.html#cb16-241" aria-hidden="true" tabindex="-1"></a>                 cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-242"><a href="5-1-helper-functions.html#cb16-242" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-243"><a href="5-1-helper-functions.html#cb16-243" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-244"><a href="5-1-helper-functions.html#cb16-244" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-245"><a href="5-1-helper-functions.html#cb16-245" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## e_cigarette in</span></span>
<span id="cb16-246"><a href="5-1-helper-functions.html#cb16-246" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-247"><a href="5-1-helper-functions.html#cb16-247" aria-hidden="true" tabindex="-1"></a>                 e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-248"><a href="5-1-helper-functions.html#cb16-248" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-249"><a href="5-1-helper-functions.html#cb16-249" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-250"><a href="5-1-helper-functions.html#cb16-250" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-251"><a href="5-1-helper-functions.html#cb16-251" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-252"><a href="5-1-helper-functions.html#cb16-252" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-253"><a href="5-1-helper-functions.html#cb16-253" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-254"><a href="5-1-helper-functions.html#cb16-254" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-255"><a href="5-1-helper-functions.html#cb16-255" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-256"><a href="5-1-helper-functions.html#cb16-256" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-257"><a href="5-1-helper-functions.html#cb16-257" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-258"><a href="5-1-helper-functions.html#cb16-258" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-259"><a href="5-1-helper-functions.html#cb16-259" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-260"><a href="5-1-helper-functions.html#cb16-260" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-261"><a href="5-1-helper-functions.html#cb16-261" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-262"><a href="5-1-helper-functions.html#cb16-262" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-263"><a href="5-1-helper-functions.html#cb16-263" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-264"><a href="5-1-helper-functions.html#cb16-264" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-265"><a href="5-1-helper-functions.html#cb16-265" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for cessation</span></span>
<span id="cb16-266"><a href="5-1-helper-functions.html#cb16-266" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-267"><a href="5-1-helper-functions.html#cb16-267" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-268"><a href="5-1-helper-functions.html#cb16-268" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-269"><a href="5-1-helper-functions.html#cb16-269" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-270"><a href="5-1-helper-functions.html#cb16-270" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-271"><a href="5-1-helper-functions.html#cb16-271" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## e_cigarette out</span></span>
<span id="cb16-272"><a href="5-1-helper-functions.html#cb16-272" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-273"><a href="5-1-helper-functions.html#cb16-273" aria-hidden="true" tabindex="-1"></a>                 e_cigaretteOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-274"><a href="5-1-helper-functions.html#cb16-274" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-275"><a href="5-1-helper-functions.html#cb16-275" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-276"><a href="5-1-helper-functions.html#cb16-276" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-277"><a href="5-1-helper-functions.html#cb16-277" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for initiation</span></span>
<span id="cb16-278"><a href="5-1-helper-functions.html#cb16-278" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-279"><a href="5-1-helper-functions.html#cb16-279" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-280"><a href="5-1-helper-functions.html#cb16-280" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-281"><a href="5-1-helper-functions.html#cb16-281" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-282"><a href="5-1-helper-functions.html#cb16-282" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-283"><a href="5-1-helper-functions.html#cb16-283" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for cessation</span></span>
<span id="cb16-284"><a href="5-1-helper-functions.html#cb16-284" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-285"><a href="5-1-helper-functions.html#cb16-285" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-286"><a href="5-1-helper-functions.html#cb16-286" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-287"><a href="5-1-helper-functions.html#cb16-287" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-288"><a href="5-1-helper-functions.html#cb16-288" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-289"><a href="5-1-helper-functions.html#cb16-289" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-290"><a href="5-1-helper-functions.html#cb16-290" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-291"><a href="5-1-helper-functions.html#cb16-291" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-292"><a href="5-1-helper-functions.html#cb16-292" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-293"><a href="5-1-helper-functions.html#cb16-293" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-294"><a href="5-1-helper-functions.html#cb16-294" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-295"><a href="5-1-helper-functions.html#cb16-295" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Death</span></span>
<span id="cb16-296"><a href="5-1-helper-functions.html#cb16-296" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-297"><a href="5-1-helper-functions.html#cb16-297" aria-hidden="true" tabindex="-1"></a>                 death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-298"><a href="5-1-helper-functions.html#cb16-298" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-299"><a href="5-1-helper-functions.html#cb16-299" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## ODE 1</span></span>
<span id="cb16-300"><a href="5-1-helper-functions.html#cb16-300" aria-hidden="true" tabindex="-1"></a>                 ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-301"><a href="5-1-helper-functions.html#cb16-301" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-302"><a href="5-1-helper-functions.html#cb16-302" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-303"><a href="5-1-helper-functions.html#cb16-303" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-304"><a href="5-1-helper-functions.html#cb16-304" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-305"><a href="5-1-helper-functions.html#cb16-305" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-306"><a href="5-1-helper-functions.html#cb16-306" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-307"><a href="5-1-helper-functions.html#cb16-307" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-308"><a href="5-1-helper-functions.html#cb16-308" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Age In</span></span>
<span id="cb16-309"><a href="5-1-helper-functions.html#cb16-309" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-310"><a href="5-1-helper-functions.html#cb16-310" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-311"><a href="5-1-helper-functions.html#cb16-311" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-312"><a href="5-1-helper-functions.html#cb16-312" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-313"><a href="5-1-helper-functions.html#cb16-313" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## All other age groups</span></span>
<span id="cb16-314"><a href="5-1-helper-functions.html#cb16-314" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-315"><a href="5-1-helper-functions.html#cb16-315" aria-hidden="true" tabindex="-1"></a>                 ageIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-316"><a href="5-1-helper-functions.html#cb16-316" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-317"><a href="5-1-helper-functions.html#cb16-317" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(age <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb16-318"><a href="5-1-helper-functions.html#cb16-318" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-319"><a href="5-1-helper-functions.html#cb16-319" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## times the proportion of people who will age out</span></span>
<span id="cb16-320"><a href="5-1-helper-functions.html#cb16-320" aria-hidden="true" tabindex="-1"></a>                   ageIn <span class="ot">&lt;-</span> states[sex,age <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span>age_transitions[age <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb16-321"><a href="5-1-helper-functions.html#cb16-321" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(age <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-322"><a href="5-1-helper-functions.html#cb16-322" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-323"><a href="5-1-helper-functions.html#cb16-323" aria-hidden="true" tabindex="-1"></a>                   <span class="do">##</span></span>
<span id="cb16-324"><a href="5-1-helper-functions.html#cb16-324" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-325"><a href="5-1-helper-functions.html#cb16-325" aria-hidden="true" tabindex="-1"></a>                   <span class="do">##</span></span>
<span id="cb16-326"><a href="5-1-helper-functions.html#cb16-326" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-327"><a href="5-1-helper-functions.html#cb16-327" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-328"><a href="5-1-helper-functions.html#cb16-328" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-329"><a href="5-1-helper-functions.html#cb16-329" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Age Out</span></span>
<span id="cb16-330"><a href="5-1-helper-functions.html#cb16-330" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-331"><a href="5-1-helper-functions.html#cb16-331" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-332"><a href="5-1-helper-functions.html#cb16-332" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-333"><a href="5-1-helper-functions.html#cb16-333" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-334"><a href="5-1-helper-functions.html#cb16-334" aria-hidden="true" tabindex="-1"></a>                 ageOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-335"><a href="5-1-helper-functions.html#cb16-335" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(age <span class="sc">&lt;</span> <span class="dv">6</span>){</span>
<span id="cb16-336"><a href="5-1-helper-functions.html#cb16-336" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-337"><a href="5-1-helper-functions.html#cb16-337" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-338"><a href="5-1-helper-functions.html#cb16-338" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-339"><a href="5-1-helper-functions.html#cb16-339" aria-hidden="true" tabindex="-1"></a>                   ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-340"><a href="5-1-helper-functions.html#cb16-340" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-341"><a href="5-1-helper-functions.html#cb16-341" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-342"><a href="5-1-helper-functions.html#cb16-342" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Income In</span></span>
<span id="cb16-343"><a href="5-1-helper-functions.html#cb16-343" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-344"><a href="5-1-helper-functions.html#cb16-344" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-345"><a href="5-1-helper-functions.html#cb16-345" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-346"><a href="5-1-helper-functions.html#cb16-346" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-347"><a href="5-1-helper-functions.html#cb16-347" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-348"><a href="5-1-helper-functions.html#cb16-348" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## can transition into X from</span></span>
<span id="cb16-349"><a href="5-1-helper-functions.html#cb16-349" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-350"><a href="5-1-helper-functions.html#cb16-350" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-351"><a href="5-1-helper-functions.html#cb16-351" aria-hidden="true" tabindex="-1"></a>                 incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-352"><a href="5-1-helper-functions.html#cb16-352" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-353"><a href="5-1-helper-functions.html#cb16-353" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-354"><a href="5-1-helper-functions.html#cb16-354" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-355"><a href="5-1-helper-functions.html#cb16-355" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-356"><a href="5-1-helper-functions.html#cb16-356" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-357"><a href="5-1-helper-functions.html#cb16-357" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-358"><a href="5-1-helper-functions.html#cb16-358" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-359"><a href="5-1-helper-functions.html#cb16-359" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-360"><a href="5-1-helper-functions.html#cb16-360" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-361"><a href="5-1-helper-functions.html#cb16-361" aria-hidden="true" tabindex="-1"></a>                   mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-362"><a href="5-1-helper-functions.html#cb16-362" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-363"><a href="5-1-helper-functions.html#cb16-363" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-364"><a href="5-1-helper-functions.html#cb16-364" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## is the same</span></span>
<span id="cb16-365"><a href="5-1-helper-functions.html#cb16-365" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span>(income_level <span class="sc">!=</span> income_5_cat[income_level] <span class="sc">&amp;&amp;</span> income <span class="sc">==</span> income_5_cat[income_level]){</span>
<span id="cb16-366"><a href="5-1-helper-functions.html#cb16-366" aria-hidden="true" tabindex="-1"></a>                     mod <span class="ot">&lt;-</span> staging_modifier</span>
<span id="cb16-367"><a href="5-1-helper-functions.html#cb16-367" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb16-368"><a href="5-1-helper-functions.html#cb16-368" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-369"><a href="5-1-helper-functions.html#cb16-369" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-370"><a href="5-1-helper-functions.html#cb16-370" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-371"><a href="5-1-helper-functions.html#cb16-371" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-372"><a href="5-1-helper-functions.html#cb16-372" aria-hidden="true" tabindex="-1"></a>                   incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-373"><a href="5-1-helper-functions.html#cb16-373" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-374"><a href="5-1-helper-functions.html#cb16-374" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-375"><a href="5-1-helper-functions.html#cb16-375" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-376"><a href="5-1-helper-functions.html#cb16-376" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Income Out</span></span>
<span id="cb16-377"><a href="5-1-helper-functions.html#cb16-377" aria-hidden="true" tabindex="-1"></a>                 incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-378"><a href="5-1-helper-functions.html#cb16-378" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-379"><a href="5-1-helper-functions.html#cb16-379" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-380"><a href="5-1-helper-functions.html#cb16-380" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-381"><a href="5-1-helper-functions.html#cb16-381" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-382"><a href="5-1-helper-functions.html#cb16-382" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-383"><a href="5-1-helper-functions.html#cb16-383" aria-hidden="true" tabindex="-1"></a>                   mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-384"><a href="5-1-helper-functions.html#cb16-384" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-385"><a href="5-1-helper-functions.html#cb16-385" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span>(income <span class="sc">!=</span> income_5_cat[income] <span class="sc">&amp;&amp;</span> income_level <span class="sc">==</span> income_5_cat[income]){</span>
<span id="cb16-386"><a href="5-1-helper-functions.html#cb16-386" aria-hidden="true" tabindex="-1"></a>                     mod <span class="ot">&lt;-</span> staging_modifier</span>
<span id="cb16-387"><a href="5-1-helper-functions.html#cb16-387" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb16-388"><a href="5-1-helper-functions.html#cb16-388" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-389"><a href="5-1-helper-functions.html#cb16-389" aria-hidden="true" tabindex="-1"></a>                   incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-390"><a href="5-1-helper-functions.html#cb16-390" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-391"><a href="5-1-helper-functions.html#cb16-391" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-392"><a href="5-1-helper-functions.html#cb16-392" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-393"><a href="5-1-helper-functions.html#cb16-393" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## Income Out</span></span>
<span id="cb16-394"><a href="5-1-helper-functions.html#cb16-394" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-395"><a href="5-1-helper-functions.html#cb16-395" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-396"><a href="5-1-helper-functions.html#cb16-396" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-397"><a href="5-1-helper-functions.html#cb16-397" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># </span></span>
<span id="cb16-398"><a href="5-1-helper-functions.html#cb16-398" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-399"><a href="5-1-helper-functions.html#cb16-399" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-400"><a href="5-1-helper-functions.html#cb16-400" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-401"><a href="5-1-helper-functions.html#cb16-401" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-402"><a href="5-1-helper-functions.html#cb16-402" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-403"><a href="5-1-helper-functions.html#cb16-403" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># }else{</span></span>
<span id="cb16-404"><a href="5-1-helper-functions.html#cb16-404" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-405"><a href="5-1-helper-functions.html#cb16-405" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-406"><a href="5-1-helper-functions.html#cb16-406" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-407"><a href="5-1-helper-functions.html#cb16-407" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-408"><a href="5-1-helper-functions.html#cb16-408" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-409"><a href="5-1-helper-functions.html#cb16-409" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-410"><a href="5-1-helper-functions.html#cb16-410" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-411"><a href="5-1-helper-functions.html#cb16-411" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-412"><a href="5-1-helper-functions.html#cb16-412" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Income level changes</span></span>
<span id="cb16-413"><a href="5-1-helper-functions.html#cb16-413" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-414"><a href="5-1-helper-functions.html#cb16-414" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-415"><a href="5-1-helper-functions.html#cb16-415" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-416"><a href="5-1-helper-functions.html#cb16-416" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-417"><a href="5-1-helper-functions.html#cb16-417" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-418"><a href="5-1-helper-functions.html#cb16-418" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-419"><a href="5-1-helper-functions.html#cb16-419" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-420"><a href="5-1-helper-functions.html#cb16-420" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-421"><a href="5-1-helper-functions.html#cb16-421" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-422"><a href="5-1-helper-functions.html#cb16-422" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-423"><a href="5-1-helper-functions.html#cb16-423" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-424"><a href="5-1-helper-functions.html#cb16-424" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-425"><a href="5-1-helper-functions.html#cb16-425" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-426"><a href="5-1-helper-functions.html#cb16-426" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># }</span></span>
<span id="cb16-427"><a href="5-1-helper-functions.html#cb16-427" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-428"><a href="5-1-helper-functions.html#cb16-428" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette In</span></span>
<span id="cb16-429"><a href="5-1-helper-functions.html#cb16-429" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-430"><a href="5-1-helper-functions.html#cb16-430" aria-hidden="true" tabindex="-1"></a>                 cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-431"><a href="5-1-helper-functions.html#cb16-431" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-432"><a href="5-1-helper-functions.html#cb16-432" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-433"><a href="5-1-helper-functions.html#cb16-433" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-434"><a href="5-1-helper-functions.html#cb16-434" aria-hidden="true" tabindex="-1"></a>                 cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-435"><a href="5-1-helper-functions.html#cb16-435" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-436"><a href="5-1-helper-functions.html#cb16-436" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-437"><a href="5-1-helper-functions.html#cb16-437" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-438"><a href="5-1-helper-functions.html#cb16-438" aria-hidden="true" tabindex="-1"></a>                 cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-439"><a href="5-1-helper-functions.html#cb16-439" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-440"><a href="5-1-helper-functions.html#cb16-440" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## cigarette Out</span></span>
<span id="cb16-441"><a href="5-1-helper-functions.html#cb16-441" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-442"><a href="5-1-helper-functions.html#cb16-442" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-443"><a href="5-1-helper-functions.html#cb16-443" aria-hidden="true" tabindex="-1"></a>                 cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-444"><a href="5-1-helper-functions.html#cb16-444" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-445"><a href="5-1-helper-functions.html#cb16-445" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-446"><a href="5-1-helper-functions.html#cb16-446" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-447"><a href="5-1-helper-functions.html#cb16-447" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## e_cigarette in</span></span>
<span id="cb16-448"><a href="5-1-helper-functions.html#cb16-448" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-449"><a href="5-1-helper-functions.html#cb16-449" aria-hidden="true" tabindex="-1"></a>                 e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-450"><a href="5-1-helper-functions.html#cb16-450" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-451"><a href="5-1-helper-functions.html#cb16-451" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-452"><a href="5-1-helper-functions.html#cb16-452" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-453"><a href="5-1-helper-functions.html#cb16-453" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-454"><a href="5-1-helper-functions.html#cb16-454" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-455"><a href="5-1-helper-functions.html#cb16-455" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-456"><a href="5-1-helper-functions.html#cb16-456" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-457"><a href="5-1-helper-functions.html#cb16-457" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-458"><a href="5-1-helper-functions.html#cb16-458" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-459"><a href="5-1-helper-functions.html#cb16-459" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-460"><a href="5-1-helper-functions.html#cb16-460" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-461"><a href="5-1-helper-functions.html#cb16-461" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-462"><a href="5-1-helper-functions.html#cb16-462" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-463"><a href="5-1-helper-functions.html#cb16-463" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-464"><a href="5-1-helper-functions.html#cb16-464" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-465"><a href="5-1-helper-functions.html#cb16-465" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-466"><a href="5-1-helper-functions.html#cb16-466" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-467"><a href="5-1-helper-functions.html#cb16-467" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for cessation</span></span>
<span id="cb16-468"><a href="5-1-helper-functions.html#cb16-468" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-469"><a href="5-1-helper-functions.html#cb16-469" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-470"><a href="5-1-helper-functions.html#cb16-470" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-471"><a href="5-1-helper-functions.html#cb16-471" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-472"><a href="5-1-helper-functions.html#cb16-472" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-473"><a href="5-1-helper-functions.html#cb16-473" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## e_cigarette out</span></span>
<span id="cb16-474"><a href="5-1-helper-functions.html#cb16-474" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-475"><a href="5-1-helper-functions.html#cb16-475" aria-hidden="true" tabindex="-1"></a>                 e_cigaretteOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-476"><a href="5-1-helper-functions.html#cb16-476" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-477"><a href="5-1-helper-functions.html#cb16-477" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-478"><a href="5-1-helper-functions.html#cb16-478" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-479"><a href="5-1-helper-functions.html#cb16-479" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for initiation</span></span>
<span id="cb16-480"><a href="5-1-helper-functions.html#cb16-480" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-481"><a href="5-1-helper-functions.html#cb16-481" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-482"><a href="5-1-helper-functions.html#cb16-482" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-483"><a href="5-1-helper-functions.html#cb16-483" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-484"><a href="5-1-helper-functions.html#cb16-484" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-485"><a href="5-1-helper-functions.html#cb16-485" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for cessation</span></span>
<span id="cb16-486"><a href="5-1-helper-functions.html#cb16-486" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-487"><a href="5-1-helper-functions.html#cb16-487" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-488"><a href="5-1-helper-functions.html#cb16-488" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-489"><a href="5-1-helper-functions.html#cb16-489" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-490"><a href="5-1-helper-functions.html#cb16-490" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-491"><a href="5-1-helper-functions.html#cb16-491" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-492"><a href="5-1-helper-functions.html#cb16-492" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-493"><a href="5-1-helper-functions.html#cb16-493" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-494"><a href="5-1-helper-functions.html#cb16-494" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-495"><a href="5-1-helper-functions.html#cb16-495" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-496"><a href="5-1-helper-functions.html#cb16-496" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-497"><a href="5-1-helper-functions.html#cb16-497" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Death</span></span>
<span id="cb16-498"><a href="5-1-helper-functions.html#cb16-498" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-499"><a href="5-1-helper-functions.html#cb16-499" aria-hidden="true" tabindex="-1"></a>                 death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-500"><a href="5-1-helper-functions.html#cb16-500" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-501"><a href="5-1-helper-functions.html#cb16-501" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## ODE 2</span></span>
<span id="cb16-502"><a href="5-1-helper-functions.html#cb16-502" aria-hidden="true" tabindex="-1"></a>                 ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-503"><a href="5-1-helper-functions.html#cb16-503" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-504"><a href="5-1-helper-functions.html#cb16-504" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-505"><a href="5-1-helper-functions.html#cb16-505" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-506"><a href="5-1-helper-functions.html#cb16-506" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-507"><a href="5-1-helper-functions.html#cb16-507" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-508"><a href="5-1-helper-functions.html#cb16-508" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-509"><a href="5-1-helper-functions.html#cb16-509" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Age In</span></span>
<span id="cb16-510"><a href="5-1-helper-functions.html#cb16-510" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-511"><a href="5-1-helper-functions.html#cb16-511" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-512"><a href="5-1-helper-functions.html#cb16-512" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-513"><a href="5-1-helper-functions.html#cb16-513" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-514"><a href="5-1-helper-functions.html#cb16-514" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## All other age groups</span></span>
<span id="cb16-515"><a href="5-1-helper-functions.html#cb16-515" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-516"><a href="5-1-helper-functions.html#cb16-516" aria-hidden="true" tabindex="-1"></a>                 ageIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-517"><a href="5-1-helper-functions.html#cb16-517" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-518"><a href="5-1-helper-functions.html#cb16-518" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(age <span class="sc">&gt;</span> <span class="dv">1</span>){</span>
<span id="cb16-519"><a href="5-1-helper-functions.html#cb16-519" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-520"><a href="5-1-helper-functions.html#cb16-520" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## times the proportion of people who will age out</span></span>
<span id="cb16-521"><a href="5-1-helper-functions.html#cb16-521" aria-hidden="true" tabindex="-1"></a>                   ageIn <span class="ot">&lt;-</span> states[sex,age <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, e_cigarette,income]<span class="sc">*</span>age_transitions[age <span class="sc">-</span> <span class="dv">1</span>]</span>
<span id="cb16-522"><a href="5-1-helper-functions.html#cb16-522" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(age <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-523"><a href="5-1-helper-functions.html#cb16-523" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-524"><a href="5-1-helper-functions.html#cb16-524" aria-hidden="true" tabindex="-1"></a>                   <span class="do">##</span></span>
<span id="cb16-525"><a href="5-1-helper-functions.html#cb16-525" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-526"><a href="5-1-helper-functions.html#cb16-526" aria-hidden="true" tabindex="-1"></a>                   <span class="do">##</span></span>
<span id="cb16-527"><a href="5-1-helper-functions.html#cb16-527" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-528"><a href="5-1-helper-functions.html#cb16-528" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-529"><a href="5-1-helper-functions.html#cb16-529" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-530"><a href="5-1-helper-functions.html#cb16-530" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Age Out</span></span>
<span id="cb16-531"><a href="5-1-helper-functions.html#cb16-531" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-532"><a href="5-1-helper-functions.html#cb16-532" aria-hidden="true" tabindex="-1"></a>                 <span class="do">##</span></span>
<span id="cb16-533"><a href="5-1-helper-functions.html#cb16-533" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-534"><a href="5-1-helper-functions.html#cb16-534" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-535"><a href="5-1-helper-functions.html#cb16-535" aria-hidden="true" tabindex="-1"></a>                 ageOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-536"><a href="5-1-helper-functions.html#cb16-536" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(age <span class="sc">&lt;</span> <span class="dv">6</span>){</span>
<span id="cb16-537"><a href="5-1-helper-functions.html#cb16-537" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-538"><a href="5-1-helper-functions.html#cb16-538" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-539"><a href="5-1-helper-functions.html#cb16-539" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-540"><a href="5-1-helper-functions.html#cb16-540" aria-hidden="true" tabindex="-1"></a>                   ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-541"><a href="5-1-helper-functions.html#cb16-541" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-542"><a href="5-1-helper-functions.html#cb16-542" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-543"><a href="5-1-helper-functions.html#cb16-543" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Income In</span></span>
<span id="cb16-544"><a href="5-1-helper-functions.html#cb16-544" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-545"><a href="5-1-helper-functions.html#cb16-545" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-546"><a href="5-1-helper-functions.html#cb16-546" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-547"><a href="5-1-helper-functions.html#cb16-547" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-548"><a href="5-1-helper-functions.html#cb16-548" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-549"><a href="5-1-helper-functions.html#cb16-549" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## can transition into X from</span></span>
<span id="cb16-550"><a href="5-1-helper-functions.html#cb16-550" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-551"><a href="5-1-helper-functions.html#cb16-551" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-552"><a href="5-1-helper-functions.html#cb16-552" aria-hidden="true" tabindex="-1"></a>                 incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-553"><a href="5-1-helper-functions.html#cb16-553" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-554"><a href="5-1-helper-functions.html#cb16-554" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-555"><a href="5-1-helper-functions.html#cb16-555" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-556"><a href="5-1-helper-functions.html#cb16-556" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-557"><a href="5-1-helper-functions.html#cb16-557" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-558"><a href="5-1-helper-functions.html#cb16-558" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-559"><a href="5-1-helper-functions.html#cb16-559" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-560"><a href="5-1-helper-functions.html#cb16-560" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-561"><a href="5-1-helper-functions.html#cb16-561" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-562"><a href="5-1-helper-functions.html#cb16-562" aria-hidden="true" tabindex="-1"></a>                   mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-563"><a href="5-1-helper-functions.html#cb16-563" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-564"><a href="5-1-helper-functions.html#cb16-564" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-565"><a href="5-1-helper-functions.html#cb16-565" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## is the same</span></span>
<span id="cb16-566"><a href="5-1-helper-functions.html#cb16-566" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span>(income_level <span class="sc">!=</span> income_5_cat[income_level] <span class="sc">&amp;&amp;</span> income <span class="sc">==</span> income_5_cat[income_level]){</span>
<span id="cb16-567"><a href="5-1-helper-functions.html#cb16-567" aria-hidden="true" tabindex="-1"></a>                     mod <span class="ot">&lt;-</span> staging_modifier</span>
<span id="cb16-568"><a href="5-1-helper-functions.html#cb16-568" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb16-569"><a href="5-1-helper-functions.html#cb16-569" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-570"><a href="5-1-helper-functions.html#cb16-570" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-571"><a href="5-1-helper-functions.html#cb16-571" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-572"><a href="5-1-helper-functions.html#cb16-572" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-573"><a href="5-1-helper-functions.html#cb16-573" aria-hidden="true" tabindex="-1"></a>                   incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-574"><a href="5-1-helper-functions.html#cb16-574" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-575"><a href="5-1-helper-functions.html#cb16-575" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-576"><a href="5-1-helper-functions.html#cb16-576" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-577"><a href="5-1-helper-functions.html#cb16-577" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Income Out</span></span>
<span id="cb16-578"><a href="5-1-helper-functions.html#cb16-578" aria-hidden="true" tabindex="-1"></a>                 incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-579"><a href="5-1-helper-functions.html#cb16-579" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-580"><a href="5-1-helper-functions.html#cb16-580" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-581"><a href="5-1-helper-functions.html#cb16-581" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-582"><a href="5-1-helper-functions.html#cb16-582" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-583"><a href="5-1-helper-functions.html#cb16-583" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-584"><a href="5-1-helper-functions.html#cb16-584" aria-hidden="true" tabindex="-1"></a>                   mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-585"><a href="5-1-helper-functions.html#cb16-585" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-586"><a href="5-1-helper-functions.html#cb16-586" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">if</span>(income <span class="sc">!=</span> income_5_cat[income] <span class="sc">&amp;&amp;</span> income_level <span class="sc">==</span> income_5_cat[income]){</span>
<span id="cb16-587"><a href="5-1-helper-functions.html#cb16-587" aria-hidden="true" tabindex="-1"></a>                     mod <span class="ot">&lt;-</span> staging_modifier</span>
<span id="cb16-588"><a href="5-1-helper-functions.html#cb16-588" aria-hidden="true" tabindex="-1"></a>                   }</span>
<span id="cb16-589"><a href="5-1-helper-functions.html#cb16-589" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-590"><a href="5-1-helper-functions.html#cb16-590" aria-hidden="true" tabindex="-1"></a>                   incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-591"><a href="5-1-helper-functions.html#cb16-591" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-592"><a href="5-1-helper-functions.html#cb16-592" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-593"><a href="5-1-helper-functions.html#cb16-593" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-594"><a href="5-1-helper-functions.html#cb16-594" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># </span></span>
<span id="cb16-595"><a href="5-1-helper-functions.html#cb16-595" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## Income Out</span></span>
<span id="cb16-596"><a href="5-1-helper-functions.html#cb16-596" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-597"><a href="5-1-helper-functions.html#cb16-597" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-598"><a href="5-1-helper-functions.html#cb16-598" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-599"><a href="5-1-helper-functions.html#cb16-599" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># </span></span>
<span id="cb16-600"><a href="5-1-helper-functions.html#cb16-600" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-601"><a href="5-1-helper-functions.html#cb16-601" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-602"><a href="5-1-helper-functions.html#cb16-602" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-603"><a href="5-1-helper-functions.html#cb16-603" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-604"><a href="5-1-helper-functions.html#cb16-604" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-605"><a href="5-1-helper-functions.html#cb16-605" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># }else{</span></span>
<span id="cb16-606"><a href="5-1-helper-functions.html#cb16-606" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-607"><a href="5-1-helper-functions.html#cb16-607" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-608"><a href="5-1-helper-functions.html#cb16-608" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-609"><a href="5-1-helper-functions.html#cb16-609" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-610"><a href="5-1-helper-functions.html#cb16-610" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-611"><a href="5-1-helper-functions.html#cb16-611" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-612"><a href="5-1-helper-functions.html#cb16-612" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-613"><a href="5-1-helper-functions.html#cb16-613" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-614"><a href="5-1-helper-functions.html#cb16-614" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Income level changes</span></span>
<span id="cb16-615"><a href="5-1-helper-functions.html#cb16-615" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-616"><a href="5-1-helper-functions.html#cb16-616" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ##</span></span>
<span id="cb16-617"><a href="5-1-helper-functions.html#cb16-617" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-618"><a href="5-1-helper-functions.html#cb16-618" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-619"><a href="5-1-helper-functions.html#cb16-619" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-620"><a href="5-1-helper-functions.html#cb16-620" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-621"><a href="5-1-helper-functions.html#cb16-621" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-622"><a href="5-1-helper-functions.html#cb16-622" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-623"><a href="5-1-helper-functions.html#cb16-623" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-624"><a href="5-1-helper-functions.html#cb16-624" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-625"><a href="5-1-helper-functions.html#cb16-625" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-626"><a href="5-1-helper-functions.html#cb16-626" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-627"><a href="5-1-helper-functions.html#cb16-627" aria-hidden="true" tabindex="-1"></a>                 <span class="co">#   </span></span>
<span id="cb16-628"><a href="5-1-helper-functions.html#cb16-628" aria-hidden="true" tabindex="-1"></a>                 <span class="co"># }</span></span>
<span id="cb16-629"><a href="5-1-helper-functions.html#cb16-629" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-630"><a href="5-1-helper-functions.html#cb16-630" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Cigarette In</span></span>
<span id="cb16-631"><a href="5-1-helper-functions.html#cb16-631" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-632"><a href="5-1-helper-functions.html#cb16-632" aria-hidden="true" tabindex="-1"></a>                 cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-633"><a href="5-1-helper-functions.html#cb16-633" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-634"><a href="5-1-helper-functions.html#cb16-634" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-635"><a href="5-1-helper-functions.html#cb16-635" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-636"><a href="5-1-helper-functions.html#cb16-636" aria-hidden="true" tabindex="-1"></a>                 cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-637"><a href="5-1-helper-functions.html#cb16-637" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-638"><a href="5-1-helper-functions.html#cb16-638" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## cigarette Out</span></span>
<span id="cb16-639"><a href="5-1-helper-functions.html#cb16-639" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-640"><a href="5-1-helper-functions.html#cb16-640" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-641"><a href="5-1-helper-functions.html#cb16-641" aria-hidden="true" tabindex="-1"></a>                 cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-642"><a href="5-1-helper-functions.html#cb16-642" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-643"><a href="5-1-helper-functions.html#cb16-643" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-644"><a href="5-1-helper-functions.html#cb16-644" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-645"><a href="5-1-helper-functions.html#cb16-645" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## e_cigarette in</span></span>
<span id="cb16-646"><a href="5-1-helper-functions.html#cb16-646" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-647"><a href="5-1-helper-functions.html#cb16-647" aria-hidden="true" tabindex="-1"></a>                 e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-648"><a href="5-1-helper-functions.html#cb16-648" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-649"><a href="5-1-helper-functions.html#cb16-649" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-650"><a href="5-1-helper-functions.html#cb16-650" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-651"><a href="5-1-helper-functions.html#cb16-651" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-652"><a href="5-1-helper-functions.html#cb16-652" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-653"><a href="5-1-helper-functions.html#cb16-653" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-654"><a href="5-1-helper-functions.html#cb16-654" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-655"><a href="5-1-helper-functions.html#cb16-655" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-656"><a href="5-1-helper-functions.html#cb16-656" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-657"><a href="5-1-helper-functions.html#cb16-657" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-658"><a href="5-1-helper-functions.html#cb16-658" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-659"><a href="5-1-helper-functions.html#cb16-659" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-660"><a href="5-1-helper-functions.html#cb16-660" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-661"><a href="5-1-helper-functions.html#cb16-661" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-662"><a href="5-1-helper-functions.html#cb16-662" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-663"><a href="5-1-helper-functions.html#cb16-663" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-664"><a href="5-1-helper-functions.html#cb16-664" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-665"><a href="5-1-helper-functions.html#cb16-665" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for cessation</span></span>
<span id="cb16-666"><a href="5-1-helper-functions.html#cb16-666" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-667"><a href="5-1-helper-functions.html#cb16-667" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-668"><a href="5-1-helper-functions.html#cb16-668" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-669"><a href="5-1-helper-functions.html#cb16-669" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-670"><a href="5-1-helper-functions.html#cb16-670" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-671"><a href="5-1-helper-functions.html#cb16-671" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## e_cigarette out</span></span>
<span id="cb16-672"><a href="5-1-helper-functions.html#cb16-672" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-673"><a href="5-1-helper-functions.html#cb16-673" aria-hidden="true" tabindex="-1"></a>                 e_cigaretteOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-674"><a href="5-1-helper-functions.html#cb16-674" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-675"><a href="5-1-helper-functions.html#cb16-675" aria-hidden="true" tabindex="-1"></a>                 <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-676"><a href="5-1-helper-functions.html#cb16-676" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-677"><a href="5-1-helper-functions.html#cb16-677" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for initiation</span></span>
<span id="cb16-678"><a href="5-1-helper-functions.html#cb16-678" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-679"><a href="5-1-helper-functions.html#cb16-679" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-680"><a href="5-1-helper-functions.html#cb16-680" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-681"><a href="5-1-helper-functions.html#cb16-681" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-682"><a href="5-1-helper-functions.html#cb16-682" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-683"><a href="5-1-helper-functions.html#cb16-683" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for cessation</span></span>
<span id="cb16-684"><a href="5-1-helper-functions.html#cb16-684" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-685"><a href="5-1-helper-functions.html#cb16-685" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-686"><a href="5-1-helper-functions.html#cb16-686" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-687"><a href="5-1-helper-functions.html#cb16-687" aria-hidden="true" tabindex="-1"></a>                 }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-688"><a href="5-1-helper-functions.html#cb16-688" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-689"><a href="5-1-helper-functions.html#cb16-689" aria-hidden="true" tabindex="-1"></a>                   <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-690"><a href="5-1-helper-functions.html#cb16-690" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-691"><a href="5-1-helper-functions.html#cb16-691" aria-hidden="true" tabindex="-1"></a>                   e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-692"><a href="5-1-helper-functions.html#cb16-692" aria-hidden="true" tabindex="-1"></a>                   </span>
<span id="cb16-693"><a href="5-1-helper-functions.html#cb16-693" aria-hidden="true" tabindex="-1"></a>                 }</span>
<span id="cb16-694"><a href="5-1-helper-functions.html#cb16-694" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-695"><a href="5-1-helper-functions.html#cb16-695" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## Death</span></span>
<span id="cb16-696"><a href="5-1-helper-functions.html#cb16-696" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-697"><a href="5-1-helper-functions.html#cb16-697" aria-hidden="true" tabindex="-1"></a>                 death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-698"><a href="5-1-helper-functions.html#cb16-698" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb16-699"><a href="5-1-helper-functions.html#cb16-699" aria-hidden="true" tabindex="-1"></a>                 <span class="do">## ODE 3</span></span>
<span id="cb16-700"><a href="5-1-helper-functions.html#cb16-700" aria-hidden="true" tabindex="-1"></a>                 ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-701"><a href="5-1-helper-functions.html#cb16-701" aria-hidden="true" tabindex="-1"></a>               }</span>
<span id="cb16-702"><a href="5-1-helper-functions.html#cb16-702" aria-hidden="true" tabindex="-1"></a>             }</span>
<span id="cb16-703"><a href="5-1-helper-functions.html#cb16-703" aria-hidden="true" tabindex="-1"></a>           }</span>
<span id="cb16-704"><a href="5-1-helper-functions.html#cb16-704" aria-hidden="true" tabindex="-1"></a>         }</span>
<span id="cb16-705"><a href="5-1-helper-functions.html#cb16-705" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-706"><a href="5-1-helper-functions.html#cb16-706" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-707"><a href="5-1-helper-functions.html#cb16-707" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-708"><a href="5-1-helper-functions.html#cb16-708" aria-hidden="true" tabindex="-1"></a>         </span>
<span id="cb16-709"><a href="5-1-helper-functions.html#cb16-709" aria-hidden="true" tabindex="-1"></a>         <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-710"><a href="5-1-helper-functions.html#cb16-710" aria-hidden="true" tabindex="-1"></a>         <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-711"><a href="5-1-helper-functions.html#cb16-711" aria-hidden="true" tabindex="-1"></a>       })</span>
<span id="cb16-712"><a href="5-1-helper-functions.html#cb16-712" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-713"><a href="5-1-helper-functions.html#cb16-713" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-714"><a href="5-1-helper-functions.html#cb16-714" aria-hidden="true" tabindex="-1"></a>de_fun_beta2_female <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-715"><a href="5-1-helper-functions.html#cb16-715" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-716"><a href="5-1-helper-functions.html#cb16-716" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-717"><a href="5-1-helper-functions.html#cb16-717" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-718"><a href="5-1-helper-functions.html#cb16-718" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-719"><a href="5-1-helper-functions.html#cb16-719" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-720"><a href="5-1-helper-functions.html#cb16-720" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-721"><a href="5-1-helper-functions.html#cb16-721" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-722"><a href="5-1-helper-functions.html#cb16-722" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-723"><a href="5-1-helper-functions.html#cb16-723" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-724"><a href="5-1-helper-functions.html#cb16-724" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-725"><a href="5-1-helper-functions.html#cb16-725" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-726"><a href="5-1-helper-functions.html#cb16-726" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-727"><a href="5-1-helper-functions.html#cb16-727" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-728"><a href="5-1-helper-functions.html#cb16-728" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-729"><a href="5-1-helper-functions.html#cb16-729" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-730"><a href="5-1-helper-functions.html#cb16-730" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-731"><a href="5-1-helper-functions.html#cb16-731" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-732"><a href="5-1-helper-functions.html#cb16-732" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-733"><a href="5-1-helper-functions.html#cb16-733" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-734"><a href="5-1-helper-functions.html#cb16-734" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-735"><a href="5-1-helper-functions.html#cb16-735" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-736"><a href="5-1-helper-functions.html#cb16-736" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-737"><a href="5-1-helper-functions.html#cb16-737" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-738"><a href="5-1-helper-functions.html#cb16-738" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-739"><a href="5-1-helper-functions.html#cb16-739" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-740"><a href="5-1-helper-functions.html#cb16-740" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-741"><a href="5-1-helper-functions.html#cb16-741" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-742"><a href="5-1-helper-functions.html#cb16-742" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-743"><a href="5-1-helper-functions.html#cb16-743" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-744"><a href="5-1-helper-functions.html#cb16-744" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-745"><a href="5-1-helper-functions.html#cb16-745" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-746"><a href="5-1-helper-functions.html#cb16-746" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-747"><a href="5-1-helper-functions.html#cb16-747" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-748"><a href="5-1-helper-functions.html#cb16-748" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-749"><a href="5-1-helper-functions.html#cb16-749" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-750"><a href="5-1-helper-functions.html#cb16-750" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-751"><a href="5-1-helper-functions.html#cb16-751" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-752"><a href="5-1-helper-functions.html#cb16-752" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-753"><a href="5-1-helper-functions.html#cb16-753" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-754"><a href="5-1-helper-functions.html#cb16-754" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-755"><a href="5-1-helper-functions.html#cb16-755" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-756"><a href="5-1-helper-functions.html#cb16-756" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-757"><a href="5-1-helper-functions.html#cb16-757" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-758"><a href="5-1-helper-functions.html#cb16-758" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-759"><a href="5-1-helper-functions.html#cb16-759" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-760"><a href="5-1-helper-functions.html#cb16-760" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-761"><a href="5-1-helper-functions.html#cb16-761" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-762"><a href="5-1-helper-functions.html#cb16-762" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-763"><a href="5-1-helper-functions.html#cb16-763" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-764"><a href="5-1-helper-functions.html#cb16-764" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-765"><a href="5-1-helper-functions.html#cb16-765" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-766"><a href="5-1-helper-functions.html#cb16-766" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-767"><a href="5-1-helper-functions.html#cb16-767" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-768"><a href="5-1-helper-functions.html#cb16-768" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-769"><a href="5-1-helper-functions.html#cb16-769" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-770"><a href="5-1-helper-functions.html#cb16-770" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-771"><a href="5-1-helper-functions.html#cb16-771" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-772"><a href="5-1-helper-functions.html#cb16-772" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-773"><a href="5-1-helper-functions.html#cb16-773" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-774"><a href="5-1-helper-functions.html#cb16-774" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-775"><a href="5-1-helper-functions.html#cb16-775" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-776"><a href="5-1-helper-functions.html#cb16-776" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-777"><a href="5-1-helper-functions.html#cb16-777" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-778"><a href="5-1-helper-functions.html#cb16-778" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-779"><a href="5-1-helper-functions.html#cb16-779" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-780"><a href="5-1-helper-functions.html#cb16-780" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-781"><a href="5-1-helper-functions.html#cb16-781" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-782"><a href="5-1-helper-functions.html#cb16-782" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-783"><a href="5-1-helper-functions.html#cb16-783" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-784"><a href="5-1-helper-functions.html#cb16-784" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-785"><a href="5-1-helper-functions.html#cb16-785" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-786"><a href="5-1-helper-functions.html#cb16-786" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-787"><a href="5-1-helper-functions.html#cb16-787" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-788"><a href="5-1-helper-functions.html#cb16-788" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-789"><a href="5-1-helper-functions.html#cb16-789" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-790"><a href="5-1-helper-functions.html#cb16-790" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-791"><a href="5-1-helper-functions.html#cb16-791" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-792"><a href="5-1-helper-functions.html#cb16-792" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-793"><a href="5-1-helper-functions.html#cb16-793" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-794"><a href="5-1-helper-functions.html#cb16-794" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-795"><a href="5-1-helper-functions.html#cb16-795" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-796"><a href="5-1-helper-functions.html#cb16-796" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-797"><a href="5-1-helper-functions.html#cb16-797" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-798"><a href="5-1-helper-functions.html#cb16-798" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-799"><a href="5-1-helper-functions.html#cb16-799" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-800"><a href="5-1-helper-functions.html#cb16-800" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-801"><a href="5-1-helper-functions.html#cb16-801" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-802"><a href="5-1-helper-functions.html#cb16-802" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-803"><a href="5-1-helper-functions.html#cb16-803" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-804"><a href="5-1-helper-functions.html#cb16-804" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-805"><a href="5-1-helper-functions.html#cb16-805" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-806"><a href="5-1-helper-functions.html#cb16-806" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-807"><a href="5-1-helper-functions.html#cb16-807" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-808"><a href="5-1-helper-functions.html#cb16-808" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-809"><a href="5-1-helper-functions.html#cb16-809" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-810"><a href="5-1-helper-functions.html#cb16-810" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-811"><a href="5-1-helper-functions.html#cb16-811" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-812"><a href="5-1-helper-functions.html#cb16-812" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb16-813"><a href="5-1-helper-functions.html#cb16-813" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-814"><a href="5-1-helper-functions.html#cb16-814" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-815"><a href="5-1-helper-functions.html#cb16-815" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-816"><a href="5-1-helper-functions.html#cb16-816" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-817"><a href="5-1-helper-functions.html#cb16-817" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-818"><a href="5-1-helper-functions.html#cb16-818" aria-hidden="true" tabindex="-1"></a>  ODEs[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-819"><a href="5-1-helper-functions.html#cb16-819" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-820"><a href="5-1-helper-functions.html#cb16-820" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-821"><a href="5-1-helper-functions.html#cb16-821" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-822"><a href="5-1-helper-functions.html#cb16-822" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-823"><a href="5-1-helper-functions.html#cb16-823" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-824"><a href="5-1-helper-functions.html#cb16-824" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-825"><a href="5-1-helper-functions.html#cb16-825" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb16-826"><a href="5-1-helper-functions.html#cb16-826" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb16-827"><a href="5-1-helper-functions.html#cb16-827" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-828"><a href="5-1-helper-functions.html#cb16-828" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-829"><a href="5-1-helper-functions.html#cb16-829" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-830"><a href="5-1-helper-functions.html#cb16-830" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-831"><a href="5-1-helper-functions.html#cb16-831" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb16-832"><a href="5-1-helper-functions.html#cb16-832" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-833"><a href="5-1-helper-functions.html#cb16-833" aria-hidden="true" tabindex="-1"></a>      <span class="co"># for(sex in 1:sex_types){</span></span>
<span id="cb16-834"><a href="5-1-helper-functions.html#cb16-834" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-835"><a href="5-1-helper-functions.html#cb16-835" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-836"><a href="5-1-helper-functions.html#cb16-836" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-837"><a href="5-1-helper-functions.html#cb16-837" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-838"><a href="5-1-helper-functions.html#cb16-838" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-839"><a href="5-1-helper-functions.html#cb16-839" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-840"><a href="5-1-helper-functions.html#cb16-840" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-841"><a href="5-1-helper-functions.html#cb16-841" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-842"><a href="5-1-helper-functions.html#cb16-842" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-843"><a href="5-1-helper-functions.html#cb16-843" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-844"><a href="5-1-helper-functions.html#cb16-844" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-845"><a href="5-1-helper-functions.html#cb16-845" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-846"><a href="5-1-helper-functions.html#cb16-846" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-847"><a href="5-1-helper-functions.html#cb16-847" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-848"><a href="5-1-helper-functions.html#cb16-848" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-849"><a href="5-1-helper-functions.html#cb16-849" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-850"><a href="5-1-helper-functions.html#cb16-850" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-851"><a href="5-1-helper-functions.html#cb16-851" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-852"><a href="5-1-helper-functions.html#cb16-852" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-853"><a href="5-1-helper-functions.html#cb16-853" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-854"><a href="5-1-helper-functions.html#cb16-854" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-855"><a href="5-1-helper-functions.html#cb16-855" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-856"><a href="5-1-helper-functions.html#cb16-856" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-857"><a href="5-1-helper-functions.html#cb16-857" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-858"><a href="5-1-helper-functions.html#cb16-858" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-859"><a href="5-1-helper-functions.html#cb16-859" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-860"><a href="5-1-helper-functions.html#cb16-860" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-861"><a href="5-1-helper-functions.html#cb16-861" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-862"><a href="5-1-helper-functions.html#cb16-862" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-863"><a href="5-1-helper-functions.html#cb16-863" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-864"><a href="5-1-helper-functions.html#cb16-864" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-865"><a href="5-1-helper-functions.html#cb16-865" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-866"><a href="5-1-helper-functions.html#cb16-866" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-867"><a href="5-1-helper-functions.html#cb16-867" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-868"><a href="5-1-helper-functions.html#cb16-868" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-869"><a href="5-1-helper-functions.html#cb16-869" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-870"><a href="5-1-helper-functions.html#cb16-870" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-871"><a href="5-1-helper-functions.html#cb16-871" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-872"><a href="5-1-helper-functions.html#cb16-872" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-873"><a href="5-1-helper-functions.html#cb16-873" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-874"><a href="5-1-helper-functions.html#cb16-874" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-875"><a href="5-1-helper-functions.html#cb16-875" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-876"><a href="5-1-helper-functions.html#cb16-876" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-877"><a href="5-1-helper-functions.html#cb16-877" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-878"><a href="5-1-helper-functions.html#cb16-878" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-879"><a href="5-1-helper-functions.html#cb16-879" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-880"><a href="5-1-helper-functions.html#cb16-880" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-881"><a href="5-1-helper-functions.html#cb16-881" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-882"><a href="5-1-helper-functions.html#cb16-882" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-883"><a href="5-1-helper-functions.html#cb16-883" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-884"><a href="5-1-helper-functions.html#cb16-884" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-885"><a href="5-1-helper-functions.html#cb16-885" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-886"><a href="5-1-helper-functions.html#cb16-886" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-887"><a href="5-1-helper-functions.html#cb16-887" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-888"><a href="5-1-helper-functions.html#cb16-888" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-889"><a href="5-1-helper-functions.html#cb16-889" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-890"><a href="5-1-helper-functions.html#cb16-890" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-891"><a href="5-1-helper-functions.html#cb16-891" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-892"><a href="5-1-helper-functions.html#cb16-892" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-893"><a href="5-1-helper-functions.html#cb16-893" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-894"><a href="5-1-helper-functions.html#cb16-894" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-895"><a href="5-1-helper-functions.html#cb16-895" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-896"><a href="5-1-helper-functions.html#cb16-896" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-897"><a href="5-1-helper-functions.html#cb16-897" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-898"><a href="5-1-helper-functions.html#cb16-898" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-899"><a href="5-1-helper-functions.html#cb16-899" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-900"><a href="5-1-helper-functions.html#cb16-900" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-901"><a href="5-1-helper-functions.html#cb16-901" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-902"><a href="5-1-helper-functions.html#cb16-902" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-903"><a href="5-1-helper-functions.html#cb16-903" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-904"><a href="5-1-helper-functions.html#cb16-904" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-905"><a href="5-1-helper-functions.html#cb16-905" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-906"><a href="5-1-helper-functions.html#cb16-906" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-907"><a href="5-1-helper-functions.html#cb16-907" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-908"><a href="5-1-helper-functions.html#cb16-908" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-909"><a href="5-1-helper-functions.html#cb16-909" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-910"><a href="5-1-helper-functions.html#cb16-910" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-911"><a href="5-1-helper-functions.html#cb16-911" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-912"><a href="5-1-helper-functions.html#cb16-912" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-913"><a href="5-1-helper-functions.html#cb16-913" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-914"><a href="5-1-helper-functions.html#cb16-914" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-915"><a href="5-1-helper-functions.html#cb16-915" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-916"><a href="5-1-helper-functions.html#cb16-916" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-917"><a href="5-1-helper-functions.html#cb16-917" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-918"><a href="5-1-helper-functions.html#cb16-918" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-919"><a href="5-1-helper-functions.html#cb16-919" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-920"><a href="5-1-helper-functions.html#cb16-920" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-921"><a href="5-1-helper-functions.html#cb16-921" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-922"><a href="5-1-helper-functions.html#cb16-922" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-923"><a href="5-1-helper-functions.html#cb16-923" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-924"><a href="5-1-helper-functions.html#cb16-924" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-925"><a href="5-1-helper-functions.html#cb16-925" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-926"><a href="5-1-helper-functions.html#cb16-926" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-927"><a href="5-1-helper-functions.html#cb16-927" aria-hidden="true" tabindex="-1"></a>          <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-928"><a href="5-1-helper-functions.html#cb16-928" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-929"><a href="5-1-helper-functions.html#cb16-929" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-930"><a href="5-1-helper-functions.html#cb16-930" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-931"><a href="5-1-helper-functions.html#cb16-931" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-932"><a href="5-1-helper-functions.html#cb16-932" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-933"><a href="5-1-helper-functions.html#cb16-933" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-934"><a href="5-1-helper-functions.html#cb16-934" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-935"><a href="5-1-helper-functions.html#cb16-935" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-936"><a href="5-1-helper-functions.html#cb16-936" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-937"><a href="5-1-helper-functions.html#cb16-937" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-938"><a href="5-1-helper-functions.html#cb16-938" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-939"><a href="5-1-helper-functions.html#cb16-939" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-940"><a href="5-1-helper-functions.html#cb16-940" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-941"><a href="5-1-helper-functions.html#cb16-941" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-942"><a href="5-1-helper-functions.html#cb16-942" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-943"><a href="5-1-helper-functions.html#cb16-943" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-944"><a href="5-1-helper-functions.html#cb16-944" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-945"><a href="5-1-helper-functions.html#cb16-945" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-946"><a href="5-1-helper-functions.html#cb16-946" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-947"><a href="5-1-helper-functions.html#cb16-947" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-948"><a href="5-1-helper-functions.html#cb16-948" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-949"><a href="5-1-helper-functions.html#cb16-949" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-950"><a href="5-1-helper-functions.html#cb16-950" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-951"><a href="5-1-helper-functions.html#cb16-951" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-952"><a href="5-1-helper-functions.html#cb16-952" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-953"><a href="5-1-helper-functions.html#cb16-953" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-954"><a href="5-1-helper-functions.html#cb16-954" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-955"><a href="5-1-helper-functions.html#cb16-955" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-956"><a href="5-1-helper-functions.html#cb16-956" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-957"><a href="5-1-helper-functions.html#cb16-957" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-958"><a href="5-1-helper-functions.html#cb16-958" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-959"><a href="5-1-helper-functions.html#cb16-959" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-960"><a href="5-1-helper-functions.html#cb16-960" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-961"><a href="5-1-helper-functions.html#cb16-961" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-962"><a href="5-1-helper-functions.html#cb16-962" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-963"><a href="5-1-helper-functions.html#cb16-963" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-964"><a href="5-1-helper-functions.html#cb16-964" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-965"><a href="5-1-helper-functions.html#cb16-965" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-966"><a href="5-1-helper-functions.html#cb16-966" aria-hidden="true" tabindex="-1"></a>        <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-967"><a href="5-1-helper-functions.html#cb16-967" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-968"><a href="5-1-helper-functions.html#cb16-968" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-969"><a href="5-1-helper-functions.html#cb16-969" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-970"><a href="5-1-helper-functions.html#cb16-970" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-971"><a href="5-1-helper-functions.html#cb16-971" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-972"><a href="5-1-helper-functions.html#cb16-972" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-973"><a href="5-1-helper-functions.html#cb16-973" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-974"><a href="5-1-helper-functions.html#cb16-974" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-975"><a href="5-1-helper-functions.html#cb16-975" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-976"><a href="5-1-helper-functions.html#cb16-976" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-977"><a href="5-1-helper-functions.html#cb16-977" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-978"><a href="5-1-helper-functions.html#cb16-978" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-979"><a href="5-1-helper-functions.html#cb16-979" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-980"><a href="5-1-helper-functions.html#cb16-980" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-981"><a href="5-1-helper-functions.html#cb16-981" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-982"><a href="5-1-helper-functions.html#cb16-982" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-983"><a href="5-1-helper-functions.html#cb16-983" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-984"><a href="5-1-helper-functions.html#cb16-984" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-985"><a href="5-1-helper-functions.html#cb16-985" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else </span></span>
<span id="cb16-986"><a href="5-1-helper-functions.html#cb16-986" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-987"><a href="5-1-helper-functions.html#cb16-987" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-988"><a href="5-1-helper-functions.html#cb16-988" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-989"><a href="5-1-helper-functions.html#cb16-989" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-990"><a href="5-1-helper-functions.html#cb16-990" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-991"><a href="5-1-helper-functions.html#cb16-991" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-992"><a href="5-1-helper-functions.html#cb16-992" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-993"><a href="5-1-helper-functions.html#cb16-993" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-994"><a href="5-1-helper-functions.html#cb16-994" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-995"><a href="5-1-helper-functions.html#cb16-995" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-996"><a href="5-1-helper-functions.html#cb16-996" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-997"><a href="5-1-helper-functions.html#cb16-997" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-998"><a href="5-1-helper-functions.html#cb16-998" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-999"><a href="5-1-helper-functions.html#cb16-999" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1000"><a href="5-1-helper-functions.html#cb16-1000" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1001"><a href="5-1-helper-functions.html#cb16-1001" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-1002"><a href="5-1-helper-functions.html#cb16-1002" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1003"><a href="5-1-helper-functions.html#cb16-1003" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1004"><a href="5-1-helper-functions.html#cb16-1004" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1005"><a href="5-1-helper-functions.html#cb16-1005" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-1006"><a href="5-1-helper-functions.html#cb16-1006" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1007"><a href="5-1-helper-functions.html#cb16-1007" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-1008"><a href="5-1-helper-functions.html#cb16-1008" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1009"><a href="5-1-helper-functions.html#cb16-1009" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-1010"><a href="5-1-helper-functions.html#cb16-1010" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1011"><a href="5-1-helper-functions.html#cb16-1011" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-1012"><a href="5-1-helper-functions.html#cb16-1012" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1013"><a href="5-1-helper-functions.html#cb16-1013" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-1014"><a href="5-1-helper-functions.html#cb16-1014" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1015"><a href="5-1-helper-functions.html#cb16-1015" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-1016"><a href="5-1-helper-functions.html#cb16-1016" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1017"><a href="5-1-helper-functions.html#cb16-1017" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-1018"><a href="5-1-helper-functions.html#cb16-1018" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1019"><a href="5-1-helper-functions.html#cb16-1019" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1020"><a href="5-1-helper-functions.html#cb16-1020" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1021"><a href="5-1-helper-functions.html#cb16-1021" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-1022"><a href="5-1-helper-functions.html#cb16-1022" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1023"><a href="5-1-helper-functions.html#cb16-1023" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1024"><a href="5-1-helper-functions.html#cb16-1024" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1025"><a href="5-1-helper-functions.html#cb16-1025" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1026"><a href="5-1-helper-functions.html#cb16-1026" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1027"><a href="5-1-helper-functions.html#cb16-1027" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-1028"><a href="5-1-helper-functions.html#cb16-1028" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1029"><a href="5-1-helper-functions.html#cb16-1029" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1030"><a href="5-1-helper-functions.html#cb16-1030" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1031"><a href="5-1-helper-functions.html#cb16-1031" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-1032"><a href="5-1-helper-functions.html#cb16-1032" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1033"><a href="5-1-helper-functions.html#cb16-1033" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-1034"><a href="5-1-helper-functions.html#cb16-1034" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1035"><a href="5-1-helper-functions.html#cb16-1035" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 1</span></span>
<span id="cb16-1036"><a href="5-1-helper-functions.html#cb16-1036" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-1037"><a href="5-1-helper-functions.html#cb16-1037" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1038"><a href="5-1-helper-functions.html#cb16-1038" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1039"><a href="5-1-helper-functions.html#cb16-1039" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1040"><a href="5-1-helper-functions.html#cb16-1040" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-1041"><a href="5-1-helper-functions.html#cb16-1041" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1042"><a href="5-1-helper-functions.html#cb16-1042" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1043"><a href="5-1-helper-functions.html#cb16-1043" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1044"><a href="5-1-helper-functions.html#cb16-1044" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-1045"><a href="5-1-helper-functions.html#cb16-1045" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1046"><a href="5-1-helper-functions.html#cb16-1046" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1047"><a href="5-1-helper-functions.html#cb16-1047" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-1048"><a href="5-1-helper-functions.html#cb16-1048" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-1049"><a href="5-1-helper-functions.html#cb16-1049" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-1050"><a href="5-1-helper-functions.html#cb16-1050" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1051"><a href="5-1-helper-functions.html#cb16-1051" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-1052"><a href="5-1-helper-functions.html#cb16-1052" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1053"><a href="5-1-helper-functions.html#cb16-1053" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-1054"><a href="5-1-helper-functions.html#cb16-1054" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-1055"><a href="5-1-helper-functions.html#cb16-1055" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-1056"><a href="5-1-helper-functions.html#cb16-1056" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-1057"><a href="5-1-helper-functions.html#cb16-1057" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-1058"><a href="5-1-helper-functions.html#cb16-1058" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1059"><a href="5-1-helper-functions.html#cb16-1059" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1060"><a href="5-1-helper-functions.html#cb16-1060" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-1061"><a href="5-1-helper-functions.html#cb16-1061" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1062"><a href="5-1-helper-functions.html#cb16-1062" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1063"><a href="5-1-helper-functions.html#cb16-1063" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1064"><a href="5-1-helper-functions.html#cb16-1064" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1065"><a href="5-1-helper-functions.html#cb16-1065" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-1066"><a href="5-1-helper-functions.html#cb16-1066" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1067"><a href="5-1-helper-functions.html#cb16-1067" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-1068"><a href="5-1-helper-functions.html#cb16-1068" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1069"><a href="5-1-helper-functions.html#cb16-1069" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1070"><a href="5-1-helper-functions.html#cb16-1070" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-1071"><a href="5-1-helper-functions.html#cb16-1071" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-1072"><a href="5-1-helper-functions.html#cb16-1072" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-1073"><a href="5-1-helper-functions.html#cb16-1073" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-1074"><a href="5-1-helper-functions.html#cb16-1074" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-1075"><a href="5-1-helper-functions.html#cb16-1075" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-1076"><a href="5-1-helper-functions.html#cb16-1076" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-1077"><a href="5-1-helper-functions.html#cb16-1077" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-1078"><a href="5-1-helper-functions.html#cb16-1078" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-1079"><a href="5-1-helper-functions.html#cb16-1079" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1080"><a href="5-1-helper-functions.html#cb16-1080" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-1081"><a href="5-1-helper-functions.html#cb16-1081" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1082"><a href="5-1-helper-functions.html#cb16-1082" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-1083"><a href="5-1-helper-functions.html#cb16-1083" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-1084"><a href="5-1-helper-functions.html#cb16-1084" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-1085"><a href="5-1-helper-functions.html#cb16-1085" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-1086"><a href="5-1-helper-functions.html#cb16-1086" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-1087"><a href="5-1-helper-functions.html#cb16-1087" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1088"><a href="5-1-helper-functions.html#cb16-1088" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1089"><a href="5-1-helper-functions.html#cb16-1089" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1090"><a href="5-1-helper-functions.html#cb16-1090" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1091"><a href="5-1-helper-functions.html#cb16-1091" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-1092"><a href="5-1-helper-functions.html#cb16-1092" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-1093"><a href="5-1-helper-functions.html#cb16-1093" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-1094"><a href="5-1-helper-functions.html#cb16-1094" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-1095"><a href="5-1-helper-functions.html#cb16-1095" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1096"><a href="5-1-helper-functions.html#cb16-1096" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-1097"><a href="5-1-helper-functions.html#cb16-1097" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-1098"><a href="5-1-helper-functions.html#cb16-1098" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-1099"><a href="5-1-helper-functions.html#cb16-1099" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1100"><a href="5-1-helper-functions.html#cb16-1100" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-1101"><a href="5-1-helper-functions.html#cb16-1101" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-1102"><a href="5-1-helper-functions.html#cb16-1102" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-1103"><a href="5-1-helper-functions.html#cb16-1103" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-1104"><a href="5-1-helper-functions.html#cb16-1104" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-1105"><a href="5-1-helper-functions.html#cb16-1105" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1106"><a href="5-1-helper-functions.html#cb16-1106" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1107"><a href="5-1-helper-functions.html#cb16-1107" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-1108"><a href="5-1-helper-functions.html#cb16-1108" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-1109"><a href="5-1-helper-functions.html#cb16-1109" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-1110"><a href="5-1-helper-functions.html#cb16-1110" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-1111"><a href="5-1-helper-functions.html#cb16-1111" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1112"><a href="5-1-helper-functions.html#cb16-1112" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1113"><a href="5-1-helper-functions.html#cb16-1113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1114"><a href="5-1-helper-functions.html#cb16-1114" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-1115"><a href="5-1-helper-functions.html#cb16-1115" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1116"><a href="5-1-helper-functions.html#cb16-1116" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1117"><a href="5-1-helper-functions.html#cb16-1117" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1118"><a href="5-1-helper-functions.html#cb16-1118" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1119"><a href="5-1-helper-functions.html#cb16-1119" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-1120"><a href="5-1-helper-functions.html#cb16-1120" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1121"><a href="5-1-helper-functions.html#cb16-1121" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1122"><a href="5-1-helper-functions.html#cb16-1122" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1123"><a href="5-1-helper-functions.html#cb16-1123" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-1124"><a href="5-1-helper-functions.html#cb16-1124" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-1125"><a href="5-1-helper-functions.html#cb16-1125" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1126"><a href="5-1-helper-functions.html#cb16-1126" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1127"><a href="5-1-helper-functions.html#cb16-1127" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-1128"><a href="5-1-helper-functions.html#cb16-1128" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1129"><a href="5-1-helper-functions.html#cb16-1129" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1130"><a href="5-1-helper-functions.html#cb16-1130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1131"><a href="5-1-helper-functions.html#cb16-1131" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-1132"><a href="5-1-helper-functions.html#cb16-1132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-1133"><a href="5-1-helper-functions.html#cb16-1133" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1134"><a href="5-1-helper-functions.html#cb16-1134" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1135"><a href="5-1-helper-functions.html#cb16-1135" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1136"><a href="5-1-helper-functions.html#cb16-1136" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-1137"><a href="5-1-helper-functions.html#cb16-1137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-1138"><a href="5-1-helper-functions.html#cb16-1138" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-1139"><a href="5-1-helper-functions.html#cb16-1139" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-1140"><a href="5-1-helper-functions.html#cb16-1140" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-1141"><a href="5-1-helper-functions.html#cb16-1141" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-1142"><a href="5-1-helper-functions.html#cb16-1142" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1143"><a href="5-1-helper-functions.html#cb16-1143" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-1144"><a href="5-1-helper-functions.html#cb16-1144" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-1145"><a href="5-1-helper-functions.html#cb16-1145" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-1146"><a href="5-1-helper-functions.html#cb16-1146" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1147"><a href="5-1-helper-functions.html#cb16-1147" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1148"><a href="5-1-helper-functions.html#cb16-1148" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1149"><a href="5-1-helper-functions.html#cb16-1149" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-1150"><a href="5-1-helper-functions.html#cb16-1150" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-1151"><a href="5-1-helper-functions.html#cb16-1151" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-1152"><a href="5-1-helper-functions.html#cb16-1152" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1153"><a href="5-1-helper-functions.html#cb16-1153" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1154"><a href="5-1-helper-functions.html#cb16-1154" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-1155"><a href="5-1-helper-functions.html#cb16-1155" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-1156"><a href="5-1-helper-functions.html#cb16-1156" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-1157"><a href="5-1-helper-functions.html#cb16-1157" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1158"><a href="5-1-helper-functions.html#cb16-1158" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-1159"><a href="5-1-helper-functions.html#cb16-1159" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-1160"><a href="5-1-helper-functions.html#cb16-1160" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-1161"><a href="5-1-helper-functions.html#cb16-1161" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-1162"><a href="5-1-helper-functions.html#cb16-1162" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-1163"><a href="5-1-helper-functions.html#cb16-1163" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1164"><a href="5-1-helper-functions.html#cb16-1164" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1165"><a href="5-1-helper-functions.html#cb16-1165" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1166"><a href="5-1-helper-functions.html#cb16-1166" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-1167"><a href="5-1-helper-functions.html#cb16-1167" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1168"><a href="5-1-helper-functions.html#cb16-1168" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1169"><a href="5-1-helper-functions.html#cb16-1169" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1170"><a href="5-1-helper-functions.html#cb16-1170" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-1171"><a href="5-1-helper-functions.html#cb16-1171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1172"><a href="5-1-helper-functions.html#cb16-1172" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-1173"><a href="5-1-helper-functions.html#cb16-1173" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1174"><a href="5-1-helper-functions.html#cb16-1174" aria-hidden="true" tabindex="-1"></a>        <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-1175"><a href="5-1-helper-functions.html#cb16-1175" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1176"><a href="5-1-helper-functions.html#cb16-1176" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-1177"><a href="5-1-helper-functions.html#cb16-1177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1178"><a href="5-1-helper-functions.html#cb16-1178" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-1179"><a href="5-1-helper-functions.html#cb16-1179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1180"><a href="5-1-helper-functions.html#cb16-1180" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-1181"><a href="5-1-helper-functions.html#cb16-1181" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-1182"><a href="5-1-helper-functions.html#cb16-1182" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1183"><a href="5-1-helper-functions.html#cb16-1183" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-1184"><a href="5-1-helper-functions.html#cb16-1184" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1185"><a href="5-1-helper-functions.html#cb16-1185" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-1186"><a href="5-1-helper-functions.html#cb16-1186" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1187"><a href="5-1-helper-functions.html#cb16-1187" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-1188"><a href="5-1-helper-functions.html#cb16-1188" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-1189"><a href="5-1-helper-functions.html#cb16-1189" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-1190"><a href="5-1-helper-functions.html#cb16-1190" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1191"><a href="5-1-helper-functions.html#cb16-1191" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-1192"><a href="5-1-helper-functions.html#cb16-1192" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1193"><a href="5-1-helper-functions.html#cb16-1193" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-1194"><a href="5-1-helper-functions.html#cb16-1194" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-1195"><a href="5-1-helper-functions.html#cb16-1195" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-1196"><a href="5-1-helper-functions.html#cb16-1196" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-1197"><a href="5-1-helper-functions.html#cb16-1197" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-1198"><a href="5-1-helper-functions.html#cb16-1198" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1199"><a href="5-1-helper-functions.html#cb16-1199" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-1200"><a href="5-1-helper-functions.html#cb16-1200" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1201"><a href="5-1-helper-functions.html#cb16-1201" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-1202"><a href="5-1-helper-functions.html#cb16-1202" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1203"><a href="5-1-helper-functions.html#cb16-1203" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-1204"><a href="5-1-helper-functions.html#cb16-1204" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1205"><a href="5-1-helper-functions.html#cb16-1205" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1206"><a href="5-1-helper-functions.html#cb16-1206" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1207"><a href="5-1-helper-functions.html#cb16-1207" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-1208"><a href="5-1-helper-functions.html#cb16-1208" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1209"><a href="5-1-helper-functions.html#cb16-1209" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1210"><a href="5-1-helper-functions.html#cb16-1210" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1211"><a href="5-1-helper-functions.html#cb16-1211" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1212"><a href="5-1-helper-functions.html#cb16-1212" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1213"><a href="5-1-helper-functions.html#cb16-1213" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-1214"><a href="5-1-helper-functions.html#cb16-1214" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1215"><a href="5-1-helper-functions.html#cb16-1215" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1216"><a href="5-1-helper-functions.html#cb16-1216" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1217"><a href="5-1-helper-functions.html#cb16-1217" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-1218"><a href="5-1-helper-functions.html#cb16-1218" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1219"><a href="5-1-helper-functions.html#cb16-1219" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-1220"><a href="5-1-helper-functions.html#cb16-1220" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1221"><a href="5-1-helper-functions.html#cb16-1221" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-1222"><a href="5-1-helper-functions.html#cb16-1222" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1223"><a href="5-1-helper-functions.html#cb16-1223" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-1224"><a href="5-1-helper-functions.html#cb16-1224" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1225"><a href="5-1-helper-functions.html#cb16-1225" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-1226"><a href="5-1-helper-functions.html#cb16-1226" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1227"><a href="5-1-helper-functions.html#cb16-1227" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-1228"><a href="5-1-helper-functions.html#cb16-1228" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1229"><a href="5-1-helper-functions.html#cb16-1229" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-1230"><a href="5-1-helper-functions.html#cb16-1230" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1231"><a href="5-1-helper-functions.html#cb16-1231" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1232"><a href="5-1-helper-functions.html#cb16-1232" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1233"><a href="5-1-helper-functions.html#cb16-1233" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-1234"><a href="5-1-helper-functions.html#cb16-1234" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1235"><a href="5-1-helper-functions.html#cb16-1235" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1236"><a href="5-1-helper-functions.html#cb16-1236" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1237"><a href="5-1-helper-functions.html#cb16-1237" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1238"><a href="5-1-helper-functions.html#cb16-1238" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1239"><a href="5-1-helper-functions.html#cb16-1239" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-1240"><a href="5-1-helper-functions.html#cb16-1240" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1241"><a href="5-1-helper-functions.html#cb16-1241" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1242"><a href="5-1-helper-functions.html#cb16-1242" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1243"><a href="5-1-helper-functions.html#cb16-1243" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-1244"><a href="5-1-helper-functions.html#cb16-1244" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1245"><a href="5-1-helper-functions.html#cb16-1245" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-1246"><a href="5-1-helper-functions.html#cb16-1246" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1247"><a href="5-1-helper-functions.html#cb16-1247" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 2</span></span>
<span id="cb16-1248"><a href="5-1-helper-functions.html#cb16-1248" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-1249"><a href="5-1-helper-functions.html#cb16-1249" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1250"><a href="5-1-helper-functions.html#cb16-1250" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1251"><a href="5-1-helper-functions.html#cb16-1251" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-1252"><a href="5-1-helper-functions.html#cb16-1252" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1253"><a href="5-1-helper-functions.html#cb16-1253" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1254"><a href="5-1-helper-functions.html#cb16-1254" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1255"><a href="5-1-helper-functions.html#cb16-1255" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-1256"><a href="5-1-helper-functions.html#cb16-1256" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1257"><a href="5-1-helper-functions.html#cb16-1257" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1258"><a href="5-1-helper-functions.html#cb16-1258" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-1259"><a href="5-1-helper-functions.html#cb16-1259" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-1260"><a href="5-1-helper-functions.html#cb16-1260" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-1261"><a href="5-1-helper-functions.html#cb16-1261" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1262"><a href="5-1-helper-functions.html#cb16-1262" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-1263"><a href="5-1-helper-functions.html#cb16-1263" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1264"><a href="5-1-helper-functions.html#cb16-1264" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-1265"><a href="5-1-helper-functions.html#cb16-1265" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-1266"><a href="5-1-helper-functions.html#cb16-1266" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-1267"><a href="5-1-helper-functions.html#cb16-1267" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-1268"><a href="5-1-helper-functions.html#cb16-1268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-1269"><a href="5-1-helper-functions.html#cb16-1269" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1270"><a href="5-1-helper-functions.html#cb16-1270" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1271"><a href="5-1-helper-functions.html#cb16-1271" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-1272"><a href="5-1-helper-functions.html#cb16-1272" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1273"><a href="5-1-helper-functions.html#cb16-1273" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1274"><a href="5-1-helper-functions.html#cb16-1274" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1275"><a href="5-1-helper-functions.html#cb16-1275" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1276"><a href="5-1-helper-functions.html#cb16-1276" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-1277"><a href="5-1-helper-functions.html#cb16-1277" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1278"><a href="5-1-helper-functions.html#cb16-1278" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-1279"><a href="5-1-helper-functions.html#cb16-1279" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1280"><a href="5-1-helper-functions.html#cb16-1280" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1281"><a href="5-1-helper-functions.html#cb16-1281" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-1282"><a href="5-1-helper-functions.html#cb16-1282" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-1283"><a href="5-1-helper-functions.html#cb16-1283" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-1284"><a href="5-1-helper-functions.html#cb16-1284" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-1285"><a href="5-1-helper-functions.html#cb16-1285" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-1286"><a href="5-1-helper-functions.html#cb16-1286" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-1287"><a href="5-1-helper-functions.html#cb16-1287" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-1288"><a href="5-1-helper-functions.html#cb16-1288" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-1289"><a href="5-1-helper-functions.html#cb16-1289" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1290"><a href="5-1-helper-functions.html#cb16-1290" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1291"><a href="5-1-helper-functions.html#cb16-1291" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-1292"><a href="5-1-helper-functions.html#cb16-1292" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1293"><a href="5-1-helper-functions.html#cb16-1293" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-1294"><a href="5-1-helper-functions.html#cb16-1294" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-1295"><a href="5-1-helper-functions.html#cb16-1295" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-1296"><a href="5-1-helper-functions.html#cb16-1296" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-1297"><a href="5-1-helper-functions.html#cb16-1297" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-1298"><a href="5-1-helper-functions.html#cb16-1298" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1299"><a href="5-1-helper-functions.html#cb16-1299" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1300"><a href="5-1-helper-functions.html#cb16-1300" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1301"><a href="5-1-helper-functions.html#cb16-1301" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1302"><a href="5-1-helper-functions.html#cb16-1302" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-1303"><a href="5-1-helper-functions.html#cb16-1303" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-1304"><a href="5-1-helper-functions.html#cb16-1304" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-1305"><a href="5-1-helper-functions.html#cb16-1305" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-1306"><a href="5-1-helper-functions.html#cb16-1306" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1307"><a href="5-1-helper-functions.html#cb16-1307" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-1308"><a href="5-1-helper-functions.html#cb16-1308" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-1309"><a href="5-1-helper-functions.html#cb16-1309" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-1310"><a href="5-1-helper-functions.html#cb16-1310" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1311"><a href="5-1-helper-functions.html#cb16-1311" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-1312"><a href="5-1-helper-functions.html#cb16-1312" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-1313"><a href="5-1-helper-functions.html#cb16-1313" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-1314"><a href="5-1-helper-functions.html#cb16-1314" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-1315"><a href="5-1-helper-functions.html#cb16-1315" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-1316"><a href="5-1-helper-functions.html#cb16-1316" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1317"><a href="5-1-helper-functions.html#cb16-1317" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1318"><a href="5-1-helper-functions.html#cb16-1318" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-1319"><a href="5-1-helper-functions.html#cb16-1319" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-1320"><a href="5-1-helper-functions.html#cb16-1320" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-1321"><a href="5-1-helper-functions.html#cb16-1321" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-1322"><a href="5-1-helper-functions.html#cb16-1322" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1323"><a href="5-1-helper-functions.html#cb16-1323" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1324"><a href="5-1-helper-functions.html#cb16-1324" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1325"><a href="5-1-helper-functions.html#cb16-1325" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-1326"><a href="5-1-helper-functions.html#cb16-1326" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1327"><a href="5-1-helper-functions.html#cb16-1327" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1328"><a href="5-1-helper-functions.html#cb16-1328" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1329"><a href="5-1-helper-functions.html#cb16-1329" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1330"><a href="5-1-helper-functions.html#cb16-1330" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-1331"><a href="5-1-helper-functions.html#cb16-1331" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1332"><a href="5-1-helper-functions.html#cb16-1332" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1333"><a href="5-1-helper-functions.html#cb16-1333" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1334"><a href="5-1-helper-functions.html#cb16-1334" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-1335"><a href="5-1-helper-functions.html#cb16-1335" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-1336"><a href="5-1-helper-functions.html#cb16-1336" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1337"><a href="5-1-helper-functions.html#cb16-1337" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1338"><a href="5-1-helper-functions.html#cb16-1338" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-1339"><a href="5-1-helper-functions.html#cb16-1339" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1340"><a href="5-1-helper-functions.html#cb16-1340" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1341"><a href="5-1-helper-functions.html#cb16-1341" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1342"><a href="5-1-helper-functions.html#cb16-1342" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1343"><a href="5-1-helper-functions.html#cb16-1343" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-1344"><a href="5-1-helper-functions.html#cb16-1344" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-1345"><a href="5-1-helper-functions.html#cb16-1345" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1346"><a href="5-1-helper-functions.html#cb16-1346" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1347"><a href="5-1-helper-functions.html#cb16-1347" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1348"><a href="5-1-helper-functions.html#cb16-1348" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-1349"><a href="5-1-helper-functions.html#cb16-1349" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-1350"><a href="5-1-helper-functions.html#cb16-1350" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-1351"><a href="5-1-helper-functions.html#cb16-1351" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-1352"><a href="5-1-helper-functions.html#cb16-1352" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-1353"><a href="5-1-helper-functions.html#cb16-1353" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-1354"><a href="5-1-helper-functions.html#cb16-1354" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1355"><a href="5-1-helper-functions.html#cb16-1355" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-1356"><a href="5-1-helper-functions.html#cb16-1356" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-1357"><a href="5-1-helper-functions.html#cb16-1357" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-1358"><a href="5-1-helper-functions.html#cb16-1358" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1359"><a href="5-1-helper-functions.html#cb16-1359" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1360"><a href="5-1-helper-functions.html#cb16-1360" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1361"><a href="5-1-helper-functions.html#cb16-1361" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-1362"><a href="5-1-helper-functions.html#cb16-1362" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-1363"><a href="5-1-helper-functions.html#cb16-1363" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-1364"><a href="5-1-helper-functions.html#cb16-1364" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1365"><a href="5-1-helper-functions.html#cb16-1365" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1366"><a href="5-1-helper-functions.html#cb16-1366" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-1367"><a href="5-1-helper-functions.html#cb16-1367" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-1368"><a href="5-1-helper-functions.html#cb16-1368" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-1369"><a href="5-1-helper-functions.html#cb16-1369" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1370"><a href="5-1-helper-functions.html#cb16-1370" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-1371"><a href="5-1-helper-functions.html#cb16-1371" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-1372"><a href="5-1-helper-functions.html#cb16-1372" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-1373"><a href="5-1-helper-functions.html#cb16-1373" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-1374"><a href="5-1-helper-functions.html#cb16-1374" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-1375"><a href="5-1-helper-functions.html#cb16-1375" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1376"><a href="5-1-helper-functions.html#cb16-1376" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1377"><a href="5-1-helper-functions.html#cb16-1377" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1378"><a href="5-1-helper-functions.html#cb16-1378" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-1379"><a href="5-1-helper-functions.html#cb16-1379" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1380"><a href="5-1-helper-functions.html#cb16-1380" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1381"><a href="5-1-helper-functions.html#cb16-1381" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1382"><a href="5-1-helper-functions.html#cb16-1382" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-1383"><a href="5-1-helper-functions.html#cb16-1383" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1384"><a href="5-1-helper-functions.html#cb16-1384" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-1385"><a href="5-1-helper-functions.html#cb16-1385" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1386"><a href="5-1-helper-functions.html#cb16-1386" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-1387"><a href="5-1-helper-functions.html#cb16-1387" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1388"><a href="5-1-helper-functions.html#cb16-1388" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-1389"><a href="5-1-helper-functions.html#cb16-1389" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-1390"><a href="5-1-helper-functions.html#cb16-1390" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1391"><a href="5-1-helper-functions.html#cb16-1391" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-1392"><a href="5-1-helper-functions.html#cb16-1392" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1393"><a href="5-1-helper-functions.html#cb16-1393" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-1394"><a href="5-1-helper-functions.html#cb16-1394" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1395"><a href="5-1-helper-functions.html#cb16-1395" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-1396"><a href="5-1-helper-functions.html#cb16-1396" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-1397"><a href="5-1-helper-functions.html#cb16-1397" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-1398"><a href="5-1-helper-functions.html#cb16-1398" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1399"><a href="5-1-helper-functions.html#cb16-1399" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-1400"><a href="5-1-helper-functions.html#cb16-1400" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1401"><a href="5-1-helper-functions.html#cb16-1401" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-1402"><a href="5-1-helper-functions.html#cb16-1402" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-1403"><a href="5-1-helper-functions.html#cb16-1403" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-1404"><a href="5-1-helper-functions.html#cb16-1404" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-1405"><a href="5-1-helper-functions.html#cb16-1405" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-1406"><a href="5-1-helper-functions.html#cb16-1406" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 2){</span></span>
<span id="cb16-1407"><a href="5-1-helper-functions.html#cb16-1407" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1408"><a href="5-1-helper-functions.html#cb16-1408" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-1409"><a href="5-1-helper-functions.html#cb16-1409" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1410"><a href="5-1-helper-functions.html#cb16-1410" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-1411"><a href="5-1-helper-functions.html#cb16-1411" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1412"><a href="5-1-helper-functions.html#cb16-1412" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1413"><a href="5-1-helper-functions.html#cb16-1413" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1414"><a href="5-1-helper-functions.html#cb16-1414" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-1415"><a href="5-1-helper-functions.html#cb16-1415" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1416"><a href="5-1-helper-functions.html#cb16-1416" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1417"><a href="5-1-helper-functions.html#cb16-1417" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1418"><a href="5-1-helper-functions.html#cb16-1418" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1419"><a href="5-1-helper-functions.html#cb16-1419" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1420"><a href="5-1-helper-functions.html#cb16-1420" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-1421"><a href="5-1-helper-functions.html#cb16-1421" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1422"><a href="5-1-helper-functions.html#cb16-1422" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1423"><a href="5-1-helper-functions.html#cb16-1423" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1424"><a href="5-1-helper-functions.html#cb16-1424" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-1425"><a href="5-1-helper-functions.html#cb16-1425" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1426"><a href="5-1-helper-functions.html#cb16-1426" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-1427"><a href="5-1-helper-functions.html#cb16-1427" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1428"><a href="5-1-helper-functions.html#cb16-1428" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-1429"><a href="5-1-helper-functions.html#cb16-1429" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1430"><a href="5-1-helper-functions.html#cb16-1430" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-1431"><a href="5-1-helper-functions.html#cb16-1431" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1432"><a href="5-1-helper-functions.html#cb16-1432" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-1433"><a href="5-1-helper-functions.html#cb16-1433" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1434"><a href="5-1-helper-functions.html#cb16-1434" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-1435"><a href="5-1-helper-functions.html#cb16-1435" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1436"><a href="5-1-helper-functions.html#cb16-1436" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-1437"><a href="5-1-helper-functions.html#cb16-1437" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1438"><a href="5-1-helper-functions.html#cb16-1438" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1439"><a href="5-1-helper-functions.html#cb16-1439" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1440"><a href="5-1-helper-functions.html#cb16-1440" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-1441"><a href="5-1-helper-functions.html#cb16-1441" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1442"><a href="5-1-helper-functions.html#cb16-1442" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1443"><a href="5-1-helper-functions.html#cb16-1443" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1444"><a href="5-1-helper-functions.html#cb16-1444" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1445"><a href="5-1-helper-functions.html#cb16-1445" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1446"><a href="5-1-helper-functions.html#cb16-1446" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-1447"><a href="5-1-helper-functions.html#cb16-1447" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1448"><a href="5-1-helper-functions.html#cb16-1448" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1449"><a href="5-1-helper-functions.html#cb16-1449" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1450"><a href="5-1-helper-functions.html#cb16-1450" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-1451"><a href="5-1-helper-functions.html#cb16-1451" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1452"><a href="5-1-helper-functions.html#cb16-1452" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-1453"><a href="5-1-helper-functions.html#cb16-1453" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1454"><a href="5-1-helper-functions.html#cb16-1454" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 3</span></span>
<span id="cb16-1455"><a href="5-1-helper-functions.html#cb16-1455" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-1456"><a href="5-1-helper-functions.html#cb16-1456" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-1457"><a href="5-1-helper-functions.html#cb16-1457" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-1458"><a href="5-1-helper-functions.html#cb16-1458" aria-hidden="true" tabindex="-1"></a>    <span class="co">#}</span></span>
<span id="cb16-1459"><a href="5-1-helper-functions.html#cb16-1459" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-1460"><a href="5-1-helper-functions.html#cb16-1460" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1461"><a href="5-1-helper-functions.html#cb16-1461" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1462"><a href="5-1-helper-functions.html#cb16-1462" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1463"><a href="5-1-helper-functions.html#cb16-1463" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1464"><a href="5-1-helper-functions.html#cb16-1464" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-1465"><a href="5-1-helper-functions.html#cb16-1465" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-1466"><a href="5-1-helper-functions.html#cb16-1466" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-1467"><a href="5-1-helper-functions.html#cb16-1467" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-1468"><a href="5-1-helper-functions.html#cb16-1468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1469"><a href="5-1-helper-functions.html#cb16-1469" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-1470"><a href="5-1-helper-functions.html#cb16-1470" aria-hidden="true" tabindex="-1"></a>de_fun_beta2_male <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-1471"><a href="5-1-helper-functions.html#cb16-1471" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-1472"><a href="5-1-helper-functions.html#cb16-1472" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-1473"><a href="5-1-helper-functions.html#cb16-1473" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1474"><a href="5-1-helper-functions.html#cb16-1474" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1475"><a href="5-1-helper-functions.html#cb16-1475" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-1476"><a href="5-1-helper-functions.html#cb16-1476" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-1477"><a href="5-1-helper-functions.html#cb16-1477" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-1478"><a href="5-1-helper-functions.html#cb16-1478" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1479"><a href="5-1-helper-functions.html#cb16-1479" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-1480"><a href="5-1-helper-functions.html#cb16-1480" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1481"><a href="5-1-helper-functions.html#cb16-1481" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-1482"><a href="5-1-helper-functions.html#cb16-1482" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-1483"><a href="5-1-helper-functions.html#cb16-1483" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1484"><a href="5-1-helper-functions.html#cb16-1484" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-1485"><a href="5-1-helper-functions.html#cb16-1485" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-1486"><a href="5-1-helper-functions.html#cb16-1486" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1487"><a href="5-1-helper-functions.html#cb16-1487" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-1488"><a href="5-1-helper-functions.html#cb16-1488" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-1489"><a href="5-1-helper-functions.html#cb16-1489" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1490"><a href="5-1-helper-functions.html#cb16-1490" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-1491"><a href="5-1-helper-functions.html#cb16-1491" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-1492"><a href="5-1-helper-functions.html#cb16-1492" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1493"><a href="5-1-helper-functions.html#cb16-1493" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-1494"><a href="5-1-helper-functions.html#cb16-1494" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-1495"><a href="5-1-helper-functions.html#cb16-1495" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-1496"><a href="5-1-helper-functions.html#cb16-1496" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-1497"><a href="5-1-helper-functions.html#cb16-1497" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-1498"><a href="5-1-helper-functions.html#cb16-1498" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-1499"><a href="5-1-helper-functions.html#cb16-1499" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1500"><a href="5-1-helper-functions.html#cb16-1500" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-1501"><a href="5-1-helper-functions.html#cb16-1501" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1502"><a href="5-1-helper-functions.html#cb16-1502" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-1503"><a href="5-1-helper-functions.html#cb16-1503" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-1504"><a href="5-1-helper-functions.html#cb16-1504" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-1505"><a href="5-1-helper-functions.html#cb16-1505" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-1506"><a href="5-1-helper-functions.html#cb16-1506" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-1507"><a href="5-1-helper-functions.html#cb16-1507" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-1508"><a href="5-1-helper-functions.html#cb16-1508" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-1509"><a href="5-1-helper-functions.html#cb16-1509" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-1510"><a href="5-1-helper-functions.html#cb16-1510" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-1511"><a href="5-1-helper-functions.html#cb16-1511" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-1512"><a href="5-1-helper-functions.html#cb16-1512" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-1513"><a href="5-1-helper-functions.html#cb16-1513" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-1514"><a href="5-1-helper-functions.html#cb16-1514" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-1515"><a href="5-1-helper-functions.html#cb16-1515" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1516"><a href="5-1-helper-functions.html#cb16-1516" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-1517"><a href="5-1-helper-functions.html#cb16-1517" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-1518"><a href="5-1-helper-functions.html#cb16-1518" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-1519"><a href="5-1-helper-functions.html#cb16-1519" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-1520"><a href="5-1-helper-functions.html#cb16-1520" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-1521"><a href="5-1-helper-functions.html#cb16-1521" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-1522"><a href="5-1-helper-functions.html#cb16-1522" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-1523"><a href="5-1-helper-functions.html#cb16-1523" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-1524"><a href="5-1-helper-functions.html#cb16-1524" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-1525"><a href="5-1-helper-functions.html#cb16-1525" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-1526"><a href="5-1-helper-functions.html#cb16-1526" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-1527"><a href="5-1-helper-functions.html#cb16-1527" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-1528"><a href="5-1-helper-functions.html#cb16-1528" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-1529"><a href="5-1-helper-functions.html#cb16-1529" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1530"><a href="5-1-helper-functions.html#cb16-1530" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-1531"><a href="5-1-helper-functions.html#cb16-1531" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-1532"><a href="5-1-helper-functions.html#cb16-1532" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-1533"><a href="5-1-helper-functions.html#cb16-1533" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-1534"><a href="5-1-helper-functions.html#cb16-1534" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1535"><a href="5-1-helper-functions.html#cb16-1535" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-1536"><a href="5-1-helper-functions.html#cb16-1536" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-1537"><a href="5-1-helper-functions.html#cb16-1537" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-1538"><a href="5-1-helper-functions.html#cb16-1538" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1539"><a href="5-1-helper-functions.html#cb16-1539" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-1540"><a href="5-1-helper-functions.html#cb16-1540" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-1541"><a href="5-1-helper-functions.html#cb16-1541" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1542"><a href="5-1-helper-functions.html#cb16-1542" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-1543"><a href="5-1-helper-functions.html#cb16-1543" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-1544"><a href="5-1-helper-functions.html#cb16-1544" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-1545"><a href="5-1-helper-functions.html#cb16-1545" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-1546"><a href="5-1-helper-functions.html#cb16-1546" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1547"><a href="5-1-helper-functions.html#cb16-1547" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-1548"><a href="5-1-helper-functions.html#cb16-1548" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1549"><a href="5-1-helper-functions.html#cb16-1549" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-1550"><a href="5-1-helper-functions.html#cb16-1550" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-1551"><a href="5-1-helper-functions.html#cb16-1551" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-1552"><a href="5-1-helper-functions.html#cb16-1552" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-1553"><a href="5-1-helper-functions.html#cb16-1553" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1554"><a href="5-1-helper-functions.html#cb16-1554" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1555"><a href="5-1-helper-functions.html#cb16-1555" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1556"><a href="5-1-helper-functions.html#cb16-1556" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1557"><a href="5-1-helper-functions.html#cb16-1557" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1558"><a href="5-1-helper-functions.html#cb16-1558" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1559"><a href="5-1-helper-functions.html#cb16-1559" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1560"><a href="5-1-helper-functions.html#cb16-1560" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1561"><a href="5-1-helper-functions.html#cb16-1561" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-1562"><a href="5-1-helper-functions.html#cb16-1562" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-1563"><a href="5-1-helper-functions.html#cb16-1563" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-1564"><a href="5-1-helper-functions.html#cb16-1564" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-1565"><a href="5-1-helper-functions.html#cb16-1565" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1566"><a href="5-1-helper-functions.html#cb16-1566" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-1567"><a href="5-1-helper-functions.html#cb16-1567" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1568"><a href="5-1-helper-functions.html#cb16-1568" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb16-1569"><a href="5-1-helper-functions.html#cb16-1569" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1570"><a href="5-1-helper-functions.html#cb16-1570" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-1571"><a href="5-1-helper-functions.html#cb16-1571" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-1572"><a href="5-1-helper-functions.html#cb16-1572" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-1573"><a href="5-1-helper-functions.html#cb16-1573" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1574"><a href="5-1-helper-functions.html#cb16-1574" aria-hidden="true" tabindex="-1"></a>  ODEs[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1575"><a href="5-1-helper-functions.html#cb16-1575" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1576"><a href="5-1-helper-functions.html#cb16-1576" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1577"><a href="5-1-helper-functions.html#cb16-1577" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-1578"><a href="5-1-helper-functions.html#cb16-1578" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-1579"><a href="5-1-helper-functions.html#cb16-1579" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-1580"><a href="5-1-helper-functions.html#cb16-1580" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1581"><a href="5-1-helper-functions.html#cb16-1581" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb16-1582"><a href="5-1-helper-functions.html#cb16-1582" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb16-1583"><a href="5-1-helper-functions.html#cb16-1583" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1584"><a href="5-1-helper-functions.html#cb16-1584" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-1585"><a href="5-1-helper-functions.html#cb16-1585" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-1586"><a href="5-1-helper-functions.html#cb16-1586" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-1587"><a href="5-1-helper-functions.html#cb16-1587" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb16-1588"><a href="5-1-helper-functions.html#cb16-1588" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-1589"><a href="5-1-helper-functions.html#cb16-1589" aria-hidden="true" tabindex="-1"></a>      <span class="co"># for(sex in 1:sex_types){</span></span>
<span id="cb16-1590"><a href="5-1-helper-functions.html#cb16-1590" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-1591"><a href="5-1-helper-functions.html#cb16-1591" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1592"><a href="5-1-helper-functions.html#cb16-1592" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1593"><a href="5-1-helper-functions.html#cb16-1593" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1594"><a href="5-1-helper-functions.html#cb16-1594" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1595"><a href="5-1-helper-functions.html#cb16-1595" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1596"><a href="5-1-helper-functions.html#cb16-1596" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1597"><a href="5-1-helper-functions.html#cb16-1597" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-1598"><a href="5-1-helper-functions.html#cb16-1598" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1599"><a href="5-1-helper-functions.html#cb16-1599" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1600"><a href="5-1-helper-functions.html#cb16-1600" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1601"><a href="5-1-helper-functions.html#cb16-1601" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-1602"><a href="5-1-helper-functions.html#cb16-1602" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1603"><a href="5-1-helper-functions.html#cb16-1603" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1604"><a href="5-1-helper-functions.html#cb16-1604" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-1605"><a href="5-1-helper-functions.html#cb16-1605" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-1606"><a href="5-1-helper-functions.html#cb16-1606" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-1607"><a href="5-1-helper-functions.html#cb16-1607" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1608"><a href="5-1-helper-functions.html#cb16-1608" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-1609"><a href="5-1-helper-functions.html#cb16-1609" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1610"><a href="5-1-helper-functions.html#cb16-1610" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-1611"><a href="5-1-helper-functions.html#cb16-1611" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-1612"><a href="5-1-helper-functions.html#cb16-1612" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-1613"><a href="5-1-helper-functions.html#cb16-1613" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-1614"><a href="5-1-helper-functions.html#cb16-1614" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-1615"><a href="5-1-helper-functions.html#cb16-1615" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1616"><a href="5-1-helper-functions.html#cb16-1616" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1617"><a href="5-1-helper-functions.html#cb16-1617" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-1618"><a href="5-1-helper-functions.html#cb16-1618" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1619"><a href="5-1-helper-functions.html#cb16-1619" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1620"><a href="5-1-helper-functions.html#cb16-1620" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1621"><a href="5-1-helper-functions.html#cb16-1621" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1622"><a href="5-1-helper-functions.html#cb16-1622" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-1623"><a href="5-1-helper-functions.html#cb16-1623" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1624"><a href="5-1-helper-functions.html#cb16-1624" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-1625"><a href="5-1-helper-functions.html#cb16-1625" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1626"><a href="5-1-helper-functions.html#cb16-1626" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1627"><a href="5-1-helper-functions.html#cb16-1627" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-1628"><a href="5-1-helper-functions.html#cb16-1628" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-1629"><a href="5-1-helper-functions.html#cb16-1629" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1630"><a href="5-1-helper-functions.html#cb16-1630" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-1631"><a href="5-1-helper-functions.html#cb16-1631" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-1632"><a href="5-1-helper-functions.html#cb16-1632" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-1633"><a href="5-1-helper-functions.html#cb16-1633" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-1634"><a href="5-1-helper-functions.html#cb16-1634" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-1635"><a href="5-1-helper-functions.html#cb16-1635" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-1636"><a href="5-1-helper-functions.html#cb16-1636" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-1637"><a href="5-1-helper-functions.html#cb16-1637" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1638"><a href="5-1-helper-functions.html#cb16-1638" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-1639"><a href="5-1-helper-functions.html#cb16-1639" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1640"><a href="5-1-helper-functions.html#cb16-1640" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-1641"><a href="5-1-helper-functions.html#cb16-1641" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-1642"><a href="5-1-helper-functions.html#cb16-1642" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-1643"><a href="5-1-helper-functions.html#cb16-1643" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-1644"><a href="5-1-helper-functions.html#cb16-1644" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-1645"><a href="5-1-helper-functions.html#cb16-1645" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1646"><a href="5-1-helper-functions.html#cb16-1646" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1647"><a href="5-1-helper-functions.html#cb16-1647" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1648"><a href="5-1-helper-functions.html#cb16-1648" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1649"><a href="5-1-helper-functions.html#cb16-1649" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-1650"><a href="5-1-helper-functions.html#cb16-1650" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-1651"><a href="5-1-helper-functions.html#cb16-1651" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-1652"><a href="5-1-helper-functions.html#cb16-1652" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-1653"><a href="5-1-helper-functions.html#cb16-1653" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1654"><a href="5-1-helper-functions.html#cb16-1654" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-1655"><a href="5-1-helper-functions.html#cb16-1655" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-1656"><a href="5-1-helper-functions.html#cb16-1656" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-1657"><a href="5-1-helper-functions.html#cb16-1657" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1658"><a href="5-1-helper-functions.html#cb16-1658" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-1659"><a href="5-1-helper-functions.html#cb16-1659" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-1660"><a href="5-1-helper-functions.html#cb16-1660" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-1661"><a href="5-1-helper-functions.html#cb16-1661" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1662"><a href="5-1-helper-functions.html#cb16-1662" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-1663"><a href="5-1-helper-functions.html#cb16-1663" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-1664"><a href="5-1-helper-functions.html#cb16-1664" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1665"><a href="5-1-helper-functions.html#cb16-1665" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1666"><a href="5-1-helper-functions.html#cb16-1666" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-1667"><a href="5-1-helper-functions.html#cb16-1667" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-1668"><a href="5-1-helper-functions.html#cb16-1668" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-1669"><a href="5-1-helper-functions.html#cb16-1669" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-1670"><a href="5-1-helper-functions.html#cb16-1670" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1671"><a href="5-1-helper-functions.html#cb16-1671" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1672"><a href="5-1-helper-functions.html#cb16-1672" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1673"><a href="5-1-helper-functions.html#cb16-1673" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-1674"><a href="5-1-helper-functions.html#cb16-1674" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1675"><a href="5-1-helper-functions.html#cb16-1675" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1676"><a href="5-1-helper-functions.html#cb16-1676" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1677"><a href="5-1-helper-functions.html#cb16-1677" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1678"><a href="5-1-helper-functions.html#cb16-1678" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-1679"><a href="5-1-helper-functions.html#cb16-1679" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1680"><a href="5-1-helper-functions.html#cb16-1680" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1681"><a href="5-1-helper-functions.html#cb16-1681" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1682"><a href="5-1-helper-functions.html#cb16-1682" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-1683"><a href="5-1-helper-functions.html#cb16-1683" aria-hidden="true" tabindex="-1"></a>          <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-1684"><a href="5-1-helper-functions.html#cb16-1684" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1685"><a href="5-1-helper-functions.html#cb16-1685" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1686"><a href="5-1-helper-functions.html#cb16-1686" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-1687"><a href="5-1-helper-functions.html#cb16-1687" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1688"><a href="5-1-helper-functions.html#cb16-1688" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1689"><a href="5-1-helper-functions.html#cb16-1689" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1690"><a href="5-1-helper-functions.html#cb16-1690" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-1691"><a href="5-1-helper-functions.html#cb16-1691" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-1692"><a href="5-1-helper-functions.html#cb16-1692" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-1693"><a href="5-1-helper-functions.html#cb16-1693" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-1694"><a href="5-1-helper-functions.html#cb16-1694" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-1695"><a href="5-1-helper-functions.html#cb16-1695" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-1696"><a href="5-1-helper-functions.html#cb16-1696" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1697"><a href="5-1-helper-functions.html#cb16-1697" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-1698"><a href="5-1-helper-functions.html#cb16-1698" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-1699"><a href="5-1-helper-functions.html#cb16-1699" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-1700"><a href="5-1-helper-functions.html#cb16-1700" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1701"><a href="5-1-helper-functions.html#cb16-1701" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1702"><a href="5-1-helper-functions.html#cb16-1702" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1703"><a href="5-1-helper-functions.html#cb16-1703" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-1704"><a href="5-1-helper-functions.html#cb16-1704" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-1705"><a href="5-1-helper-functions.html#cb16-1705" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-1706"><a href="5-1-helper-functions.html#cb16-1706" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1707"><a href="5-1-helper-functions.html#cb16-1707" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1708"><a href="5-1-helper-functions.html#cb16-1708" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-1709"><a href="5-1-helper-functions.html#cb16-1709" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-1710"><a href="5-1-helper-functions.html#cb16-1710" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-1711"><a href="5-1-helper-functions.html#cb16-1711" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1712"><a href="5-1-helper-functions.html#cb16-1712" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-1713"><a href="5-1-helper-functions.html#cb16-1713" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-1714"><a href="5-1-helper-functions.html#cb16-1714" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-1715"><a href="5-1-helper-functions.html#cb16-1715" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-1716"><a href="5-1-helper-functions.html#cb16-1716" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-1717"><a href="5-1-helper-functions.html#cb16-1717" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1718"><a href="5-1-helper-functions.html#cb16-1718" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1719"><a href="5-1-helper-functions.html#cb16-1719" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1720"><a href="5-1-helper-functions.html#cb16-1720" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-1721"><a href="5-1-helper-functions.html#cb16-1721" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1722"><a href="5-1-helper-functions.html#cb16-1722" aria-hidden="true" tabindex="-1"></a>        <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-1723"><a href="5-1-helper-functions.html#cb16-1723" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1724"><a href="5-1-helper-functions.html#cb16-1724" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-1725"><a href="5-1-helper-functions.html#cb16-1725" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1726"><a href="5-1-helper-functions.html#cb16-1726" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-1727"><a href="5-1-helper-functions.html#cb16-1727" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-1728"><a href="5-1-helper-functions.html#cb16-1728" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1729"><a href="5-1-helper-functions.html#cb16-1729" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-1730"><a href="5-1-helper-functions.html#cb16-1730" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1731"><a href="5-1-helper-functions.html#cb16-1731" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-1732"><a href="5-1-helper-functions.html#cb16-1732" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1733"><a href="5-1-helper-functions.html#cb16-1733" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-1734"><a href="5-1-helper-functions.html#cb16-1734" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-1735"><a href="5-1-helper-functions.html#cb16-1735" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-1736"><a href="5-1-helper-functions.html#cb16-1736" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1737"><a href="5-1-helper-functions.html#cb16-1737" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-1738"><a href="5-1-helper-functions.html#cb16-1738" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1739"><a href="5-1-helper-functions.html#cb16-1739" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-1740"><a href="5-1-helper-functions.html#cb16-1740" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1741"><a href="5-1-helper-functions.html#cb16-1741" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else </span></span>
<span id="cb16-1742"><a href="5-1-helper-functions.html#cb16-1742" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1743"><a href="5-1-helper-functions.html#cb16-1743" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-1744"><a href="5-1-helper-functions.html#cb16-1744" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1745"><a href="5-1-helper-functions.html#cb16-1745" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-1746"><a href="5-1-helper-functions.html#cb16-1746" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1747"><a href="5-1-helper-functions.html#cb16-1747" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-1748"><a href="5-1-helper-functions.html#cb16-1748" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1749"><a href="5-1-helper-functions.html#cb16-1749" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1750"><a href="5-1-helper-functions.html#cb16-1750" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1751"><a href="5-1-helper-functions.html#cb16-1751" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-1752"><a href="5-1-helper-functions.html#cb16-1752" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1753"><a href="5-1-helper-functions.html#cb16-1753" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1754"><a href="5-1-helper-functions.html#cb16-1754" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1755"><a href="5-1-helper-functions.html#cb16-1755" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1756"><a href="5-1-helper-functions.html#cb16-1756" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1757"><a href="5-1-helper-functions.html#cb16-1757" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-1758"><a href="5-1-helper-functions.html#cb16-1758" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1759"><a href="5-1-helper-functions.html#cb16-1759" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1760"><a href="5-1-helper-functions.html#cb16-1760" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1761"><a href="5-1-helper-functions.html#cb16-1761" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-1762"><a href="5-1-helper-functions.html#cb16-1762" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1763"><a href="5-1-helper-functions.html#cb16-1763" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-1764"><a href="5-1-helper-functions.html#cb16-1764" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1765"><a href="5-1-helper-functions.html#cb16-1765" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-1766"><a href="5-1-helper-functions.html#cb16-1766" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1767"><a href="5-1-helper-functions.html#cb16-1767" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-1768"><a href="5-1-helper-functions.html#cb16-1768" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1769"><a href="5-1-helper-functions.html#cb16-1769" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-1770"><a href="5-1-helper-functions.html#cb16-1770" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1771"><a href="5-1-helper-functions.html#cb16-1771" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-1772"><a href="5-1-helper-functions.html#cb16-1772" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1773"><a href="5-1-helper-functions.html#cb16-1773" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-1774"><a href="5-1-helper-functions.html#cb16-1774" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1775"><a href="5-1-helper-functions.html#cb16-1775" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1776"><a href="5-1-helper-functions.html#cb16-1776" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1777"><a href="5-1-helper-functions.html#cb16-1777" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-1778"><a href="5-1-helper-functions.html#cb16-1778" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1779"><a href="5-1-helper-functions.html#cb16-1779" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1780"><a href="5-1-helper-functions.html#cb16-1780" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1781"><a href="5-1-helper-functions.html#cb16-1781" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1782"><a href="5-1-helper-functions.html#cb16-1782" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1783"><a href="5-1-helper-functions.html#cb16-1783" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-1784"><a href="5-1-helper-functions.html#cb16-1784" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1785"><a href="5-1-helper-functions.html#cb16-1785" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1786"><a href="5-1-helper-functions.html#cb16-1786" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1787"><a href="5-1-helper-functions.html#cb16-1787" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-1788"><a href="5-1-helper-functions.html#cb16-1788" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1789"><a href="5-1-helper-functions.html#cb16-1789" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-1790"><a href="5-1-helper-functions.html#cb16-1790" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1791"><a href="5-1-helper-functions.html#cb16-1791" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 1</span></span>
<span id="cb16-1792"><a href="5-1-helper-functions.html#cb16-1792" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-1793"><a href="5-1-helper-functions.html#cb16-1793" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1794"><a href="5-1-helper-functions.html#cb16-1794" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1795"><a href="5-1-helper-functions.html#cb16-1795" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1796"><a href="5-1-helper-functions.html#cb16-1796" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-1797"><a href="5-1-helper-functions.html#cb16-1797" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1798"><a href="5-1-helper-functions.html#cb16-1798" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1799"><a href="5-1-helper-functions.html#cb16-1799" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1800"><a href="5-1-helper-functions.html#cb16-1800" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-1801"><a href="5-1-helper-functions.html#cb16-1801" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1802"><a href="5-1-helper-functions.html#cb16-1802" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1803"><a href="5-1-helper-functions.html#cb16-1803" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-1804"><a href="5-1-helper-functions.html#cb16-1804" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-1805"><a href="5-1-helper-functions.html#cb16-1805" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-1806"><a href="5-1-helper-functions.html#cb16-1806" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1807"><a href="5-1-helper-functions.html#cb16-1807" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-1808"><a href="5-1-helper-functions.html#cb16-1808" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1809"><a href="5-1-helper-functions.html#cb16-1809" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-1810"><a href="5-1-helper-functions.html#cb16-1810" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-1811"><a href="5-1-helper-functions.html#cb16-1811" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-1812"><a href="5-1-helper-functions.html#cb16-1812" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-1813"><a href="5-1-helper-functions.html#cb16-1813" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-1814"><a href="5-1-helper-functions.html#cb16-1814" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1815"><a href="5-1-helper-functions.html#cb16-1815" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1816"><a href="5-1-helper-functions.html#cb16-1816" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-1817"><a href="5-1-helper-functions.html#cb16-1817" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1818"><a href="5-1-helper-functions.html#cb16-1818" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1819"><a href="5-1-helper-functions.html#cb16-1819" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1820"><a href="5-1-helper-functions.html#cb16-1820" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1821"><a href="5-1-helper-functions.html#cb16-1821" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-1822"><a href="5-1-helper-functions.html#cb16-1822" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1823"><a href="5-1-helper-functions.html#cb16-1823" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-1824"><a href="5-1-helper-functions.html#cb16-1824" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1825"><a href="5-1-helper-functions.html#cb16-1825" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-1826"><a href="5-1-helper-functions.html#cb16-1826" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-1827"><a href="5-1-helper-functions.html#cb16-1827" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-1828"><a href="5-1-helper-functions.html#cb16-1828" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-1829"><a href="5-1-helper-functions.html#cb16-1829" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-1830"><a href="5-1-helper-functions.html#cb16-1830" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-1831"><a href="5-1-helper-functions.html#cb16-1831" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-1832"><a href="5-1-helper-functions.html#cb16-1832" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-1833"><a href="5-1-helper-functions.html#cb16-1833" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-1834"><a href="5-1-helper-functions.html#cb16-1834" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-1835"><a href="5-1-helper-functions.html#cb16-1835" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1836"><a href="5-1-helper-functions.html#cb16-1836" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-1837"><a href="5-1-helper-functions.html#cb16-1837" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1838"><a href="5-1-helper-functions.html#cb16-1838" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-1839"><a href="5-1-helper-functions.html#cb16-1839" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-1840"><a href="5-1-helper-functions.html#cb16-1840" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-1841"><a href="5-1-helper-functions.html#cb16-1841" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-1842"><a href="5-1-helper-functions.html#cb16-1842" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-1843"><a href="5-1-helper-functions.html#cb16-1843" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1844"><a href="5-1-helper-functions.html#cb16-1844" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1845"><a href="5-1-helper-functions.html#cb16-1845" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1846"><a href="5-1-helper-functions.html#cb16-1846" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1847"><a href="5-1-helper-functions.html#cb16-1847" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-1848"><a href="5-1-helper-functions.html#cb16-1848" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-1849"><a href="5-1-helper-functions.html#cb16-1849" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-1850"><a href="5-1-helper-functions.html#cb16-1850" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-1851"><a href="5-1-helper-functions.html#cb16-1851" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1852"><a href="5-1-helper-functions.html#cb16-1852" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-1853"><a href="5-1-helper-functions.html#cb16-1853" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-1854"><a href="5-1-helper-functions.html#cb16-1854" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-1855"><a href="5-1-helper-functions.html#cb16-1855" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1856"><a href="5-1-helper-functions.html#cb16-1856" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-1857"><a href="5-1-helper-functions.html#cb16-1857" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-1858"><a href="5-1-helper-functions.html#cb16-1858" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-1859"><a href="5-1-helper-functions.html#cb16-1859" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-1860"><a href="5-1-helper-functions.html#cb16-1860" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-1861"><a href="5-1-helper-functions.html#cb16-1861" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1862"><a href="5-1-helper-functions.html#cb16-1862" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1863"><a href="5-1-helper-functions.html#cb16-1863" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-1864"><a href="5-1-helper-functions.html#cb16-1864" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-1865"><a href="5-1-helper-functions.html#cb16-1865" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-1866"><a href="5-1-helper-functions.html#cb16-1866" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-1867"><a href="5-1-helper-functions.html#cb16-1867" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1868"><a href="5-1-helper-functions.html#cb16-1868" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1869"><a href="5-1-helper-functions.html#cb16-1869" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1870"><a href="5-1-helper-functions.html#cb16-1870" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-1871"><a href="5-1-helper-functions.html#cb16-1871" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1872"><a href="5-1-helper-functions.html#cb16-1872" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1873"><a href="5-1-helper-functions.html#cb16-1873" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1874"><a href="5-1-helper-functions.html#cb16-1874" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1875"><a href="5-1-helper-functions.html#cb16-1875" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-1876"><a href="5-1-helper-functions.html#cb16-1876" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1877"><a href="5-1-helper-functions.html#cb16-1877" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-1878"><a href="5-1-helper-functions.html#cb16-1878" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1879"><a href="5-1-helper-functions.html#cb16-1879" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-1880"><a href="5-1-helper-functions.html#cb16-1880" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-1881"><a href="5-1-helper-functions.html#cb16-1881" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-1882"><a href="5-1-helper-functions.html#cb16-1882" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1883"><a href="5-1-helper-functions.html#cb16-1883" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-1884"><a href="5-1-helper-functions.html#cb16-1884" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-1885"><a href="5-1-helper-functions.html#cb16-1885" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-1886"><a href="5-1-helper-functions.html#cb16-1886" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1887"><a href="5-1-helper-functions.html#cb16-1887" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-1888"><a href="5-1-helper-functions.html#cb16-1888" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-1889"><a href="5-1-helper-functions.html#cb16-1889" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-1890"><a href="5-1-helper-functions.html#cb16-1890" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-1891"><a href="5-1-helper-functions.html#cb16-1891" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1892"><a href="5-1-helper-functions.html#cb16-1892" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-1893"><a href="5-1-helper-functions.html#cb16-1893" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-1894"><a href="5-1-helper-functions.html#cb16-1894" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-1895"><a href="5-1-helper-functions.html#cb16-1895" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-1896"><a href="5-1-helper-functions.html#cb16-1896" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-1897"><a href="5-1-helper-functions.html#cb16-1897" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-1898"><a href="5-1-helper-functions.html#cb16-1898" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1899"><a href="5-1-helper-functions.html#cb16-1899" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-1900"><a href="5-1-helper-functions.html#cb16-1900" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-1901"><a href="5-1-helper-functions.html#cb16-1901" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-1902"><a href="5-1-helper-functions.html#cb16-1902" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1903"><a href="5-1-helper-functions.html#cb16-1903" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1904"><a href="5-1-helper-functions.html#cb16-1904" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1905"><a href="5-1-helper-functions.html#cb16-1905" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-1906"><a href="5-1-helper-functions.html#cb16-1906" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-1907"><a href="5-1-helper-functions.html#cb16-1907" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-1908"><a href="5-1-helper-functions.html#cb16-1908" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-1909"><a href="5-1-helper-functions.html#cb16-1909" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1910"><a href="5-1-helper-functions.html#cb16-1910" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-1911"><a href="5-1-helper-functions.html#cb16-1911" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-1912"><a href="5-1-helper-functions.html#cb16-1912" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-1913"><a href="5-1-helper-functions.html#cb16-1913" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1914"><a href="5-1-helper-functions.html#cb16-1914" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-1915"><a href="5-1-helper-functions.html#cb16-1915" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-1916"><a href="5-1-helper-functions.html#cb16-1916" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-1917"><a href="5-1-helper-functions.html#cb16-1917" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-1918"><a href="5-1-helper-functions.html#cb16-1918" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-1919"><a href="5-1-helper-functions.html#cb16-1919" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1920"><a href="5-1-helper-functions.html#cb16-1920" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1921"><a href="5-1-helper-functions.html#cb16-1921" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1922"><a href="5-1-helper-functions.html#cb16-1922" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-1923"><a href="5-1-helper-functions.html#cb16-1923" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1924"><a href="5-1-helper-functions.html#cb16-1924" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-1925"><a href="5-1-helper-functions.html#cb16-1925" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1926"><a href="5-1-helper-functions.html#cb16-1926" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-1927"><a href="5-1-helper-functions.html#cb16-1927" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1928"><a href="5-1-helper-functions.html#cb16-1928" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-1929"><a href="5-1-helper-functions.html#cb16-1929" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1930"><a href="5-1-helper-functions.html#cb16-1930" aria-hidden="true" tabindex="-1"></a>        <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-1931"><a href="5-1-helper-functions.html#cb16-1931" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1932"><a href="5-1-helper-functions.html#cb16-1932" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-1933"><a href="5-1-helper-functions.html#cb16-1933" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1934"><a href="5-1-helper-functions.html#cb16-1934" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-1935"><a href="5-1-helper-functions.html#cb16-1935" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1936"><a href="5-1-helper-functions.html#cb16-1936" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-1937"><a href="5-1-helper-functions.html#cb16-1937" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-1938"><a href="5-1-helper-functions.html#cb16-1938" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1939"><a href="5-1-helper-functions.html#cb16-1939" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-1940"><a href="5-1-helper-functions.html#cb16-1940" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1941"><a href="5-1-helper-functions.html#cb16-1941" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-1942"><a href="5-1-helper-functions.html#cb16-1942" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1943"><a href="5-1-helper-functions.html#cb16-1943" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-1944"><a href="5-1-helper-functions.html#cb16-1944" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-1945"><a href="5-1-helper-functions.html#cb16-1945" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-1946"><a href="5-1-helper-functions.html#cb16-1946" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1947"><a href="5-1-helper-functions.html#cb16-1947" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-1948"><a href="5-1-helper-functions.html#cb16-1948" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1949"><a href="5-1-helper-functions.html#cb16-1949" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-1950"><a href="5-1-helper-functions.html#cb16-1950" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-1951"><a href="5-1-helper-functions.html#cb16-1951" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-1952"><a href="5-1-helper-functions.html#cb16-1952" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-1953"><a href="5-1-helper-functions.html#cb16-1953" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-1954"><a href="5-1-helper-functions.html#cb16-1954" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1955"><a href="5-1-helper-functions.html#cb16-1955" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-1956"><a href="5-1-helper-functions.html#cb16-1956" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1957"><a href="5-1-helper-functions.html#cb16-1957" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-1958"><a href="5-1-helper-functions.html#cb16-1958" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1959"><a href="5-1-helper-functions.html#cb16-1959" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-1960"><a href="5-1-helper-functions.html#cb16-1960" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1961"><a href="5-1-helper-functions.html#cb16-1961" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1962"><a href="5-1-helper-functions.html#cb16-1962" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1963"><a href="5-1-helper-functions.html#cb16-1963" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-1964"><a href="5-1-helper-functions.html#cb16-1964" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1965"><a href="5-1-helper-functions.html#cb16-1965" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1966"><a href="5-1-helper-functions.html#cb16-1966" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1967"><a href="5-1-helper-functions.html#cb16-1967" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1968"><a href="5-1-helper-functions.html#cb16-1968" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1969"><a href="5-1-helper-functions.html#cb16-1969" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-1970"><a href="5-1-helper-functions.html#cb16-1970" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1971"><a href="5-1-helper-functions.html#cb16-1971" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1972"><a href="5-1-helper-functions.html#cb16-1972" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1973"><a href="5-1-helper-functions.html#cb16-1973" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-1974"><a href="5-1-helper-functions.html#cb16-1974" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1975"><a href="5-1-helper-functions.html#cb16-1975" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-1976"><a href="5-1-helper-functions.html#cb16-1976" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1977"><a href="5-1-helper-functions.html#cb16-1977" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-1978"><a href="5-1-helper-functions.html#cb16-1978" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-1979"><a href="5-1-helper-functions.html#cb16-1979" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-1980"><a href="5-1-helper-functions.html#cb16-1980" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1981"><a href="5-1-helper-functions.html#cb16-1981" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-1982"><a href="5-1-helper-functions.html#cb16-1982" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1983"><a href="5-1-helper-functions.html#cb16-1983" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-1984"><a href="5-1-helper-functions.html#cb16-1984" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1985"><a href="5-1-helper-functions.html#cb16-1985" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-1986"><a href="5-1-helper-functions.html#cb16-1986" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1987"><a href="5-1-helper-functions.html#cb16-1987" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-1988"><a href="5-1-helper-functions.html#cb16-1988" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1989"><a href="5-1-helper-functions.html#cb16-1989" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-1990"><a href="5-1-helper-functions.html#cb16-1990" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1991"><a href="5-1-helper-functions.html#cb16-1991" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-1992"><a href="5-1-helper-functions.html#cb16-1992" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1993"><a href="5-1-helper-functions.html#cb16-1993" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-1994"><a href="5-1-helper-functions.html#cb16-1994" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1995"><a href="5-1-helper-functions.html#cb16-1995" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-1996"><a href="5-1-helper-functions.html#cb16-1996" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-1997"><a href="5-1-helper-functions.html#cb16-1997" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-1998"><a href="5-1-helper-functions.html#cb16-1998" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-1999"><a href="5-1-helper-functions.html#cb16-1999" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-2000"><a href="5-1-helper-functions.html#cb16-2000" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2001"><a href="5-1-helper-functions.html#cb16-2001" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-2002"><a href="5-1-helper-functions.html#cb16-2002" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2003"><a href="5-1-helper-functions.html#cb16-2003" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 2</span></span>
<span id="cb16-2004"><a href="5-1-helper-functions.html#cb16-2004" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-2005"><a href="5-1-helper-functions.html#cb16-2005" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2006"><a href="5-1-helper-functions.html#cb16-2006" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-2007"><a href="5-1-helper-functions.html#cb16-2007" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-2008"><a href="5-1-helper-functions.html#cb16-2008" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-2009"><a href="5-1-helper-functions.html#cb16-2009" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2010"><a href="5-1-helper-functions.html#cb16-2010" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2011"><a href="5-1-helper-functions.html#cb16-2011" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-2012"><a href="5-1-helper-functions.html#cb16-2012" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2013"><a href="5-1-helper-functions.html#cb16-2013" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-2014"><a href="5-1-helper-functions.html#cb16-2014" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-2015"><a href="5-1-helper-functions.html#cb16-2015" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-2016"><a href="5-1-helper-functions.html#cb16-2016" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-2017"><a href="5-1-helper-functions.html#cb16-2017" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-2018"><a href="5-1-helper-functions.html#cb16-2018" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-2019"><a href="5-1-helper-functions.html#cb16-2019" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-2020"><a href="5-1-helper-functions.html#cb16-2020" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-2021"><a href="5-1-helper-functions.html#cb16-2021" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-2022"><a href="5-1-helper-functions.html#cb16-2022" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-2023"><a href="5-1-helper-functions.html#cb16-2023" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-2024"><a href="5-1-helper-functions.html#cb16-2024" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-2025"><a href="5-1-helper-functions.html#cb16-2025" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2026"><a href="5-1-helper-functions.html#cb16-2026" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-2027"><a href="5-1-helper-functions.html#cb16-2027" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-2028"><a href="5-1-helper-functions.html#cb16-2028" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-2029"><a href="5-1-helper-functions.html#cb16-2029" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2030"><a href="5-1-helper-functions.html#cb16-2030" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-2031"><a href="5-1-helper-functions.html#cb16-2031" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2032"><a href="5-1-helper-functions.html#cb16-2032" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-2033"><a href="5-1-helper-functions.html#cb16-2033" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2034"><a href="5-1-helper-functions.html#cb16-2034" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-2035"><a href="5-1-helper-functions.html#cb16-2035" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2036"><a href="5-1-helper-functions.html#cb16-2036" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-2037"><a href="5-1-helper-functions.html#cb16-2037" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-2038"><a href="5-1-helper-functions.html#cb16-2038" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-2039"><a href="5-1-helper-functions.html#cb16-2039" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-2040"><a href="5-1-helper-functions.html#cb16-2040" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-2041"><a href="5-1-helper-functions.html#cb16-2041" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-2042"><a href="5-1-helper-functions.html#cb16-2042" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-2043"><a href="5-1-helper-functions.html#cb16-2043" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-2044"><a href="5-1-helper-functions.html#cb16-2044" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-2045"><a href="5-1-helper-functions.html#cb16-2045" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-2046"><a href="5-1-helper-functions.html#cb16-2046" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2047"><a href="5-1-helper-functions.html#cb16-2047" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-2048"><a href="5-1-helper-functions.html#cb16-2048" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2049"><a href="5-1-helper-functions.html#cb16-2049" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-2050"><a href="5-1-helper-functions.html#cb16-2050" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-2051"><a href="5-1-helper-functions.html#cb16-2051" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-2052"><a href="5-1-helper-functions.html#cb16-2052" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-2053"><a href="5-1-helper-functions.html#cb16-2053" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-2054"><a href="5-1-helper-functions.html#cb16-2054" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2055"><a href="5-1-helper-functions.html#cb16-2055" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2056"><a href="5-1-helper-functions.html#cb16-2056" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2057"><a href="5-1-helper-functions.html#cb16-2057" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2058"><a href="5-1-helper-functions.html#cb16-2058" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-2059"><a href="5-1-helper-functions.html#cb16-2059" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-2060"><a href="5-1-helper-functions.html#cb16-2060" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-2061"><a href="5-1-helper-functions.html#cb16-2061" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-2062"><a href="5-1-helper-functions.html#cb16-2062" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2063"><a href="5-1-helper-functions.html#cb16-2063" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-2064"><a href="5-1-helper-functions.html#cb16-2064" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-2065"><a href="5-1-helper-functions.html#cb16-2065" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-2066"><a href="5-1-helper-functions.html#cb16-2066" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2067"><a href="5-1-helper-functions.html#cb16-2067" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-2068"><a href="5-1-helper-functions.html#cb16-2068" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-2069"><a href="5-1-helper-functions.html#cb16-2069" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-2070"><a href="5-1-helper-functions.html#cb16-2070" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-2071"><a href="5-1-helper-functions.html#cb16-2071" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-2072"><a href="5-1-helper-functions.html#cb16-2072" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-2073"><a href="5-1-helper-functions.html#cb16-2073" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2074"><a href="5-1-helper-functions.html#cb16-2074" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-2075"><a href="5-1-helper-functions.html#cb16-2075" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-2076"><a href="5-1-helper-functions.html#cb16-2076" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-2077"><a href="5-1-helper-functions.html#cb16-2077" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-2078"><a href="5-1-helper-functions.html#cb16-2078" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2079"><a href="5-1-helper-functions.html#cb16-2079" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-2080"><a href="5-1-helper-functions.html#cb16-2080" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2081"><a href="5-1-helper-functions.html#cb16-2081" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-2082"><a href="5-1-helper-functions.html#cb16-2082" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2083"><a href="5-1-helper-functions.html#cb16-2083" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2084"><a href="5-1-helper-functions.html#cb16-2084" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2085"><a href="5-1-helper-functions.html#cb16-2085" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2086"><a href="5-1-helper-functions.html#cb16-2086" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-2087"><a href="5-1-helper-functions.html#cb16-2087" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2088"><a href="5-1-helper-functions.html#cb16-2088" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2089"><a href="5-1-helper-functions.html#cb16-2089" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2090"><a href="5-1-helper-functions.html#cb16-2090" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-2091"><a href="5-1-helper-functions.html#cb16-2091" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-2092"><a href="5-1-helper-functions.html#cb16-2092" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-2093"><a href="5-1-helper-functions.html#cb16-2093" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2094"><a href="5-1-helper-functions.html#cb16-2094" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-2095"><a href="5-1-helper-functions.html#cb16-2095" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2096"><a href="5-1-helper-functions.html#cb16-2096" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-2097"><a href="5-1-helper-functions.html#cb16-2097" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2098"><a href="5-1-helper-functions.html#cb16-2098" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-2099"><a href="5-1-helper-functions.html#cb16-2099" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-2100"><a href="5-1-helper-functions.html#cb16-2100" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-2101"><a href="5-1-helper-functions.html#cb16-2101" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2102"><a href="5-1-helper-functions.html#cb16-2102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2103"><a href="5-1-helper-functions.html#cb16-2103" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-2104"><a href="5-1-helper-functions.html#cb16-2104" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-2105"><a href="5-1-helper-functions.html#cb16-2105" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-2106"><a href="5-1-helper-functions.html#cb16-2106" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-2107"><a href="5-1-helper-functions.html#cb16-2107" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-2108"><a href="5-1-helper-functions.html#cb16-2108" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-2109"><a href="5-1-helper-functions.html#cb16-2109" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-2110"><a href="5-1-helper-functions.html#cb16-2110" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-2111"><a href="5-1-helper-functions.html#cb16-2111" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-2112"><a href="5-1-helper-functions.html#cb16-2112" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-2113"><a href="5-1-helper-functions.html#cb16-2113" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-2114"><a href="5-1-helper-functions.html#cb16-2114" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-2115"><a href="5-1-helper-functions.html#cb16-2115" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2116"><a href="5-1-helper-functions.html#cb16-2116" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-2117"><a href="5-1-helper-functions.html#cb16-2117" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-2118"><a href="5-1-helper-functions.html#cb16-2118" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-2119"><a href="5-1-helper-functions.html#cb16-2119" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-2120"><a href="5-1-helper-functions.html#cb16-2120" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-2121"><a href="5-1-helper-functions.html#cb16-2121" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2122"><a href="5-1-helper-functions.html#cb16-2122" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-2123"><a href="5-1-helper-functions.html#cb16-2123" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-2124"><a href="5-1-helper-functions.html#cb16-2124" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-2125"><a href="5-1-helper-functions.html#cb16-2125" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2126"><a href="5-1-helper-functions.html#cb16-2126" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-2127"><a href="5-1-helper-functions.html#cb16-2127" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-2128"><a href="5-1-helper-functions.html#cb16-2128" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-2129"><a href="5-1-helper-functions.html#cb16-2129" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-2130"><a href="5-1-helper-functions.html#cb16-2130" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-2131"><a href="5-1-helper-functions.html#cb16-2131" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2132"><a href="5-1-helper-functions.html#cb16-2132" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-2133"><a href="5-1-helper-functions.html#cb16-2133" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2134"><a href="5-1-helper-functions.html#cb16-2134" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-2135"><a href="5-1-helper-functions.html#cb16-2135" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2136"><a href="5-1-helper-functions.html#cb16-2136" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2137"><a href="5-1-helper-functions.html#cb16-2137" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2138"><a href="5-1-helper-functions.html#cb16-2138" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-2139"><a href="5-1-helper-functions.html#cb16-2139" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2140"><a href="5-1-helper-functions.html#cb16-2140" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-2141"><a href="5-1-helper-functions.html#cb16-2141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2142"><a href="5-1-helper-functions.html#cb16-2142" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-2143"><a href="5-1-helper-functions.html#cb16-2143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2144"><a href="5-1-helper-functions.html#cb16-2144" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-2145"><a href="5-1-helper-functions.html#cb16-2145" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-2146"><a href="5-1-helper-functions.html#cb16-2146" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2147"><a href="5-1-helper-functions.html#cb16-2147" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-2148"><a href="5-1-helper-functions.html#cb16-2148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2149"><a href="5-1-helper-functions.html#cb16-2149" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-2150"><a href="5-1-helper-functions.html#cb16-2150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2151"><a href="5-1-helper-functions.html#cb16-2151" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-2152"><a href="5-1-helper-functions.html#cb16-2152" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-2153"><a href="5-1-helper-functions.html#cb16-2153" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-2154"><a href="5-1-helper-functions.html#cb16-2154" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2155"><a href="5-1-helper-functions.html#cb16-2155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-2156"><a href="5-1-helper-functions.html#cb16-2156" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-2157"><a href="5-1-helper-functions.html#cb16-2157" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-2158"><a href="5-1-helper-functions.html#cb16-2158" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-2159"><a href="5-1-helper-functions.html#cb16-2159" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-2160"><a href="5-1-helper-functions.html#cb16-2160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-2161"><a href="5-1-helper-functions.html#cb16-2161" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-2162"><a href="5-1-helper-functions.html#cb16-2162" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 2){</span></span>
<span id="cb16-2163"><a href="5-1-helper-functions.html#cb16-2163" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2164"><a href="5-1-helper-functions.html#cb16-2164" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-2165"><a href="5-1-helper-functions.html#cb16-2165" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2166"><a href="5-1-helper-functions.html#cb16-2166" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-2167"><a href="5-1-helper-functions.html#cb16-2167" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2168"><a href="5-1-helper-functions.html#cb16-2168" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2169"><a href="5-1-helper-functions.html#cb16-2169" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2170"><a href="5-1-helper-functions.html#cb16-2170" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-2171"><a href="5-1-helper-functions.html#cb16-2171" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2172"><a href="5-1-helper-functions.html#cb16-2172" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2173"><a href="5-1-helper-functions.html#cb16-2173" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2174"><a href="5-1-helper-functions.html#cb16-2174" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2175"><a href="5-1-helper-functions.html#cb16-2175" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2176"><a href="5-1-helper-functions.html#cb16-2176" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-2177"><a href="5-1-helper-functions.html#cb16-2177" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2178"><a href="5-1-helper-functions.html#cb16-2178" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-2179"><a href="5-1-helper-functions.html#cb16-2179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2180"><a href="5-1-helper-functions.html#cb16-2180" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-2181"><a href="5-1-helper-functions.html#cb16-2181" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2182"><a href="5-1-helper-functions.html#cb16-2182" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-2183"><a href="5-1-helper-functions.html#cb16-2183" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-2184"><a href="5-1-helper-functions.html#cb16-2184" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-2185"><a href="5-1-helper-functions.html#cb16-2185" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-2186"><a href="5-1-helper-functions.html#cb16-2186" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-2187"><a href="5-1-helper-functions.html#cb16-2187" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2188"><a href="5-1-helper-functions.html#cb16-2188" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-2189"><a href="5-1-helper-functions.html#cb16-2189" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2190"><a href="5-1-helper-functions.html#cb16-2190" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-2191"><a href="5-1-helper-functions.html#cb16-2191" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2192"><a href="5-1-helper-functions.html#cb16-2192" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-2193"><a href="5-1-helper-functions.html#cb16-2193" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2194"><a href="5-1-helper-functions.html#cb16-2194" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2195"><a href="5-1-helper-functions.html#cb16-2195" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2196"><a href="5-1-helper-functions.html#cb16-2196" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-2197"><a href="5-1-helper-functions.html#cb16-2197" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2198"><a href="5-1-helper-functions.html#cb16-2198" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2199"><a href="5-1-helper-functions.html#cb16-2199" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2200"><a href="5-1-helper-functions.html#cb16-2200" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2201"><a href="5-1-helper-functions.html#cb16-2201" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2202"><a href="5-1-helper-functions.html#cb16-2202" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-2203"><a href="5-1-helper-functions.html#cb16-2203" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-2204"><a href="5-1-helper-functions.html#cb16-2204" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-2205"><a href="5-1-helper-functions.html#cb16-2205" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2206"><a href="5-1-helper-functions.html#cb16-2206" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-2207"><a href="5-1-helper-functions.html#cb16-2207" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2208"><a href="5-1-helper-functions.html#cb16-2208" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-2209"><a href="5-1-helper-functions.html#cb16-2209" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-2210"><a href="5-1-helper-functions.html#cb16-2210" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 3</span></span>
<span id="cb16-2211"><a href="5-1-helper-functions.html#cb16-2211" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-2212"><a href="5-1-helper-functions.html#cb16-2212" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-2213"><a href="5-1-helper-functions.html#cb16-2213" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-2214"><a href="5-1-helper-functions.html#cb16-2214" aria-hidden="true" tabindex="-1"></a>    <span class="co">#}</span></span>
<span id="cb16-2215"><a href="5-1-helper-functions.html#cb16-2215" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-2216"><a href="5-1-helper-functions.html#cb16-2216" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2217"><a href="5-1-helper-functions.html#cb16-2217" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2218"><a href="5-1-helper-functions.html#cb16-2218" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2219"><a href="5-1-helper-functions.html#cb16-2219" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2220"><a href="5-1-helper-functions.html#cb16-2220" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-2221"><a href="5-1-helper-functions.html#cb16-2221" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-2222"><a href="5-1-helper-functions.html#cb16-2222" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-2223"><a href="5-1-helper-functions.html#cb16-2223" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2224"><a href="5-1-helper-functions.html#cb16-2224" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2225"><a href="5-1-helper-functions.html#cb16-2225" aria-hidden="true" tabindex="-1"></a>de_fun_beta2_sex <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-2226"><a href="5-1-helper-functions.html#cb16-2226" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-2227"><a href="5-1-helper-functions.html#cb16-2227" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-2228"><a href="5-1-helper-functions.html#cb16-2228" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2229"><a href="5-1-helper-functions.html#cb16-2229" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2230"><a href="5-1-helper-functions.html#cb16-2230" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2231"><a href="5-1-helper-functions.html#cb16-2231" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-2232"><a href="5-1-helper-functions.html#cb16-2232" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2233"><a href="5-1-helper-functions.html#cb16-2233" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2234"><a href="5-1-helper-functions.html#cb16-2234" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-2235"><a href="5-1-helper-functions.html#cb16-2235" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2236"><a href="5-1-helper-functions.html#cb16-2236" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-2237"><a href="5-1-helper-functions.html#cb16-2237" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-2238"><a href="5-1-helper-functions.html#cb16-2238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2239"><a href="5-1-helper-functions.html#cb16-2239" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-2240"><a href="5-1-helper-functions.html#cb16-2240" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-2241"><a href="5-1-helper-functions.html#cb16-2241" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2242"><a href="5-1-helper-functions.html#cb16-2242" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-2243"><a href="5-1-helper-functions.html#cb16-2243" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-2244"><a href="5-1-helper-functions.html#cb16-2244" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2245"><a href="5-1-helper-functions.html#cb16-2245" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-2246"><a href="5-1-helper-functions.html#cb16-2246" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-2247"><a href="5-1-helper-functions.html#cb16-2247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2248"><a href="5-1-helper-functions.html#cb16-2248" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-2249"><a href="5-1-helper-functions.html#cb16-2249" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-2250"><a href="5-1-helper-functions.html#cb16-2250" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-2251"><a href="5-1-helper-functions.html#cb16-2251" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-2252"><a href="5-1-helper-functions.html#cb16-2252" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-2253"><a href="5-1-helper-functions.html#cb16-2253" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-2254"><a href="5-1-helper-functions.html#cb16-2254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2255"><a href="5-1-helper-functions.html#cb16-2255" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-2256"><a href="5-1-helper-functions.html#cb16-2256" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2257"><a href="5-1-helper-functions.html#cb16-2257" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-2258"><a href="5-1-helper-functions.html#cb16-2258" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-2259"><a href="5-1-helper-functions.html#cb16-2259" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-2260"><a href="5-1-helper-functions.html#cb16-2260" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-2261"><a href="5-1-helper-functions.html#cb16-2261" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-2262"><a href="5-1-helper-functions.html#cb16-2262" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-2263"><a href="5-1-helper-functions.html#cb16-2263" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-2264"><a href="5-1-helper-functions.html#cb16-2264" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-2265"><a href="5-1-helper-functions.html#cb16-2265" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-2266"><a href="5-1-helper-functions.html#cb16-2266" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-2267"><a href="5-1-helper-functions.html#cb16-2267" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-2268"><a href="5-1-helper-functions.html#cb16-2268" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-2269"><a href="5-1-helper-functions.html#cb16-2269" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-2270"><a href="5-1-helper-functions.html#cb16-2270" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2271"><a href="5-1-helper-functions.html#cb16-2271" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-2272"><a href="5-1-helper-functions.html#cb16-2272" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-2273"><a href="5-1-helper-functions.html#cb16-2273" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-2274"><a href="5-1-helper-functions.html#cb16-2274" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-2275"><a href="5-1-helper-functions.html#cb16-2275" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-2276"><a href="5-1-helper-functions.html#cb16-2276" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-2277"><a href="5-1-helper-functions.html#cb16-2277" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-2278"><a href="5-1-helper-functions.html#cb16-2278" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-2279"><a href="5-1-helper-functions.html#cb16-2279" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-2280"><a href="5-1-helper-functions.html#cb16-2280" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-2281"><a href="5-1-helper-functions.html#cb16-2281" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-2282"><a href="5-1-helper-functions.html#cb16-2282" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-2283"><a href="5-1-helper-functions.html#cb16-2283" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-2284"><a href="5-1-helper-functions.html#cb16-2284" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2285"><a href="5-1-helper-functions.html#cb16-2285" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-2286"><a href="5-1-helper-functions.html#cb16-2286" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-2287"><a href="5-1-helper-functions.html#cb16-2287" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-2288"><a href="5-1-helper-functions.html#cb16-2288" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-2289"><a href="5-1-helper-functions.html#cb16-2289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2290"><a href="5-1-helper-functions.html#cb16-2290" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-2291"><a href="5-1-helper-functions.html#cb16-2291" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-2292"><a href="5-1-helper-functions.html#cb16-2292" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-2293"><a href="5-1-helper-functions.html#cb16-2293" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2294"><a href="5-1-helper-functions.html#cb16-2294" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-2295"><a href="5-1-helper-functions.html#cb16-2295" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-2296"><a href="5-1-helper-functions.html#cb16-2296" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2297"><a href="5-1-helper-functions.html#cb16-2297" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2298"><a href="5-1-helper-functions.html#cb16-2298" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-2299"><a href="5-1-helper-functions.html#cb16-2299" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-2300"><a href="5-1-helper-functions.html#cb16-2300" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-2301"><a href="5-1-helper-functions.html#cb16-2301" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2302"><a href="5-1-helper-functions.html#cb16-2302" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-2303"><a href="5-1-helper-functions.html#cb16-2303" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2304"><a href="5-1-helper-functions.html#cb16-2304" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2305"><a href="5-1-helper-functions.html#cb16-2305" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-2306"><a href="5-1-helper-functions.html#cb16-2306" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-2307"><a href="5-1-helper-functions.html#cb16-2307" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2308"><a href="5-1-helper-functions.html#cb16-2308" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2309"><a href="5-1-helper-functions.html#cb16-2309" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2310"><a href="5-1-helper-functions.html#cb16-2310" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2311"><a href="5-1-helper-functions.html#cb16-2311" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2312"><a href="5-1-helper-functions.html#cb16-2312" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2313"><a href="5-1-helper-functions.html#cb16-2313" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2314"><a href="5-1-helper-functions.html#cb16-2314" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2315"><a href="5-1-helper-functions.html#cb16-2315" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2316"><a href="5-1-helper-functions.html#cb16-2316" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-2317"><a href="5-1-helper-functions.html#cb16-2317" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-2318"><a href="5-1-helper-functions.html#cb16-2318" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-2319"><a href="5-1-helper-functions.html#cb16-2319" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-2320"><a href="5-1-helper-functions.html#cb16-2320" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2321"><a href="5-1-helper-functions.html#cb16-2321" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-2322"><a href="5-1-helper-functions.html#cb16-2322" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2323"><a href="5-1-helper-functions.html#cb16-2323" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb16-2324"><a href="5-1-helper-functions.html#cb16-2324" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2325"><a href="5-1-helper-functions.html#cb16-2325" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-2326"><a href="5-1-helper-functions.html#cb16-2326" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-2327"><a href="5-1-helper-functions.html#cb16-2327" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-2328"><a href="5-1-helper-functions.html#cb16-2328" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2329"><a href="5-1-helper-functions.html#cb16-2329" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> parameters[<span class="dv">2978</span>]</span>
<span id="cb16-2330"><a href="5-1-helper-functions.html#cb16-2330" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2331"><a href="5-1-helper-functions.html#cb16-2331" aria-hidden="true" tabindex="-1"></a>  not_sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2332"><a href="5-1-helper-functions.html#cb16-2332" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sex <span class="sc">==</span> <span class="dv">1</span>){not_sex <span class="ot">&lt;-</span> <span class="dv">2</span>}</span>
<span id="cb16-2333"><a href="5-1-helper-functions.html#cb16-2333" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2334"><a href="5-1-helper-functions.html#cb16-2334" aria-hidden="true" tabindex="-1"></a>  ODEs[not_sex,,,,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2335"><a href="5-1-helper-functions.html#cb16-2335" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2336"><a href="5-1-helper-functions.html#cb16-2336" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2337"><a href="5-1-helper-functions.html#cb16-2337" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-2338"><a href="5-1-helper-functions.html#cb16-2338" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-2339"><a href="5-1-helper-functions.html#cb16-2339" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-2340"><a href="5-1-helper-functions.html#cb16-2340" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb16-2341"><a href="5-1-helper-functions.html#cb16-2341" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb16-2342"><a href="5-1-helper-functions.html#cb16-2342" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-2343"><a href="5-1-helper-functions.html#cb16-2343" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-2344"><a href="5-1-helper-functions.html#cb16-2344" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-2345"><a href="5-1-helper-functions.html#cb16-2345" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-2346"><a href="5-1-helper-functions.html#cb16-2346" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb16-2347"><a href="5-1-helper-functions.html#cb16-2347" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-2348"><a href="5-1-helper-functions.html#cb16-2348" aria-hidden="true" tabindex="-1"></a>     <span class="co"># for(sex in 1:sex_types){</span></span>
<span id="cb16-2349"><a href="5-1-helper-functions.html#cb16-2349" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-2350"><a href="5-1-helper-functions.html#cb16-2350" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2351"><a href="5-1-helper-functions.html#cb16-2351" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2352"><a href="5-1-helper-functions.html#cb16-2352" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2353"><a href="5-1-helper-functions.html#cb16-2353" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2354"><a href="5-1-helper-functions.html#cb16-2354" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2355"><a href="5-1-helper-functions.html#cb16-2355" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2356"><a href="5-1-helper-functions.html#cb16-2356" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-2357"><a href="5-1-helper-functions.html#cb16-2357" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2358"><a href="5-1-helper-functions.html#cb16-2358" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2359"><a href="5-1-helper-functions.html#cb16-2359" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2360"><a href="5-1-helper-functions.html#cb16-2360" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-2361"><a href="5-1-helper-functions.html#cb16-2361" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2362"><a href="5-1-helper-functions.html#cb16-2362" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2363"><a href="5-1-helper-functions.html#cb16-2363" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-2364"><a href="5-1-helper-functions.html#cb16-2364" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-2365"><a href="5-1-helper-functions.html#cb16-2365" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-2366"><a href="5-1-helper-functions.html#cb16-2366" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2367"><a href="5-1-helper-functions.html#cb16-2367" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-2368"><a href="5-1-helper-functions.html#cb16-2368" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2369"><a href="5-1-helper-functions.html#cb16-2369" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-2370"><a href="5-1-helper-functions.html#cb16-2370" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-2371"><a href="5-1-helper-functions.html#cb16-2371" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-2372"><a href="5-1-helper-functions.html#cb16-2372" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-2373"><a href="5-1-helper-functions.html#cb16-2373" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-2374"><a href="5-1-helper-functions.html#cb16-2374" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2375"><a href="5-1-helper-functions.html#cb16-2375" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2376"><a href="5-1-helper-functions.html#cb16-2376" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-2377"><a href="5-1-helper-functions.html#cb16-2377" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2378"><a href="5-1-helper-functions.html#cb16-2378" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2379"><a href="5-1-helper-functions.html#cb16-2379" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2380"><a href="5-1-helper-functions.html#cb16-2380" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2381"><a href="5-1-helper-functions.html#cb16-2381" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-2382"><a href="5-1-helper-functions.html#cb16-2382" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2383"><a href="5-1-helper-functions.html#cb16-2383" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-2384"><a href="5-1-helper-functions.html#cb16-2384" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2385"><a href="5-1-helper-functions.html#cb16-2385" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2386"><a href="5-1-helper-functions.html#cb16-2386" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-2387"><a href="5-1-helper-functions.html#cb16-2387" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-2388"><a href="5-1-helper-functions.html#cb16-2388" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2389"><a href="5-1-helper-functions.html#cb16-2389" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-2390"><a href="5-1-helper-functions.html#cb16-2390" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-2391"><a href="5-1-helper-functions.html#cb16-2391" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-2392"><a href="5-1-helper-functions.html#cb16-2392" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-2393"><a href="5-1-helper-functions.html#cb16-2393" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-2394"><a href="5-1-helper-functions.html#cb16-2394" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-2395"><a href="5-1-helper-functions.html#cb16-2395" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-2396"><a href="5-1-helper-functions.html#cb16-2396" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2397"><a href="5-1-helper-functions.html#cb16-2397" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-2398"><a href="5-1-helper-functions.html#cb16-2398" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2399"><a href="5-1-helper-functions.html#cb16-2399" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-2400"><a href="5-1-helper-functions.html#cb16-2400" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-2401"><a href="5-1-helper-functions.html#cb16-2401" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-2402"><a href="5-1-helper-functions.html#cb16-2402" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-2403"><a href="5-1-helper-functions.html#cb16-2403" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-2404"><a href="5-1-helper-functions.html#cb16-2404" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2405"><a href="5-1-helper-functions.html#cb16-2405" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2406"><a href="5-1-helper-functions.html#cb16-2406" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2407"><a href="5-1-helper-functions.html#cb16-2407" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2408"><a href="5-1-helper-functions.html#cb16-2408" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-2409"><a href="5-1-helper-functions.html#cb16-2409" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-2410"><a href="5-1-helper-functions.html#cb16-2410" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-2411"><a href="5-1-helper-functions.html#cb16-2411" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-2412"><a href="5-1-helper-functions.html#cb16-2412" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2413"><a href="5-1-helper-functions.html#cb16-2413" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-2414"><a href="5-1-helper-functions.html#cb16-2414" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-2415"><a href="5-1-helper-functions.html#cb16-2415" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-2416"><a href="5-1-helper-functions.html#cb16-2416" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2417"><a href="5-1-helper-functions.html#cb16-2417" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-2418"><a href="5-1-helper-functions.html#cb16-2418" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-2419"><a href="5-1-helper-functions.html#cb16-2419" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-2420"><a href="5-1-helper-functions.html#cb16-2420" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2421"><a href="5-1-helper-functions.html#cb16-2421" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-2422"><a href="5-1-helper-functions.html#cb16-2422" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-2423"><a href="5-1-helper-functions.html#cb16-2423" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-2424"><a href="5-1-helper-functions.html#cb16-2424" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2425"><a href="5-1-helper-functions.html#cb16-2425" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-2426"><a href="5-1-helper-functions.html#cb16-2426" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-2427"><a href="5-1-helper-functions.html#cb16-2427" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-2428"><a href="5-1-helper-functions.html#cb16-2428" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-2429"><a href="5-1-helper-functions.html#cb16-2429" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2430"><a href="5-1-helper-functions.html#cb16-2430" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-2431"><a href="5-1-helper-functions.html#cb16-2431" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2432"><a href="5-1-helper-functions.html#cb16-2432" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-2433"><a href="5-1-helper-functions.html#cb16-2433" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2434"><a href="5-1-helper-functions.html#cb16-2434" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2435"><a href="5-1-helper-functions.html#cb16-2435" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2436"><a href="5-1-helper-functions.html#cb16-2436" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2437"><a href="5-1-helper-functions.html#cb16-2437" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-2438"><a href="5-1-helper-functions.html#cb16-2438" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2439"><a href="5-1-helper-functions.html#cb16-2439" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2440"><a href="5-1-helper-functions.html#cb16-2440" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2441"><a href="5-1-helper-functions.html#cb16-2441" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-2442"><a href="5-1-helper-functions.html#cb16-2442" aria-hidden="true" tabindex="-1"></a>            <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-2443"><a href="5-1-helper-functions.html#cb16-2443" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-2444"><a href="5-1-helper-functions.html#cb16-2444" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2445"><a href="5-1-helper-functions.html#cb16-2445" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-2446"><a href="5-1-helper-functions.html#cb16-2446" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2447"><a href="5-1-helper-functions.html#cb16-2447" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-2448"><a href="5-1-helper-functions.html#cb16-2448" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2449"><a href="5-1-helper-functions.html#cb16-2449" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-2450"><a href="5-1-helper-functions.html#cb16-2450" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-2451"><a href="5-1-helper-functions.html#cb16-2451" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-2452"><a href="5-1-helper-functions.html#cb16-2452" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-2453"><a href="5-1-helper-functions.html#cb16-2453" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-2454"><a href="5-1-helper-functions.html#cb16-2454" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-2455"><a href="5-1-helper-functions.html#cb16-2455" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2456"><a href="5-1-helper-functions.html#cb16-2456" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-2457"><a href="5-1-helper-functions.html#cb16-2457" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-2458"><a href="5-1-helper-functions.html#cb16-2458" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-2459"><a href="5-1-helper-functions.html#cb16-2459" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2460"><a href="5-1-helper-functions.html#cb16-2460" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2461"><a href="5-1-helper-functions.html#cb16-2461" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2462"><a href="5-1-helper-functions.html#cb16-2462" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-2463"><a href="5-1-helper-functions.html#cb16-2463" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-2464"><a href="5-1-helper-functions.html#cb16-2464" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-2465"><a href="5-1-helper-functions.html#cb16-2465" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2466"><a href="5-1-helper-functions.html#cb16-2466" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2467"><a href="5-1-helper-functions.html#cb16-2467" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-2468"><a href="5-1-helper-functions.html#cb16-2468" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-2469"><a href="5-1-helper-functions.html#cb16-2469" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-2470"><a href="5-1-helper-functions.html#cb16-2470" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2471"><a href="5-1-helper-functions.html#cb16-2471" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-2472"><a href="5-1-helper-functions.html#cb16-2472" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-2473"><a href="5-1-helper-functions.html#cb16-2473" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-2474"><a href="5-1-helper-functions.html#cb16-2474" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-2475"><a href="5-1-helper-functions.html#cb16-2475" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-2476"><a href="5-1-helper-functions.html#cb16-2476" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2477"><a href="5-1-helper-functions.html#cb16-2477" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2478"><a href="5-1-helper-functions.html#cb16-2478" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2479"><a href="5-1-helper-functions.html#cb16-2479" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-2480"><a href="5-1-helper-functions.html#cb16-2480" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2481"><a href="5-1-helper-functions.html#cb16-2481" aria-hidden="true" tabindex="-1"></a>          <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-2482"><a href="5-1-helper-functions.html#cb16-2482" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2483"><a href="5-1-helper-functions.html#cb16-2483" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-2484"><a href="5-1-helper-functions.html#cb16-2484" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2485"><a href="5-1-helper-functions.html#cb16-2485" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-2486"><a href="5-1-helper-functions.html#cb16-2486" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-2487"><a href="5-1-helper-functions.html#cb16-2487" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2488"><a href="5-1-helper-functions.html#cb16-2488" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-2489"><a href="5-1-helper-functions.html#cb16-2489" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2490"><a href="5-1-helper-functions.html#cb16-2490" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-2491"><a href="5-1-helper-functions.html#cb16-2491" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2492"><a href="5-1-helper-functions.html#cb16-2492" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-2493"><a href="5-1-helper-functions.html#cb16-2493" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-2494"><a href="5-1-helper-functions.html#cb16-2494" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-2495"><a href="5-1-helper-functions.html#cb16-2495" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2496"><a href="5-1-helper-functions.html#cb16-2496" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-2497"><a href="5-1-helper-functions.html#cb16-2497" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2498"><a href="5-1-helper-functions.html#cb16-2498" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-2499"><a href="5-1-helper-functions.html#cb16-2499" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2500"><a href="5-1-helper-functions.html#cb16-2500" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else </span></span>
<span id="cb16-2501"><a href="5-1-helper-functions.html#cb16-2501" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2502"><a href="5-1-helper-functions.html#cb16-2502" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-2503"><a href="5-1-helper-functions.html#cb16-2503" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2504"><a href="5-1-helper-functions.html#cb16-2504" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-2505"><a href="5-1-helper-functions.html#cb16-2505" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2506"><a href="5-1-helper-functions.html#cb16-2506" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-2507"><a href="5-1-helper-functions.html#cb16-2507" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2508"><a href="5-1-helper-functions.html#cb16-2508" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2509"><a href="5-1-helper-functions.html#cb16-2509" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2510"><a href="5-1-helper-functions.html#cb16-2510" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-2511"><a href="5-1-helper-functions.html#cb16-2511" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2512"><a href="5-1-helper-functions.html#cb16-2512" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2513"><a href="5-1-helper-functions.html#cb16-2513" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2514"><a href="5-1-helper-functions.html#cb16-2514" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2515"><a href="5-1-helper-functions.html#cb16-2515" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2516"><a href="5-1-helper-functions.html#cb16-2516" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-2517"><a href="5-1-helper-functions.html#cb16-2517" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2518"><a href="5-1-helper-functions.html#cb16-2518" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2519"><a href="5-1-helper-functions.html#cb16-2519" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2520"><a href="5-1-helper-functions.html#cb16-2520" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-2521"><a href="5-1-helper-functions.html#cb16-2521" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2522"><a href="5-1-helper-functions.html#cb16-2522" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-2523"><a href="5-1-helper-functions.html#cb16-2523" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2524"><a href="5-1-helper-functions.html#cb16-2524" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-2525"><a href="5-1-helper-functions.html#cb16-2525" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2526"><a href="5-1-helper-functions.html#cb16-2526" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-2527"><a href="5-1-helper-functions.html#cb16-2527" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2528"><a href="5-1-helper-functions.html#cb16-2528" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-2529"><a href="5-1-helper-functions.html#cb16-2529" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2530"><a href="5-1-helper-functions.html#cb16-2530" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-2531"><a href="5-1-helper-functions.html#cb16-2531" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2532"><a href="5-1-helper-functions.html#cb16-2532" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-2533"><a href="5-1-helper-functions.html#cb16-2533" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2534"><a href="5-1-helper-functions.html#cb16-2534" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2535"><a href="5-1-helper-functions.html#cb16-2535" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2536"><a href="5-1-helper-functions.html#cb16-2536" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-2537"><a href="5-1-helper-functions.html#cb16-2537" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2538"><a href="5-1-helper-functions.html#cb16-2538" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2539"><a href="5-1-helper-functions.html#cb16-2539" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2540"><a href="5-1-helper-functions.html#cb16-2540" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2541"><a href="5-1-helper-functions.html#cb16-2541" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2542"><a href="5-1-helper-functions.html#cb16-2542" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-2543"><a href="5-1-helper-functions.html#cb16-2543" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2544"><a href="5-1-helper-functions.html#cb16-2544" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2545"><a href="5-1-helper-functions.html#cb16-2545" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2546"><a href="5-1-helper-functions.html#cb16-2546" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-2547"><a href="5-1-helper-functions.html#cb16-2547" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2548"><a href="5-1-helper-functions.html#cb16-2548" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-2549"><a href="5-1-helper-functions.html#cb16-2549" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2550"><a href="5-1-helper-functions.html#cb16-2550" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 1</span></span>
<span id="cb16-2551"><a href="5-1-helper-functions.html#cb16-2551" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-2552"><a href="5-1-helper-functions.html#cb16-2552" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2553"><a href="5-1-helper-functions.html#cb16-2553" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2554"><a href="5-1-helper-functions.html#cb16-2554" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2555"><a href="5-1-helper-functions.html#cb16-2555" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-2556"><a href="5-1-helper-functions.html#cb16-2556" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2557"><a href="5-1-helper-functions.html#cb16-2557" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2558"><a href="5-1-helper-functions.html#cb16-2558" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2559"><a href="5-1-helper-functions.html#cb16-2559" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-2560"><a href="5-1-helper-functions.html#cb16-2560" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2561"><a href="5-1-helper-functions.html#cb16-2561" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2562"><a href="5-1-helper-functions.html#cb16-2562" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-2563"><a href="5-1-helper-functions.html#cb16-2563" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-2564"><a href="5-1-helper-functions.html#cb16-2564" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-2565"><a href="5-1-helper-functions.html#cb16-2565" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2566"><a href="5-1-helper-functions.html#cb16-2566" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-2567"><a href="5-1-helper-functions.html#cb16-2567" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2568"><a href="5-1-helper-functions.html#cb16-2568" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-2569"><a href="5-1-helper-functions.html#cb16-2569" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-2570"><a href="5-1-helper-functions.html#cb16-2570" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-2571"><a href="5-1-helper-functions.html#cb16-2571" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-2572"><a href="5-1-helper-functions.html#cb16-2572" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-2573"><a href="5-1-helper-functions.html#cb16-2573" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2574"><a href="5-1-helper-functions.html#cb16-2574" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2575"><a href="5-1-helper-functions.html#cb16-2575" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-2576"><a href="5-1-helper-functions.html#cb16-2576" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2577"><a href="5-1-helper-functions.html#cb16-2577" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2578"><a href="5-1-helper-functions.html#cb16-2578" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2579"><a href="5-1-helper-functions.html#cb16-2579" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2580"><a href="5-1-helper-functions.html#cb16-2580" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-2581"><a href="5-1-helper-functions.html#cb16-2581" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2582"><a href="5-1-helper-functions.html#cb16-2582" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-2583"><a href="5-1-helper-functions.html#cb16-2583" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2584"><a href="5-1-helper-functions.html#cb16-2584" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2585"><a href="5-1-helper-functions.html#cb16-2585" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-2586"><a href="5-1-helper-functions.html#cb16-2586" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-2587"><a href="5-1-helper-functions.html#cb16-2587" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-2588"><a href="5-1-helper-functions.html#cb16-2588" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-2589"><a href="5-1-helper-functions.html#cb16-2589" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-2590"><a href="5-1-helper-functions.html#cb16-2590" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-2591"><a href="5-1-helper-functions.html#cb16-2591" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-2592"><a href="5-1-helper-functions.html#cb16-2592" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-2593"><a href="5-1-helper-functions.html#cb16-2593" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-2594"><a href="5-1-helper-functions.html#cb16-2594" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2595"><a href="5-1-helper-functions.html#cb16-2595" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-2596"><a href="5-1-helper-functions.html#cb16-2596" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2597"><a href="5-1-helper-functions.html#cb16-2597" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-2598"><a href="5-1-helper-functions.html#cb16-2598" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-2599"><a href="5-1-helper-functions.html#cb16-2599" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-2600"><a href="5-1-helper-functions.html#cb16-2600" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-2601"><a href="5-1-helper-functions.html#cb16-2601" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-2602"><a href="5-1-helper-functions.html#cb16-2602" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2603"><a href="5-1-helper-functions.html#cb16-2603" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2604"><a href="5-1-helper-functions.html#cb16-2604" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2605"><a href="5-1-helper-functions.html#cb16-2605" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2606"><a href="5-1-helper-functions.html#cb16-2606" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-2607"><a href="5-1-helper-functions.html#cb16-2607" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-2608"><a href="5-1-helper-functions.html#cb16-2608" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-2609"><a href="5-1-helper-functions.html#cb16-2609" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-2610"><a href="5-1-helper-functions.html#cb16-2610" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2611"><a href="5-1-helper-functions.html#cb16-2611" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-2612"><a href="5-1-helper-functions.html#cb16-2612" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-2613"><a href="5-1-helper-functions.html#cb16-2613" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-2614"><a href="5-1-helper-functions.html#cb16-2614" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2615"><a href="5-1-helper-functions.html#cb16-2615" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-2616"><a href="5-1-helper-functions.html#cb16-2616" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-2617"><a href="5-1-helper-functions.html#cb16-2617" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-2618"><a href="5-1-helper-functions.html#cb16-2618" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-2619"><a href="5-1-helper-functions.html#cb16-2619" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-2620"><a href="5-1-helper-functions.html#cb16-2620" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-2621"><a href="5-1-helper-functions.html#cb16-2621" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2622"><a href="5-1-helper-functions.html#cb16-2622" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-2623"><a href="5-1-helper-functions.html#cb16-2623" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-2624"><a href="5-1-helper-functions.html#cb16-2624" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-2625"><a href="5-1-helper-functions.html#cb16-2625" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-2626"><a href="5-1-helper-functions.html#cb16-2626" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2627"><a href="5-1-helper-functions.html#cb16-2627" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-2628"><a href="5-1-helper-functions.html#cb16-2628" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2629"><a href="5-1-helper-functions.html#cb16-2629" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-2630"><a href="5-1-helper-functions.html#cb16-2630" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2631"><a href="5-1-helper-functions.html#cb16-2631" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2632"><a href="5-1-helper-functions.html#cb16-2632" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2633"><a href="5-1-helper-functions.html#cb16-2633" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2634"><a href="5-1-helper-functions.html#cb16-2634" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-2635"><a href="5-1-helper-functions.html#cb16-2635" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2636"><a href="5-1-helper-functions.html#cb16-2636" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2637"><a href="5-1-helper-functions.html#cb16-2637" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2638"><a href="5-1-helper-functions.html#cb16-2638" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-2639"><a href="5-1-helper-functions.html#cb16-2639" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-2640"><a href="5-1-helper-functions.html#cb16-2640" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-2641"><a href="5-1-helper-functions.html#cb16-2641" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2642"><a href="5-1-helper-functions.html#cb16-2642" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-2643"><a href="5-1-helper-functions.html#cb16-2643" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2644"><a href="5-1-helper-functions.html#cb16-2644" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-2645"><a href="5-1-helper-functions.html#cb16-2645" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2646"><a href="5-1-helper-functions.html#cb16-2646" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-2647"><a href="5-1-helper-functions.html#cb16-2647" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-2648"><a href="5-1-helper-functions.html#cb16-2648" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2649"><a href="5-1-helper-functions.html#cb16-2649" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2650"><a href="5-1-helper-functions.html#cb16-2650" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2651"><a href="5-1-helper-functions.html#cb16-2651" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-2652"><a href="5-1-helper-functions.html#cb16-2652" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-2653"><a href="5-1-helper-functions.html#cb16-2653" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-2654"><a href="5-1-helper-functions.html#cb16-2654" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-2655"><a href="5-1-helper-functions.html#cb16-2655" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-2656"><a href="5-1-helper-functions.html#cb16-2656" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-2657"><a href="5-1-helper-functions.html#cb16-2657" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2658"><a href="5-1-helper-functions.html#cb16-2658" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-2659"><a href="5-1-helper-functions.html#cb16-2659" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-2660"><a href="5-1-helper-functions.html#cb16-2660" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-2661"><a href="5-1-helper-functions.html#cb16-2661" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2662"><a href="5-1-helper-functions.html#cb16-2662" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2663"><a href="5-1-helper-functions.html#cb16-2663" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2664"><a href="5-1-helper-functions.html#cb16-2664" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-2665"><a href="5-1-helper-functions.html#cb16-2665" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-2666"><a href="5-1-helper-functions.html#cb16-2666" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-2667"><a href="5-1-helper-functions.html#cb16-2667" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2668"><a href="5-1-helper-functions.html#cb16-2668" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2669"><a href="5-1-helper-functions.html#cb16-2669" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-2670"><a href="5-1-helper-functions.html#cb16-2670" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-2671"><a href="5-1-helper-functions.html#cb16-2671" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-2672"><a href="5-1-helper-functions.html#cb16-2672" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2673"><a href="5-1-helper-functions.html#cb16-2673" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-2674"><a href="5-1-helper-functions.html#cb16-2674" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-2675"><a href="5-1-helper-functions.html#cb16-2675" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-2676"><a href="5-1-helper-functions.html#cb16-2676" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-2677"><a href="5-1-helper-functions.html#cb16-2677" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-2678"><a href="5-1-helper-functions.html#cb16-2678" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2679"><a href="5-1-helper-functions.html#cb16-2679" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2680"><a href="5-1-helper-functions.html#cb16-2680" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2681"><a href="5-1-helper-functions.html#cb16-2681" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-2682"><a href="5-1-helper-functions.html#cb16-2682" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2683"><a href="5-1-helper-functions.html#cb16-2683" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2684"><a href="5-1-helper-functions.html#cb16-2684" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2685"><a href="5-1-helper-functions.html#cb16-2685" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-2686"><a href="5-1-helper-functions.html#cb16-2686" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2687"><a href="5-1-helper-functions.html#cb16-2687" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-2688"><a href="5-1-helper-functions.html#cb16-2688" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2689"><a href="5-1-helper-functions.html#cb16-2689" aria-hidden="true" tabindex="-1"></a>          <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-2690"><a href="5-1-helper-functions.html#cb16-2690" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2691"><a href="5-1-helper-functions.html#cb16-2691" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-2692"><a href="5-1-helper-functions.html#cb16-2692" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2693"><a href="5-1-helper-functions.html#cb16-2693" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-2694"><a href="5-1-helper-functions.html#cb16-2694" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2695"><a href="5-1-helper-functions.html#cb16-2695" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-2696"><a href="5-1-helper-functions.html#cb16-2696" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-2697"><a href="5-1-helper-functions.html#cb16-2697" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2698"><a href="5-1-helper-functions.html#cb16-2698" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-2699"><a href="5-1-helper-functions.html#cb16-2699" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2700"><a href="5-1-helper-functions.html#cb16-2700" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-2701"><a href="5-1-helper-functions.html#cb16-2701" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2702"><a href="5-1-helper-functions.html#cb16-2702" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-2703"><a href="5-1-helper-functions.html#cb16-2703" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-2704"><a href="5-1-helper-functions.html#cb16-2704" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-2705"><a href="5-1-helper-functions.html#cb16-2705" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2706"><a href="5-1-helper-functions.html#cb16-2706" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-2707"><a href="5-1-helper-functions.html#cb16-2707" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2708"><a href="5-1-helper-functions.html#cb16-2708" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-2709"><a href="5-1-helper-functions.html#cb16-2709" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-2710"><a href="5-1-helper-functions.html#cb16-2710" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-2711"><a href="5-1-helper-functions.html#cb16-2711" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-2712"><a href="5-1-helper-functions.html#cb16-2712" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # }else </span></span>
<span id="cb16-2713"><a href="5-1-helper-functions.html#cb16-2713" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2714"><a href="5-1-helper-functions.html#cb16-2714" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-2715"><a href="5-1-helper-functions.html#cb16-2715" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2716"><a href="5-1-helper-functions.html#cb16-2716" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-2717"><a href="5-1-helper-functions.html#cb16-2717" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2718"><a href="5-1-helper-functions.html#cb16-2718" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-2719"><a href="5-1-helper-functions.html#cb16-2719" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2720"><a href="5-1-helper-functions.html#cb16-2720" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2721"><a href="5-1-helper-functions.html#cb16-2721" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2722"><a href="5-1-helper-functions.html#cb16-2722" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-2723"><a href="5-1-helper-functions.html#cb16-2723" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2724"><a href="5-1-helper-functions.html#cb16-2724" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2725"><a href="5-1-helper-functions.html#cb16-2725" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2726"><a href="5-1-helper-functions.html#cb16-2726" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2727"><a href="5-1-helper-functions.html#cb16-2727" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2728"><a href="5-1-helper-functions.html#cb16-2728" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-2729"><a href="5-1-helper-functions.html#cb16-2729" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2730"><a href="5-1-helper-functions.html#cb16-2730" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2731"><a href="5-1-helper-functions.html#cb16-2731" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2732"><a href="5-1-helper-functions.html#cb16-2732" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-2733"><a href="5-1-helper-functions.html#cb16-2733" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2734"><a href="5-1-helper-functions.html#cb16-2734" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-2735"><a href="5-1-helper-functions.html#cb16-2735" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2736"><a href="5-1-helper-functions.html#cb16-2736" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-2737"><a href="5-1-helper-functions.html#cb16-2737" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2738"><a href="5-1-helper-functions.html#cb16-2738" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-2739"><a href="5-1-helper-functions.html#cb16-2739" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2740"><a href="5-1-helper-functions.html#cb16-2740" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-2741"><a href="5-1-helper-functions.html#cb16-2741" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2742"><a href="5-1-helper-functions.html#cb16-2742" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-2743"><a href="5-1-helper-functions.html#cb16-2743" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2744"><a href="5-1-helper-functions.html#cb16-2744" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-2745"><a href="5-1-helper-functions.html#cb16-2745" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2746"><a href="5-1-helper-functions.html#cb16-2746" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2747"><a href="5-1-helper-functions.html#cb16-2747" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2748"><a href="5-1-helper-functions.html#cb16-2748" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-2749"><a href="5-1-helper-functions.html#cb16-2749" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2750"><a href="5-1-helper-functions.html#cb16-2750" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2751"><a href="5-1-helper-functions.html#cb16-2751" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2752"><a href="5-1-helper-functions.html#cb16-2752" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2753"><a href="5-1-helper-functions.html#cb16-2753" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2754"><a href="5-1-helper-functions.html#cb16-2754" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-2755"><a href="5-1-helper-functions.html#cb16-2755" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2756"><a href="5-1-helper-functions.html#cb16-2756" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2757"><a href="5-1-helper-functions.html#cb16-2757" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2758"><a href="5-1-helper-functions.html#cb16-2758" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-2759"><a href="5-1-helper-functions.html#cb16-2759" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2760"><a href="5-1-helper-functions.html#cb16-2760" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-2761"><a href="5-1-helper-functions.html#cb16-2761" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2762"><a href="5-1-helper-functions.html#cb16-2762" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 2</span></span>
<span id="cb16-2763"><a href="5-1-helper-functions.html#cb16-2763" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-2764"><a href="5-1-helper-functions.html#cb16-2764" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2765"><a href="5-1-helper-functions.html#cb16-2765" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2766"><a href="5-1-helper-functions.html#cb16-2766" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-2767"><a href="5-1-helper-functions.html#cb16-2767" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2768"><a href="5-1-helper-functions.html#cb16-2768" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2769"><a href="5-1-helper-functions.html#cb16-2769" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2770"><a href="5-1-helper-functions.html#cb16-2770" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-2771"><a href="5-1-helper-functions.html#cb16-2771" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2772"><a href="5-1-helper-functions.html#cb16-2772" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2773"><a href="5-1-helper-functions.html#cb16-2773" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-2774"><a href="5-1-helper-functions.html#cb16-2774" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-2775"><a href="5-1-helper-functions.html#cb16-2775" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-2776"><a href="5-1-helper-functions.html#cb16-2776" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2777"><a href="5-1-helper-functions.html#cb16-2777" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-2778"><a href="5-1-helper-functions.html#cb16-2778" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2779"><a href="5-1-helper-functions.html#cb16-2779" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-2780"><a href="5-1-helper-functions.html#cb16-2780" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-2781"><a href="5-1-helper-functions.html#cb16-2781" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-2782"><a href="5-1-helper-functions.html#cb16-2782" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-2783"><a href="5-1-helper-functions.html#cb16-2783" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-2784"><a href="5-1-helper-functions.html#cb16-2784" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2785"><a href="5-1-helper-functions.html#cb16-2785" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2786"><a href="5-1-helper-functions.html#cb16-2786" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-2787"><a href="5-1-helper-functions.html#cb16-2787" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2788"><a href="5-1-helper-functions.html#cb16-2788" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2789"><a href="5-1-helper-functions.html#cb16-2789" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2790"><a href="5-1-helper-functions.html#cb16-2790" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2791"><a href="5-1-helper-functions.html#cb16-2791" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-2792"><a href="5-1-helper-functions.html#cb16-2792" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2793"><a href="5-1-helper-functions.html#cb16-2793" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-2794"><a href="5-1-helper-functions.html#cb16-2794" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2795"><a href="5-1-helper-functions.html#cb16-2795" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-2796"><a href="5-1-helper-functions.html#cb16-2796" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-2797"><a href="5-1-helper-functions.html#cb16-2797" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-2798"><a href="5-1-helper-functions.html#cb16-2798" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-2799"><a href="5-1-helper-functions.html#cb16-2799" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-2800"><a href="5-1-helper-functions.html#cb16-2800" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-2801"><a href="5-1-helper-functions.html#cb16-2801" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-2802"><a href="5-1-helper-functions.html#cb16-2802" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-2803"><a href="5-1-helper-functions.html#cb16-2803" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-2804"><a href="5-1-helper-functions.html#cb16-2804" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2805"><a href="5-1-helper-functions.html#cb16-2805" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2806"><a href="5-1-helper-functions.html#cb16-2806" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-2807"><a href="5-1-helper-functions.html#cb16-2807" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2808"><a href="5-1-helper-functions.html#cb16-2808" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-2809"><a href="5-1-helper-functions.html#cb16-2809" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-2810"><a href="5-1-helper-functions.html#cb16-2810" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-2811"><a href="5-1-helper-functions.html#cb16-2811" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-2812"><a href="5-1-helper-functions.html#cb16-2812" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-2813"><a href="5-1-helper-functions.html#cb16-2813" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2814"><a href="5-1-helper-functions.html#cb16-2814" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2815"><a href="5-1-helper-functions.html#cb16-2815" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2816"><a href="5-1-helper-functions.html#cb16-2816" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2817"><a href="5-1-helper-functions.html#cb16-2817" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-2818"><a href="5-1-helper-functions.html#cb16-2818" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-2819"><a href="5-1-helper-functions.html#cb16-2819" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-2820"><a href="5-1-helper-functions.html#cb16-2820" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-2821"><a href="5-1-helper-functions.html#cb16-2821" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2822"><a href="5-1-helper-functions.html#cb16-2822" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-2823"><a href="5-1-helper-functions.html#cb16-2823" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-2824"><a href="5-1-helper-functions.html#cb16-2824" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-2825"><a href="5-1-helper-functions.html#cb16-2825" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2826"><a href="5-1-helper-functions.html#cb16-2826" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-2827"><a href="5-1-helper-functions.html#cb16-2827" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-2828"><a href="5-1-helper-functions.html#cb16-2828" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-2829"><a href="5-1-helper-functions.html#cb16-2829" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-2830"><a href="5-1-helper-functions.html#cb16-2830" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-2831"><a href="5-1-helper-functions.html#cb16-2831" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-2832"><a href="5-1-helper-functions.html#cb16-2832" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2833"><a href="5-1-helper-functions.html#cb16-2833" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-2834"><a href="5-1-helper-functions.html#cb16-2834" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-2835"><a href="5-1-helper-functions.html#cb16-2835" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-2836"><a href="5-1-helper-functions.html#cb16-2836" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-2837"><a href="5-1-helper-functions.html#cb16-2837" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2838"><a href="5-1-helper-functions.html#cb16-2838" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-2839"><a href="5-1-helper-functions.html#cb16-2839" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2840"><a href="5-1-helper-functions.html#cb16-2840" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-2841"><a href="5-1-helper-functions.html#cb16-2841" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2842"><a href="5-1-helper-functions.html#cb16-2842" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2843"><a href="5-1-helper-functions.html#cb16-2843" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2844"><a href="5-1-helper-functions.html#cb16-2844" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2845"><a href="5-1-helper-functions.html#cb16-2845" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-2846"><a href="5-1-helper-functions.html#cb16-2846" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2847"><a href="5-1-helper-functions.html#cb16-2847" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-2848"><a href="5-1-helper-functions.html#cb16-2848" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2849"><a href="5-1-helper-functions.html#cb16-2849" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-2850"><a href="5-1-helper-functions.html#cb16-2850" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-2851"><a href="5-1-helper-functions.html#cb16-2851" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-2852"><a href="5-1-helper-functions.html#cb16-2852" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2853"><a href="5-1-helper-functions.html#cb16-2853" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-2854"><a href="5-1-helper-functions.html#cb16-2854" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-2855"><a href="5-1-helper-functions.html#cb16-2855" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-2856"><a href="5-1-helper-functions.html#cb16-2856" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2857"><a href="5-1-helper-functions.html#cb16-2857" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2858"><a href="5-1-helper-functions.html#cb16-2858" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-2859"><a href="5-1-helper-functions.html#cb16-2859" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-2860"><a href="5-1-helper-functions.html#cb16-2860" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-2861"><a href="5-1-helper-functions.html#cb16-2861" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-2862"><a href="5-1-helper-functions.html#cb16-2862" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2863"><a href="5-1-helper-functions.html#cb16-2863" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-2864"><a href="5-1-helper-functions.html#cb16-2864" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-2865"><a href="5-1-helper-functions.html#cb16-2865" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-2866"><a href="5-1-helper-functions.html#cb16-2866" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-2867"><a href="5-1-helper-functions.html#cb16-2867" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-2868"><a href="5-1-helper-functions.html#cb16-2868" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-2869"><a href="5-1-helper-functions.html#cb16-2869" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2870"><a href="5-1-helper-functions.html#cb16-2870" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-2871"><a href="5-1-helper-functions.html#cb16-2871" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-2872"><a href="5-1-helper-functions.html#cb16-2872" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-2873"><a href="5-1-helper-functions.html#cb16-2873" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2874"><a href="5-1-helper-functions.html#cb16-2874" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2875"><a href="5-1-helper-functions.html#cb16-2875" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2876"><a href="5-1-helper-functions.html#cb16-2876" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-2877"><a href="5-1-helper-functions.html#cb16-2877" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-2878"><a href="5-1-helper-functions.html#cb16-2878" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-2879"><a href="5-1-helper-functions.html#cb16-2879" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-2880"><a href="5-1-helper-functions.html#cb16-2880" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2881"><a href="5-1-helper-functions.html#cb16-2881" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-2882"><a href="5-1-helper-functions.html#cb16-2882" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-2883"><a href="5-1-helper-functions.html#cb16-2883" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-2884"><a href="5-1-helper-functions.html#cb16-2884" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2885"><a href="5-1-helper-functions.html#cb16-2885" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-2886"><a href="5-1-helper-functions.html#cb16-2886" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-2887"><a href="5-1-helper-functions.html#cb16-2887" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-2888"><a href="5-1-helper-functions.html#cb16-2888" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-2889"><a href="5-1-helper-functions.html#cb16-2889" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-2890"><a href="5-1-helper-functions.html#cb16-2890" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2891"><a href="5-1-helper-functions.html#cb16-2891" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2892"><a href="5-1-helper-functions.html#cb16-2892" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2893"><a href="5-1-helper-functions.html#cb16-2893" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-2894"><a href="5-1-helper-functions.html#cb16-2894" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2895"><a href="5-1-helper-functions.html#cb16-2895" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-2896"><a href="5-1-helper-functions.html#cb16-2896" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2897"><a href="5-1-helper-functions.html#cb16-2897" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-2898"><a href="5-1-helper-functions.html#cb16-2898" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2899"><a href="5-1-helper-functions.html#cb16-2899" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-2900"><a href="5-1-helper-functions.html#cb16-2900" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2901"><a href="5-1-helper-functions.html#cb16-2901" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-2902"><a href="5-1-helper-functions.html#cb16-2902" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2903"><a href="5-1-helper-functions.html#cb16-2903" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-2904"><a href="5-1-helper-functions.html#cb16-2904" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-2905"><a href="5-1-helper-functions.html#cb16-2905" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2906"><a href="5-1-helper-functions.html#cb16-2906" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-2907"><a href="5-1-helper-functions.html#cb16-2907" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2908"><a href="5-1-helper-functions.html#cb16-2908" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-2909"><a href="5-1-helper-functions.html#cb16-2909" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2910"><a href="5-1-helper-functions.html#cb16-2910" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-2911"><a href="5-1-helper-functions.html#cb16-2911" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-2912"><a href="5-1-helper-functions.html#cb16-2912" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-2913"><a href="5-1-helper-functions.html#cb16-2913" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2914"><a href="5-1-helper-functions.html#cb16-2914" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-2915"><a href="5-1-helper-functions.html#cb16-2915" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2916"><a href="5-1-helper-functions.html#cb16-2916" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-2917"><a href="5-1-helper-functions.html#cb16-2917" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-2918"><a href="5-1-helper-functions.html#cb16-2918" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-2919"><a href="5-1-helper-functions.html#cb16-2919" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-2920"><a href="5-1-helper-functions.html#cb16-2920" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # }else </span></span>
<span id="cb16-2921"><a href="5-1-helper-functions.html#cb16-2921" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 2){</span></span>
<span id="cb16-2922"><a href="5-1-helper-functions.html#cb16-2922" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2923"><a href="5-1-helper-functions.html#cb16-2923" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-2924"><a href="5-1-helper-functions.html#cb16-2924" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2925"><a href="5-1-helper-functions.html#cb16-2925" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-2926"><a href="5-1-helper-functions.html#cb16-2926" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2927"><a href="5-1-helper-functions.html#cb16-2927" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2928"><a href="5-1-helper-functions.html#cb16-2928" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2929"><a href="5-1-helper-functions.html#cb16-2929" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-2930"><a href="5-1-helper-functions.html#cb16-2930" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2931"><a href="5-1-helper-functions.html#cb16-2931" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2932"><a href="5-1-helper-functions.html#cb16-2932" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2933"><a href="5-1-helper-functions.html#cb16-2933" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2934"><a href="5-1-helper-functions.html#cb16-2934" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2935"><a href="5-1-helper-functions.html#cb16-2935" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-2936"><a href="5-1-helper-functions.html#cb16-2936" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2937"><a href="5-1-helper-functions.html#cb16-2937" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2938"><a href="5-1-helper-functions.html#cb16-2938" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2939"><a href="5-1-helper-functions.html#cb16-2939" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-2940"><a href="5-1-helper-functions.html#cb16-2940" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2941"><a href="5-1-helper-functions.html#cb16-2941" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-2942"><a href="5-1-helper-functions.html#cb16-2942" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2943"><a href="5-1-helper-functions.html#cb16-2943" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-2944"><a href="5-1-helper-functions.html#cb16-2944" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-2945"><a href="5-1-helper-functions.html#cb16-2945" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-2946"><a href="5-1-helper-functions.html#cb16-2946" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2947"><a href="5-1-helper-functions.html#cb16-2947" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-2948"><a href="5-1-helper-functions.html#cb16-2948" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2949"><a href="5-1-helper-functions.html#cb16-2949" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-2950"><a href="5-1-helper-functions.html#cb16-2950" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2951"><a href="5-1-helper-functions.html#cb16-2951" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-2952"><a href="5-1-helper-functions.html#cb16-2952" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2953"><a href="5-1-helper-functions.html#cb16-2953" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-2954"><a href="5-1-helper-functions.html#cb16-2954" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2955"><a href="5-1-helper-functions.html#cb16-2955" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-2956"><a href="5-1-helper-functions.html#cb16-2956" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2957"><a href="5-1-helper-functions.html#cb16-2957" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-2958"><a href="5-1-helper-functions.html#cb16-2958" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2959"><a href="5-1-helper-functions.html#cb16-2959" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-2960"><a href="5-1-helper-functions.html#cb16-2960" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2961"><a href="5-1-helper-functions.html#cb16-2961" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-2962"><a href="5-1-helper-functions.html#cb16-2962" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-2963"><a href="5-1-helper-functions.html#cb16-2963" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-2964"><a href="5-1-helper-functions.html#cb16-2964" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2965"><a href="5-1-helper-functions.html#cb16-2965" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-2966"><a href="5-1-helper-functions.html#cb16-2966" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2967"><a href="5-1-helper-functions.html#cb16-2967" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-2968"><a href="5-1-helper-functions.html#cb16-2968" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-2969"><a href="5-1-helper-functions.html#cb16-2969" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 3</span></span>
<span id="cb16-2970"><a href="5-1-helper-functions.html#cb16-2970" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-2971"><a href="5-1-helper-functions.html#cb16-2971" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-2972"><a href="5-1-helper-functions.html#cb16-2972" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-2973"><a href="5-1-helper-functions.html#cb16-2973" aria-hidden="true" tabindex="-1"></a>   <span class="co"># }</span></span>
<span id="cb16-2974"><a href="5-1-helper-functions.html#cb16-2974" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-2975"><a href="5-1-helper-functions.html#cb16-2975" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2976"><a href="5-1-helper-functions.html#cb16-2976" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2977"><a href="5-1-helper-functions.html#cb16-2977" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2978"><a href="5-1-helper-functions.html#cb16-2978" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2979"><a href="5-1-helper-functions.html#cb16-2979" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-2980"><a href="5-1-helper-functions.html#cb16-2980" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-2981"><a href="5-1-helper-functions.html#cb16-2981" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-2982"><a href="5-1-helper-functions.html#cb16-2982" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-2983"><a href="5-1-helper-functions.html#cb16-2983" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2984"><a href="5-1-helper-functions.html#cb16-2984" aria-hidden="true" tabindex="-1"></a>de_fun_beta2_sex_w_death <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-2985"><a href="5-1-helper-functions.html#cb16-2985" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-2986"><a href="5-1-helper-functions.html#cb16-2986" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-2987"><a href="5-1-helper-functions.html#cb16-2987" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2988"><a href="5-1-helper-functions.html#cb16-2988" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2989"><a href="5-1-helper-functions.html#cb16-2989" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2990"><a href="5-1-helper-functions.html#cb16-2990" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-2991"><a href="5-1-helper-functions.html#cb16-2991" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-2992"><a href="5-1-helper-functions.html#cb16-2992" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2993"><a href="5-1-helper-functions.html#cb16-2993" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-2994"><a href="5-1-helper-functions.html#cb16-2994" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2995"><a href="5-1-helper-functions.html#cb16-2995" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-2996"><a href="5-1-helper-functions.html#cb16-2996" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-2997"><a href="5-1-helper-functions.html#cb16-2997" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-2998"><a href="5-1-helper-functions.html#cb16-2998" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-2999"><a href="5-1-helper-functions.html#cb16-2999" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-3000"><a href="5-1-helper-functions.html#cb16-3000" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3001"><a href="5-1-helper-functions.html#cb16-3001" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-3002"><a href="5-1-helper-functions.html#cb16-3002" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-3003"><a href="5-1-helper-functions.html#cb16-3003" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3004"><a href="5-1-helper-functions.html#cb16-3004" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-3005"><a href="5-1-helper-functions.html#cb16-3005" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-3006"><a href="5-1-helper-functions.html#cb16-3006" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3007"><a href="5-1-helper-functions.html#cb16-3007" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-3008"><a href="5-1-helper-functions.html#cb16-3008" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-3009"><a href="5-1-helper-functions.html#cb16-3009" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-3010"><a href="5-1-helper-functions.html#cb16-3010" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-3011"><a href="5-1-helper-functions.html#cb16-3011" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-3012"><a href="5-1-helper-functions.html#cb16-3012" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-3013"><a href="5-1-helper-functions.html#cb16-3013" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3014"><a href="5-1-helper-functions.html#cb16-3014" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-3015"><a href="5-1-helper-functions.html#cb16-3015" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3016"><a href="5-1-helper-functions.html#cb16-3016" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-3017"><a href="5-1-helper-functions.html#cb16-3017" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-3018"><a href="5-1-helper-functions.html#cb16-3018" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-3019"><a href="5-1-helper-functions.html#cb16-3019" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-3020"><a href="5-1-helper-functions.html#cb16-3020" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-3021"><a href="5-1-helper-functions.html#cb16-3021" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-3022"><a href="5-1-helper-functions.html#cb16-3022" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-3023"><a href="5-1-helper-functions.html#cb16-3023" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-3024"><a href="5-1-helper-functions.html#cb16-3024" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-3025"><a href="5-1-helper-functions.html#cb16-3025" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-3026"><a href="5-1-helper-functions.html#cb16-3026" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-3027"><a href="5-1-helper-functions.html#cb16-3027" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-3028"><a href="5-1-helper-functions.html#cb16-3028" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-3029"><a href="5-1-helper-functions.html#cb16-3029" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3030"><a href="5-1-helper-functions.html#cb16-3030" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-3031"><a href="5-1-helper-functions.html#cb16-3031" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-3032"><a href="5-1-helper-functions.html#cb16-3032" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-3033"><a href="5-1-helper-functions.html#cb16-3033" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-3034"><a href="5-1-helper-functions.html#cb16-3034" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-3035"><a href="5-1-helper-functions.html#cb16-3035" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-3036"><a href="5-1-helper-functions.html#cb16-3036" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-3037"><a href="5-1-helper-functions.html#cb16-3037" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-3038"><a href="5-1-helper-functions.html#cb16-3038" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-3039"><a href="5-1-helper-functions.html#cb16-3039" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-3040"><a href="5-1-helper-functions.html#cb16-3040" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-3041"><a href="5-1-helper-functions.html#cb16-3041" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-3042"><a href="5-1-helper-functions.html#cb16-3042" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-3043"><a href="5-1-helper-functions.html#cb16-3043" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3044"><a href="5-1-helper-functions.html#cb16-3044" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-3045"><a href="5-1-helper-functions.html#cb16-3045" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-3046"><a href="5-1-helper-functions.html#cb16-3046" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-3047"><a href="5-1-helper-functions.html#cb16-3047" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-3048"><a href="5-1-helper-functions.html#cb16-3048" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3049"><a href="5-1-helper-functions.html#cb16-3049" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-3050"><a href="5-1-helper-functions.html#cb16-3050" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-3051"><a href="5-1-helper-functions.html#cb16-3051" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-3052"><a href="5-1-helper-functions.html#cb16-3052" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3053"><a href="5-1-helper-functions.html#cb16-3053" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-3054"><a href="5-1-helper-functions.html#cb16-3054" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-3055"><a href="5-1-helper-functions.html#cb16-3055" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3056"><a href="5-1-helper-functions.html#cb16-3056" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3057"><a href="5-1-helper-functions.html#cb16-3057" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-3058"><a href="5-1-helper-functions.html#cb16-3058" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-3059"><a href="5-1-helper-functions.html#cb16-3059" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-3060"><a href="5-1-helper-functions.html#cb16-3060" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3061"><a href="5-1-helper-functions.html#cb16-3061" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-3062"><a href="5-1-helper-functions.html#cb16-3062" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3063"><a href="5-1-helper-functions.html#cb16-3063" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3064"><a href="5-1-helper-functions.html#cb16-3064" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-3065"><a href="5-1-helper-functions.html#cb16-3065" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-3066"><a href="5-1-helper-functions.html#cb16-3066" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3067"><a href="5-1-helper-functions.html#cb16-3067" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3068"><a href="5-1-helper-functions.html#cb16-3068" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3069"><a href="5-1-helper-functions.html#cb16-3069" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3070"><a href="5-1-helper-functions.html#cb16-3070" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3071"><a href="5-1-helper-functions.html#cb16-3071" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3072"><a href="5-1-helper-functions.html#cb16-3072" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3073"><a href="5-1-helper-functions.html#cb16-3073" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3074"><a href="5-1-helper-functions.html#cb16-3074" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3075"><a href="5-1-helper-functions.html#cb16-3075" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3076"><a href="5-1-helper-functions.html#cb16-3076" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-3077"><a href="5-1-helper-functions.html#cb16-3077" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-3078"><a href="5-1-helper-functions.html#cb16-3078" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-3079"><a href="5-1-helper-functions.html#cb16-3079" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3080"><a href="5-1-helper-functions.html#cb16-3080" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-3081"><a href="5-1-helper-functions.html#cb16-3081" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3082"><a href="5-1-helper-functions.html#cb16-3082" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb16-3083"><a href="5-1-helper-functions.html#cb16-3083" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3084"><a href="5-1-helper-functions.html#cb16-3084" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3085"><a href="5-1-helper-functions.html#cb16-3085" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Finally need death parameters</span></span>
<span id="cb16-3086"><a href="5-1-helper-functions.html#cb16-3086" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Will use CDC life tables to get death https://www.cdc.gov/nchs/products/life_tables.htm</span></span>
<span id="cb16-3087"><a href="5-1-helper-functions.html#cb16-3087" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Will stratify death rates by age and sex</span></span>
<span id="cb16-3088"><a href="5-1-helper-functions.html#cb16-3088" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Death rate is computed as follows:</span></span>
<span id="cb16-3089"><a href="5-1-helper-functions.html#cb16-3089" aria-hidden="true" tabindex="-1"></a>  <span class="do">## First, the probability of death between ages X and X+1 were extracted from the lifetable</span></span>
<span id="cb16-3090"><a href="5-1-helper-functions.html#cb16-3090" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For each age range, the median probability was sampled</span></span>
<span id="cb16-3091"><a href="5-1-helper-functions.html#cb16-3091" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the over 65 group, we exlcuded the &gt;100 category because the probability of death was 100%</span></span>
<span id="cb16-3092"><a href="5-1-helper-functions.html#cb16-3092" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The probabilities were then converted into rates using the formula: rate = -ln(1 - probability)</span></span>
<span id="cb16-3093"><a href="5-1-helper-functions.html#cb16-3093" aria-hidden="true" tabindex="-1"></a>  <span class="do">## </span></span>
<span id="cb16-3094"><a href="5-1-helper-functions.html#cb16-3094" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3095"><a href="5-1-helper-functions.html#cb16-3095" aria-hidden="true" tabindex="-1"></a>  death_rates <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,sex_types<span class="sc">*</span>age_types), <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types))</span>
<span id="cb16-3096"><a href="5-1-helper-functions.html#cb16-3096" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3097"><a href="5-1-helper-functions.html#cb16-3097" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For Men</span></span>
<span id="cb16-3098"><a href="5-1-helper-functions.html#cb16-3098" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3099"><a href="5-1-helper-functions.html#cb16-3099" aria-hidden="true" tabindex="-1"></a>  <span class="do">##-ln(1 - probability)</span></span>
<span id="cb16-3100"><a href="5-1-helper-functions.html#cb16-3100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3101"><a href="5-1-helper-functions.html#cb16-3101" aria-hidden="true" tabindex="-1"></a>  death_rates[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.001286</span>, <span class="fl">0.001835</span>, <span class="fl">0.002426</span>, <span class="fl">0.004763</span>, <span class="fl">0.011045</span>, <span class="fl">0.069452</span>))</span>
<span id="cb16-3102"><a href="5-1-helper-functions.html#cb16-3102" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3103"><a href="5-1-helper-functions.html#cb16-3103" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For Women</span></span>
<span id="cb16-3104"><a href="5-1-helper-functions.html#cb16-3104" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3105"><a href="5-1-helper-functions.html#cb16-3105" aria-hidden="true" tabindex="-1"></a>  death_rates[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.000471</span>, <span class="fl">0.000801</span>, <span class="fl">0.001373</span>, <span class="fl">0.002971</span>, <span class="fl">0.006655</span>, <span class="fl">0.051681</span>))</span>
<span id="cb16-3106"><a href="5-1-helper-functions.html#cb16-3106" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3107"><a href="5-1-helper-functions.html#cb16-3107" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3108"><a href="5-1-helper-functions.html#cb16-3108" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We also need excess mortality related to cigarette use</span></span>
<span id="cb16-3109"><a href="5-1-helper-functions.html#cb16-3109" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3110"><a href="5-1-helper-functions.html#cb16-3110" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3111"><a href="5-1-helper-functions.html#cb16-3111" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,sex_types<span class="sc">*</span>cigarette_types), <span class="at">dim =</span> <span class="fu">c</span>(sex_types,cigarette_types))</span>
<span id="cb16-3112"><a href="5-1-helper-functions.html#cb16-3112" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3113"><a href="5-1-helper-functions.html#cb16-3113" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.24</span>,<span class="fl">1.30</span>) </span>
<span id="cb16-3114"><a href="5-1-helper-functions.html#cb16-3114" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.29</span>,<span class="fl">1.35</span>)</span>
<span id="cb16-3115"><a href="5-1-helper-functions.html#cb16-3115" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3116"><a href="5-1-helper-functions.html#cb16-3116" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-3117"><a href="5-1-helper-functions.html#cb16-3117" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-3118"><a href="5-1-helper-functions.html#cb16-3118" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-3119"><a href="5-1-helper-functions.html#cb16-3119" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3120"><a href="5-1-helper-functions.html#cb16-3120" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> parameters[<span class="dv">2978</span>]</span>
<span id="cb16-3121"><a href="5-1-helper-functions.html#cb16-3121" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3122"><a href="5-1-helper-functions.html#cb16-3122" aria-hidden="true" tabindex="-1"></a>  not_sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3123"><a href="5-1-helper-functions.html#cb16-3123" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sex <span class="sc">==</span> <span class="dv">1</span>){not_sex <span class="ot">&lt;-</span> <span class="dv">2</span>}</span>
<span id="cb16-3124"><a href="5-1-helper-functions.html#cb16-3124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3125"><a href="5-1-helper-functions.html#cb16-3125" aria-hidden="true" tabindex="-1"></a>  ODEs[not_sex,,,,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3126"><a href="5-1-helper-functions.html#cb16-3126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3127"><a href="5-1-helper-functions.html#cb16-3127" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3128"><a href="5-1-helper-functions.html#cb16-3128" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-3129"><a href="5-1-helper-functions.html#cb16-3129" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-3130"><a href="5-1-helper-functions.html#cb16-3130" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3131"><a href="5-1-helper-functions.html#cb16-3131" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb16-3132"><a href="5-1-helper-functions.html#cb16-3132" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb16-3133"><a href="5-1-helper-functions.html#cb16-3133" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3134"><a href="5-1-helper-functions.html#cb16-3134" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3135"><a href="5-1-helper-functions.html#cb16-3135" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-3136"><a href="5-1-helper-functions.html#cb16-3136" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-3137"><a href="5-1-helper-functions.html#cb16-3137" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb16-3138"><a href="5-1-helper-functions.html#cb16-3138" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-3139"><a href="5-1-helper-functions.html#cb16-3139" aria-hidden="true" tabindex="-1"></a>      <span class="co"># for(sex in 1:sex_types){</span></span>
<span id="cb16-3140"><a href="5-1-helper-functions.html#cb16-3140" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-3141"><a href="5-1-helper-functions.html#cb16-3141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3142"><a href="5-1-helper-functions.html#cb16-3142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3143"><a href="5-1-helper-functions.html#cb16-3143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3144"><a href="5-1-helper-functions.html#cb16-3144" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3145"><a href="5-1-helper-functions.html#cb16-3145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3146"><a href="5-1-helper-functions.html#cb16-3146" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3147"><a href="5-1-helper-functions.html#cb16-3147" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-3148"><a href="5-1-helper-functions.html#cb16-3148" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3149"><a href="5-1-helper-functions.html#cb16-3149" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3150"><a href="5-1-helper-functions.html#cb16-3150" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3151"><a href="5-1-helper-functions.html#cb16-3151" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-3152"><a href="5-1-helper-functions.html#cb16-3152" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3153"><a href="5-1-helper-functions.html#cb16-3153" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3154"><a href="5-1-helper-functions.html#cb16-3154" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-3155"><a href="5-1-helper-functions.html#cb16-3155" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-3156"><a href="5-1-helper-functions.html#cb16-3156" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-3157"><a href="5-1-helper-functions.html#cb16-3157" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3158"><a href="5-1-helper-functions.html#cb16-3158" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-3159"><a href="5-1-helper-functions.html#cb16-3159" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3160"><a href="5-1-helper-functions.html#cb16-3160" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-3161"><a href="5-1-helper-functions.html#cb16-3161" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-3162"><a href="5-1-helper-functions.html#cb16-3162" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-3163"><a href="5-1-helper-functions.html#cb16-3163" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-3164"><a href="5-1-helper-functions.html#cb16-3164" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-3165"><a href="5-1-helper-functions.html#cb16-3165" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3166"><a href="5-1-helper-functions.html#cb16-3166" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3167"><a href="5-1-helper-functions.html#cb16-3167" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-3168"><a href="5-1-helper-functions.html#cb16-3168" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3169"><a href="5-1-helper-functions.html#cb16-3169" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3170"><a href="5-1-helper-functions.html#cb16-3170" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3171"><a href="5-1-helper-functions.html#cb16-3171" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3172"><a href="5-1-helper-functions.html#cb16-3172" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-3173"><a href="5-1-helper-functions.html#cb16-3173" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3174"><a href="5-1-helper-functions.html#cb16-3174" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-3175"><a href="5-1-helper-functions.html#cb16-3175" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3176"><a href="5-1-helper-functions.html#cb16-3176" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3177"><a href="5-1-helper-functions.html#cb16-3177" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-3178"><a href="5-1-helper-functions.html#cb16-3178" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-3179"><a href="5-1-helper-functions.html#cb16-3179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3180"><a href="5-1-helper-functions.html#cb16-3180" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-3181"><a href="5-1-helper-functions.html#cb16-3181" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-3182"><a href="5-1-helper-functions.html#cb16-3182" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-3183"><a href="5-1-helper-functions.html#cb16-3183" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-3184"><a href="5-1-helper-functions.html#cb16-3184" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-3185"><a href="5-1-helper-functions.html#cb16-3185" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-3186"><a href="5-1-helper-functions.html#cb16-3186" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-3187"><a href="5-1-helper-functions.html#cb16-3187" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3188"><a href="5-1-helper-functions.html#cb16-3188" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-3189"><a href="5-1-helper-functions.html#cb16-3189" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3190"><a href="5-1-helper-functions.html#cb16-3190" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-3191"><a href="5-1-helper-functions.html#cb16-3191" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-3192"><a href="5-1-helper-functions.html#cb16-3192" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-3193"><a href="5-1-helper-functions.html#cb16-3193" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-3194"><a href="5-1-helper-functions.html#cb16-3194" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-3195"><a href="5-1-helper-functions.html#cb16-3195" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3196"><a href="5-1-helper-functions.html#cb16-3196" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3197"><a href="5-1-helper-functions.html#cb16-3197" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3198"><a href="5-1-helper-functions.html#cb16-3198" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3199"><a href="5-1-helper-functions.html#cb16-3199" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-3200"><a href="5-1-helper-functions.html#cb16-3200" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-3201"><a href="5-1-helper-functions.html#cb16-3201" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-3202"><a href="5-1-helper-functions.html#cb16-3202" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-3203"><a href="5-1-helper-functions.html#cb16-3203" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3204"><a href="5-1-helper-functions.html#cb16-3204" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-3205"><a href="5-1-helper-functions.html#cb16-3205" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-3206"><a href="5-1-helper-functions.html#cb16-3206" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-3207"><a href="5-1-helper-functions.html#cb16-3207" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3208"><a href="5-1-helper-functions.html#cb16-3208" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-3209"><a href="5-1-helper-functions.html#cb16-3209" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-3210"><a href="5-1-helper-functions.html#cb16-3210" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-3211"><a href="5-1-helper-functions.html#cb16-3211" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3212"><a href="5-1-helper-functions.html#cb16-3212" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-3213"><a href="5-1-helper-functions.html#cb16-3213" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-3214"><a href="5-1-helper-functions.html#cb16-3214" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-3215"><a href="5-1-helper-functions.html#cb16-3215" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3216"><a href="5-1-helper-functions.html#cb16-3216" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-3217"><a href="5-1-helper-functions.html#cb16-3217" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-3218"><a href="5-1-helper-functions.html#cb16-3218" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-3219"><a href="5-1-helper-functions.html#cb16-3219" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-3220"><a href="5-1-helper-functions.html#cb16-3220" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3221"><a href="5-1-helper-functions.html#cb16-3221" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3222"><a href="5-1-helper-functions.html#cb16-3222" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3223"><a href="5-1-helper-functions.html#cb16-3223" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-3224"><a href="5-1-helper-functions.html#cb16-3224" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3225"><a href="5-1-helper-functions.html#cb16-3225" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-3226"><a href="5-1-helper-functions.html#cb16-3226" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-3227"><a href="5-1-helper-functions.html#cb16-3227" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3228"><a href="5-1-helper-functions.html#cb16-3228" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-3229"><a href="5-1-helper-functions.html#cb16-3229" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3230"><a href="5-1-helper-functions.html#cb16-3230" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3231"><a href="5-1-helper-functions.html#cb16-3231" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3232"><a href="5-1-helper-functions.html#cb16-3232" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-3233"><a href="5-1-helper-functions.html#cb16-3233" aria-hidden="true" tabindex="-1"></a>          <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-3234"><a href="5-1-helper-functions.html#cb16-3234" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-3235"><a href="5-1-helper-functions.html#cb16-3235" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3236"><a href="5-1-helper-functions.html#cb16-3236" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-3237"><a href="5-1-helper-functions.html#cb16-3237" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3238"><a href="5-1-helper-functions.html#cb16-3238" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3239"><a href="5-1-helper-functions.html#cb16-3239" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3240"><a href="5-1-helper-functions.html#cb16-3240" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-3241"><a href="5-1-helper-functions.html#cb16-3241" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-3242"><a href="5-1-helper-functions.html#cb16-3242" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-3243"><a href="5-1-helper-functions.html#cb16-3243" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-3244"><a href="5-1-helper-functions.html#cb16-3244" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-3245"><a href="5-1-helper-functions.html#cb16-3245" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-3246"><a href="5-1-helper-functions.html#cb16-3246" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3247"><a href="5-1-helper-functions.html#cb16-3247" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-3248"><a href="5-1-helper-functions.html#cb16-3248" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-3249"><a href="5-1-helper-functions.html#cb16-3249" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-3250"><a href="5-1-helper-functions.html#cb16-3250" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3251"><a href="5-1-helper-functions.html#cb16-3251" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3252"><a href="5-1-helper-functions.html#cb16-3252" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3253"><a href="5-1-helper-functions.html#cb16-3253" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-3254"><a href="5-1-helper-functions.html#cb16-3254" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-3255"><a href="5-1-helper-functions.html#cb16-3255" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-3256"><a href="5-1-helper-functions.html#cb16-3256" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3257"><a href="5-1-helper-functions.html#cb16-3257" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3258"><a href="5-1-helper-functions.html#cb16-3258" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-3259"><a href="5-1-helper-functions.html#cb16-3259" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-3260"><a href="5-1-helper-functions.html#cb16-3260" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-3261"><a href="5-1-helper-functions.html#cb16-3261" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3262"><a href="5-1-helper-functions.html#cb16-3262" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-3263"><a href="5-1-helper-functions.html#cb16-3263" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-3264"><a href="5-1-helper-functions.html#cb16-3264" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-3265"><a href="5-1-helper-functions.html#cb16-3265" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-3266"><a href="5-1-helper-functions.html#cb16-3266" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-3267"><a href="5-1-helper-functions.html#cb16-3267" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3268"><a href="5-1-helper-functions.html#cb16-3268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3269"><a href="5-1-helper-functions.html#cb16-3269" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3270"><a href="5-1-helper-functions.html#cb16-3270" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-3271"><a href="5-1-helper-functions.html#cb16-3271" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3272"><a href="5-1-helper-functions.html#cb16-3272" aria-hidden="true" tabindex="-1"></a>        <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-3273"><a href="5-1-helper-functions.html#cb16-3273" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3274"><a href="5-1-helper-functions.html#cb16-3274" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-3275"><a href="5-1-helper-functions.html#cb16-3275" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3276"><a href="5-1-helper-functions.html#cb16-3276" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-3277"><a href="5-1-helper-functions.html#cb16-3277" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-3278"><a href="5-1-helper-functions.html#cb16-3278" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3279"><a href="5-1-helper-functions.html#cb16-3279" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-3280"><a href="5-1-helper-functions.html#cb16-3280" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3281"><a href="5-1-helper-functions.html#cb16-3281" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-3282"><a href="5-1-helper-functions.html#cb16-3282" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3283"><a href="5-1-helper-functions.html#cb16-3283" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-3284"><a href="5-1-helper-functions.html#cb16-3284" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-3285"><a href="5-1-helper-functions.html#cb16-3285" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-3286"><a href="5-1-helper-functions.html#cb16-3286" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3287"><a href="5-1-helper-functions.html#cb16-3287" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-3288"><a href="5-1-helper-functions.html#cb16-3288" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3289"><a href="5-1-helper-functions.html#cb16-3289" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-3290"><a href="5-1-helper-functions.html#cb16-3290" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3291"><a href="5-1-helper-functions.html#cb16-3291" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else </span></span>
<span id="cb16-3292"><a href="5-1-helper-functions.html#cb16-3292" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3293"><a href="5-1-helper-functions.html#cb16-3293" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-3294"><a href="5-1-helper-functions.html#cb16-3294" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3295"><a href="5-1-helper-functions.html#cb16-3295" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-3296"><a href="5-1-helper-functions.html#cb16-3296" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3297"><a href="5-1-helper-functions.html#cb16-3297" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-3298"><a href="5-1-helper-functions.html#cb16-3298" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3299"><a href="5-1-helper-functions.html#cb16-3299" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-3300"><a href="5-1-helper-functions.html#cb16-3300" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3301"><a href="5-1-helper-functions.html#cb16-3301" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-3302"><a href="5-1-helper-functions.html#cb16-3302" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3303"><a href="5-1-helper-functions.html#cb16-3303" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-3304"><a href="5-1-helper-functions.html#cb16-3304" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3305"><a href="5-1-helper-functions.html#cb16-3305" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-3306"><a href="5-1-helper-functions.html#cb16-3306" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3307"><a href="5-1-helper-functions.html#cb16-3307" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-3308"><a href="5-1-helper-functions.html#cb16-3308" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3309"><a href="5-1-helper-functions.html#cb16-3309" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3310"><a href="5-1-helper-functions.html#cb16-3310" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3311"><a href="5-1-helper-functions.html#cb16-3311" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-3312"><a href="5-1-helper-functions.html#cb16-3312" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3313"><a href="5-1-helper-functions.html#cb16-3313" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-3314"><a href="5-1-helper-functions.html#cb16-3314" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3315"><a href="5-1-helper-functions.html#cb16-3315" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-3316"><a href="5-1-helper-functions.html#cb16-3316" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3317"><a href="5-1-helper-functions.html#cb16-3317" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-3318"><a href="5-1-helper-functions.html#cb16-3318" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3319"><a href="5-1-helper-functions.html#cb16-3319" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-3320"><a href="5-1-helper-functions.html#cb16-3320" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3321"><a href="5-1-helper-functions.html#cb16-3321" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-3322"><a href="5-1-helper-functions.html#cb16-3322" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3323"><a href="5-1-helper-functions.html#cb16-3323" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-3324"><a href="5-1-helper-functions.html#cb16-3324" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3325"><a href="5-1-helper-functions.html#cb16-3325" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-3326"><a href="5-1-helper-functions.html#cb16-3326" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3327"><a href="5-1-helper-functions.html#cb16-3327" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-3328"><a href="5-1-helper-functions.html#cb16-3328" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3329"><a href="5-1-helper-functions.html#cb16-3329" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-3330"><a href="5-1-helper-functions.html#cb16-3330" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3331"><a href="5-1-helper-functions.html#cb16-3331" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-3332"><a href="5-1-helper-functions.html#cb16-3332" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3333"><a href="5-1-helper-functions.html#cb16-3333" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-3334"><a href="5-1-helper-functions.html#cb16-3334" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3335"><a href="5-1-helper-functions.html#cb16-3335" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3336"><a href="5-1-helper-functions.html#cb16-3336" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3337"><a href="5-1-helper-functions.html#cb16-3337" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-3338"><a href="5-1-helper-functions.html#cb16-3338" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3339"><a href="5-1-helper-functions.html#cb16-3339" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">1</span>] <span class="do">## not implemented yet</span></span>
<span id="cb16-3340"><a href="5-1-helper-functions.html#cb16-3340" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3341"><a href="5-1-helper-functions.html#cb16-3341" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 1</span></span>
<span id="cb16-3342"><a href="5-1-helper-functions.html#cb16-3342" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-3343"><a href="5-1-helper-functions.html#cb16-3343" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3344"><a href="5-1-helper-functions.html#cb16-3344" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3345"><a href="5-1-helper-functions.html#cb16-3345" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3346"><a href="5-1-helper-functions.html#cb16-3346" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-3347"><a href="5-1-helper-functions.html#cb16-3347" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3348"><a href="5-1-helper-functions.html#cb16-3348" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3349"><a href="5-1-helper-functions.html#cb16-3349" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3350"><a href="5-1-helper-functions.html#cb16-3350" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-3351"><a href="5-1-helper-functions.html#cb16-3351" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3352"><a href="5-1-helper-functions.html#cb16-3352" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3353"><a href="5-1-helper-functions.html#cb16-3353" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-3354"><a href="5-1-helper-functions.html#cb16-3354" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-3355"><a href="5-1-helper-functions.html#cb16-3355" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-3356"><a href="5-1-helper-functions.html#cb16-3356" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3357"><a href="5-1-helper-functions.html#cb16-3357" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-3358"><a href="5-1-helper-functions.html#cb16-3358" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3359"><a href="5-1-helper-functions.html#cb16-3359" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-3360"><a href="5-1-helper-functions.html#cb16-3360" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-3361"><a href="5-1-helper-functions.html#cb16-3361" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-3362"><a href="5-1-helper-functions.html#cb16-3362" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-3363"><a href="5-1-helper-functions.html#cb16-3363" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-3364"><a href="5-1-helper-functions.html#cb16-3364" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3365"><a href="5-1-helper-functions.html#cb16-3365" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3366"><a href="5-1-helper-functions.html#cb16-3366" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-3367"><a href="5-1-helper-functions.html#cb16-3367" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3368"><a href="5-1-helper-functions.html#cb16-3368" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3369"><a href="5-1-helper-functions.html#cb16-3369" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3370"><a href="5-1-helper-functions.html#cb16-3370" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3371"><a href="5-1-helper-functions.html#cb16-3371" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-3372"><a href="5-1-helper-functions.html#cb16-3372" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3373"><a href="5-1-helper-functions.html#cb16-3373" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-3374"><a href="5-1-helper-functions.html#cb16-3374" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3375"><a href="5-1-helper-functions.html#cb16-3375" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3376"><a href="5-1-helper-functions.html#cb16-3376" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-3377"><a href="5-1-helper-functions.html#cb16-3377" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-3378"><a href="5-1-helper-functions.html#cb16-3378" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-3379"><a href="5-1-helper-functions.html#cb16-3379" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-3380"><a href="5-1-helper-functions.html#cb16-3380" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-3381"><a href="5-1-helper-functions.html#cb16-3381" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-3382"><a href="5-1-helper-functions.html#cb16-3382" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-3383"><a href="5-1-helper-functions.html#cb16-3383" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-3384"><a href="5-1-helper-functions.html#cb16-3384" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-3385"><a href="5-1-helper-functions.html#cb16-3385" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3386"><a href="5-1-helper-functions.html#cb16-3386" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-3387"><a href="5-1-helper-functions.html#cb16-3387" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3388"><a href="5-1-helper-functions.html#cb16-3388" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-3389"><a href="5-1-helper-functions.html#cb16-3389" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-3390"><a href="5-1-helper-functions.html#cb16-3390" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-3391"><a href="5-1-helper-functions.html#cb16-3391" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-3392"><a href="5-1-helper-functions.html#cb16-3392" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-3393"><a href="5-1-helper-functions.html#cb16-3393" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3394"><a href="5-1-helper-functions.html#cb16-3394" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3395"><a href="5-1-helper-functions.html#cb16-3395" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3396"><a href="5-1-helper-functions.html#cb16-3396" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3397"><a href="5-1-helper-functions.html#cb16-3397" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-3398"><a href="5-1-helper-functions.html#cb16-3398" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-3399"><a href="5-1-helper-functions.html#cb16-3399" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-3400"><a href="5-1-helper-functions.html#cb16-3400" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-3401"><a href="5-1-helper-functions.html#cb16-3401" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3402"><a href="5-1-helper-functions.html#cb16-3402" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-3403"><a href="5-1-helper-functions.html#cb16-3403" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-3404"><a href="5-1-helper-functions.html#cb16-3404" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-3405"><a href="5-1-helper-functions.html#cb16-3405" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3406"><a href="5-1-helper-functions.html#cb16-3406" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-3407"><a href="5-1-helper-functions.html#cb16-3407" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-3408"><a href="5-1-helper-functions.html#cb16-3408" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-3409"><a href="5-1-helper-functions.html#cb16-3409" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-3410"><a href="5-1-helper-functions.html#cb16-3410" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-3411"><a href="5-1-helper-functions.html#cb16-3411" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-3412"><a href="5-1-helper-functions.html#cb16-3412" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3413"><a href="5-1-helper-functions.html#cb16-3413" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-3414"><a href="5-1-helper-functions.html#cb16-3414" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-3415"><a href="5-1-helper-functions.html#cb16-3415" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-3416"><a href="5-1-helper-functions.html#cb16-3416" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-3417"><a href="5-1-helper-functions.html#cb16-3417" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3418"><a href="5-1-helper-functions.html#cb16-3418" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3419"><a href="5-1-helper-functions.html#cb16-3419" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3420"><a href="5-1-helper-functions.html#cb16-3420" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-3421"><a href="5-1-helper-functions.html#cb16-3421" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3422"><a href="5-1-helper-functions.html#cb16-3422" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-3423"><a href="5-1-helper-functions.html#cb16-3423" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-3424"><a href="5-1-helper-functions.html#cb16-3424" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3425"><a href="5-1-helper-functions.html#cb16-3425" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-3426"><a href="5-1-helper-functions.html#cb16-3426" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3427"><a href="5-1-helper-functions.html#cb16-3427" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3428"><a href="5-1-helper-functions.html#cb16-3428" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3429"><a href="5-1-helper-functions.html#cb16-3429" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-3430"><a href="5-1-helper-functions.html#cb16-3430" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-3431"><a href="5-1-helper-functions.html#cb16-3431" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-3432"><a href="5-1-helper-functions.html#cb16-3432" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3433"><a href="5-1-helper-functions.html#cb16-3433" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-3434"><a href="5-1-helper-functions.html#cb16-3434" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3435"><a href="5-1-helper-functions.html#cb16-3435" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3436"><a href="5-1-helper-functions.html#cb16-3436" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3437"><a href="5-1-helper-functions.html#cb16-3437" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-3438"><a href="5-1-helper-functions.html#cb16-3438" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-3439"><a href="5-1-helper-functions.html#cb16-3439" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-3440"><a href="5-1-helper-functions.html#cb16-3440" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-3441"><a href="5-1-helper-functions.html#cb16-3441" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3442"><a href="5-1-helper-functions.html#cb16-3442" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-3443"><a href="5-1-helper-functions.html#cb16-3443" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-3444"><a href="5-1-helper-functions.html#cb16-3444" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-3445"><a href="5-1-helper-functions.html#cb16-3445" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-3446"><a href="5-1-helper-functions.html#cb16-3446" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-3447"><a href="5-1-helper-functions.html#cb16-3447" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-3448"><a href="5-1-helper-functions.html#cb16-3448" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3449"><a href="5-1-helper-functions.html#cb16-3449" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-3450"><a href="5-1-helper-functions.html#cb16-3450" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-3451"><a href="5-1-helper-functions.html#cb16-3451" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-3452"><a href="5-1-helper-functions.html#cb16-3452" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3453"><a href="5-1-helper-functions.html#cb16-3453" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3454"><a href="5-1-helper-functions.html#cb16-3454" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3455"><a href="5-1-helper-functions.html#cb16-3455" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-3456"><a href="5-1-helper-functions.html#cb16-3456" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-3457"><a href="5-1-helper-functions.html#cb16-3457" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-3458"><a href="5-1-helper-functions.html#cb16-3458" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3459"><a href="5-1-helper-functions.html#cb16-3459" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3460"><a href="5-1-helper-functions.html#cb16-3460" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-3461"><a href="5-1-helper-functions.html#cb16-3461" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-3462"><a href="5-1-helper-functions.html#cb16-3462" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-3463"><a href="5-1-helper-functions.html#cb16-3463" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3464"><a href="5-1-helper-functions.html#cb16-3464" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-3465"><a href="5-1-helper-functions.html#cb16-3465" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-3466"><a href="5-1-helper-functions.html#cb16-3466" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-3467"><a href="5-1-helper-functions.html#cb16-3467" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-3468"><a href="5-1-helper-functions.html#cb16-3468" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-3469"><a href="5-1-helper-functions.html#cb16-3469" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3470"><a href="5-1-helper-functions.html#cb16-3470" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3471"><a href="5-1-helper-functions.html#cb16-3471" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3472"><a href="5-1-helper-functions.html#cb16-3472" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-3473"><a href="5-1-helper-functions.html#cb16-3473" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3474"><a href="5-1-helper-functions.html#cb16-3474" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3475"><a href="5-1-helper-functions.html#cb16-3475" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3476"><a href="5-1-helper-functions.html#cb16-3476" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-3477"><a href="5-1-helper-functions.html#cb16-3477" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3478"><a href="5-1-helper-functions.html#cb16-3478" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-3479"><a href="5-1-helper-functions.html#cb16-3479" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3480"><a href="5-1-helper-functions.html#cb16-3480" aria-hidden="true" tabindex="-1"></a>        <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-3481"><a href="5-1-helper-functions.html#cb16-3481" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3482"><a href="5-1-helper-functions.html#cb16-3482" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-3483"><a href="5-1-helper-functions.html#cb16-3483" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3484"><a href="5-1-helper-functions.html#cb16-3484" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-3485"><a href="5-1-helper-functions.html#cb16-3485" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3486"><a href="5-1-helper-functions.html#cb16-3486" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-3487"><a href="5-1-helper-functions.html#cb16-3487" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-3488"><a href="5-1-helper-functions.html#cb16-3488" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3489"><a href="5-1-helper-functions.html#cb16-3489" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-3490"><a href="5-1-helper-functions.html#cb16-3490" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3491"><a href="5-1-helper-functions.html#cb16-3491" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-3492"><a href="5-1-helper-functions.html#cb16-3492" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3493"><a href="5-1-helper-functions.html#cb16-3493" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-3494"><a href="5-1-helper-functions.html#cb16-3494" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-3495"><a href="5-1-helper-functions.html#cb16-3495" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-3496"><a href="5-1-helper-functions.html#cb16-3496" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3497"><a href="5-1-helper-functions.html#cb16-3497" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-3498"><a href="5-1-helper-functions.html#cb16-3498" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3499"><a href="5-1-helper-functions.html#cb16-3499" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-3500"><a href="5-1-helper-functions.html#cb16-3500" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-3501"><a href="5-1-helper-functions.html#cb16-3501" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-3502"><a href="5-1-helper-functions.html#cb16-3502" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-3503"><a href="5-1-helper-functions.html#cb16-3503" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-3504"><a href="5-1-helper-functions.html#cb16-3504" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3505"><a href="5-1-helper-functions.html#cb16-3505" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-3506"><a href="5-1-helper-functions.html#cb16-3506" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3507"><a href="5-1-helper-functions.html#cb16-3507" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-3508"><a href="5-1-helper-functions.html#cb16-3508" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3509"><a href="5-1-helper-functions.html#cb16-3509" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-3510"><a href="5-1-helper-functions.html#cb16-3510" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3511"><a href="5-1-helper-functions.html#cb16-3511" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-3512"><a href="5-1-helper-functions.html#cb16-3512" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3513"><a href="5-1-helper-functions.html#cb16-3513" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-3514"><a href="5-1-helper-functions.html#cb16-3514" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3515"><a href="5-1-helper-functions.html#cb16-3515" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-3516"><a href="5-1-helper-functions.html#cb16-3516" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3517"><a href="5-1-helper-functions.html#cb16-3517" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-3518"><a href="5-1-helper-functions.html#cb16-3518" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3519"><a href="5-1-helper-functions.html#cb16-3519" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-3520"><a href="5-1-helper-functions.html#cb16-3520" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3521"><a href="5-1-helper-functions.html#cb16-3521" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3522"><a href="5-1-helper-functions.html#cb16-3522" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3523"><a href="5-1-helper-functions.html#cb16-3523" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-3524"><a href="5-1-helper-functions.html#cb16-3524" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3525"><a href="5-1-helper-functions.html#cb16-3525" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-3526"><a href="5-1-helper-functions.html#cb16-3526" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3527"><a href="5-1-helper-functions.html#cb16-3527" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-3528"><a href="5-1-helper-functions.html#cb16-3528" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3529"><a href="5-1-helper-functions.html#cb16-3529" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-3530"><a href="5-1-helper-functions.html#cb16-3530" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3531"><a href="5-1-helper-functions.html#cb16-3531" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-3532"><a href="5-1-helper-functions.html#cb16-3532" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3533"><a href="5-1-helper-functions.html#cb16-3533" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-3534"><a href="5-1-helper-functions.html#cb16-3534" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3535"><a href="5-1-helper-functions.html#cb16-3535" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-3536"><a href="5-1-helper-functions.html#cb16-3536" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3537"><a href="5-1-helper-functions.html#cb16-3537" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-3538"><a href="5-1-helper-functions.html#cb16-3538" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3539"><a href="5-1-helper-functions.html#cb16-3539" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-3540"><a href="5-1-helper-functions.html#cb16-3540" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3541"><a href="5-1-helper-functions.html#cb16-3541" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-3542"><a href="5-1-helper-functions.html#cb16-3542" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3543"><a href="5-1-helper-functions.html#cb16-3543" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-3544"><a href="5-1-helper-functions.html#cb16-3544" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3545"><a href="5-1-helper-functions.html#cb16-3545" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-3546"><a href="5-1-helper-functions.html#cb16-3546" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3547"><a href="5-1-helper-functions.html#cb16-3547" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3548"><a href="5-1-helper-functions.html#cb16-3548" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3549"><a href="5-1-helper-functions.html#cb16-3549" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-3550"><a href="5-1-helper-functions.html#cb16-3550" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3551"><a href="5-1-helper-functions.html#cb16-3551" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">2</span>]</span>
<span id="cb16-3552"><a href="5-1-helper-functions.html#cb16-3552" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3553"><a href="5-1-helper-functions.html#cb16-3553" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 2</span></span>
<span id="cb16-3554"><a href="5-1-helper-functions.html#cb16-3554" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-3555"><a href="5-1-helper-functions.html#cb16-3555" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3556"><a href="5-1-helper-functions.html#cb16-3556" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3557"><a href="5-1-helper-functions.html#cb16-3557" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-3558"><a href="5-1-helper-functions.html#cb16-3558" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3559"><a href="5-1-helper-functions.html#cb16-3559" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3560"><a href="5-1-helper-functions.html#cb16-3560" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3561"><a href="5-1-helper-functions.html#cb16-3561" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-3562"><a href="5-1-helper-functions.html#cb16-3562" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3563"><a href="5-1-helper-functions.html#cb16-3563" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3564"><a href="5-1-helper-functions.html#cb16-3564" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-3565"><a href="5-1-helper-functions.html#cb16-3565" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-3566"><a href="5-1-helper-functions.html#cb16-3566" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-3567"><a href="5-1-helper-functions.html#cb16-3567" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3568"><a href="5-1-helper-functions.html#cb16-3568" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-3569"><a href="5-1-helper-functions.html#cb16-3569" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3570"><a href="5-1-helper-functions.html#cb16-3570" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-3571"><a href="5-1-helper-functions.html#cb16-3571" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-3572"><a href="5-1-helper-functions.html#cb16-3572" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-3573"><a href="5-1-helper-functions.html#cb16-3573" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-3574"><a href="5-1-helper-functions.html#cb16-3574" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-3575"><a href="5-1-helper-functions.html#cb16-3575" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3576"><a href="5-1-helper-functions.html#cb16-3576" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3577"><a href="5-1-helper-functions.html#cb16-3577" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-3578"><a href="5-1-helper-functions.html#cb16-3578" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3579"><a href="5-1-helper-functions.html#cb16-3579" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3580"><a href="5-1-helper-functions.html#cb16-3580" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3581"><a href="5-1-helper-functions.html#cb16-3581" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3582"><a href="5-1-helper-functions.html#cb16-3582" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-3583"><a href="5-1-helper-functions.html#cb16-3583" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3584"><a href="5-1-helper-functions.html#cb16-3584" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-3585"><a href="5-1-helper-functions.html#cb16-3585" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3586"><a href="5-1-helper-functions.html#cb16-3586" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-3587"><a href="5-1-helper-functions.html#cb16-3587" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-3588"><a href="5-1-helper-functions.html#cb16-3588" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-3589"><a href="5-1-helper-functions.html#cb16-3589" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-3590"><a href="5-1-helper-functions.html#cb16-3590" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-3591"><a href="5-1-helper-functions.html#cb16-3591" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-3592"><a href="5-1-helper-functions.html#cb16-3592" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-3593"><a href="5-1-helper-functions.html#cb16-3593" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-3594"><a href="5-1-helper-functions.html#cb16-3594" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-3595"><a href="5-1-helper-functions.html#cb16-3595" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3596"><a href="5-1-helper-functions.html#cb16-3596" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3597"><a href="5-1-helper-functions.html#cb16-3597" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-3598"><a href="5-1-helper-functions.html#cb16-3598" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3599"><a href="5-1-helper-functions.html#cb16-3599" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-3600"><a href="5-1-helper-functions.html#cb16-3600" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-3601"><a href="5-1-helper-functions.html#cb16-3601" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-3602"><a href="5-1-helper-functions.html#cb16-3602" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-3603"><a href="5-1-helper-functions.html#cb16-3603" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-3604"><a href="5-1-helper-functions.html#cb16-3604" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3605"><a href="5-1-helper-functions.html#cb16-3605" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3606"><a href="5-1-helper-functions.html#cb16-3606" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3607"><a href="5-1-helper-functions.html#cb16-3607" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3608"><a href="5-1-helper-functions.html#cb16-3608" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-3609"><a href="5-1-helper-functions.html#cb16-3609" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-3610"><a href="5-1-helper-functions.html#cb16-3610" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-3611"><a href="5-1-helper-functions.html#cb16-3611" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-3612"><a href="5-1-helper-functions.html#cb16-3612" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3613"><a href="5-1-helper-functions.html#cb16-3613" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-3614"><a href="5-1-helper-functions.html#cb16-3614" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-3615"><a href="5-1-helper-functions.html#cb16-3615" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-3616"><a href="5-1-helper-functions.html#cb16-3616" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3617"><a href="5-1-helper-functions.html#cb16-3617" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-3618"><a href="5-1-helper-functions.html#cb16-3618" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-3619"><a href="5-1-helper-functions.html#cb16-3619" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-3620"><a href="5-1-helper-functions.html#cb16-3620" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-3621"><a href="5-1-helper-functions.html#cb16-3621" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-3622"><a href="5-1-helper-functions.html#cb16-3622" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-3623"><a href="5-1-helper-functions.html#cb16-3623" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3624"><a href="5-1-helper-functions.html#cb16-3624" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-3625"><a href="5-1-helper-functions.html#cb16-3625" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-3626"><a href="5-1-helper-functions.html#cb16-3626" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-3627"><a href="5-1-helper-functions.html#cb16-3627" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-3628"><a href="5-1-helper-functions.html#cb16-3628" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3629"><a href="5-1-helper-functions.html#cb16-3629" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3630"><a href="5-1-helper-functions.html#cb16-3630" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3631"><a href="5-1-helper-functions.html#cb16-3631" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-3632"><a href="5-1-helper-functions.html#cb16-3632" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3633"><a href="5-1-helper-functions.html#cb16-3633" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-3634"><a href="5-1-helper-functions.html#cb16-3634" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-3635"><a href="5-1-helper-functions.html#cb16-3635" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3636"><a href="5-1-helper-functions.html#cb16-3636" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-3637"><a href="5-1-helper-functions.html#cb16-3637" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3638"><a href="5-1-helper-functions.html#cb16-3638" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3639"><a href="5-1-helper-functions.html#cb16-3639" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3640"><a href="5-1-helper-functions.html#cb16-3640" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-3641"><a href="5-1-helper-functions.html#cb16-3641" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-3642"><a href="5-1-helper-functions.html#cb16-3642" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-3643"><a href="5-1-helper-functions.html#cb16-3643" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3644"><a href="5-1-helper-functions.html#cb16-3644" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-3645"><a href="5-1-helper-functions.html#cb16-3645" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3646"><a href="5-1-helper-functions.html#cb16-3646" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-3647"><a href="5-1-helper-functions.html#cb16-3647" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3648"><a href="5-1-helper-functions.html#cb16-3648" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3649"><a href="5-1-helper-functions.html#cb16-3649" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-3650"><a href="5-1-helper-functions.html#cb16-3650" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-3651"><a href="5-1-helper-functions.html#cb16-3651" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-3652"><a href="5-1-helper-functions.html#cb16-3652" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-3653"><a href="5-1-helper-functions.html#cb16-3653" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3654"><a href="5-1-helper-functions.html#cb16-3654" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-3655"><a href="5-1-helper-functions.html#cb16-3655" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-3656"><a href="5-1-helper-functions.html#cb16-3656" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-3657"><a href="5-1-helper-functions.html#cb16-3657" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-3658"><a href="5-1-helper-functions.html#cb16-3658" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-3659"><a href="5-1-helper-functions.html#cb16-3659" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-3660"><a href="5-1-helper-functions.html#cb16-3660" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3661"><a href="5-1-helper-functions.html#cb16-3661" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-3662"><a href="5-1-helper-functions.html#cb16-3662" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-3663"><a href="5-1-helper-functions.html#cb16-3663" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-3664"><a href="5-1-helper-functions.html#cb16-3664" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3665"><a href="5-1-helper-functions.html#cb16-3665" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3666"><a href="5-1-helper-functions.html#cb16-3666" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3667"><a href="5-1-helper-functions.html#cb16-3667" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-3668"><a href="5-1-helper-functions.html#cb16-3668" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-3669"><a href="5-1-helper-functions.html#cb16-3669" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-3670"><a href="5-1-helper-functions.html#cb16-3670" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-3671"><a href="5-1-helper-functions.html#cb16-3671" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3672"><a href="5-1-helper-functions.html#cb16-3672" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-3673"><a href="5-1-helper-functions.html#cb16-3673" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-3674"><a href="5-1-helper-functions.html#cb16-3674" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-3675"><a href="5-1-helper-functions.html#cb16-3675" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3676"><a href="5-1-helper-functions.html#cb16-3676" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-3677"><a href="5-1-helper-functions.html#cb16-3677" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-3678"><a href="5-1-helper-functions.html#cb16-3678" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-3679"><a href="5-1-helper-functions.html#cb16-3679" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-3680"><a href="5-1-helper-functions.html#cb16-3680" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-3681"><a href="5-1-helper-functions.html#cb16-3681" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3682"><a href="5-1-helper-functions.html#cb16-3682" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3683"><a href="5-1-helper-functions.html#cb16-3683" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3684"><a href="5-1-helper-functions.html#cb16-3684" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-3685"><a href="5-1-helper-functions.html#cb16-3685" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3686"><a href="5-1-helper-functions.html#cb16-3686" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3687"><a href="5-1-helper-functions.html#cb16-3687" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3688"><a href="5-1-helper-functions.html#cb16-3688" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-3689"><a href="5-1-helper-functions.html#cb16-3689" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3690"><a href="5-1-helper-functions.html#cb16-3690" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-3691"><a href="5-1-helper-functions.html#cb16-3691" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3692"><a href="5-1-helper-functions.html#cb16-3692" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-3693"><a href="5-1-helper-functions.html#cb16-3693" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3694"><a href="5-1-helper-functions.html#cb16-3694" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-3695"><a href="5-1-helper-functions.html#cb16-3695" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-3696"><a href="5-1-helper-functions.html#cb16-3696" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3697"><a href="5-1-helper-functions.html#cb16-3697" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-3698"><a href="5-1-helper-functions.html#cb16-3698" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3699"><a href="5-1-helper-functions.html#cb16-3699" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-3700"><a href="5-1-helper-functions.html#cb16-3700" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3701"><a href="5-1-helper-functions.html#cb16-3701" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-3702"><a href="5-1-helper-functions.html#cb16-3702" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-3703"><a href="5-1-helper-functions.html#cb16-3703" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-3704"><a href="5-1-helper-functions.html#cb16-3704" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3705"><a href="5-1-helper-functions.html#cb16-3705" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-3706"><a href="5-1-helper-functions.html#cb16-3706" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3707"><a href="5-1-helper-functions.html#cb16-3707" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-3708"><a href="5-1-helper-functions.html#cb16-3708" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-3709"><a href="5-1-helper-functions.html#cb16-3709" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-3710"><a href="5-1-helper-functions.html#cb16-3710" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-3711"><a href="5-1-helper-functions.html#cb16-3711" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-3712"><a href="5-1-helper-functions.html#cb16-3712" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 2){</span></span>
<span id="cb16-3713"><a href="5-1-helper-functions.html#cb16-3713" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3714"><a href="5-1-helper-functions.html#cb16-3714" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-3715"><a href="5-1-helper-functions.html#cb16-3715" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3716"><a href="5-1-helper-functions.html#cb16-3716" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-3717"><a href="5-1-helper-functions.html#cb16-3717" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3718"><a href="5-1-helper-functions.html#cb16-3718" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-3719"><a href="5-1-helper-functions.html#cb16-3719" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3720"><a href="5-1-helper-functions.html#cb16-3720" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-3721"><a href="5-1-helper-functions.html#cb16-3721" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3722"><a href="5-1-helper-functions.html#cb16-3722" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-3723"><a href="5-1-helper-functions.html#cb16-3723" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3724"><a href="5-1-helper-functions.html#cb16-3724" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-3725"><a href="5-1-helper-functions.html#cb16-3725" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3726"><a href="5-1-helper-functions.html#cb16-3726" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-3727"><a href="5-1-helper-functions.html#cb16-3727" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3728"><a href="5-1-helper-functions.html#cb16-3728" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3729"><a href="5-1-helper-functions.html#cb16-3729" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3730"><a href="5-1-helper-functions.html#cb16-3730" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-3731"><a href="5-1-helper-functions.html#cb16-3731" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3732"><a href="5-1-helper-functions.html#cb16-3732" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-3733"><a href="5-1-helper-functions.html#cb16-3733" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3734"><a href="5-1-helper-functions.html#cb16-3734" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-3735"><a href="5-1-helper-functions.html#cb16-3735" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-3736"><a href="5-1-helper-functions.html#cb16-3736" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-3737"><a href="5-1-helper-functions.html#cb16-3737" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3738"><a href="5-1-helper-functions.html#cb16-3738" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-3739"><a href="5-1-helper-functions.html#cb16-3739" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3740"><a href="5-1-helper-functions.html#cb16-3740" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-3741"><a href="5-1-helper-functions.html#cb16-3741" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3742"><a href="5-1-helper-functions.html#cb16-3742" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-3743"><a href="5-1-helper-functions.html#cb16-3743" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3744"><a href="5-1-helper-functions.html#cb16-3744" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-3745"><a href="5-1-helper-functions.html#cb16-3745" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3746"><a href="5-1-helper-functions.html#cb16-3746" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-3747"><a href="5-1-helper-functions.html#cb16-3747" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3748"><a href="5-1-helper-functions.html#cb16-3748" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-3749"><a href="5-1-helper-functions.html#cb16-3749" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3750"><a href="5-1-helper-functions.html#cb16-3750" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-3751"><a href="5-1-helper-functions.html#cb16-3751" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3752"><a href="5-1-helper-functions.html#cb16-3752" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-3753"><a href="5-1-helper-functions.html#cb16-3753" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-3754"><a href="5-1-helper-functions.html#cb16-3754" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-3755"><a href="5-1-helper-functions.html#cb16-3755" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3756"><a href="5-1-helper-functions.html#cb16-3756" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-3757"><a href="5-1-helper-functions.html#cb16-3757" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3758"><a href="5-1-helper-functions.html#cb16-3758" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">3</span>]</span>
<span id="cb16-3759"><a href="5-1-helper-functions.html#cb16-3759" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-3760"><a href="5-1-helper-functions.html#cb16-3760" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 3</span></span>
<span id="cb16-3761"><a href="5-1-helper-functions.html#cb16-3761" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-3762"><a href="5-1-helper-functions.html#cb16-3762" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-3763"><a href="5-1-helper-functions.html#cb16-3763" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-3764"><a href="5-1-helper-functions.html#cb16-3764" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb16-3765"><a href="5-1-helper-functions.html#cb16-3765" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-3766"><a href="5-1-helper-functions.html#cb16-3766" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3767"><a href="5-1-helper-functions.html#cb16-3767" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3768"><a href="5-1-helper-functions.html#cb16-3768" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3769"><a href="5-1-helper-functions.html#cb16-3769" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3770"><a href="5-1-helper-functions.html#cb16-3770" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-3771"><a href="5-1-helper-functions.html#cb16-3771" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-3772"><a href="5-1-helper-functions.html#cb16-3772" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-3773"><a href="5-1-helper-functions.html#cb16-3773" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-3774"><a href="5-1-helper-functions.html#cb16-3774" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3775"><a href="5-1-helper-functions.html#cb16-3775" aria-hidden="true" tabindex="-1"></a>de_fun_beta2 <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-3776"><a href="5-1-helper-functions.html#cb16-3776" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-3777"><a href="5-1-helper-functions.html#cb16-3777" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-3778"><a href="5-1-helper-functions.html#cb16-3778" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3779"><a href="5-1-helper-functions.html#cb16-3779" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3780"><a href="5-1-helper-functions.html#cb16-3780" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3781"><a href="5-1-helper-functions.html#cb16-3781" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-3782"><a href="5-1-helper-functions.html#cb16-3782" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3783"><a href="5-1-helper-functions.html#cb16-3783" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3784"><a href="5-1-helper-functions.html#cb16-3784" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-3785"><a href="5-1-helper-functions.html#cb16-3785" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3786"><a href="5-1-helper-functions.html#cb16-3786" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-3787"><a href="5-1-helper-functions.html#cb16-3787" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-3788"><a href="5-1-helper-functions.html#cb16-3788" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3789"><a href="5-1-helper-functions.html#cb16-3789" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-3790"><a href="5-1-helper-functions.html#cb16-3790" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-3791"><a href="5-1-helper-functions.html#cb16-3791" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3792"><a href="5-1-helper-functions.html#cb16-3792" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-3793"><a href="5-1-helper-functions.html#cb16-3793" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-3794"><a href="5-1-helper-functions.html#cb16-3794" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3795"><a href="5-1-helper-functions.html#cb16-3795" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-3796"><a href="5-1-helper-functions.html#cb16-3796" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-3797"><a href="5-1-helper-functions.html#cb16-3797" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3798"><a href="5-1-helper-functions.html#cb16-3798" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-3799"><a href="5-1-helper-functions.html#cb16-3799" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-3800"><a href="5-1-helper-functions.html#cb16-3800" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-3801"><a href="5-1-helper-functions.html#cb16-3801" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-3802"><a href="5-1-helper-functions.html#cb16-3802" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-3803"><a href="5-1-helper-functions.html#cb16-3803" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-3804"><a href="5-1-helper-functions.html#cb16-3804" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3805"><a href="5-1-helper-functions.html#cb16-3805" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-3806"><a href="5-1-helper-functions.html#cb16-3806" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3807"><a href="5-1-helper-functions.html#cb16-3807" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-3808"><a href="5-1-helper-functions.html#cb16-3808" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-3809"><a href="5-1-helper-functions.html#cb16-3809" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-3810"><a href="5-1-helper-functions.html#cb16-3810" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-3811"><a href="5-1-helper-functions.html#cb16-3811" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-3812"><a href="5-1-helper-functions.html#cb16-3812" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-3813"><a href="5-1-helper-functions.html#cb16-3813" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-3814"><a href="5-1-helper-functions.html#cb16-3814" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-3815"><a href="5-1-helper-functions.html#cb16-3815" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-3816"><a href="5-1-helper-functions.html#cb16-3816" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-3817"><a href="5-1-helper-functions.html#cb16-3817" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-3818"><a href="5-1-helper-functions.html#cb16-3818" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-3819"><a href="5-1-helper-functions.html#cb16-3819" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-3820"><a href="5-1-helper-functions.html#cb16-3820" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3821"><a href="5-1-helper-functions.html#cb16-3821" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-3822"><a href="5-1-helper-functions.html#cb16-3822" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-3823"><a href="5-1-helper-functions.html#cb16-3823" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-3824"><a href="5-1-helper-functions.html#cb16-3824" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-3825"><a href="5-1-helper-functions.html#cb16-3825" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-3826"><a href="5-1-helper-functions.html#cb16-3826" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-3827"><a href="5-1-helper-functions.html#cb16-3827" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-3828"><a href="5-1-helper-functions.html#cb16-3828" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-3829"><a href="5-1-helper-functions.html#cb16-3829" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-3830"><a href="5-1-helper-functions.html#cb16-3830" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-3831"><a href="5-1-helper-functions.html#cb16-3831" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-3832"><a href="5-1-helper-functions.html#cb16-3832" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-3833"><a href="5-1-helper-functions.html#cb16-3833" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-3834"><a href="5-1-helper-functions.html#cb16-3834" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3835"><a href="5-1-helper-functions.html#cb16-3835" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-3836"><a href="5-1-helper-functions.html#cb16-3836" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-3837"><a href="5-1-helper-functions.html#cb16-3837" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-3838"><a href="5-1-helper-functions.html#cb16-3838" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-3839"><a href="5-1-helper-functions.html#cb16-3839" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3840"><a href="5-1-helper-functions.html#cb16-3840" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-3841"><a href="5-1-helper-functions.html#cb16-3841" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-3842"><a href="5-1-helper-functions.html#cb16-3842" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-3843"><a href="5-1-helper-functions.html#cb16-3843" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3844"><a href="5-1-helper-functions.html#cb16-3844" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-3845"><a href="5-1-helper-functions.html#cb16-3845" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-3846"><a href="5-1-helper-functions.html#cb16-3846" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3847"><a href="5-1-helper-functions.html#cb16-3847" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3848"><a href="5-1-helper-functions.html#cb16-3848" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-3849"><a href="5-1-helper-functions.html#cb16-3849" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-3850"><a href="5-1-helper-functions.html#cb16-3850" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-3851"><a href="5-1-helper-functions.html#cb16-3851" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3852"><a href="5-1-helper-functions.html#cb16-3852" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-3853"><a href="5-1-helper-functions.html#cb16-3853" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3854"><a href="5-1-helper-functions.html#cb16-3854" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3855"><a href="5-1-helper-functions.html#cb16-3855" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-3856"><a href="5-1-helper-functions.html#cb16-3856" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-3857"><a href="5-1-helper-functions.html#cb16-3857" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-3858"><a href="5-1-helper-functions.html#cb16-3858" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3859"><a href="5-1-helper-functions.html#cb16-3859" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3860"><a href="5-1-helper-functions.html#cb16-3860" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3861"><a href="5-1-helper-functions.html#cb16-3861" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3862"><a href="5-1-helper-functions.html#cb16-3862" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3863"><a href="5-1-helper-functions.html#cb16-3863" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3864"><a href="5-1-helper-functions.html#cb16-3864" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3865"><a href="5-1-helper-functions.html#cb16-3865" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3866"><a href="5-1-helper-functions.html#cb16-3866" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-3867"><a href="5-1-helper-functions.html#cb16-3867" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-3868"><a href="5-1-helper-functions.html#cb16-3868" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-3869"><a href="5-1-helper-functions.html#cb16-3869" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-3870"><a href="5-1-helper-functions.html#cb16-3870" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3871"><a href="5-1-helper-functions.html#cb16-3871" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-3872"><a href="5-1-helper-functions.html#cb16-3872" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3873"><a href="5-1-helper-functions.html#cb16-3873" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb16-3874"><a href="5-1-helper-functions.html#cb16-3874" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3875"><a href="5-1-helper-functions.html#cb16-3875" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-3876"><a href="5-1-helper-functions.html#cb16-3876" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-3877"><a href="5-1-helper-functions.html#cb16-3877" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-3878"><a href="5-1-helper-functions.html#cb16-3878" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3879"><a href="5-1-helper-functions.html#cb16-3879" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3880"><a href="5-1-helper-functions.html#cb16-3880" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3881"><a href="5-1-helper-functions.html#cb16-3881" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-3882"><a href="5-1-helper-functions.html#cb16-3882" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-3883"><a href="5-1-helper-functions.html#cb16-3883" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3884"><a href="5-1-helper-functions.html#cb16-3884" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb16-3885"><a href="5-1-helper-functions.html#cb16-3885" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb16-3886"><a href="5-1-helper-functions.html#cb16-3886" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3887"><a href="5-1-helper-functions.html#cb16-3887" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-3888"><a href="5-1-helper-functions.html#cb16-3888" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-3889"><a href="5-1-helper-functions.html#cb16-3889" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-3890"><a href="5-1-helper-functions.html#cb16-3890" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb16-3891"><a href="5-1-helper-functions.html#cb16-3891" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-3892"><a href="5-1-helper-functions.html#cb16-3892" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(sex <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>sex_types){</span>
<span id="cb16-3893"><a href="5-1-helper-functions.html#cb16-3893" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-3894"><a href="5-1-helper-functions.html#cb16-3894" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3895"><a href="5-1-helper-functions.html#cb16-3895" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3896"><a href="5-1-helper-functions.html#cb16-3896" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3897"><a href="5-1-helper-functions.html#cb16-3897" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3898"><a href="5-1-helper-functions.html#cb16-3898" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3899"><a href="5-1-helper-functions.html#cb16-3899" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-3900"><a href="5-1-helper-functions.html#cb16-3900" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-3901"><a href="5-1-helper-functions.html#cb16-3901" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-3902"><a href="5-1-helper-functions.html#cb16-3902" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3903"><a href="5-1-helper-functions.html#cb16-3903" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3904"><a href="5-1-helper-functions.html#cb16-3904" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-3905"><a href="5-1-helper-functions.html#cb16-3905" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3906"><a href="5-1-helper-functions.html#cb16-3906" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-3907"><a href="5-1-helper-functions.html#cb16-3907" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-3908"><a href="5-1-helper-functions.html#cb16-3908" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-3909"><a href="5-1-helper-functions.html#cb16-3909" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-3910"><a href="5-1-helper-functions.html#cb16-3910" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-3911"><a href="5-1-helper-functions.html#cb16-3911" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-3912"><a href="5-1-helper-functions.html#cb16-3912" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-3913"><a href="5-1-helper-functions.html#cb16-3913" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-3914"><a href="5-1-helper-functions.html#cb16-3914" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-3915"><a href="5-1-helper-functions.html#cb16-3915" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-3916"><a href="5-1-helper-functions.html#cb16-3916" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-3917"><a href="5-1-helper-functions.html#cb16-3917" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-3918"><a href="5-1-helper-functions.html#cb16-3918" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-3919"><a href="5-1-helper-functions.html#cb16-3919" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-3920"><a href="5-1-helper-functions.html#cb16-3920" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-3921"><a href="5-1-helper-functions.html#cb16-3921" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-3922"><a href="5-1-helper-functions.html#cb16-3922" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-3923"><a href="5-1-helper-functions.html#cb16-3923" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-3924"><a href="5-1-helper-functions.html#cb16-3924" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3925"><a href="5-1-helper-functions.html#cb16-3925" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-3926"><a href="5-1-helper-functions.html#cb16-3926" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3927"><a href="5-1-helper-functions.html#cb16-3927" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-3928"><a href="5-1-helper-functions.html#cb16-3928" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3929"><a href="5-1-helper-functions.html#cb16-3929" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-3930"><a href="5-1-helper-functions.html#cb16-3930" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-3931"><a href="5-1-helper-functions.html#cb16-3931" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-3932"><a href="5-1-helper-functions.html#cb16-3932" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3933"><a href="5-1-helper-functions.html#cb16-3933" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-3934"><a href="5-1-helper-functions.html#cb16-3934" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-3935"><a href="5-1-helper-functions.html#cb16-3935" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-3936"><a href="5-1-helper-functions.html#cb16-3936" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-3937"><a href="5-1-helper-functions.html#cb16-3937" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-3938"><a href="5-1-helper-functions.html#cb16-3938" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-3939"><a href="5-1-helper-functions.html#cb16-3939" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-3940"><a href="5-1-helper-functions.html#cb16-3940" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3941"><a href="5-1-helper-functions.html#cb16-3941" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-3942"><a href="5-1-helper-functions.html#cb16-3942" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3943"><a href="5-1-helper-functions.html#cb16-3943" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-3944"><a href="5-1-helper-functions.html#cb16-3944" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-3945"><a href="5-1-helper-functions.html#cb16-3945" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-3946"><a href="5-1-helper-functions.html#cb16-3946" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-3947"><a href="5-1-helper-functions.html#cb16-3947" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-3948"><a href="5-1-helper-functions.html#cb16-3948" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3949"><a href="5-1-helper-functions.html#cb16-3949" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3950"><a href="5-1-helper-functions.html#cb16-3950" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3951"><a href="5-1-helper-functions.html#cb16-3951" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3952"><a href="5-1-helper-functions.html#cb16-3952" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-3953"><a href="5-1-helper-functions.html#cb16-3953" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-3954"><a href="5-1-helper-functions.html#cb16-3954" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-3955"><a href="5-1-helper-functions.html#cb16-3955" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-3956"><a href="5-1-helper-functions.html#cb16-3956" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3957"><a href="5-1-helper-functions.html#cb16-3957" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-3958"><a href="5-1-helper-functions.html#cb16-3958" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-3959"><a href="5-1-helper-functions.html#cb16-3959" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-3960"><a href="5-1-helper-functions.html#cb16-3960" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3961"><a href="5-1-helper-functions.html#cb16-3961" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-3962"><a href="5-1-helper-functions.html#cb16-3962" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-3963"><a href="5-1-helper-functions.html#cb16-3963" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-3964"><a href="5-1-helper-functions.html#cb16-3964" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3965"><a href="5-1-helper-functions.html#cb16-3965" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-3966"><a href="5-1-helper-functions.html#cb16-3966" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-3967"><a href="5-1-helper-functions.html#cb16-3967" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-3968"><a href="5-1-helper-functions.html#cb16-3968" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3969"><a href="5-1-helper-functions.html#cb16-3969" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-3970"><a href="5-1-helper-functions.html#cb16-3970" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-3971"><a href="5-1-helper-functions.html#cb16-3971" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-3972"><a href="5-1-helper-functions.html#cb16-3972" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-3973"><a href="5-1-helper-functions.html#cb16-3973" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3974"><a href="5-1-helper-functions.html#cb16-3974" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-3975"><a href="5-1-helper-functions.html#cb16-3975" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3976"><a href="5-1-helper-functions.html#cb16-3976" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-3977"><a href="5-1-helper-functions.html#cb16-3977" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-3978"><a href="5-1-helper-functions.html#cb16-3978" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-3979"><a href="5-1-helper-functions.html#cb16-3979" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-3980"><a href="5-1-helper-functions.html#cb16-3980" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3981"><a href="5-1-helper-functions.html#cb16-3981" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-3982"><a href="5-1-helper-functions.html#cb16-3982" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3983"><a href="5-1-helper-functions.html#cb16-3983" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-3984"><a href="5-1-helper-functions.html#cb16-3984" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3985"><a href="5-1-helper-functions.html#cb16-3985" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-3986"><a href="5-1-helper-functions.html#cb16-3986" aria-hidden="true" tabindex="-1"></a>            <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-3987"><a href="5-1-helper-functions.html#cb16-3987" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-3988"><a href="5-1-helper-functions.html#cb16-3988" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3989"><a href="5-1-helper-functions.html#cb16-3989" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-3990"><a href="5-1-helper-functions.html#cb16-3990" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-3991"><a href="5-1-helper-functions.html#cb16-3991" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-3992"><a href="5-1-helper-functions.html#cb16-3992" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-3993"><a href="5-1-helper-functions.html#cb16-3993" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-3994"><a href="5-1-helper-functions.html#cb16-3994" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-3995"><a href="5-1-helper-functions.html#cb16-3995" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-3996"><a href="5-1-helper-functions.html#cb16-3996" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-3997"><a href="5-1-helper-functions.html#cb16-3997" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-3998"><a href="5-1-helper-functions.html#cb16-3998" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-3999"><a href="5-1-helper-functions.html#cb16-3999" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4000"><a href="5-1-helper-functions.html#cb16-4000" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-4001"><a href="5-1-helper-functions.html#cb16-4001" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-4002"><a href="5-1-helper-functions.html#cb16-4002" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-4003"><a href="5-1-helper-functions.html#cb16-4003" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4004"><a href="5-1-helper-functions.html#cb16-4004" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4005"><a href="5-1-helper-functions.html#cb16-4005" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4006"><a href="5-1-helper-functions.html#cb16-4006" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-4007"><a href="5-1-helper-functions.html#cb16-4007" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-4008"><a href="5-1-helper-functions.html#cb16-4008" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-4009"><a href="5-1-helper-functions.html#cb16-4009" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4010"><a href="5-1-helper-functions.html#cb16-4010" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4011"><a href="5-1-helper-functions.html#cb16-4011" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-4012"><a href="5-1-helper-functions.html#cb16-4012" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-4013"><a href="5-1-helper-functions.html#cb16-4013" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-4014"><a href="5-1-helper-functions.html#cb16-4014" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4015"><a href="5-1-helper-functions.html#cb16-4015" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-4016"><a href="5-1-helper-functions.html#cb16-4016" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-4017"><a href="5-1-helper-functions.html#cb16-4017" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-4018"><a href="5-1-helper-functions.html#cb16-4018" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-4019"><a href="5-1-helper-functions.html#cb16-4019" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-4020"><a href="5-1-helper-functions.html#cb16-4020" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4021"><a href="5-1-helper-functions.html#cb16-4021" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4022"><a href="5-1-helper-functions.html#cb16-4022" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4023"><a href="5-1-helper-functions.html#cb16-4023" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-4024"><a href="5-1-helper-functions.html#cb16-4024" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4025"><a href="5-1-helper-functions.html#cb16-4025" aria-hidden="true" tabindex="-1"></a>          <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-4026"><a href="5-1-helper-functions.html#cb16-4026" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4027"><a href="5-1-helper-functions.html#cb16-4027" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-4028"><a href="5-1-helper-functions.html#cb16-4028" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4029"><a href="5-1-helper-functions.html#cb16-4029" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-4030"><a href="5-1-helper-functions.html#cb16-4030" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-4031"><a href="5-1-helper-functions.html#cb16-4031" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4032"><a href="5-1-helper-functions.html#cb16-4032" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-4033"><a href="5-1-helper-functions.html#cb16-4033" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4034"><a href="5-1-helper-functions.html#cb16-4034" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-4035"><a href="5-1-helper-functions.html#cb16-4035" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4036"><a href="5-1-helper-functions.html#cb16-4036" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-4037"><a href="5-1-helper-functions.html#cb16-4037" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-4038"><a href="5-1-helper-functions.html#cb16-4038" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-4039"><a href="5-1-helper-functions.html#cb16-4039" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4040"><a href="5-1-helper-functions.html#cb16-4040" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-4041"><a href="5-1-helper-functions.html#cb16-4041" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4042"><a href="5-1-helper-functions.html#cb16-4042" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-4043"><a href="5-1-helper-functions.html#cb16-4043" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4044"><a href="5-1-helper-functions.html#cb16-4044" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else </span></span>
<span id="cb16-4045"><a href="5-1-helper-functions.html#cb16-4045" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4046"><a href="5-1-helper-functions.html#cb16-4046" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-4047"><a href="5-1-helper-functions.html#cb16-4047" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4048"><a href="5-1-helper-functions.html#cb16-4048" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-4049"><a href="5-1-helper-functions.html#cb16-4049" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4050"><a href="5-1-helper-functions.html#cb16-4050" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-4051"><a href="5-1-helper-functions.html#cb16-4051" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4052"><a href="5-1-helper-functions.html#cb16-4052" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4053"><a href="5-1-helper-functions.html#cb16-4053" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4054"><a href="5-1-helper-functions.html#cb16-4054" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-4055"><a href="5-1-helper-functions.html#cb16-4055" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4056"><a href="5-1-helper-functions.html#cb16-4056" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4057"><a href="5-1-helper-functions.html#cb16-4057" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4058"><a href="5-1-helper-functions.html#cb16-4058" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4059"><a href="5-1-helper-functions.html#cb16-4059" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4060"><a href="5-1-helper-functions.html#cb16-4060" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-4061"><a href="5-1-helper-functions.html#cb16-4061" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4062"><a href="5-1-helper-functions.html#cb16-4062" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4063"><a href="5-1-helper-functions.html#cb16-4063" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4064"><a href="5-1-helper-functions.html#cb16-4064" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-4065"><a href="5-1-helper-functions.html#cb16-4065" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4066"><a href="5-1-helper-functions.html#cb16-4066" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-4067"><a href="5-1-helper-functions.html#cb16-4067" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4068"><a href="5-1-helper-functions.html#cb16-4068" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-4069"><a href="5-1-helper-functions.html#cb16-4069" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4070"><a href="5-1-helper-functions.html#cb16-4070" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-4071"><a href="5-1-helper-functions.html#cb16-4071" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4072"><a href="5-1-helper-functions.html#cb16-4072" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-4073"><a href="5-1-helper-functions.html#cb16-4073" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4074"><a href="5-1-helper-functions.html#cb16-4074" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-4075"><a href="5-1-helper-functions.html#cb16-4075" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4076"><a href="5-1-helper-functions.html#cb16-4076" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-4077"><a href="5-1-helper-functions.html#cb16-4077" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4078"><a href="5-1-helper-functions.html#cb16-4078" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4079"><a href="5-1-helper-functions.html#cb16-4079" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4080"><a href="5-1-helper-functions.html#cb16-4080" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-4081"><a href="5-1-helper-functions.html#cb16-4081" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4082"><a href="5-1-helper-functions.html#cb16-4082" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4083"><a href="5-1-helper-functions.html#cb16-4083" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4084"><a href="5-1-helper-functions.html#cb16-4084" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4085"><a href="5-1-helper-functions.html#cb16-4085" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4086"><a href="5-1-helper-functions.html#cb16-4086" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-4087"><a href="5-1-helper-functions.html#cb16-4087" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4088"><a href="5-1-helper-functions.html#cb16-4088" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4089"><a href="5-1-helper-functions.html#cb16-4089" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4090"><a href="5-1-helper-functions.html#cb16-4090" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-4091"><a href="5-1-helper-functions.html#cb16-4091" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4092"><a href="5-1-helper-functions.html#cb16-4092" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-4093"><a href="5-1-helper-functions.html#cb16-4093" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4094"><a href="5-1-helper-functions.html#cb16-4094" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 1</span></span>
<span id="cb16-4095"><a href="5-1-helper-functions.html#cb16-4095" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-4096"><a href="5-1-helper-functions.html#cb16-4096" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4097"><a href="5-1-helper-functions.html#cb16-4097" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4098"><a href="5-1-helper-functions.html#cb16-4098" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4099"><a href="5-1-helper-functions.html#cb16-4099" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-4100"><a href="5-1-helper-functions.html#cb16-4100" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4101"><a href="5-1-helper-functions.html#cb16-4101" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4102"><a href="5-1-helper-functions.html#cb16-4102" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4103"><a href="5-1-helper-functions.html#cb16-4103" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-4104"><a href="5-1-helper-functions.html#cb16-4104" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4105"><a href="5-1-helper-functions.html#cb16-4105" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4106"><a href="5-1-helper-functions.html#cb16-4106" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-4107"><a href="5-1-helper-functions.html#cb16-4107" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-4108"><a href="5-1-helper-functions.html#cb16-4108" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-4109"><a href="5-1-helper-functions.html#cb16-4109" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4110"><a href="5-1-helper-functions.html#cb16-4110" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-4111"><a href="5-1-helper-functions.html#cb16-4111" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4112"><a href="5-1-helper-functions.html#cb16-4112" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-4113"><a href="5-1-helper-functions.html#cb16-4113" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-4114"><a href="5-1-helper-functions.html#cb16-4114" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-4115"><a href="5-1-helper-functions.html#cb16-4115" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-4116"><a href="5-1-helper-functions.html#cb16-4116" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-4117"><a href="5-1-helper-functions.html#cb16-4117" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4118"><a href="5-1-helper-functions.html#cb16-4118" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4119"><a href="5-1-helper-functions.html#cb16-4119" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-4120"><a href="5-1-helper-functions.html#cb16-4120" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4121"><a href="5-1-helper-functions.html#cb16-4121" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4122"><a href="5-1-helper-functions.html#cb16-4122" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4123"><a href="5-1-helper-functions.html#cb16-4123" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4124"><a href="5-1-helper-functions.html#cb16-4124" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-4125"><a href="5-1-helper-functions.html#cb16-4125" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4126"><a href="5-1-helper-functions.html#cb16-4126" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-4127"><a href="5-1-helper-functions.html#cb16-4127" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4128"><a href="5-1-helper-functions.html#cb16-4128" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4129"><a href="5-1-helper-functions.html#cb16-4129" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-4130"><a href="5-1-helper-functions.html#cb16-4130" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-4131"><a href="5-1-helper-functions.html#cb16-4131" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-4132"><a href="5-1-helper-functions.html#cb16-4132" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-4133"><a href="5-1-helper-functions.html#cb16-4133" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-4134"><a href="5-1-helper-functions.html#cb16-4134" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-4135"><a href="5-1-helper-functions.html#cb16-4135" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-4136"><a href="5-1-helper-functions.html#cb16-4136" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-4137"><a href="5-1-helper-functions.html#cb16-4137" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-4138"><a href="5-1-helper-functions.html#cb16-4138" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4139"><a href="5-1-helper-functions.html#cb16-4139" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-4140"><a href="5-1-helper-functions.html#cb16-4140" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4141"><a href="5-1-helper-functions.html#cb16-4141" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-4142"><a href="5-1-helper-functions.html#cb16-4142" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-4143"><a href="5-1-helper-functions.html#cb16-4143" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-4144"><a href="5-1-helper-functions.html#cb16-4144" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-4145"><a href="5-1-helper-functions.html#cb16-4145" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-4146"><a href="5-1-helper-functions.html#cb16-4146" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4147"><a href="5-1-helper-functions.html#cb16-4147" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4148"><a href="5-1-helper-functions.html#cb16-4148" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4149"><a href="5-1-helper-functions.html#cb16-4149" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4150"><a href="5-1-helper-functions.html#cb16-4150" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-4151"><a href="5-1-helper-functions.html#cb16-4151" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-4152"><a href="5-1-helper-functions.html#cb16-4152" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-4153"><a href="5-1-helper-functions.html#cb16-4153" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-4154"><a href="5-1-helper-functions.html#cb16-4154" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4155"><a href="5-1-helper-functions.html#cb16-4155" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-4156"><a href="5-1-helper-functions.html#cb16-4156" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-4157"><a href="5-1-helper-functions.html#cb16-4157" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-4158"><a href="5-1-helper-functions.html#cb16-4158" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4159"><a href="5-1-helper-functions.html#cb16-4159" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-4160"><a href="5-1-helper-functions.html#cb16-4160" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-4161"><a href="5-1-helper-functions.html#cb16-4161" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-4162"><a href="5-1-helper-functions.html#cb16-4162" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-4163"><a href="5-1-helper-functions.html#cb16-4163" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-4164"><a href="5-1-helper-functions.html#cb16-4164" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4165"><a href="5-1-helper-functions.html#cb16-4165" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4166"><a href="5-1-helper-functions.html#cb16-4166" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-4167"><a href="5-1-helper-functions.html#cb16-4167" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-4168"><a href="5-1-helper-functions.html#cb16-4168" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-4169"><a href="5-1-helper-functions.html#cb16-4169" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-4170"><a href="5-1-helper-functions.html#cb16-4170" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4171"><a href="5-1-helper-functions.html#cb16-4171" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4172"><a href="5-1-helper-functions.html#cb16-4172" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4173"><a href="5-1-helper-functions.html#cb16-4173" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-4174"><a href="5-1-helper-functions.html#cb16-4174" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4175"><a href="5-1-helper-functions.html#cb16-4175" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4176"><a href="5-1-helper-functions.html#cb16-4176" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4177"><a href="5-1-helper-functions.html#cb16-4177" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4178"><a href="5-1-helper-functions.html#cb16-4178" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-4179"><a href="5-1-helper-functions.html#cb16-4179" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4180"><a href="5-1-helper-functions.html#cb16-4180" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4181"><a href="5-1-helper-functions.html#cb16-4181" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4182"><a href="5-1-helper-functions.html#cb16-4182" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-4183"><a href="5-1-helper-functions.html#cb16-4183" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-4184"><a href="5-1-helper-functions.html#cb16-4184" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4185"><a href="5-1-helper-functions.html#cb16-4185" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4186"><a href="5-1-helper-functions.html#cb16-4186" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-4187"><a href="5-1-helper-functions.html#cb16-4187" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4188"><a href="5-1-helper-functions.html#cb16-4188" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4189"><a href="5-1-helper-functions.html#cb16-4189" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4190"><a href="5-1-helper-functions.html#cb16-4190" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-4191"><a href="5-1-helper-functions.html#cb16-4191" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-4192"><a href="5-1-helper-functions.html#cb16-4192" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4193"><a href="5-1-helper-functions.html#cb16-4193" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4194"><a href="5-1-helper-functions.html#cb16-4194" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4195"><a href="5-1-helper-functions.html#cb16-4195" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-4196"><a href="5-1-helper-functions.html#cb16-4196" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-4197"><a href="5-1-helper-functions.html#cb16-4197" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-4198"><a href="5-1-helper-functions.html#cb16-4198" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-4199"><a href="5-1-helper-functions.html#cb16-4199" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-4200"><a href="5-1-helper-functions.html#cb16-4200" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-4201"><a href="5-1-helper-functions.html#cb16-4201" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4202"><a href="5-1-helper-functions.html#cb16-4202" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-4203"><a href="5-1-helper-functions.html#cb16-4203" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-4204"><a href="5-1-helper-functions.html#cb16-4204" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-4205"><a href="5-1-helper-functions.html#cb16-4205" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4206"><a href="5-1-helper-functions.html#cb16-4206" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4207"><a href="5-1-helper-functions.html#cb16-4207" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4208"><a href="5-1-helper-functions.html#cb16-4208" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-4209"><a href="5-1-helper-functions.html#cb16-4209" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-4210"><a href="5-1-helper-functions.html#cb16-4210" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-4211"><a href="5-1-helper-functions.html#cb16-4211" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4212"><a href="5-1-helper-functions.html#cb16-4212" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4213"><a href="5-1-helper-functions.html#cb16-4213" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-4214"><a href="5-1-helper-functions.html#cb16-4214" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-4215"><a href="5-1-helper-functions.html#cb16-4215" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-4216"><a href="5-1-helper-functions.html#cb16-4216" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4217"><a href="5-1-helper-functions.html#cb16-4217" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-4218"><a href="5-1-helper-functions.html#cb16-4218" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-4219"><a href="5-1-helper-functions.html#cb16-4219" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-4220"><a href="5-1-helper-functions.html#cb16-4220" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-4221"><a href="5-1-helper-functions.html#cb16-4221" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-4222"><a href="5-1-helper-functions.html#cb16-4222" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4223"><a href="5-1-helper-functions.html#cb16-4223" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4224"><a href="5-1-helper-functions.html#cb16-4224" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4225"><a href="5-1-helper-functions.html#cb16-4225" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-4226"><a href="5-1-helper-functions.html#cb16-4226" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4227"><a href="5-1-helper-functions.html#cb16-4227" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4228"><a href="5-1-helper-functions.html#cb16-4228" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4229"><a href="5-1-helper-functions.html#cb16-4229" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-4230"><a href="5-1-helper-functions.html#cb16-4230" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4231"><a href="5-1-helper-functions.html#cb16-4231" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-4232"><a href="5-1-helper-functions.html#cb16-4232" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4233"><a href="5-1-helper-functions.html#cb16-4233" aria-hidden="true" tabindex="-1"></a>          <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-4234"><a href="5-1-helper-functions.html#cb16-4234" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4235"><a href="5-1-helper-functions.html#cb16-4235" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-4236"><a href="5-1-helper-functions.html#cb16-4236" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4237"><a href="5-1-helper-functions.html#cb16-4237" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-4238"><a href="5-1-helper-functions.html#cb16-4238" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4239"><a href="5-1-helper-functions.html#cb16-4239" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-4240"><a href="5-1-helper-functions.html#cb16-4240" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-4241"><a href="5-1-helper-functions.html#cb16-4241" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4242"><a href="5-1-helper-functions.html#cb16-4242" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-4243"><a href="5-1-helper-functions.html#cb16-4243" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4244"><a href="5-1-helper-functions.html#cb16-4244" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-4245"><a href="5-1-helper-functions.html#cb16-4245" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4246"><a href="5-1-helper-functions.html#cb16-4246" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-4247"><a href="5-1-helper-functions.html#cb16-4247" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-4248"><a href="5-1-helper-functions.html#cb16-4248" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-4249"><a href="5-1-helper-functions.html#cb16-4249" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4250"><a href="5-1-helper-functions.html#cb16-4250" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-4251"><a href="5-1-helper-functions.html#cb16-4251" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4252"><a href="5-1-helper-functions.html#cb16-4252" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-4253"><a href="5-1-helper-functions.html#cb16-4253" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-4254"><a href="5-1-helper-functions.html#cb16-4254" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-4255"><a href="5-1-helper-functions.html#cb16-4255" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-4256"><a href="5-1-helper-functions.html#cb16-4256" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # }else </span></span>
<span id="cb16-4257"><a href="5-1-helper-functions.html#cb16-4257" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4258"><a href="5-1-helper-functions.html#cb16-4258" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-4259"><a href="5-1-helper-functions.html#cb16-4259" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4260"><a href="5-1-helper-functions.html#cb16-4260" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-4261"><a href="5-1-helper-functions.html#cb16-4261" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4262"><a href="5-1-helper-functions.html#cb16-4262" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-4263"><a href="5-1-helper-functions.html#cb16-4263" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4264"><a href="5-1-helper-functions.html#cb16-4264" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4265"><a href="5-1-helper-functions.html#cb16-4265" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4266"><a href="5-1-helper-functions.html#cb16-4266" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-4267"><a href="5-1-helper-functions.html#cb16-4267" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4268"><a href="5-1-helper-functions.html#cb16-4268" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4269"><a href="5-1-helper-functions.html#cb16-4269" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4270"><a href="5-1-helper-functions.html#cb16-4270" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4271"><a href="5-1-helper-functions.html#cb16-4271" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4272"><a href="5-1-helper-functions.html#cb16-4272" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-4273"><a href="5-1-helper-functions.html#cb16-4273" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4274"><a href="5-1-helper-functions.html#cb16-4274" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4275"><a href="5-1-helper-functions.html#cb16-4275" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4276"><a href="5-1-helper-functions.html#cb16-4276" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-4277"><a href="5-1-helper-functions.html#cb16-4277" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4278"><a href="5-1-helper-functions.html#cb16-4278" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-4279"><a href="5-1-helper-functions.html#cb16-4279" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4280"><a href="5-1-helper-functions.html#cb16-4280" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-4281"><a href="5-1-helper-functions.html#cb16-4281" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4282"><a href="5-1-helper-functions.html#cb16-4282" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-4283"><a href="5-1-helper-functions.html#cb16-4283" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4284"><a href="5-1-helper-functions.html#cb16-4284" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-4285"><a href="5-1-helper-functions.html#cb16-4285" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4286"><a href="5-1-helper-functions.html#cb16-4286" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-4287"><a href="5-1-helper-functions.html#cb16-4287" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4288"><a href="5-1-helper-functions.html#cb16-4288" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-4289"><a href="5-1-helper-functions.html#cb16-4289" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4290"><a href="5-1-helper-functions.html#cb16-4290" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4291"><a href="5-1-helper-functions.html#cb16-4291" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4292"><a href="5-1-helper-functions.html#cb16-4292" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-4293"><a href="5-1-helper-functions.html#cb16-4293" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4294"><a href="5-1-helper-functions.html#cb16-4294" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4295"><a href="5-1-helper-functions.html#cb16-4295" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4296"><a href="5-1-helper-functions.html#cb16-4296" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4297"><a href="5-1-helper-functions.html#cb16-4297" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4298"><a href="5-1-helper-functions.html#cb16-4298" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-4299"><a href="5-1-helper-functions.html#cb16-4299" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4300"><a href="5-1-helper-functions.html#cb16-4300" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4301"><a href="5-1-helper-functions.html#cb16-4301" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4302"><a href="5-1-helper-functions.html#cb16-4302" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-4303"><a href="5-1-helper-functions.html#cb16-4303" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4304"><a href="5-1-helper-functions.html#cb16-4304" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-4305"><a href="5-1-helper-functions.html#cb16-4305" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4306"><a href="5-1-helper-functions.html#cb16-4306" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 2</span></span>
<span id="cb16-4307"><a href="5-1-helper-functions.html#cb16-4307" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-4308"><a href="5-1-helper-functions.html#cb16-4308" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4309"><a href="5-1-helper-functions.html#cb16-4309" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4310"><a href="5-1-helper-functions.html#cb16-4310" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-4311"><a href="5-1-helper-functions.html#cb16-4311" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4312"><a href="5-1-helper-functions.html#cb16-4312" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4313"><a href="5-1-helper-functions.html#cb16-4313" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4314"><a href="5-1-helper-functions.html#cb16-4314" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-4315"><a href="5-1-helper-functions.html#cb16-4315" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4316"><a href="5-1-helper-functions.html#cb16-4316" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4317"><a href="5-1-helper-functions.html#cb16-4317" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-4318"><a href="5-1-helper-functions.html#cb16-4318" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-4319"><a href="5-1-helper-functions.html#cb16-4319" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-4320"><a href="5-1-helper-functions.html#cb16-4320" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4321"><a href="5-1-helper-functions.html#cb16-4321" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-4322"><a href="5-1-helper-functions.html#cb16-4322" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4323"><a href="5-1-helper-functions.html#cb16-4323" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-4324"><a href="5-1-helper-functions.html#cb16-4324" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-4325"><a href="5-1-helper-functions.html#cb16-4325" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-4326"><a href="5-1-helper-functions.html#cb16-4326" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-4327"><a href="5-1-helper-functions.html#cb16-4327" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-4328"><a href="5-1-helper-functions.html#cb16-4328" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4329"><a href="5-1-helper-functions.html#cb16-4329" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4330"><a href="5-1-helper-functions.html#cb16-4330" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-4331"><a href="5-1-helper-functions.html#cb16-4331" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4332"><a href="5-1-helper-functions.html#cb16-4332" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4333"><a href="5-1-helper-functions.html#cb16-4333" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4334"><a href="5-1-helper-functions.html#cb16-4334" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4335"><a href="5-1-helper-functions.html#cb16-4335" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-4336"><a href="5-1-helper-functions.html#cb16-4336" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4337"><a href="5-1-helper-functions.html#cb16-4337" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-4338"><a href="5-1-helper-functions.html#cb16-4338" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4339"><a href="5-1-helper-functions.html#cb16-4339" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4340"><a href="5-1-helper-functions.html#cb16-4340" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-4341"><a href="5-1-helper-functions.html#cb16-4341" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-4342"><a href="5-1-helper-functions.html#cb16-4342" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-4343"><a href="5-1-helper-functions.html#cb16-4343" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-4344"><a href="5-1-helper-functions.html#cb16-4344" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-4345"><a href="5-1-helper-functions.html#cb16-4345" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-4346"><a href="5-1-helper-functions.html#cb16-4346" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-4347"><a href="5-1-helper-functions.html#cb16-4347" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-4348"><a href="5-1-helper-functions.html#cb16-4348" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4349"><a href="5-1-helper-functions.html#cb16-4349" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4350"><a href="5-1-helper-functions.html#cb16-4350" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-4351"><a href="5-1-helper-functions.html#cb16-4351" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4352"><a href="5-1-helper-functions.html#cb16-4352" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-4353"><a href="5-1-helper-functions.html#cb16-4353" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-4354"><a href="5-1-helper-functions.html#cb16-4354" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-4355"><a href="5-1-helper-functions.html#cb16-4355" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-4356"><a href="5-1-helper-functions.html#cb16-4356" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-4357"><a href="5-1-helper-functions.html#cb16-4357" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4358"><a href="5-1-helper-functions.html#cb16-4358" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4359"><a href="5-1-helper-functions.html#cb16-4359" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4360"><a href="5-1-helper-functions.html#cb16-4360" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4361"><a href="5-1-helper-functions.html#cb16-4361" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-4362"><a href="5-1-helper-functions.html#cb16-4362" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-4363"><a href="5-1-helper-functions.html#cb16-4363" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-4364"><a href="5-1-helper-functions.html#cb16-4364" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-4365"><a href="5-1-helper-functions.html#cb16-4365" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4366"><a href="5-1-helper-functions.html#cb16-4366" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-4367"><a href="5-1-helper-functions.html#cb16-4367" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-4368"><a href="5-1-helper-functions.html#cb16-4368" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-4369"><a href="5-1-helper-functions.html#cb16-4369" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4370"><a href="5-1-helper-functions.html#cb16-4370" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-4371"><a href="5-1-helper-functions.html#cb16-4371" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-4372"><a href="5-1-helper-functions.html#cb16-4372" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-4373"><a href="5-1-helper-functions.html#cb16-4373" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-4374"><a href="5-1-helper-functions.html#cb16-4374" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-4375"><a href="5-1-helper-functions.html#cb16-4375" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4376"><a href="5-1-helper-functions.html#cb16-4376" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4377"><a href="5-1-helper-functions.html#cb16-4377" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-4378"><a href="5-1-helper-functions.html#cb16-4378" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-4379"><a href="5-1-helper-functions.html#cb16-4379" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-4380"><a href="5-1-helper-functions.html#cb16-4380" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-4381"><a href="5-1-helper-functions.html#cb16-4381" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4382"><a href="5-1-helper-functions.html#cb16-4382" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4383"><a href="5-1-helper-functions.html#cb16-4383" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4384"><a href="5-1-helper-functions.html#cb16-4384" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-4385"><a href="5-1-helper-functions.html#cb16-4385" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4386"><a href="5-1-helper-functions.html#cb16-4386" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4387"><a href="5-1-helper-functions.html#cb16-4387" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4388"><a href="5-1-helper-functions.html#cb16-4388" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4389"><a href="5-1-helper-functions.html#cb16-4389" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-4390"><a href="5-1-helper-functions.html#cb16-4390" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4391"><a href="5-1-helper-functions.html#cb16-4391" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4392"><a href="5-1-helper-functions.html#cb16-4392" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4393"><a href="5-1-helper-functions.html#cb16-4393" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-4394"><a href="5-1-helper-functions.html#cb16-4394" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-4395"><a href="5-1-helper-functions.html#cb16-4395" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4396"><a href="5-1-helper-functions.html#cb16-4396" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4397"><a href="5-1-helper-functions.html#cb16-4397" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-4398"><a href="5-1-helper-functions.html#cb16-4398" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4399"><a href="5-1-helper-functions.html#cb16-4399" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4400"><a href="5-1-helper-functions.html#cb16-4400" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4401"><a href="5-1-helper-functions.html#cb16-4401" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4402"><a href="5-1-helper-functions.html#cb16-4402" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-4403"><a href="5-1-helper-functions.html#cb16-4403" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-4404"><a href="5-1-helper-functions.html#cb16-4404" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4405"><a href="5-1-helper-functions.html#cb16-4405" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4406"><a href="5-1-helper-functions.html#cb16-4406" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4407"><a href="5-1-helper-functions.html#cb16-4407" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-4408"><a href="5-1-helper-functions.html#cb16-4408" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-4409"><a href="5-1-helper-functions.html#cb16-4409" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-4410"><a href="5-1-helper-functions.html#cb16-4410" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-4411"><a href="5-1-helper-functions.html#cb16-4411" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-4412"><a href="5-1-helper-functions.html#cb16-4412" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-4413"><a href="5-1-helper-functions.html#cb16-4413" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4414"><a href="5-1-helper-functions.html#cb16-4414" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-4415"><a href="5-1-helper-functions.html#cb16-4415" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-4416"><a href="5-1-helper-functions.html#cb16-4416" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-4417"><a href="5-1-helper-functions.html#cb16-4417" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4418"><a href="5-1-helper-functions.html#cb16-4418" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4419"><a href="5-1-helper-functions.html#cb16-4419" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4420"><a href="5-1-helper-functions.html#cb16-4420" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-4421"><a href="5-1-helper-functions.html#cb16-4421" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-4422"><a href="5-1-helper-functions.html#cb16-4422" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-4423"><a href="5-1-helper-functions.html#cb16-4423" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4424"><a href="5-1-helper-functions.html#cb16-4424" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4425"><a href="5-1-helper-functions.html#cb16-4425" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-4426"><a href="5-1-helper-functions.html#cb16-4426" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-4427"><a href="5-1-helper-functions.html#cb16-4427" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-4428"><a href="5-1-helper-functions.html#cb16-4428" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4429"><a href="5-1-helper-functions.html#cb16-4429" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-4430"><a href="5-1-helper-functions.html#cb16-4430" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-4431"><a href="5-1-helper-functions.html#cb16-4431" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-4432"><a href="5-1-helper-functions.html#cb16-4432" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-4433"><a href="5-1-helper-functions.html#cb16-4433" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-4434"><a href="5-1-helper-functions.html#cb16-4434" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4435"><a href="5-1-helper-functions.html#cb16-4435" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4436"><a href="5-1-helper-functions.html#cb16-4436" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4437"><a href="5-1-helper-functions.html#cb16-4437" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-4438"><a href="5-1-helper-functions.html#cb16-4438" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4439"><a href="5-1-helper-functions.html#cb16-4439" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4440"><a href="5-1-helper-functions.html#cb16-4440" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4441"><a href="5-1-helper-functions.html#cb16-4441" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-4442"><a href="5-1-helper-functions.html#cb16-4442" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4443"><a href="5-1-helper-functions.html#cb16-4443" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-4444"><a href="5-1-helper-functions.html#cb16-4444" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4445"><a href="5-1-helper-functions.html#cb16-4445" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-4446"><a href="5-1-helper-functions.html#cb16-4446" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4447"><a href="5-1-helper-functions.html#cb16-4447" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-4448"><a href="5-1-helper-functions.html#cb16-4448" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-4449"><a href="5-1-helper-functions.html#cb16-4449" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4450"><a href="5-1-helper-functions.html#cb16-4450" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-4451"><a href="5-1-helper-functions.html#cb16-4451" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4452"><a href="5-1-helper-functions.html#cb16-4452" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-4453"><a href="5-1-helper-functions.html#cb16-4453" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4454"><a href="5-1-helper-functions.html#cb16-4454" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-4455"><a href="5-1-helper-functions.html#cb16-4455" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-4456"><a href="5-1-helper-functions.html#cb16-4456" aria-hidden="true" tabindex="-1"></a>            states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-4457"><a href="5-1-helper-functions.html#cb16-4457" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4458"><a href="5-1-helper-functions.html#cb16-4458" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-4459"><a href="5-1-helper-functions.html#cb16-4459" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4460"><a href="5-1-helper-functions.html#cb16-4460" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-4461"><a href="5-1-helper-functions.html#cb16-4461" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-4462"><a href="5-1-helper-functions.html#cb16-4462" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-4463"><a href="5-1-helper-functions.html#cb16-4463" aria-hidden="true" tabindex="-1"></a>          <span class="co"># #   </span></span>
<span id="cb16-4464"><a href="5-1-helper-functions.html#cb16-4464" aria-hidden="true" tabindex="-1"></a>          <span class="co"># # }else </span></span>
<span id="cb16-4465"><a href="5-1-helper-functions.html#cb16-4465" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 2){</span></span>
<span id="cb16-4466"><a href="5-1-helper-functions.html#cb16-4466" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4467"><a href="5-1-helper-functions.html#cb16-4467" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-4468"><a href="5-1-helper-functions.html#cb16-4468" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4469"><a href="5-1-helper-functions.html#cb16-4469" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-4470"><a href="5-1-helper-functions.html#cb16-4470" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4471"><a href="5-1-helper-functions.html#cb16-4471" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4472"><a href="5-1-helper-functions.html#cb16-4472" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4473"><a href="5-1-helper-functions.html#cb16-4473" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-4474"><a href="5-1-helper-functions.html#cb16-4474" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4475"><a href="5-1-helper-functions.html#cb16-4475" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4476"><a href="5-1-helper-functions.html#cb16-4476" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4477"><a href="5-1-helper-functions.html#cb16-4477" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4478"><a href="5-1-helper-functions.html#cb16-4478" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4479"><a href="5-1-helper-functions.html#cb16-4479" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-4480"><a href="5-1-helper-functions.html#cb16-4480" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4481"><a href="5-1-helper-functions.html#cb16-4481" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4482"><a href="5-1-helper-functions.html#cb16-4482" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4483"><a href="5-1-helper-functions.html#cb16-4483" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-4484"><a href="5-1-helper-functions.html#cb16-4484" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4485"><a href="5-1-helper-functions.html#cb16-4485" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-4486"><a href="5-1-helper-functions.html#cb16-4486" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4487"><a href="5-1-helper-functions.html#cb16-4487" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-4488"><a href="5-1-helper-functions.html#cb16-4488" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4489"><a href="5-1-helper-functions.html#cb16-4489" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-4490"><a href="5-1-helper-functions.html#cb16-4490" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4491"><a href="5-1-helper-functions.html#cb16-4491" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-4492"><a href="5-1-helper-functions.html#cb16-4492" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4493"><a href="5-1-helper-functions.html#cb16-4493" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-4494"><a href="5-1-helper-functions.html#cb16-4494" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4495"><a href="5-1-helper-functions.html#cb16-4495" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-4496"><a href="5-1-helper-functions.html#cb16-4496" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4497"><a href="5-1-helper-functions.html#cb16-4497" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4498"><a href="5-1-helper-functions.html#cb16-4498" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4499"><a href="5-1-helper-functions.html#cb16-4499" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-4500"><a href="5-1-helper-functions.html#cb16-4500" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4501"><a href="5-1-helper-functions.html#cb16-4501" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4502"><a href="5-1-helper-functions.html#cb16-4502" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4503"><a href="5-1-helper-functions.html#cb16-4503" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4504"><a href="5-1-helper-functions.html#cb16-4504" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4505"><a href="5-1-helper-functions.html#cb16-4505" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-4506"><a href="5-1-helper-functions.html#cb16-4506" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4507"><a href="5-1-helper-functions.html#cb16-4507" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4508"><a href="5-1-helper-functions.html#cb16-4508" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4509"><a href="5-1-helper-functions.html#cb16-4509" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-4510"><a href="5-1-helper-functions.html#cb16-4510" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4511"><a href="5-1-helper-functions.html#cb16-4511" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-4512"><a href="5-1-helper-functions.html#cb16-4512" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4513"><a href="5-1-helper-functions.html#cb16-4513" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 3</span></span>
<span id="cb16-4514"><a href="5-1-helper-functions.html#cb16-4514" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-4515"><a href="5-1-helper-functions.html#cb16-4515" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-4516"><a href="5-1-helper-functions.html#cb16-4516" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-4517"><a href="5-1-helper-functions.html#cb16-4517" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-4518"><a href="5-1-helper-functions.html#cb16-4518" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-4519"><a href="5-1-helper-functions.html#cb16-4519" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4520"><a href="5-1-helper-functions.html#cb16-4520" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4521"><a href="5-1-helper-functions.html#cb16-4521" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4522"><a href="5-1-helper-functions.html#cb16-4522" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4523"><a href="5-1-helper-functions.html#cb16-4523" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-4524"><a href="5-1-helper-functions.html#cb16-4524" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-4525"><a href="5-1-helper-functions.html#cb16-4525" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-4526"><a href="5-1-helper-functions.html#cb16-4526" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-4527"><a href="5-1-helper-functions.html#cb16-4527" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-4528"><a href="5-1-helper-functions.html#cb16-4528" aria-hidden="true" tabindex="-1"></a>de_fun_beta <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-4529"><a href="5-1-helper-functions.html#cb16-4529" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-4530"><a href="5-1-helper-functions.html#cb16-4530" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-4531"><a href="5-1-helper-functions.html#cb16-4531" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4532"><a href="5-1-helper-functions.html#cb16-4532" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4533"><a href="5-1-helper-functions.html#cb16-4533" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-4534"><a href="5-1-helper-functions.html#cb16-4534" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-4535"><a href="5-1-helper-functions.html#cb16-4535" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-4536"><a href="5-1-helper-functions.html#cb16-4536" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4537"><a href="5-1-helper-functions.html#cb16-4537" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-4538"><a href="5-1-helper-functions.html#cb16-4538" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4539"><a href="5-1-helper-functions.html#cb16-4539" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-4540"><a href="5-1-helper-functions.html#cb16-4540" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-4541"><a href="5-1-helper-functions.html#cb16-4541" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4542"><a href="5-1-helper-functions.html#cb16-4542" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-4543"><a href="5-1-helper-functions.html#cb16-4543" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-4544"><a href="5-1-helper-functions.html#cb16-4544" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4545"><a href="5-1-helper-functions.html#cb16-4545" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-4546"><a href="5-1-helper-functions.html#cb16-4546" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-4547"><a href="5-1-helper-functions.html#cb16-4547" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4548"><a href="5-1-helper-functions.html#cb16-4548" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-4549"><a href="5-1-helper-functions.html#cb16-4549" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-4550"><a href="5-1-helper-functions.html#cb16-4550" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4551"><a href="5-1-helper-functions.html#cb16-4551" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-4552"><a href="5-1-helper-functions.html#cb16-4552" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-4553"><a href="5-1-helper-functions.html#cb16-4553" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-4554"><a href="5-1-helper-functions.html#cb16-4554" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-4555"><a href="5-1-helper-functions.html#cb16-4555" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-4556"><a href="5-1-helper-functions.html#cb16-4556" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-4557"><a href="5-1-helper-functions.html#cb16-4557" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4558"><a href="5-1-helper-functions.html#cb16-4558" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-4559"><a href="5-1-helper-functions.html#cb16-4559" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4560"><a href="5-1-helper-functions.html#cb16-4560" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-4561"><a href="5-1-helper-functions.html#cb16-4561" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-4562"><a href="5-1-helper-functions.html#cb16-4562" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-4563"><a href="5-1-helper-functions.html#cb16-4563" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-4564"><a href="5-1-helper-functions.html#cb16-4564" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-4565"><a href="5-1-helper-functions.html#cb16-4565" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-4566"><a href="5-1-helper-functions.html#cb16-4566" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-4567"><a href="5-1-helper-functions.html#cb16-4567" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-4568"><a href="5-1-helper-functions.html#cb16-4568" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-4569"><a href="5-1-helper-functions.html#cb16-4569" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-4570"><a href="5-1-helper-functions.html#cb16-4570" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-4571"><a href="5-1-helper-functions.html#cb16-4571" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-4572"><a href="5-1-helper-functions.html#cb16-4572" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-4573"><a href="5-1-helper-functions.html#cb16-4573" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4574"><a href="5-1-helper-functions.html#cb16-4574" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-4575"><a href="5-1-helper-functions.html#cb16-4575" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-4576"><a href="5-1-helper-functions.html#cb16-4576" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-4577"><a href="5-1-helper-functions.html#cb16-4577" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-4578"><a href="5-1-helper-functions.html#cb16-4578" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-4579"><a href="5-1-helper-functions.html#cb16-4579" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-4580"><a href="5-1-helper-functions.html#cb16-4580" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-4581"><a href="5-1-helper-functions.html#cb16-4581" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-4582"><a href="5-1-helper-functions.html#cb16-4582" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-4583"><a href="5-1-helper-functions.html#cb16-4583" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-4584"><a href="5-1-helper-functions.html#cb16-4584" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-4585"><a href="5-1-helper-functions.html#cb16-4585" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-4586"><a href="5-1-helper-functions.html#cb16-4586" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-4587"><a href="5-1-helper-functions.html#cb16-4587" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4588"><a href="5-1-helper-functions.html#cb16-4588" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-4589"><a href="5-1-helper-functions.html#cb16-4589" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-4590"><a href="5-1-helper-functions.html#cb16-4590" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-4591"><a href="5-1-helper-functions.html#cb16-4591" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-4592"><a href="5-1-helper-functions.html#cb16-4592" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4593"><a href="5-1-helper-functions.html#cb16-4593" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-4594"><a href="5-1-helper-functions.html#cb16-4594" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-4595"><a href="5-1-helper-functions.html#cb16-4595" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-4596"><a href="5-1-helper-functions.html#cb16-4596" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4597"><a href="5-1-helper-functions.html#cb16-4597" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-4598"><a href="5-1-helper-functions.html#cb16-4598" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-4599"><a href="5-1-helper-functions.html#cb16-4599" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4600"><a href="5-1-helper-functions.html#cb16-4600" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-4601"><a href="5-1-helper-functions.html#cb16-4601" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-4602"><a href="5-1-helper-functions.html#cb16-4602" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-4603"><a href="5-1-helper-functions.html#cb16-4603" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-4604"><a href="5-1-helper-functions.html#cb16-4604" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4605"><a href="5-1-helper-functions.html#cb16-4605" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-4606"><a href="5-1-helper-functions.html#cb16-4606" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4607"><a href="5-1-helper-functions.html#cb16-4607" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-4608"><a href="5-1-helper-functions.html#cb16-4608" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-4609"><a href="5-1-helper-functions.html#cb16-4609" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-4610"><a href="5-1-helper-functions.html#cb16-4610" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-4611"><a href="5-1-helper-functions.html#cb16-4611" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4612"><a href="5-1-helper-functions.html#cb16-4612" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4613"><a href="5-1-helper-functions.html#cb16-4613" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4614"><a href="5-1-helper-functions.html#cb16-4614" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4615"><a href="5-1-helper-functions.html#cb16-4615" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4616"><a href="5-1-helper-functions.html#cb16-4616" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4617"><a href="5-1-helper-functions.html#cb16-4617" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4618"><a href="5-1-helper-functions.html#cb16-4618" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4619"><a href="5-1-helper-functions.html#cb16-4619" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-4620"><a href="5-1-helper-functions.html#cb16-4620" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-4621"><a href="5-1-helper-functions.html#cb16-4621" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-4622"><a href="5-1-helper-functions.html#cb16-4622" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-4623"><a href="5-1-helper-functions.html#cb16-4623" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4624"><a href="5-1-helper-functions.html#cb16-4624" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-4625"><a href="5-1-helper-functions.html#cb16-4625" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4626"><a href="5-1-helper-functions.html#cb16-4626" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-4627"><a href="5-1-helper-functions.html#cb16-4627" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-4628"><a href="5-1-helper-functions.html#cb16-4628" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-4629"><a href="5-1-helper-functions.html#cb16-4629" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4630"><a href="5-1-helper-functions.html#cb16-4630" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4631"><a href="5-1-helper-functions.html#cb16-4631" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-4632"><a href="5-1-helper-functions.html#cb16-4632" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-4633"><a href="5-1-helper-functions.html#cb16-4633" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(sex <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>sex_types){</span>
<span id="cb16-4634"><a href="5-1-helper-functions.html#cb16-4634" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-4635"><a href="5-1-helper-functions.html#cb16-4635" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-4636"><a href="5-1-helper-functions.html#cb16-4636" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-4637"><a href="5-1-helper-functions.html#cb16-4637" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4638"><a href="5-1-helper-functions.html#cb16-4638" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4639"><a href="5-1-helper-functions.html#cb16-4639" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4640"><a href="5-1-helper-functions.html#cb16-4640" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4641"><a href="5-1-helper-functions.html#cb16-4641" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4642"><a href="5-1-helper-functions.html#cb16-4642" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-4643"><a href="5-1-helper-functions.html#cb16-4643" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4644"><a href="5-1-helper-functions.html#cb16-4644" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4645"><a href="5-1-helper-functions.html#cb16-4645" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4646"><a href="5-1-helper-functions.html#cb16-4646" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-4647"><a href="5-1-helper-functions.html#cb16-4647" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4648"><a href="5-1-helper-functions.html#cb16-4648" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4649"><a href="5-1-helper-functions.html#cb16-4649" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-4650"><a href="5-1-helper-functions.html#cb16-4650" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-4651"><a href="5-1-helper-functions.html#cb16-4651" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-4652"><a href="5-1-helper-functions.html#cb16-4652" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4653"><a href="5-1-helper-functions.html#cb16-4653" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-4654"><a href="5-1-helper-functions.html#cb16-4654" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4655"><a href="5-1-helper-functions.html#cb16-4655" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-4656"><a href="5-1-helper-functions.html#cb16-4656" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-4657"><a href="5-1-helper-functions.html#cb16-4657" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-4658"><a href="5-1-helper-functions.html#cb16-4658" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-4659"><a href="5-1-helper-functions.html#cb16-4659" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-4660"><a href="5-1-helper-functions.html#cb16-4660" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4661"><a href="5-1-helper-functions.html#cb16-4661" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4662"><a href="5-1-helper-functions.html#cb16-4662" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-4663"><a href="5-1-helper-functions.html#cb16-4663" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4664"><a href="5-1-helper-functions.html#cb16-4664" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4665"><a href="5-1-helper-functions.html#cb16-4665" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4666"><a href="5-1-helper-functions.html#cb16-4666" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4667"><a href="5-1-helper-functions.html#cb16-4667" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-4668"><a href="5-1-helper-functions.html#cb16-4668" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4669"><a href="5-1-helper-functions.html#cb16-4669" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-4670"><a href="5-1-helper-functions.html#cb16-4670" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4671"><a href="5-1-helper-functions.html#cb16-4671" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4672"><a href="5-1-helper-functions.html#cb16-4672" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-4673"><a href="5-1-helper-functions.html#cb16-4673" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-4674"><a href="5-1-helper-functions.html#cb16-4674" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4675"><a href="5-1-helper-functions.html#cb16-4675" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-4676"><a href="5-1-helper-functions.html#cb16-4676" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-4677"><a href="5-1-helper-functions.html#cb16-4677" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-4678"><a href="5-1-helper-functions.html#cb16-4678" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-4679"><a href="5-1-helper-functions.html#cb16-4679" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-4680"><a href="5-1-helper-functions.html#cb16-4680" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-4681"><a href="5-1-helper-functions.html#cb16-4681" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-4682"><a href="5-1-helper-functions.html#cb16-4682" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4683"><a href="5-1-helper-functions.html#cb16-4683" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-4684"><a href="5-1-helper-functions.html#cb16-4684" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4685"><a href="5-1-helper-functions.html#cb16-4685" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-4686"><a href="5-1-helper-functions.html#cb16-4686" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-4687"><a href="5-1-helper-functions.html#cb16-4687" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-4688"><a href="5-1-helper-functions.html#cb16-4688" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-4689"><a href="5-1-helper-functions.html#cb16-4689" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-4690"><a href="5-1-helper-functions.html#cb16-4690" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4691"><a href="5-1-helper-functions.html#cb16-4691" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4692"><a href="5-1-helper-functions.html#cb16-4692" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4693"><a href="5-1-helper-functions.html#cb16-4693" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4694"><a href="5-1-helper-functions.html#cb16-4694" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-4695"><a href="5-1-helper-functions.html#cb16-4695" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-4696"><a href="5-1-helper-functions.html#cb16-4696" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-4697"><a href="5-1-helper-functions.html#cb16-4697" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-4698"><a href="5-1-helper-functions.html#cb16-4698" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4699"><a href="5-1-helper-functions.html#cb16-4699" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-4700"><a href="5-1-helper-functions.html#cb16-4700" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-4701"><a href="5-1-helper-functions.html#cb16-4701" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-4702"><a href="5-1-helper-functions.html#cb16-4702" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4703"><a href="5-1-helper-functions.html#cb16-4703" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-4704"><a href="5-1-helper-functions.html#cb16-4704" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-4705"><a href="5-1-helper-functions.html#cb16-4705" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-4706"><a href="5-1-helper-functions.html#cb16-4706" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4707"><a href="5-1-helper-functions.html#cb16-4707" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-4708"><a href="5-1-helper-functions.html#cb16-4708" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-4709"><a href="5-1-helper-functions.html#cb16-4709" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4710"><a href="5-1-helper-functions.html#cb16-4710" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4711"><a href="5-1-helper-functions.html#cb16-4711" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-4712"><a href="5-1-helper-functions.html#cb16-4712" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-4713"><a href="5-1-helper-functions.html#cb16-4713" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-4714"><a href="5-1-helper-functions.html#cb16-4714" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-4715"><a href="5-1-helper-functions.html#cb16-4715" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4716"><a href="5-1-helper-functions.html#cb16-4716" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4717"><a href="5-1-helper-functions.html#cb16-4717" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4718"><a href="5-1-helper-functions.html#cb16-4718" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-4719"><a href="5-1-helper-functions.html#cb16-4719" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4720"><a href="5-1-helper-functions.html#cb16-4720" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4721"><a href="5-1-helper-functions.html#cb16-4721" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4722"><a href="5-1-helper-functions.html#cb16-4722" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4723"><a href="5-1-helper-functions.html#cb16-4723" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-4724"><a href="5-1-helper-functions.html#cb16-4724" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4725"><a href="5-1-helper-functions.html#cb16-4725" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4726"><a href="5-1-helper-functions.html#cb16-4726" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4727"><a href="5-1-helper-functions.html#cb16-4727" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-4728"><a href="5-1-helper-functions.html#cb16-4728" aria-hidden="true" tabindex="-1"></a>            <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-4729"><a href="5-1-helper-functions.html#cb16-4729" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4730"><a href="5-1-helper-functions.html#cb16-4730" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4731"><a href="5-1-helper-functions.html#cb16-4731" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-4732"><a href="5-1-helper-functions.html#cb16-4732" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4733"><a href="5-1-helper-functions.html#cb16-4733" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4734"><a href="5-1-helper-functions.html#cb16-4734" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4735"><a href="5-1-helper-functions.html#cb16-4735" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-4736"><a href="5-1-helper-functions.html#cb16-4736" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-4737"><a href="5-1-helper-functions.html#cb16-4737" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-4738"><a href="5-1-helper-functions.html#cb16-4738" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-4739"><a href="5-1-helper-functions.html#cb16-4739" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-4740"><a href="5-1-helper-functions.html#cb16-4740" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-4741"><a href="5-1-helper-functions.html#cb16-4741" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4742"><a href="5-1-helper-functions.html#cb16-4742" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-4743"><a href="5-1-helper-functions.html#cb16-4743" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-4744"><a href="5-1-helper-functions.html#cb16-4744" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-4745"><a href="5-1-helper-functions.html#cb16-4745" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4746"><a href="5-1-helper-functions.html#cb16-4746" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4747"><a href="5-1-helper-functions.html#cb16-4747" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4748"><a href="5-1-helper-functions.html#cb16-4748" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-4749"><a href="5-1-helper-functions.html#cb16-4749" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-4750"><a href="5-1-helper-functions.html#cb16-4750" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-4751"><a href="5-1-helper-functions.html#cb16-4751" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4752"><a href="5-1-helper-functions.html#cb16-4752" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4753"><a href="5-1-helper-functions.html#cb16-4753" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-4754"><a href="5-1-helper-functions.html#cb16-4754" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-4755"><a href="5-1-helper-functions.html#cb16-4755" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-4756"><a href="5-1-helper-functions.html#cb16-4756" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4757"><a href="5-1-helper-functions.html#cb16-4757" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-4758"><a href="5-1-helper-functions.html#cb16-4758" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-4759"><a href="5-1-helper-functions.html#cb16-4759" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-4760"><a href="5-1-helper-functions.html#cb16-4760" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-4761"><a href="5-1-helper-functions.html#cb16-4761" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-4762"><a href="5-1-helper-functions.html#cb16-4762" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4763"><a href="5-1-helper-functions.html#cb16-4763" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4764"><a href="5-1-helper-functions.html#cb16-4764" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4765"><a href="5-1-helper-functions.html#cb16-4765" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-4766"><a href="5-1-helper-functions.html#cb16-4766" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4767"><a href="5-1-helper-functions.html#cb16-4767" aria-hidden="true" tabindex="-1"></a>          <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-4768"><a href="5-1-helper-functions.html#cb16-4768" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4769"><a href="5-1-helper-functions.html#cb16-4769" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-4770"><a href="5-1-helper-functions.html#cb16-4770" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4771"><a href="5-1-helper-functions.html#cb16-4771" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-4772"><a href="5-1-helper-functions.html#cb16-4772" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-4773"><a href="5-1-helper-functions.html#cb16-4773" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4774"><a href="5-1-helper-functions.html#cb16-4774" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-4775"><a href="5-1-helper-functions.html#cb16-4775" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4776"><a href="5-1-helper-functions.html#cb16-4776" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-4777"><a href="5-1-helper-functions.html#cb16-4777" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4778"><a href="5-1-helper-functions.html#cb16-4778" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4779"><a href="5-1-helper-functions.html#cb16-4779" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4780"><a href="5-1-helper-functions.html#cb16-4780" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-4781"><a href="5-1-helper-functions.html#cb16-4781" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4782"><a href="5-1-helper-functions.html#cb16-4782" aria-hidden="true" tabindex="-1"></a>            <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-4783"><a href="5-1-helper-functions.html#cb16-4783" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4784"><a href="5-1-helper-functions.html#cb16-4784" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-4785"><a href="5-1-helper-functions.html#cb16-4785" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4786"><a href="5-1-helper-functions.html#cb16-4786" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-4787"><a href="5-1-helper-functions.html#cb16-4787" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4788"><a href="5-1-helper-functions.html#cb16-4788" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-4789"><a href="5-1-helper-functions.html#cb16-4789" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4790"><a href="5-1-helper-functions.html#cb16-4790" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-4791"><a href="5-1-helper-functions.html#cb16-4791" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4792"><a href="5-1-helper-functions.html#cb16-4792" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-4793"><a href="5-1-helper-functions.html#cb16-4793" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4794"><a href="5-1-helper-functions.html#cb16-4794" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-4795"><a href="5-1-helper-functions.html#cb16-4795" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4796"><a href="5-1-helper-functions.html#cb16-4796" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-4797"><a href="5-1-helper-functions.html#cb16-4797" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4798"><a href="5-1-helper-functions.html#cb16-4798" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-4799"><a href="5-1-helper-functions.html#cb16-4799" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4800"><a href="5-1-helper-functions.html#cb16-4800" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4801"><a href="5-1-helper-functions.html#cb16-4801" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4802"><a href="5-1-helper-functions.html#cb16-4802" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-4803"><a href="5-1-helper-functions.html#cb16-4803" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4804"><a href="5-1-helper-functions.html#cb16-4804" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-4805"><a href="5-1-helper-functions.html#cb16-4805" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4806"><a href="5-1-helper-functions.html#cb16-4806" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-4807"><a href="5-1-helper-functions.html#cb16-4807" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4808"><a href="5-1-helper-functions.html#cb16-4808" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-4809"><a href="5-1-helper-functions.html#cb16-4809" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4810"><a href="5-1-helper-functions.html#cb16-4810" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-4811"><a href="5-1-helper-functions.html#cb16-4811" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4812"><a href="5-1-helper-functions.html#cb16-4812" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-4813"><a href="5-1-helper-functions.html#cb16-4813" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4814"><a href="5-1-helper-functions.html#cb16-4814" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-4815"><a href="5-1-helper-functions.html#cb16-4815" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4816"><a href="5-1-helper-functions.html#cb16-4816" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-4817"><a href="5-1-helper-functions.html#cb16-4817" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4818"><a href="5-1-helper-functions.html#cb16-4818" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-4819"><a href="5-1-helper-functions.html#cb16-4819" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4820"><a href="5-1-helper-functions.html#cb16-4820" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-4821"><a href="5-1-helper-functions.html#cb16-4821" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4822"><a href="5-1-helper-functions.html#cb16-4822" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-4823"><a href="5-1-helper-functions.html#cb16-4823" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4824"><a href="5-1-helper-functions.html#cb16-4824" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-4825"><a href="5-1-helper-functions.html#cb16-4825" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4826"><a href="5-1-helper-functions.html#cb16-4826" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4827"><a href="5-1-helper-functions.html#cb16-4827" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4828"><a href="5-1-helper-functions.html#cb16-4828" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-4829"><a href="5-1-helper-functions.html#cb16-4829" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4830"><a href="5-1-helper-functions.html#cb16-4830" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-4831"><a href="5-1-helper-functions.html#cb16-4831" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4832"><a href="5-1-helper-functions.html#cb16-4832" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 1</span></span>
<span id="cb16-4833"><a href="5-1-helper-functions.html#cb16-4833" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-4834"><a href="5-1-helper-functions.html#cb16-4834" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4835"><a href="5-1-helper-functions.html#cb16-4835" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4836"><a href="5-1-helper-functions.html#cb16-4836" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4837"><a href="5-1-helper-functions.html#cb16-4837" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-4838"><a href="5-1-helper-functions.html#cb16-4838" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4839"><a href="5-1-helper-functions.html#cb16-4839" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4840"><a href="5-1-helper-functions.html#cb16-4840" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4841"><a href="5-1-helper-functions.html#cb16-4841" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-4842"><a href="5-1-helper-functions.html#cb16-4842" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4843"><a href="5-1-helper-functions.html#cb16-4843" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4844"><a href="5-1-helper-functions.html#cb16-4844" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-4845"><a href="5-1-helper-functions.html#cb16-4845" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-4846"><a href="5-1-helper-functions.html#cb16-4846" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-4847"><a href="5-1-helper-functions.html#cb16-4847" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4848"><a href="5-1-helper-functions.html#cb16-4848" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-4849"><a href="5-1-helper-functions.html#cb16-4849" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4850"><a href="5-1-helper-functions.html#cb16-4850" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-4851"><a href="5-1-helper-functions.html#cb16-4851" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-4852"><a href="5-1-helper-functions.html#cb16-4852" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-4853"><a href="5-1-helper-functions.html#cb16-4853" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-4854"><a href="5-1-helper-functions.html#cb16-4854" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-4855"><a href="5-1-helper-functions.html#cb16-4855" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4856"><a href="5-1-helper-functions.html#cb16-4856" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4857"><a href="5-1-helper-functions.html#cb16-4857" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-4858"><a href="5-1-helper-functions.html#cb16-4858" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4859"><a href="5-1-helper-functions.html#cb16-4859" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4860"><a href="5-1-helper-functions.html#cb16-4860" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4861"><a href="5-1-helper-functions.html#cb16-4861" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4862"><a href="5-1-helper-functions.html#cb16-4862" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-4863"><a href="5-1-helper-functions.html#cb16-4863" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4864"><a href="5-1-helper-functions.html#cb16-4864" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-4865"><a href="5-1-helper-functions.html#cb16-4865" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4866"><a href="5-1-helper-functions.html#cb16-4866" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-4867"><a href="5-1-helper-functions.html#cb16-4867" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-4868"><a href="5-1-helper-functions.html#cb16-4868" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-4869"><a href="5-1-helper-functions.html#cb16-4869" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-4870"><a href="5-1-helper-functions.html#cb16-4870" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-4871"><a href="5-1-helper-functions.html#cb16-4871" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-4872"><a href="5-1-helper-functions.html#cb16-4872" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-4873"><a href="5-1-helper-functions.html#cb16-4873" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-4874"><a href="5-1-helper-functions.html#cb16-4874" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-4875"><a href="5-1-helper-functions.html#cb16-4875" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-4876"><a href="5-1-helper-functions.html#cb16-4876" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4877"><a href="5-1-helper-functions.html#cb16-4877" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-4878"><a href="5-1-helper-functions.html#cb16-4878" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4879"><a href="5-1-helper-functions.html#cb16-4879" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-4880"><a href="5-1-helper-functions.html#cb16-4880" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-4881"><a href="5-1-helper-functions.html#cb16-4881" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-4882"><a href="5-1-helper-functions.html#cb16-4882" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-4883"><a href="5-1-helper-functions.html#cb16-4883" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-4884"><a href="5-1-helper-functions.html#cb16-4884" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4885"><a href="5-1-helper-functions.html#cb16-4885" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4886"><a href="5-1-helper-functions.html#cb16-4886" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4887"><a href="5-1-helper-functions.html#cb16-4887" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4888"><a href="5-1-helper-functions.html#cb16-4888" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-4889"><a href="5-1-helper-functions.html#cb16-4889" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-4890"><a href="5-1-helper-functions.html#cb16-4890" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-4891"><a href="5-1-helper-functions.html#cb16-4891" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-4892"><a href="5-1-helper-functions.html#cb16-4892" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4893"><a href="5-1-helper-functions.html#cb16-4893" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-4894"><a href="5-1-helper-functions.html#cb16-4894" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-4895"><a href="5-1-helper-functions.html#cb16-4895" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-4896"><a href="5-1-helper-functions.html#cb16-4896" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4897"><a href="5-1-helper-functions.html#cb16-4897" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-4898"><a href="5-1-helper-functions.html#cb16-4898" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-4899"><a href="5-1-helper-functions.html#cb16-4899" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-4900"><a href="5-1-helper-functions.html#cb16-4900" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-4901"><a href="5-1-helper-functions.html#cb16-4901" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-4902"><a href="5-1-helper-functions.html#cb16-4902" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4903"><a href="5-1-helper-functions.html#cb16-4903" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4904"><a href="5-1-helper-functions.html#cb16-4904" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-4905"><a href="5-1-helper-functions.html#cb16-4905" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-4906"><a href="5-1-helper-functions.html#cb16-4906" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-4907"><a href="5-1-helper-functions.html#cb16-4907" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-4908"><a href="5-1-helper-functions.html#cb16-4908" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4909"><a href="5-1-helper-functions.html#cb16-4909" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4910"><a href="5-1-helper-functions.html#cb16-4910" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4911"><a href="5-1-helper-functions.html#cb16-4911" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-4912"><a href="5-1-helper-functions.html#cb16-4912" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4913"><a href="5-1-helper-functions.html#cb16-4913" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4914"><a href="5-1-helper-functions.html#cb16-4914" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4915"><a href="5-1-helper-functions.html#cb16-4915" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4916"><a href="5-1-helper-functions.html#cb16-4916" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-4917"><a href="5-1-helper-functions.html#cb16-4917" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4918"><a href="5-1-helper-functions.html#cb16-4918" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-4919"><a href="5-1-helper-functions.html#cb16-4919" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4920"><a href="5-1-helper-functions.html#cb16-4920" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-4921"><a href="5-1-helper-functions.html#cb16-4921" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-4922"><a href="5-1-helper-functions.html#cb16-4922" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-4923"><a href="5-1-helper-functions.html#cb16-4923" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4924"><a href="5-1-helper-functions.html#cb16-4924" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-4925"><a href="5-1-helper-functions.html#cb16-4925" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4926"><a href="5-1-helper-functions.html#cb16-4926" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-4927"><a href="5-1-helper-functions.html#cb16-4927" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4928"><a href="5-1-helper-functions.html#cb16-4928" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-4929"><a href="5-1-helper-functions.html#cb16-4929" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-4930"><a href="5-1-helper-functions.html#cb16-4930" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-4931"><a href="5-1-helper-functions.html#cb16-4931" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-4932"><a href="5-1-helper-functions.html#cb16-4932" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-4933"><a href="5-1-helper-functions.html#cb16-4933" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-4934"><a href="5-1-helper-functions.html#cb16-4934" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-4935"><a href="5-1-helper-functions.html#cb16-4935" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-4936"><a href="5-1-helper-functions.html#cb16-4936" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-4937"><a href="5-1-helper-functions.html#cb16-4937" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-4938"><a href="5-1-helper-functions.html#cb16-4938" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-4939"><a href="5-1-helper-functions.html#cb16-4939" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4940"><a href="5-1-helper-functions.html#cb16-4940" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-4941"><a href="5-1-helper-functions.html#cb16-4941" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-4942"><a href="5-1-helper-functions.html#cb16-4942" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-4943"><a href="5-1-helper-functions.html#cb16-4943" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4944"><a href="5-1-helper-functions.html#cb16-4944" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4945"><a href="5-1-helper-functions.html#cb16-4945" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4946"><a href="5-1-helper-functions.html#cb16-4946" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-4947"><a href="5-1-helper-functions.html#cb16-4947" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-4948"><a href="5-1-helper-functions.html#cb16-4948" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-4949"><a href="5-1-helper-functions.html#cb16-4949" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-4950"><a href="5-1-helper-functions.html#cb16-4950" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4951"><a href="5-1-helper-functions.html#cb16-4951" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-4952"><a href="5-1-helper-functions.html#cb16-4952" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-4953"><a href="5-1-helper-functions.html#cb16-4953" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-4954"><a href="5-1-helper-functions.html#cb16-4954" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4955"><a href="5-1-helper-functions.html#cb16-4955" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-4956"><a href="5-1-helper-functions.html#cb16-4956" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-4957"><a href="5-1-helper-functions.html#cb16-4957" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-4958"><a href="5-1-helper-functions.html#cb16-4958" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-4959"><a href="5-1-helper-functions.html#cb16-4959" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-4960"><a href="5-1-helper-functions.html#cb16-4960" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-4961"><a href="5-1-helper-functions.html#cb16-4961" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-4962"><a href="5-1-helper-functions.html#cb16-4962" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4963"><a href="5-1-helper-functions.html#cb16-4963" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-4964"><a href="5-1-helper-functions.html#cb16-4964" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4965"><a href="5-1-helper-functions.html#cb16-4965" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4966"><a href="5-1-helper-functions.html#cb16-4966" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4967"><a href="5-1-helper-functions.html#cb16-4967" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-4968"><a href="5-1-helper-functions.html#cb16-4968" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4969"><a href="5-1-helper-functions.html#cb16-4969" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-4970"><a href="5-1-helper-functions.html#cb16-4970" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4971"><a href="5-1-helper-functions.html#cb16-4971" aria-hidden="true" tabindex="-1"></a>          <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-4972"><a href="5-1-helper-functions.html#cb16-4972" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4973"><a href="5-1-helper-functions.html#cb16-4973" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-4974"><a href="5-1-helper-functions.html#cb16-4974" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4975"><a href="5-1-helper-functions.html#cb16-4975" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-4976"><a href="5-1-helper-functions.html#cb16-4976" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4977"><a href="5-1-helper-functions.html#cb16-4977" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-4978"><a href="5-1-helper-functions.html#cb16-4978" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-4979"><a href="5-1-helper-functions.html#cb16-4979" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4980"><a href="5-1-helper-functions.html#cb16-4980" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-4981"><a href="5-1-helper-functions.html#cb16-4981" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4982"><a href="5-1-helper-functions.html#cb16-4982" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-4983"><a href="5-1-helper-functions.html#cb16-4983" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4984"><a href="5-1-helper-functions.html#cb16-4984" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-4985"><a href="5-1-helper-functions.html#cb16-4985" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-4986"><a href="5-1-helper-functions.html#cb16-4986" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-4987"><a href="5-1-helper-functions.html#cb16-4987" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4988"><a href="5-1-helper-functions.html#cb16-4988" aria-hidden="true" tabindex="-1"></a>            <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-4989"><a href="5-1-helper-functions.html#cb16-4989" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4990"><a href="5-1-helper-functions.html#cb16-4990" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-4991"><a href="5-1-helper-functions.html#cb16-4991" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4992"><a href="5-1-helper-functions.html#cb16-4992" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-4993"><a href="5-1-helper-functions.html#cb16-4993" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4994"><a href="5-1-helper-functions.html#cb16-4994" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-4995"><a href="5-1-helper-functions.html#cb16-4995" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4996"><a href="5-1-helper-functions.html#cb16-4996" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-4997"><a href="5-1-helper-functions.html#cb16-4997" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-4998"><a href="5-1-helper-functions.html#cb16-4998" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-4999"><a href="5-1-helper-functions.html#cb16-4999" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5000"><a href="5-1-helper-functions.html#cb16-5000" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5001"><a href="5-1-helper-functions.html#cb16-5001" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5002"><a href="5-1-helper-functions.html#cb16-5002" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5003"><a href="5-1-helper-functions.html#cb16-5003" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5004"><a href="5-1-helper-functions.html#cb16-5004" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5005"><a href="5-1-helper-functions.html#cb16-5005" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5006"><a href="5-1-helper-functions.html#cb16-5006" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5007"><a href="5-1-helper-functions.html#cb16-5007" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5008"><a href="5-1-helper-functions.html#cb16-5008" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-5009"><a href="5-1-helper-functions.html#cb16-5009" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5010"><a href="5-1-helper-functions.html#cb16-5010" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5011"><a href="5-1-helper-functions.html#cb16-5011" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5012"><a href="5-1-helper-functions.html#cb16-5012" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-5013"><a href="5-1-helper-functions.html#cb16-5013" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5014"><a href="5-1-helper-functions.html#cb16-5014" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-5015"><a href="5-1-helper-functions.html#cb16-5015" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5016"><a href="5-1-helper-functions.html#cb16-5016" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-5017"><a href="5-1-helper-functions.html#cb16-5017" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5018"><a href="5-1-helper-functions.html#cb16-5018" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-5019"><a href="5-1-helper-functions.html#cb16-5019" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5020"><a href="5-1-helper-functions.html#cb16-5020" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-5021"><a href="5-1-helper-functions.html#cb16-5021" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5022"><a href="5-1-helper-functions.html#cb16-5022" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-5023"><a href="5-1-helper-functions.html#cb16-5023" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5024"><a href="5-1-helper-functions.html#cb16-5024" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-5025"><a href="5-1-helper-functions.html#cb16-5025" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5026"><a href="5-1-helper-functions.html#cb16-5026" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-5027"><a href="5-1-helper-functions.html#cb16-5027" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5028"><a href="5-1-helper-functions.html#cb16-5028" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-5029"><a href="5-1-helper-functions.html#cb16-5029" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5030"><a href="5-1-helper-functions.html#cb16-5030" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-5031"><a href="5-1-helper-functions.html#cb16-5031" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5032"><a href="5-1-helper-functions.html#cb16-5032" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5033"><a href="5-1-helper-functions.html#cb16-5033" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5034"><a href="5-1-helper-functions.html#cb16-5034" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-5035"><a href="5-1-helper-functions.html#cb16-5035" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5036"><a href="5-1-helper-functions.html#cb16-5036" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-5037"><a href="5-1-helper-functions.html#cb16-5037" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5038"><a href="5-1-helper-functions.html#cb16-5038" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 2</span></span>
<span id="cb16-5039"><a href="5-1-helper-functions.html#cb16-5039" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-5040"><a href="5-1-helper-functions.html#cb16-5040" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5041"><a href="5-1-helper-functions.html#cb16-5041" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5042"><a href="5-1-helper-functions.html#cb16-5042" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-5043"><a href="5-1-helper-functions.html#cb16-5043" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5044"><a href="5-1-helper-functions.html#cb16-5044" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5045"><a href="5-1-helper-functions.html#cb16-5045" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5046"><a href="5-1-helper-functions.html#cb16-5046" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-5047"><a href="5-1-helper-functions.html#cb16-5047" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5048"><a href="5-1-helper-functions.html#cb16-5048" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5049"><a href="5-1-helper-functions.html#cb16-5049" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-5050"><a href="5-1-helper-functions.html#cb16-5050" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-5051"><a href="5-1-helper-functions.html#cb16-5051" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-5052"><a href="5-1-helper-functions.html#cb16-5052" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5053"><a href="5-1-helper-functions.html#cb16-5053" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-5054"><a href="5-1-helper-functions.html#cb16-5054" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5055"><a href="5-1-helper-functions.html#cb16-5055" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-5056"><a href="5-1-helper-functions.html#cb16-5056" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-5057"><a href="5-1-helper-functions.html#cb16-5057" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-5058"><a href="5-1-helper-functions.html#cb16-5058" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-5059"><a href="5-1-helper-functions.html#cb16-5059" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-5060"><a href="5-1-helper-functions.html#cb16-5060" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5061"><a href="5-1-helper-functions.html#cb16-5061" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5062"><a href="5-1-helper-functions.html#cb16-5062" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-5063"><a href="5-1-helper-functions.html#cb16-5063" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5064"><a href="5-1-helper-functions.html#cb16-5064" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5065"><a href="5-1-helper-functions.html#cb16-5065" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5066"><a href="5-1-helper-functions.html#cb16-5066" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5067"><a href="5-1-helper-functions.html#cb16-5067" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-5068"><a href="5-1-helper-functions.html#cb16-5068" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5069"><a href="5-1-helper-functions.html#cb16-5069" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-5070"><a href="5-1-helper-functions.html#cb16-5070" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5071"><a href="5-1-helper-functions.html#cb16-5071" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5072"><a href="5-1-helper-functions.html#cb16-5072" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-5073"><a href="5-1-helper-functions.html#cb16-5073" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-5074"><a href="5-1-helper-functions.html#cb16-5074" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-5075"><a href="5-1-helper-functions.html#cb16-5075" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-5076"><a href="5-1-helper-functions.html#cb16-5076" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-5077"><a href="5-1-helper-functions.html#cb16-5077" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-5078"><a href="5-1-helper-functions.html#cb16-5078" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-5079"><a href="5-1-helper-functions.html#cb16-5079" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-5080"><a href="5-1-helper-functions.html#cb16-5080" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5081"><a href="5-1-helper-functions.html#cb16-5081" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5082"><a href="5-1-helper-functions.html#cb16-5082" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-5083"><a href="5-1-helper-functions.html#cb16-5083" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5084"><a href="5-1-helper-functions.html#cb16-5084" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-5085"><a href="5-1-helper-functions.html#cb16-5085" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-5086"><a href="5-1-helper-functions.html#cb16-5086" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-5087"><a href="5-1-helper-functions.html#cb16-5087" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-5088"><a href="5-1-helper-functions.html#cb16-5088" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-5089"><a href="5-1-helper-functions.html#cb16-5089" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5090"><a href="5-1-helper-functions.html#cb16-5090" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5091"><a href="5-1-helper-functions.html#cb16-5091" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5092"><a href="5-1-helper-functions.html#cb16-5092" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5093"><a href="5-1-helper-functions.html#cb16-5093" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-5094"><a href="5-1-helper-functions.html#cb16-5094" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-5095"><a href="5-1-helper-functions.html#cb16-5095" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-5096"><a href="5-1-helper-functions.html#cb16-5096" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-5097"><a href="5-1-helper-functions.html#cb16-5097" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5098"><a href="5-1-helper-functions.html#cb16-5098" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-5099"><a href="5-1-helper-functions.html#cb16-5099" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-5100"><a href="5-1-helper-functions.html#cb16-5100" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-5101"><a href="5-1-helper-functions.html#cb16-5101" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5102"><a href="5-1-helper-functions.html#cb16-5102" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-5103"><a href="5-1-helper-functions.html#cb16-5103" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-5104"><a href="5-1-helper-functions.html#cb16-5104" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-5105"><a href="5-1-helper-functions.html#cb16-5105" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-5106"><a href="5-1-helper-functions.html#cb16-5106" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-5107"><a href="5-1-helper-functions.html#cb16-5107" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-5108"><a href="5-1-helper-functions.html#cb16-5108" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5109"><a href="5-1-helper-functions.html#cb16-5109" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-5110"><a href="5-1-helper-functions.html#cb16-5110" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-5111"><a href="5-1-helper-functions.html#cb16-5111" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-5112"><a href="5-1-helper-functions.html#cb16-5112" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-5113"><a href="5-1-helper-functions.html#cb16-5113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5114"><a href="5-1-helper-functions.html#cb16-5114" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5115"><a href="5-1-helper-functions.html#cb16-5115" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5116"><a href="5-1-helper-functions.html#cb16-5116" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-5117"><a href="5-1-helper-functions.html#cb16-5117" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5118"><a href="5-1-helper-functions.html#cb16-5118" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5119"><a href="5-1-helper-functions.html#cb16-5119" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5120"><a href="5-1-helper-functions.html#cb16-5120" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5121"><a href="5-1-helper-functions.html#cb16-5121" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-5122"><a href="5-1-helper-functions.html#cb16-5122" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5123"><a href="5-1-helper-functions.html#cb16-5123" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5124"><a href="5-1-helper-functions.html#cb16-5124" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5125"><a href="5-1-helper-functions.html#cb16-5125" aria-hidden="true" tabindex="-1"></a>            <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-5126"><a href="5-1-helper-functions.html#cb16-5126" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-5127"><a href="5-1-helper-functions.html#cb16-5127" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-5128"><a href="5-1-helper-functions.html#cb16-5128" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5129"><a href="5-1-helper-functions.html#cb16-5129" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-5130"><a href="5-1-helper-functions.html#cb16-5130" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5131"><a href="5-1-helper-functions.html#cb16-5131" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5132"><a href="5-1-helper-functions.html#cb16-5132" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5133"><a href="5-1-helper-functions.html#cb16-5133" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5134"><a href="5-1-helper-functions.html#cb16-5134" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-5135"><a href="5-1-helper-functions.html#cb16-5135" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-5136"><a href="5-1-helper-functions.html#cb16-5136" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5137"><a href="5-1-helper-functions.html#cb16-5137" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5138"><a href="5-1-helper-functions.html#cb16-5138" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5139"><a href="5-1-helper-functions.html#cb16-5139" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-5140"><a href="5-1-helper-functions.html#cb16-5140" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-5141"><a href="5-1-helper-functions.html#cb16-5141" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-5142"><a href="5-1-helper-functions.html#cb16-5142" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-5143"><a href="5-1-helper-functions.html#cb16-5143" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-5144"><a href="5-1-helper-functions.html#cb16-5144" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-5145"><a href="5-1-helper-functions.html#cb16-5145" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5146"><a href="5-1-helper-functions.html#cb16-5146" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-5147"><a href="5-1-helper-functions.html#cb16-5147" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-5148"><a href="5-1-helper-functions.html#cb16-5148" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-5149"><a href="5-1-helper-functions.html#cb16-5149" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5150"><a href="5-1-helper-functions.html#cb16-5150" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5151"><a href="5-1-helper-functions.html#cb16-5151" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5152"><a href="5-1-helper-functions.html#cb16-5152" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-5153"><a href="5-1-helper-functions.html#cb16-5153" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-5154"><a href="5-1-helper-functions.html#cb16-5154" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-5155"><a href="5-1-helper-functions.html#cb16-5155" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5156"><a href="5-1-helper-functions.html#cb16-5156" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5157"><a href="5-1-helper-functions.html#cb16-5157" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-5158"><a href="5-1-helper-functions.html#cb16-5158" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-5159"><a href="5-1-helper-functions.html#cb16-5159" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-5160"><a href="5-1-helper-functions.html#cb16-5160" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5161"><a href="5-1-helper-functions.html#cb16-5161" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-5162"><a href="5-1-helper-functions.html#cb16-5162" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-5163"><a href="5-1-helper-functions.html#cb16-5163" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-5164"><a href="5-1-helper-functions.html#cb16-5164" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-5165"><a href="5-1-helper-functions.html#cb16-5165" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-5166"><a href="5-1-helper-functions.html#cb16-5166" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5167"><a href="5-1-helper-functions.html#cb16-5167" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5168"><a href="5-1-helper-functions.html#cb16-5168" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5169"><a href="5-1-helper-functions.html#cb16-5169" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-5170"><a href="5-1-helper-functions.html#cb16-5170" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5171"><a href="5-1-helper-functions.html#cb16-5171" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5172"><a href="5-1-helper-functions.html#cb16-5172" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5173"><a href="5-1-helper-functions.html#cb16-5173" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-5174"><a href="5-1-helper-functions.html#cb16-5174" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5175"><a href="5-1-helper-functions.html#cb16-5175" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-5176"><a href="5-1-helper-functions.html#cb16-5176" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5177"><a href="5-1-helper-functions.html#cb16-5177" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-5178"><a href="5-1-helper-functions.html#cb16-5178" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5179"><a href="5-1-helper-functions.html#cb16-5179" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-5180"><a href="5-1-helper-functions.html#cb16-5180" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-5181"><a href="5-1-helper-functions.html#cb16-5181" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5182"><a href="5-1-helper-functions.html#cb16-5182" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-5183"><a href="5-1-helper-functions.html#cb16-5183" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5184"><a href="5-1-helper-functions.html#cb16-5184" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-5185"><a href="5-1-helper-functions.html#cb16-5185" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5186"><a href="5-1-helper-functions.html#cb16-5186" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5187"><a href="5-1-helper-functions.html#cb16-5187" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5188"><a href="5-1-helper-functions.html#cb16-5188" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5189"><a href="5-1-helper-functions.html#cb16-5189" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5190"><a href="5-1-helper-functions.html#cb16-5190" aria-hidden="true" tabindex="-1"></a>            <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-5191"><a href="5-1-helper-functions.html#cb16-5191" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5192"><a href="5-1-helper-functions.html#cb16-5192" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5193"><a href="5-1-helper-functions.html#cb16-5193" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5194"><a href="5-1-helper-functions.html#cb16-5194" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-5195"><a href="5-1-helper-functions.html#cb16-5195" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5196"><a href="5-1-helper-functions.html#cb16-5196" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5197"><a href="5-1-helper-functions.html#cb16-5197" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5198"><a href="5-1-helper-functions.html#cb16-5198" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5199"><a href="5-1-helper-functions.html#cb16-5199" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5200"><a href="5-1-helper-functions.html#cb16-5200" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5201"><a href="5-1-helper-functions.html#cb16-5201" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5202"><a href="5-1-helper-functions.html#cb16-5202" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5203"><a href="5-1-helper-functions.html#cb16-5203" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5204"><a href="5-1-helper-functions.html#cb16-5204" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5205"><a href="5-1-helper-functions.html#cb16-5205" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5206"><a href="5-1-helper-functions.html#cb16-5206" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5207"><a href="5-1-helper-functions.html#cb16-5207" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5208"><a href="5-1-helper-functions.html#cb16-5208" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5209"><a href="5-1-helper-functions.html#cb16-5209" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5210"><a href="5-1-helper-functions.html#cb16-5210" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-5211"><a href="5-1-helper-functions.html#cb16-5211" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5212"><a href="5-1-helper-functions.html#cb16-5212" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5213"><a href="5-1-helper-functions.html#cb16-5213" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5214"><a href="5-1-helper-functions.html#cb16-5214" aria-hidden="true" tabindex="-1"></a>          <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-5215"><a href="5-1-helper-functions.html#cb16-5215" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5216"><a href="5-1-helper-functions.html#cb16-5216" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-5217"><a href="5-1-helper-functions.html#cb16-5217" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5218"><a href="5-1-helper-functions.html#cb16-5218" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-5219"><a href="5-1-helper-functions.html#cb16-5219" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5220"><a href="5-1-helper-functions.html#cb16-5220" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-5221"><a href="5-1-helper-functions.html#cb16-5221" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5222"><a href="5-1-helper-functions.html#cb16-5222" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-5223"><a href="5-1-helper-functions.html#cb16-5223" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5224"><a href="5-1-helper-functions.html#cb16-5224" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-5225"><a href="5-1-helper-functions.html#cb16-5225" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5226"><a href="5-1-helper-functions.html#cb16-5226" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-5227"><a href="5-1-helper-functions.html#cb16-5227" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5228"><a href="5-1-helper-functions.html#cb16-5228" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-5229"><a href="5-1-helper-functions.html#cb16-5229" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5230"><a href="5-1-helper-functions.html#cb16-5230" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-5231"><a href="5-1-helper-functions.html#cb16-5231" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5232"><a href="5-1-helper-functions.html#cb16-5232" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-5233"><a href="5-1-helper-functions.html#cb16-5233" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5234"><a href="5-1-helper-functions.html#cb16-5234" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5235"><a href="5-1-helper-functions.html#cb16-5235" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5236"><a href="5-1-helper-functions.html#cb16-5236" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-5237"><a href="5-1-helper-functions.html#cb16-5237" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5238"><a href="5-1-helper-functions.html#cb16-5238" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-5239"><a href="5-1-helper-functions.html#cb16-5239" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5240"><a href="5-1-helper-functions.html#cb16-5240" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 3</span></span>
<span id="cb16-5241"><a href="5-1-helper-functions.html#cb16-5241" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-5242"><a href="5-1-helper-functions.html#cb16-5242" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-5243"><a href="5-1-helper-functions.html#cb16-5243" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-5244"><a href="5-1-helper-functions.html#cb16-5244" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-5245"><a href="5-1-helper-functions.html#cb16-5245" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-5246"><a href="5-1-helper-functions.html#cb16-5246" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5247"><a href="5-1-helper-functions.html#cb16-5247" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5248"><a href="5-1-helper-functions.html#cb16-5248" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5249"><a href="5-1-helper-functions.html#cb16-5249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5250"><a href="5-1-helper-functions.html#cb16-5250" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-5251"><a href="5-1-helper-functions.html#cb16-5251" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-5252"><a href="5-1-helper-functions.html#cb16-5252" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-5253"><a href="5-1-helper-functions.html#cb16-5253" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-5254"><a href="5-1-helper-functions.html#cb16-5254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5255"><a href="5-1-helper-functions.html#cb16-5255" aria-hidden="true" tabindex="-1"></a>de_fun_no_ifs_broke <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-5256"><a href="5-1-helper-functions.html#cb16-5256" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-5257"><a href="5-1-helper-functions.html#cb16-5257" aria-hidden="true" tabindex="-1"></a>  <span class="co">#     {</span></span>
<span id="cb16-5258"><a href="5-1-helper-functions.html#cb16-5258" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5259"><a href="5-1-helper-functions.html#cb16-5259" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-5260"><a href="5-1-helper-functions.html#cb16-5260" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5261"><a href="5-1-helper-functions.html#cb16-5261" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-5262"><a href="5-1-helper-functions.html#cb16-5262" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-5263"><a href="5-1-helper-functions.html#cb16-5263" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5264"><a href="5-1-helper-functions.html#cb16-5264" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-5265"><a href="5-1-helper-functions.html#cb16-5265" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-5266"><a href="5-1-helper-functions.html#cb16-5266" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5267"><a href="5-1-helper-functions.html#cb16-5267" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-5268"><a href="5-1-helper-functions.html#cb16-5268" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-5269"><a href="5-1-helper-functions.html#cb16-5269" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5270"><a href="5-1-helper-functions.html#cb16-5270" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-5271"><a href="5-1-helper-functions.html#cb16-5271" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-5272"><a href="5-1-helper-functions.html#cb16-5272" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5273"><a href="5-1-helper-functions.html#cb16-5273" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-5274"><a href="5-1-helper-functions.html#cb16-5274" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-5275"><a href="5-1-helper-functions.html#cb16-5275" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-5276"><a href="5-1-helper-functions.html#cb16-5276" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-5277"><a href="5-1-helper-functions.html#cb16-5277" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-5278"><a href="5-1-helper-functions.html#cb16-5278" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-5279"><a href="5-1-helper-functions.html#cb16-5279" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5280"><a href="5-1-helper-functions.html#cb16-5280" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-5281"><a href="5-1-helper-functions.html#cb16-5281" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5282"><a href="5-1-helper-functions.html#cb16-5282" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-5283"><a href="5-1-helper-functions.html#cb16-5283" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-5284"><a href="5-1-helper-functions.html#cb16-5284" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-5285"><a href="5-1-helper-functions.html#cb16-5285" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-5286"><a href="5-1-helper-functions.html#cb16-5286" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-5287"><a href="5-1-helper-functions.html#cb16-5287" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-5288"><a href="5-1-helper-functions.html#cb16-5288" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-5289"><a href="5-1-helper-functions.html#cb16-5289" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-5290"><a href="5-1-helper-functions.html#cb16-5290" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-5291"><a href="5-1-helper-functions.html#cb16-5291" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-5292"><a href="5-1-helper-functions.html#cb16-5292" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-5293"><a href="5-1-helper-functions.html#cb16-5293" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-5294"><a href="5-1-helper-functions.html#cb16-5294" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-5295"><a href="5-1-helper-functions.html#cb16-5295" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5296"><a href="5-1-helper-functions.html#cb16-5296" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-5297"><a href="5-1-helper-functions.html#cb16-5297" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-5298"><a href="5-1-helper-functions.html#cb16-5298" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-5299"><a href="5-1-helper-functions.html#cb16-5299" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-5300"><a href="5-1-helper-functions.html#cb16-5300" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-5301"><a href="5-1-helper-functions.html#cb16-5301" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-5302"><a href="5-1-helper-functions.html#cb16-5302" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-5303"><a href="5-1-helper-functions.html#cb16-5303" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-5304"><a href="5-1-helper-functions.html#cb16-5304" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-5305"><a href="5-1-helper-functions.html#cb16-5305" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-5306"><a href="5-1-helper-functions.html#cb16-5306" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-5307"><a href="5-1-helper-functions.html#cb16-5307" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-5308"><a href="5-1-helper-functions.html#cb16-5308" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-5309"><a href="5-1-helper-functions.html#cb16-5309" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5310"><a href="5-1-helper-functions.html#cb16-5310" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-5311"><a href="5-1-helper-functions.html#cb16-5311" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>), <span class="fu">c</span>(<span class="dv">2</span>))</span>
<span id="cb16-5312"><a href="5-1-helper-functions.html#cb16-5312" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5313"><a href="5-1-helper-functions.html#cb16-5313" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-5314"><a href="5-1-helper-functions.html#cb16-5314" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5315"><a href="5-1-helper-functions.html#cb16-5315" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-5316"><a href="5-1-helper-functions.html#cb16-5316" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-5317"><a href="5-1-helper-functions.html#cb16-5317" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-5318"><a href="5-1-helper-functions.html#cb16-5318" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-5319"><a href="5-1-helper-functions.html#cb16-5319" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5320"><a href="5-1-helper-functions.html#cb16-5320" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-5321"><a href="5-1-helper-functions.html#cb16-5321" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-5322"><a href="5-1-helper-functions.html#cb16-5322" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-5323"><a href="5-1-helper-functions.html#cb16-5323" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5324"><a href="5-1-helper-functions.html#cb16-5324" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-5325"><a href="5-1-helper-functions.html#cb16-5325" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-5326"><a href="5-1-helper-functions.html#cb16-5326" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5327"><a href="5-1-helper-functions.html#cb16-5327" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-5328"><a href="5-1-helper-functions.html#cb16-5328" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-5329"><a href="5-1-helper-functions.html#cb16-5329" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-5330"><a href="5-1-helper-functions.html#cb16-5330" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-5331"><a href="5-1-helper-functions.html#cb16-5331" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5332"><a href="5-1-helper-functions.html#cb16-5332" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-5333"><a href="5-1-helper-functions.html#cb16-5333" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-5334"><a href="5-1-helper-functions.html#cb16-5334" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-5335"><a href="5-1-helper-functions.html#cb16-5335" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-5336"><a href="5-1-helper-functions.html#cb16-5336" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,income_types))</span>
<span id="cb16-5337"><a href="5-1-helper-functions.html#cb16-5337" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,income_types))</span>
<span id="cb16-5338"><a href="5-1-helper-functions.html#cb16-5338" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,income_types))</span>
<span id="cb16-5339"><a href="5-1-helper-functions.html#cb16-5339" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5340"><a href="5-1-helper-functions.html#cb16-5340" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-5341"><a href="5-1-helper-functions.html#cb16-5341" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-5342"><a href="5-1-helper-functions.html#cb16-5342" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-5343"><a href="5-1-helper-functions.html#cb16-5343" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5344"><a href="5-1-helper-functions.html#cb16-5344" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-5345"><a href="5-1-helper-functions.html#cb16-5345" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-5346"><a href="5-1-helper-functions.html#cb16-5346" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-5347"><a href="5-1-helper-functions.html#cb16-5347" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-5348"><a href="5-1-helper-functions.html#cb16-5348" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5349"><a href="5-1-helper-functions.html#cb16-5349" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5350"><a href="5-1-helper-functions.html#cb16-5350" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-5351"><a href="5-1-helper-functions.html#cb16-5351" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-5352"><a href="5-1-helper-functions.html#cb16-5352" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-5353"><a href="5-1-helper-functions.html#cb16-5353" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5354"><a href="5-1-helper-functions.html#cb16-5354" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(sex <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>sex_types){</span>
<span id="cb16-5355"><a href="5-1-helper-functions.html#cb16-5355" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-5356"><a href="5-1-helper-functions.html#cb16-5356" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-5357"><a href="5-1-helper-functions.html#cb16-5357" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-5358"><a href="5-1-helper-functions.html#cb16-5358" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5359"><a href="5-1-helper-functions.html#cb16-5359" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5360"><a href="5-1-helper-functions.html#cb16-5360" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5361"><a href="5-1-helper-functions.html#cb16-5361" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5362"><a href="5-1-helper-functions.html#cb16-5362" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5363"><a href="5-1-helper-functions.html#cb16-5363" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-5364"><a href="5-1-helper-functions.html#cb16-5364" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5365"><a href="5-1-helper-functions.html#cb16-5365" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5366"><a href="5-1-helper-functions.html#cb16-5366" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5367"><a href="5-1-helper-functions.html#cb16-5367" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-5368"><a href="5-1-helper-functions.html#cb16-5368" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5369"><a href="5-1-helper-functions.html#cb16-5369" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5370"><a href="5-1-helper-functions.html#cb16-5370" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-5371"><a href="5-1-helper-functions.html#cb16-5371" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-5372"><a href="5-1-helper-functions.html#cb16-5372" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-5373"><a href="5-1-helper-functions.html#cb16-5373" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5374"><a href="5-1-helper-functions.html#cb16-5374" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ageIn &lt;- 0</span></span>
<span id="cb16-5375"><a href="5-1-helper-functions.html#cb16-5375" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5376"><a href="5-1-helper-functions.html#cb16-5376" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-5377"><a href="5-1-helper-functions.html#cb16-5377" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-5378"><a href="5-1-helper-functions.html#cb16-5378" aria-hidden="true" tabindex="-1"></a>          <span class="do">## times the proportion of people who will age out</span></span>
<span id="cb16-5379"><a href="5-1-helper-functions.html#cb16-5379" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-5380"><a href="5-1-helper-functions.html#cb16-5380" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-5381"><a href="5-1-helper-functions.html#cb16-5381" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5382"><a href="5-1-helper-functions.html#cb16-5382" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5383"><a href="5-1-helper-functions.html#cb16-5383" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-5384"><a href="5-1-helper-functions.html#cb16-5384" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5385"><a href="5-1-helper-functions.html#cb16-5385" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5386"><a href="5-1-helper-functions.html#cb16-5386" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5387"><a href="5-1-helper-functions.html#cb16-5387" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5388"><a href="5-1-helper-functions.html#cb16-5388" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-5389"><a href="5-1-helper-functions.html#cb16-5389" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5390"><a href="5-1-helper-functions.html#cb16-5390" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5391"><a href="5-1-helper-functions.html#cb16-5391" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-5392"><a href="5-1-helper-functions.html#cb16-5392" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-5393"><a href="5-1-helper-functions.html#cb16-5393" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-5394"><a href="5-1-helper-functions.html#cb16-5394" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &lt; 6){</span></span>
<span id="cb16-5395"><a href="5-1-helper-functions.html#cb16-5395" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-5396"><a href="5-1-helper-functions.html#cb16-5396" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-5397"><a href="5-1-helper-functions.html#cb16-5397" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-5398"><a href="5-1-helper-functions.html#cb16-5398" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-5399"><a href="5-1-helper-functions.html#cb16-5399" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  }</span></span>
<span id="cb16-5400"><a href="5-1-helper-functions.html#cb16-5400" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5401"><a href="5-1-helper-functions.html#cb16-5401" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-5402"><a href="5-1-helper-functions.html#cb16-5402" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5403"><a href="5-1-helper-functions.html#cb16-5403" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-5404"><a href="5-1-helper-functions.html#cb16-5404" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-5405"><a href="5-1-helper-functions.html#cb16-5405" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-5406"><a href="5-1-helper-functions.html#cb16-5406" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-5407"><a href="5-1-helper-functions.html#cb16-5407" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-5408"><a href="5-1-helper-functions.html#cb16-5408" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5409"><a href="5-1-helper-functions.html#cb16-5409" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5410"><a href="5-1-helper-functions.html#cb16-5410" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5411"><a href="5-1-helper-functions.html#cb16-5411" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5412"><a href="5-1-helper-functions.html#cb16-5412" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-5413"><a href="5-1-helper-functions.html#cb16-5413" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-5414"><a href="5-1-helper-functions.html#cb16-5414" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-5415"><a href="5-1-helper-functions.html#cb16-5415" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-5416"><a href="5-1-helper-functions.html#cb16-5416" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5417"><a href="5-1-helper-functions.html#cb16-5417" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-5418"><a href="5-1-helper-functions.html#cb16-5418" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-5419"><a href="5-1-helper-functions.html#cb16-5419" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-5420"><a href="5-1-helper-functions.html#cb16-5420" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5421"><a href="5-1-helper-functions.html#cb16-5421" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-5422"><a href="5-1-helper-functions.html#cb16-5422" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-5423"><a href="5-1-helper-functions.html#cb16-5423" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-5424"><a href="5-1-helper-functions.html#cb16-5424" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5425"><a href="5-1-helper-functions.html#cb16-5425" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5426"><a href="5-1-helper-functions.html#cb16-5426" aria-hidden="true" tabindex="-1"></a>            <span class="do">###if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-5427"><a href="5-1-helper-functions.html#cb16-5427" aria-hidden="true" tabindex="-1"></a>            <span class="do">###   mod &lt;- staging_modifier</span></span>
<span id="cb16-5428"><a href="5-1-helper-functions.html#cb16-5428" aria-hidden="true" tabindex="-1"></a>            <span class="do">### }</span></span>
<span id="cb16-5429"><a href="5-1-helper-functions.html#cb16-5429" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5430"><a href="5-1-helper-functions.html#cb16-5430" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-5431"><a href="5-1-helper-functions.html#cb16-5431" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-5432"><a href="5-1-helper-functions.html#cb16-5432" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-5433"><a href="5-1-helper-functions.html#cb16-5433" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-5434"><a href="5-1-helper-functions.html#cb16-5434" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5435"><a href="5-1-helper-functions.html#cb16-5435" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5436"><a href="5-1-helper-functions.html#cb16-5436" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5437"><a href="5-1-helper-functions.html#cb16-5437" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-5438"><a href="5-1-helper-functions.html#cb16-5438" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5439"><a href="5-1-helper-functions.html#cb16-5439" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5440"><a href="5-1-helper-functions.html#cb16-5440" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5441"><a href="5-1-helper-functions.html#cb16-5441" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5442"><a href="5-1-helper-functions.html#cb16-5442" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-5443"><a href="5-1-helper-functions.html#cb16-5443" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5444"><a href="5-1-helper-functions.html#cb16-5444" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5445"><a href="5-1-helper-functions.html#cb16-5445" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5446"><a href="5-1-helper-functions.html#cb16-5446" aria-hidden="true" tabindex="-1"></a>            <span class="do">###if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-5447"><a href="5-1-helper-functions.html#cb16-5447" aria-hidden="true" tabindex="-1"></a>            <span class="do">###   mod &lt;- staging_modifier</span></span>
<span id="cb16-5448"><a href="5-1-helper-functions.html#cb16-5448" aria-hidden="true" tabindex="-1"></a>            <span class="do">###}</span></span>
<span id="cb16-5449"><a href="5-1-helper-functions.html#cb16-5449" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5450"><a href="5-1-helper-functions.html#cb16-5450" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-5451"><a href="5-1-helper-functions.html#cb16-5451" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5452"><a href="5-1-helper-functions.html#cb16-5452" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5453"><a href="5-1-helper-functions.html#cb16-5453" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5454"><a href="5-1-helper-functions.html#cb16-5454" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-5455"><a href="5-1-helper-functions.html#cb16-5455" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-5456"><a href="5-1-helper-functions.html#cb16-5456" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-5457"><a href="5-1-helper-functions.html#cb16-5457" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-5458"><a href="5-1-helper-functions.html#cb16-5458" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-5459"><a href="5-1-helper-functions.html#cb16-5459" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-5460"><a href="5-1-helper-functions.html#cb16-5460" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5461"><a href="5-1-helper-functions.html#cb16-5461" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-5462"><a href="5-1-helper-functions.html#cb16-5462" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-5463"><a href="5-1-helper-functions.html#cb16-5463" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-5464"><a href="5-1-helper-functions.html#cb16-5464" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5465"><a href="5-1-helper-functions.html#cb16-5465" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5466"><a href="5-1-helper-functions.html#cb16-5466" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5467"><a href="5-1-helper-functions.html#cb16-5467" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-5468"><a href="5-1-helper-functions.html#cb16-5468" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-5469"><a href="5-1-helper-functions.html#cb16-5469" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-5470"><a href="5-1-helper-functions.html#cb16-5470" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5471"><a href="5-1-helper-functions.html#cb16-5471" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5472"><a href="5-1-helper-functions.html#cb16-5472" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-5473"><a href="5-1-helper-functions.html#cb16-5473" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-5474"><a href="5-1-helper-functions.html#cb16-5474" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-5475"><a href="5-1-helper-functions.html#cb16-5475" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5476"><a href="5-1-helper-functions.html#cb16-5476" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-5477"><a href="5-1-helper-functions.html#cb16-5477" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-5478"><a href="5-1-helper-functions.html#cb16-5478" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-5479"><a href="5-1-helper-functions.html#cb16-5479" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-5480"><a href="5-1-helper-functions.html#cb16-5480" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-5481"><a href="5-1-helper-functions.html#cb16-5481" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5482"><a href="5-1-helper-functions.html#cb16-5482" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5483"><a href="5-1-helper-functions.html#cb16-5483" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5484"><a href="5-1-helper-functions.html#cb16-5484" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-5485"><a href="5-1-helper-functions.html#cb16-5485" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5486"><a href="5-1-helper-functions.html#cb16-5486" aria-hidden="true" tabindex="-1"></a>          <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-5487"><a href="5-1-helper-functions.html#cb16-5487" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5488"><a href="5-1-helper-functions.html#cb16-5488" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-5489"><a href="5-1-helper-functions.html#cb16-5489" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5490"><a href="5-1-helper-functions.html#cb16-5490" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-5491"><a href="5-1-helper-functions.html#cb16-5491" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-5492"><a href="5-1-helper-functions.html#cb16-5492" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5493"><a href="5-1-helper-functions.html#cb16-5493" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-5494"><a href="5-1-helper-functions.html#cb16-5494" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5495"><a href="5-1-helper-functions.html#cb16-5495" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-5496"><a href="5-1-helper-functions.html#cb16-5496" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5497"><a href="5-1-helper-functions.html#cb16-5497" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5498"><a href="5-1-helper-functions.html#cb16-5498" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5499"><a href="5-1-helper-functions.html#cb16-5499" aria-hidden="true" tabindex="-1"></a>          <span class="co"># for(from in cig_in[[e_cigarette]]){</span></span>
<span id="cb16-5500"><a href="5-1-helper-functions.html#cb16-5500" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5501"><a href="5-1-helper-functions.html#cb16-5501" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[from,e_cigarette]*rr_e_cigarette_transitions[from,sex,age,1,income])</span></span>
<span id="cb16-5502"><a href="5-1-helper-functions.html#cb16-5502" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5503"><a href="5-1-helper-functions.html#cb16-5503" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-5504"><a href="5-1-helper-functions.html#cb16-5504" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5505"><a href="5-1-helper-functions.html#cb16-5505" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5506"><a href="5-1-helper-functions.html#cb16-5506" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5507"><a href="5-1-helper-functions.html#cb16-5507" aria-hidden="true" tabindex="-1"></a>            <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-5508"><a href="5-1-helper-functions.html#cb16-5508" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5509"><a href="5-1-helper-functions.html#cb16-5509" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5510"><a href="5-1-helper-functions.html#cb16-5510" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5511"><a href="5-1-helper-functions.html#cb16-5511" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-5512"><a href="5-1-helper-functions.html#cb16-5512" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5513"><a href="5-1-helper-functions.html#cb16-5513" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-5514"><a href="5-1-helper-functions.html#cb16-5514" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5515"><a href="5-1-helper-functions.html#cb16-5515" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5516"><a href="5-1-helper-functions.html#cb16-5516" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5517"><a href="5-1-helper-functions.html#cb16-5517" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-5518"><a href="5-1-helper-functions.html#cb16-5518" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5519"><a href="5-1-helper-functions.html#cb16-5519" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5520"><a href="5-1-helper-functions.html#cb16-5520" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5521"><a href="5-1-helper-functions.html#cb16-5521" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5522"><a href="5-1-helper-functions.html#cb16-5522" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5523"><a href="5-1-helper-functions.html#cb16-5523" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-5524"><a href="5-1-helper-functions.html#cb16-5524" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5525"><a href="5-1-helper-functions.html#cb16-5525" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5526"><a href="5-1-helper-functions.html#cb16-5526" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5527"><a href="5-1-helper-functions.html#cb16-5527" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-5528"><a href="5-1-helper-functions.html#cb16-5528" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5529"><a href="5-1-helper-functions.html#cb16-5529" aria-hidden="true" tabindex="-1"></a>          <span class="co">#e_cigaretteOut &lt;-  states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]*rr_e_cigarette_transitions[e_cigarette,sex,age,1,income])</span></span>
<span id="cb16-5530"><a href="5-1-helper-functions.html#cb16-5530" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5531"><a href="5-1-helper-functions.html#cb16-5531" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5532"><a href="5-1-helper-functions.html#cb16-5532" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5533"><a href="5-1-helper-functions.html#cb16-5533" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation</span></span>
<span id="cb16-5534"><a href="5-1-helper-functions.html#cb16-5534" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5535"><a href="5-1-helper-functions.html#cb16-5535" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-5536"><a href="5-1-helper-functions.html#cb16-5536" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5537"><a href="5-1-helper-functions.html#cb16-5537" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5538"><a href="5-1-helper-functions.html#cb16-5538" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5539"><a href="5-1-helper-functions.html#cb16-5539" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5540"><a href="5-1-helper-functions.html#cb16-5540" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5541"><a href="5-1-helper-functions.html#cb16-5541" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-5542"><a href="5-1-helper-functions.html#cb16-5542" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5543"><a href="5-1-helper-functions.html#cb16-5543" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5544"><a href="5-1-helper-functions.html#cb16-5544" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5545"><a href="5-1-helper-functions.html#cb16-5545" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5546"><a href="5-1-helper-functions.html#cb16-5546" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5547"><a href="5-1-helper-functions.html#cb16-5547" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-5548"><a href="5-1-helper-functions.html#cb16-5548" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5549"><a href="5-1-helper-functions.html#cb16-5549" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5550"><a href="5-1-helper-functions.html#cb16-5550" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5551"><a href="5-1-helper-functions.html#cb16-5551" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-5552"><a href="5-1-helper-functions.html#cb16-5552" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5553"><a href="5-1-helper-functions.html#cb16-5553" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-5554"><a href="5-1-helper-functions.html#cb16-5554" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5555"><a href="5-1-helper-functions.html#cb16-5555" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 1</span></span>
<span id="cb16-5556"><a href="5-1-helper-functions.html#cb16-5556" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-5557"><a href="5-1-helper-functions.html#cb16-5557" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5558"><a href="5-1-helper-functions.html#cb16-5558" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5559"><a href="5-1-helper-functions.html#cb16-5559" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5560"><a href="5-1-helper-functions.html#cb16-5560" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-5561"><a href="5-1-helper-functions.html#cb16-5561" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5562"><a href="5-1-helper-functions.html#cb16-5562" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5563"><a href="5-1-helper-functions.html#cb16-5563" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5564"><a href="5-1-helper-functions.html#cb16-5564" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-5565"><a href="5-1-helper-functions.html#cb16-5565" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5566"><a href="5-1-helper-functions.html#cb16-5566" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5567"><a href="5-1-helper-functions.html#cb16-5567" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-5568"><a href="5-1-helper-functions.html#cb16-5568" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-5569"><a href="5-1-helper-functions.html#cb16-5569" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-5570"><a href="5-1-helper-functions.html#cb16-5570" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5571"><a href="5-1-helper-functions.html#cb16-5571" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageIn &lt;- 0</span></span>
<span id="cb16-5572"><a href="5-1-helper-functions.html#cb16-5572" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5573"><a href="5-1-helper-functions.html#cb16-5573" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  if(age &gt; 1){</span></span>
<span id="cb16-5574"><a href="5-1-helper-functions.html#cb16-5574" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-5575"><a href="5-1-helper-functions.html#cb16-5575" aria-hidden="true" tabindex="-1"></a>          <span class="do">## times the proportion of people who will age out</span></span>
<span id="cb16-5576"><a href="5-1-helper-functions.html#cb16-5576" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-5577"><a href="5-1-helper-functions.html#cb16-5577" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   }else if(age == 1){</span></span>
<span id="cb16-5578"><a href="5-1-helper-functions.html#cb16-5578" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5579"><a href="5-1-helper-functions.html#cb16-5579" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5580"><a href="5-1-helper-functions.html#cb16-5580" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-5581"><a href="5-1-helper-functions.html#cb16-5581" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5582"><a href="5-1-helper-functions.html#cb16-5582" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5583"><a href="5-1-helper-functions.html#cb16-5583" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  }</span></span>
<span id="cb16-5584"><a href="5-1-helper-functions.html#cb16-5584" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5585"><a href="5-1-helper-functions.html#cb16-5585" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-5586"><a href="5-1-helper-functions.html#cb16-5586" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5587"><a href="5-1-helper-functions.html#cb16-5587" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5588"><a href="5-1-helper-functions.html#cb16-5588" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-5589"><a href="5-1-helper-functions.html#cb16-5589" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-5590"><a href="5-1-helper-functions.html#cb16-5590" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-5591"><a href="5-1-helper-functions.html#cb16-5591" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-5592"><a href="5-1-helper-functions.html#cb16-5592" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-5593"><a href="5-1-helper-functions.html#cb16-5593" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-5594"><a href="5-1-helper-functions.html#cb16-5594" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-5595"><a href="5-1-helper-functions.html#cb16-5595" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-5596"><a href="5-1-helper-functions.html#cb16-5596" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-5597"><a href="5-1-helper-functions.html#cb16-5597" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5598"><a href="5-1-helper-functions.html#cb16-5598" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-5599"><a href="5-1-helper-functions.html#cb16-5599" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5600"><a href="5-1-helper-functions.html#cb16-5600" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-5601"><a href="5-1-helper-functions.html#cb16-5601" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-5602"><a href="5-1-helper-functions.html#cb16-5602" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-5603"><a href="5-1-helper-functions.html#cb16-5603" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-5604"><a href="5-1-helper-functions.html#cb16-5604" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-5605"><a href="5-1-helper-functions.html#cb16-5605" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5606"><a href="5-1-helper-functions.html#cb16-5606" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5607"><a href="5-1-helper-functions.html#cb16-5607" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5608"><a href="5-1-helper-functions.html#cb16-5608" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5609"><a href="5-1-helper-functions.html#cb16-5609" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-5610"><a href="5-1-helper-functions.html#cb16-5610" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-5611"><a href="5-1-helper-functions.html#cb16-5611" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-5612"><a href="5-1-helper-functions.html#cb16-5612" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-5613"><a href="5-1-helper-functions.html#cb16-5613" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5614"><a href="5-1-helper-functions.html#cb16-5614" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-5615"><a href="5-1-helper-functions.html#cb16-5615" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-5616"><a href="5-1-helper-functions.html#cb16-5616" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-5617"><a href="5-1-helper-functions.html#cb16-5617" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5618"><a href="5-1-helper-functions.html#cb16-5618" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-5619"><a href="5-1-helper-functions.html#cb16-5619" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-5620"><a href="5-1-helper-functions.html#cb16-5620" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-5621"><a href="5-1-helper-functions.html#cb16-5621" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5622"><a href="5-1-helper-functions.html#cb16-5622" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5623"><a href="5-1-helper-functions.html#cb16-5623" aria-hidden="true" tabindex="-1"></a>            <span class="do">### if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-5624"><a href="5-1-helper-functions.html#cb16-5624" aria-hidden="true" tabindex="-1"></a>            <span class="do">###  mod &lt;- staging_modifier</span></span>
<span id="cb16-5625"><a href="5-1-helper-functions.html#cb16-5625" aria-hidden="true" tabindex="-1"></a>            <span class="do">###}</span></span>
<span id="cb16-5626"><a href="5-1-helper-functions.html#cb16-5626" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5627"><a href="5-1-helper-functions.html#cb16-5627" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-5628"><a href="5-1-helper-functions.html#cb16-5628" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-5629"><a href="5-1-helper-functions.html#cb16-5629" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-5630"><a href="5-1-helper-functions.html#cb16-5630" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-5631"><a href="5-1-helper-functions.html#cb16-5631" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5632"><a href="5-1-helper-functions.html#cb16-5632" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5633"><a href="5-1-helper-functions.html#cb16-5633" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5634"><a href="5-1-helper-functions.html#cb16-5634" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-5635"><a href="5-1-helper-functions.html#cb16-5635" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5636"><a href="5-1-helper-functions.html#cb16-5636" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5637"><a href="5-1-helper-functions.html#cb16-5637" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5638"><a href="5-1-helper-functions.html#cb16-5638" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5639"><a href="5-1-helper-functions.html#cb16-5639" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-5640"><a href="5-1-helper-functions.html#cb16-5640" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5641"><a href="5-1-helper-functions.html#cb16-5641" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5642"><a href="5-1-helper-functions.html#cb16-5642" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5643"><a href="5-1-helper-functions.html#cb16-5643" aria-hidden="true" tabindex="-1"></a>            <span class="do">### if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-5644"><a href="5-1-helper-functions.html#cb16-5644" aria-hidden="true" tabindex="-1"></a>            <span class="do">###  mod &lt;- staging_modifier</span></span>
<span id="cb16-5645"><a href="5-1-helper-functions.html#cb16-5645" aria-hidden="true" tabindex="-1"></a>            <span class="do">###  }</span></span>
<span id="cb16-5646"><a href="5-1-helper-functions.html#cb16-5646" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5647"><a href="5-1-helper-functions.html#cb16-5647" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-5648"><a href="5-1-helper-functions.html#cb16-5648" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5649"><a href="5-1-helper-functions.html#cb16-5649" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5650"><a href="5-1-helper-functions.html#cb16-5650" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5651"><a href="5-1-helper-functions.html#cb16-5651" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-5652"><a href="5-1-helper-functions.html#cb16-5652" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-5653"><a href="5-1-helper-functions.html#cb16-5653" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5654"><a href="5-1-helper-functions.html#cb16-5654" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5655"><a href="5-1-helper-functions.html#cb16-5655" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5656"><a href="5-1-helper-functions.html#cb16-5656" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-5657"><a href="5-1-helper-functions.html#cb16-5657" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-5658"><a href="5-1-helper-functions.html#cb16-5658" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-5659"><a href="5-1-helper-functions.html#cb16-5659" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-5660"><a href="5-1-helper-functions.html#cb16-5660" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-5661"><a href="5-1-helper-functions.html#cb16-5661" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-5662"><a href="5-1-helper-functions.html#cb16-5662" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5663"><a href="5-1-helper-functions.html#cb16-5663" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-5664"><a href="5-1-helper-functions.html#cb16-5664" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-5665"><a href="5-1-helper-functions.html#cb16-5665" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-5666"><a href="5-1-helper-functions.html#cb16-5666" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5667"><a href="5-1-helper-functions.html#cb16-5667" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5668"><a href="5-1-helper-functions.html#cb16-5668" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5669"><a href="5-1-helper-functions.html#cb16-5669" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-5670"><a href="5-1-helper-functions.html#cb16-5670" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-5671"><a href="5-1-helper-functions.html#cb16-5671" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-5672"><a href="5-1-helper-functions.html#cb16-5672" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5673"><a href="5-1-helper-functions.html#cb16-5673" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5674"><a href="5-1-helper-functions.html#cb16-5674" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-5675"><a href="5-1-helper-functions.html#cb16-5675" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-5676"><a href="5-1-helper-functions.html#cb16-5676" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-5677"><a href="5-1-helper-functions.html#cb16-5677" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5678"><a href="5-1-helper-functions.html#cb16-5678" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-5679"><a href="5-1-helper-functions.html#cb16-5679" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-5680"><a href="5-1-helper-functions.html#cb16-5680" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-5681"><a href="5-1-helper-functions.html#cb16-5681" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-5682"><a href="5-1-helper-functions.html#cb16-5682" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-5683"><a href="5-1-helper-functions.html#cb16-5683" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5684"><a href="5-1-helper-functions.html#cb16-5684" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5685"><a href="5-1-helper-functions.html#cb16-5685" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5686"><a href="5-1-helper-functions.html#cb16-5686" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-5687"><a href="5-1-helper-functions.html#cb16-5687" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5688"><a href="5-1-helper-functions.html#cb16-5688" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5689"><a href="5-1-helper-functions.html#cb16-5689" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5690"><a href="5-1-helper-functions.html#cb16-5690" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-5691"><a href="5-1-helper-functions.html#cb16-5691" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5692"><a href="5-1-helper-functions.html#cb16-5692" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-5693"><a href="5-1-helper-functions.html#cb16-5693" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5694"><a href="5-1-helper-functions.html#cb16-5694" aria-hidden="true" tabindex="-1"></a>          <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5695"><a href="5-1-helper-functions.html#cb16-5695" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5696"><a href="5-1-helper-functions.html#cb16-5696" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-5697"><a href="5-1-helper-functions.html#cb16-5697" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5698"><a href="5-1-helper-functions.html#cb16-5698" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-5699"><a href="5-1-helper-functions.html#cb16-5699" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5700"><a href="5-1-helper-functions.html#cb16-5700" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-5701"><a href="5-1-helper-functions.html#cb16-5701" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-5702"><a href="5-1-helper-functions.html#cb16-5702" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5703"><a href="5-1-helper-functions.html#cb16-5703" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-5704"><a href="5-1-helper-functions.html#cb16-5704" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5705"><a href="5-1-helper-functions.html#cb16-5705" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-5706"><a href="5-1-helper-functions.html#cb16-5706" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5707"><a href="5-1-helper-functions.html#cb16-5707" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5708"><a href="5-1-helper-functions.html#cb16-5708" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5709"><a href="5-1-helper-functions.html#cb16-5709" aria-hidden="true" tabindex="-1"></a>          <span class="co"># for(from in cig_in[[e_cigarette]]){</span></span>
<span id="cb16-5710"><a href="5-1-helper-functions.html#cb16-5710" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5711"><a href="5-1-helper-functions.html#cb16-5711" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[from,e_cigarette]*rr_e_cigarette_transitions[from,sex,age,2,income])</span></span>
<span id="cb16-5712"><a href="5-1-helper-functions.html#cb16-5712" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5713"><a href="5-1-helper-functions.html#cb16-5713" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-5714"><a href="5-1-helper-functions.html#cb16-5714" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5715"><a href="5-1-helper-functions.html#cb16-5715" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5716"><a href="5-1-helper-functions.html#cb16-5716" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5717"><a href="5-1-helper-functions.html#cb16-5717" aria-hidden="true" tabindex="-1"></a>            <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-5718"><a href="5-1-helper-functions.html#cb16-5718" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5719"><a href="5-1-helper-functions.html#cb16-5719" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5720"><a href="5-1-helper-functions.html#cb16-5720" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5721"><a href="5-1-helper-functions.html#cb16-5721" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-5722"><a href="5-1-helper-functions.html#cb16-5722" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5723"><a href="5-1-helper-functions.html#cb16-5723" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5724"><a href="5-1-helper-functions.html#cb16-5724" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5725"><a href="5-1-helper-functions.html#cb16-5725" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5726"><a href="5-1-helper-functions.html#cb16-5726" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5727"><a href="5-1-helper-functions.html#cb16-5727" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5728"><a href="5-1-helper-functions.html#cb16-5728" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5729"><a href="5-1-helper-functions.html#cb16-5729" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5730"><a href="5-1-helper-functions.html#cb16-5730" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5731"><a href="5-1-helper-functions.html#cb16-5731" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5732"><a href="5-1-helper-functions.html#cb16-5732" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5733"><a href="5-1-helper-functions.html#cb16-5733" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5734"><a href="5-1-helper-functions.html#cb16-5734" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5735"><a href="5-1-helper-functions.html#cb16-5735" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5736"><a href="5-1-helper-functions.html#cb16-5736" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5737"><a href="5-1-helper-functions.html#cb16-5737" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-5738"><a href="5-1-helper-functions.html#cb16-5738" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5739"><a href="5-1-helper-functions.html#cb16-5739" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5740"><a href="5-1-helper-functions.html#cb16-5740" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5741"><a href="5-1-helper-functions.html#cb16-5741" aria-hidden="true" tabindex="-1"></a>          <span class="co">#e_cigaretteOut &lt;- states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]*rr_e_cigarette_transitions[e_cigarette,sex,age,2,income])</span></span>
<span id="cb16-5742"><a href="5-1-helper-functions.html#cb16-5742" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5743"><a href="5-1-helper-functions.html#cb16-5743" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5744"><a href="5-1-helper-functions.html#cb16-5744" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5745"><a href="5-1-helper-functions.html#cb16-5745" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation</span></span>
<span id="cb16-5746"><a href="5-1-helper-functions.html#cb16-5746" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5747"><a href="5-1-helper-functions.html#cb16-5747" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5748"><a href="5-1-helper-functions.html#cb16-5748" aria-hidden="true" tabindex="-1"></a>            <span class="co">#   </span></span>
<span id="cb16-5749"><a href="5-1-helper-functions.html#cb16-5749" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5750"><a href="5-1-helper-functions.html#cb16-5750" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5751"><a href="5-1-helper-functions.html#cb16-5751" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5752"><a href="5-1-helper-functions.html#cb16-5752" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5753"><a href="5-1-helper-functions.html#cb16-5753" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5754"><a href="5-1-helper-functions.html#cb16-5754" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5755"><a href="5-1-helper-functions.html#cb16-5755" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5756"><a href="5-1-helper-functions.html#cb16-5756" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5757"><a href="5-1-helper-functions.html#cb16-5757" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5758"><a href="5-1-helper-functions.html#cb16-5758" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5759"><a href="5-1-helper-functions.html#cb16-5759" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-5760"><a href="5-1-helper-functions.html#cb16-5760" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5761"><a href="5-1-helper-functions.html#cb16-5761" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5762"><a href="5-1-helper-functions.html#cb16-5762" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5763"><a href="5-1-helper-functions.html#cb16-5763" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-5764"><a href="5-1-helper-functions.html#cb16-5764" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5765"><a href="5-1-helper-functions.html#cb16-5765" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-5766"><a href="5-1-helper-functions.html#cb16-5766" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5767"><a href="5-1-helper-functions.html#cb16-5767" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 2</span></span>
<span id="cb16-5768"><a href="5-1-helper-functions.html#cb16-5768" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-5769"><a href="5-1-helper-functions.html#cb16-5769" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5770"><a href="5-1-helper-functions.html#cb16-5770" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5771"><a href="5-1-helper-functions.html#cb16-5771" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-5772"><a href="5-1-helper-functions.html#cb16-5772" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5773"><a href="5-1-helper-functions.html#cb16-5773" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5774"><a href="5-1-helper-functions.html#cb16-5774" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5775"><a href="5-1-helper-functions.html#cb16-5775" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age In</span></span>
<span id="cb16-5776"><a href="5-1-helper-functions.html#cb16-5776" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5777"><a href="5-1-helper-functions.html#cb16-5777" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5778"><a href="5-1-helper-functions.html#cb16-5778" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-5779"><a href="5-1-helper-functions.html#cb16-5779" aria-hidden="true" tabindex="-1"></a>          <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-5780"><a href="5-1-helper-functions.html#cb16-5780" aria-hidden="true" tabindex="-1"></a>          <span class="do">## All other age groups</span></span>
<span id="cb16-5781"><a href="5-1-helper-functions.html#cb16-5781" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5782"><a href="5-1-helper-functions.html#cb16-5782" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  ageIn &lt;- 0</span></span>
<span id="cb16-5783"><a href="5-1-helper-functions.html#cb16-5783" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5784"><a href="5-1-helper-functions.html#cb16-5784" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-5785"><a href="5-1-helper-functions.html#cb16-5785" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-5786"><a href="5-1-helper-functions.html#cb16-5786" aria-hidden="true" tabindex="-1"></a>          <span class="do">## times the proportion of people who will age out</span></span>
<span id="cb16-5787"><a href="5-1-helper-functions.html#cb16-5787" aria-hidden="true" tabindex="-1"></a>          ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span>, e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age]</span>
<span id="cb16-5788"><a href="5-1-helper-functions.html#cb16-5788" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  }#else if(age == 1){</span></span>
<span id="cb16-5789"><a href="5-1-helper-functions.html#cb16-5789" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5790"><a href="5-1-helper-functions.html#cb16-5790" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5791"><a href="5-1-helper-functions.html#cb16-5791" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-5792"><a href="5-1-helper-functions.html#cb16-5792" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5793"><a href="5-1-helper-functions.html#cb16-5793" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5794"><a href="5-1-helper-functions.html#cb16-5794" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-5795"><a href="5-1-helper-functions.html#cb16-5795" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5796"><a href="5-1-helper-functions.html#cb16-5796" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Age Out</span></span>
<span id="cb16-5797"><a href="5-1-helper-functions.html#cb16-5797" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5798"><a href="5-1-helper-functions.html#cb16-5798" aria-hidden="true" tabindex="-1"></a>          <span class="do">##</span></span>
<span id="cb16-5799"><a href="5-1-helper-functions.html#cb16-5799" aria-hidden="true" tabindex="-1"></a>          <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-5800"><a href="5-1-helper-functions.html#cb16-5800" aria-hidden="true" tabindex="-1"></a>          <span class="do">## People in the oldest age group (age == 6) can&#39;t age out -- which is accounted for by age_transitions</span></span>
<span id="cb16-5801"><a href="5-1-helper-functions.html#cb16-5801" aria-hidden="true" tabindex="-1"></a>          <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-5802"><a href="5-1-helper-functions.html#cb16-5802" aria-hidden="true" tabindex="-1"></a>          <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-5803"><a href="5-1-helper-functions.html#cb16-5803" aria-hidden="true" tabindex="-1"></a>          <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-5804"><a href="5-1-helper-functions.html#cb16-5804" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-5805"><a href="5-1-helper-functions.html#cb16-5805" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-5806"><a href="5-1-helper-functions.html#cb16-5806" aria-hidden="true" tabindex="-1"></a>          ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-5807"><a href="5-1-helper-functions.html#cb16-5807" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5808"><a href="5-1-helper-functions.html#cb16-5808" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5809"><a href="5-1-helper-functions.html#cb16-5809" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income In</span></span>
<span id="cb16-5810"><a href="5-1-helper-functions.html#cb16-5810" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5811"><a href="5-1-helper-functions.html#cb16-5811" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-5812"><a href="5-1-helper-functions.html#cb16-5812" aria-hidden="true" tabindex="-1"></a>          <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-5813"><a href="5-1-helper-functions.html#cb16-5813" aria-hidden="true" tabindex="-1"></a>          <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-5814"><a href="5-1-helper-functions.html#cb16-5814" aria-hidden="true" tabindex="-1"></a>          <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-5815"><a href="5-1-helper-functions.html#cb16-5815" aria-hidden="true" tabindex="-1"></a>          <span class="do">## can transition into X from</span></span>
<span id="cb16-5816"><a href="5-1-helper-functions.html#cb16-5816" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5817"><a href="5-1-helper-functions.html#cb16-5817" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5818"><a href="5-1-helper-functions.html#cb16-5818" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5819"><a href="5-1-helper-functions.html#cb16-5819" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5820"><a href="5-1-helper-functions.html#cb16-5820" aria-hidden="true" tabindex="-1"></a>          <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-5821"><a href="5-1-helper-functions.html#cb16-5821" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-5822"><a href="5-1-helper-functions.html#cb16-5822" aria-hidden="true" tabindex="-1"></a>          <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-5823"><a href="5-1-helper-functions.html#cb16-5823" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_sources[[income]]){</span>
<span id="cb16-5824"><a href="5-1-helper-functions.html#cb16-5824" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5825"><a href="5-1-helper-functions.html#cb16-5825" aria-hidden="true" tabindex="-1"></a>            <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-5826"><a href="5-1-helper-functions.html#cb16-5826" aria-hidden="true" tabindex="-1"></a>            <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-5827"><a href="5-1-helper-functions.html#cb16-5827" aria-hidden="true" tabindex="-1"></a>            <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-5828"><a href="5-1-helper-functions.html#cb16-5828" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5829"><a href="5-1-helper-functions.html#cb16-5829" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-5830"><a href="5-1-helper-functions.html#cb16-5830" aria-hidden="true" tabindex="-1"></a>            <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-5831"><a href="5-1-helper-functions.html#cb16-5831" aria-hidden="true" tabindex="-1"></a>            <span class="do">## is the same</span></span>
<span id="cb16-5832"><a href="5-1-helper-functions.html#cb16-5832" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5833"><a href="5-1-helper-functions.html#cb16-5833" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-5834"><a href="5-1-helper-functions.html#cb16-5834" aria-hidden="true" tabindex="-1"></a>            <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-5835"><a href="5-1-helper-functions.html#cb16-5835" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-5836"><a href="5-1-helper-functions.html#cb16-5836" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5837"><a href="5-1-helper-functions.html#cb16-5837" aria-hidden="true" tabindex="-1"></a>            <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-5838"><a href="5-1-helper-functions.html#cb16-5838" aria-hidden="true" tabindex="-1"></a>            <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-5839"><a href="5-1-helper-functions.html#cb16-5839" aria-hidden="true" tabindex="-1"></a>            <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-5840"><a href="5-1-helper-functions.html#cb16-5840" aria-hidden="true" tabindex="-1"></a>            incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-5841"><a href="5-1-helper-functions.html#cb16-5841" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5842"><a href="5-1-helper-functions.html#cb16-5842" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5843"><a href="5-1-helper-functions.html#cb16-5843" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5844"><a href="5-1-helper-functions.html#cb16-5844" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Income Out</span></span>
<span id="cb16-5845"><a href="5-1-helper-functions.html#cb16-5845" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5846"><a href="5-1-helper-functions.html#cb16-5846" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5847"><a href="5-1-helper-functions.html#cb16-5847" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5848"><a href="5-1-helper-functions.html#cb16-5848" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5849"><a href="5-1-helper-functions.html#cb16-5849" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span>(income_level <span class="cf">in</span> income_transition_landings[[income]]){</span>
<span id="cb16-5850"><a href="5-1-helper-functions.html#cb16-5850" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5851"><a href="5-1-helper-functions.html#cb16-5851" aria-hidden="true" tabindex="-1"></a>            mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-5852"><a href="5-1-helper-functions.html#cb16-5852" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5853"><a href="5-1-helper-functions.html#cb16-5853" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-5854"><a href="5-1-helper-functions.html#cb16-5854" aria-hidden="true" tabindex="-1"></a>            <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-5855"><a href="5-1-helper-functions.html#cb16-5855" aria-hidden="true" tabindex="-1"></a>            <span class="do">##}</span></span>
<span id="cb16-5856"><a href="5-1-helper-functions.html#cb16-5856" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5857"><a href="5-1-helper-functions.html#cb16-5857" aria-hidden="true" tabindex="-1"></a>            incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-5858"><a href="5-1-helper-functions.html#cb16-5858" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5859"><a href="5-1-helper-functions.html#cb16-5859" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5860"><a href="5-1-helper-functions.html#cb16-5860" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5861"><a href="5-1-helper-functions.html#cb16-5861" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5862"><a href="5-1-helper-functions.html#cb16-5862" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Income Out</span></span>
<span id="cb16-5863"><a href="5-1-helper-functions.html#cb16-5863" aria-hidden="true" tabindex="-1"></a>          <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-5864"><a href="5-1-helper-functions.html#cb16-5864" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-5865"><a href="5-1-helper-functions.html#cb16-5865" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-5866"><a href="5-1-helper-functions.html#cb16-5866" aria-hidden="true" tabindex="-1"></a>          <span class="co"># </span></span>
<span id="cb16-5867"><a href="5-1-helper-functions.html#cb16-5867" aria-hidden="true" tabindex="-1"></a>          <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-5868"><a href="5-1-helper-functions.html#cb16-5868" aria-hidden="true" tabindex="-1"></a>          <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-5869"><a href="5-1-helper-functions.html#cb16-5869" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-5870"><a href="5-1-helper-functions.html#cb16-5870" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-5871"><a href="5-1-helper-functions.html#cb16-5871" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-5872"><a href="5-1-helper-functions.html#cb16-5872" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }else{</span></span>
<span id="cb16-5873"><a href="5-1-helper-functions.html#cb16-5873" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5874"><a href="5-1-helper-functions.html#cb16-5874" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-5875"><a href="5-1-helper-functions.html#cb16-5875" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-5876"><a href="5-1-helper-functions.html#cb16-5876" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-5877"><a href="5-1-helper-functions.html#cb16-5877" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5878"><a href="5-1-helper-functions.html#cb16-5878" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5879"><a href="5-1-helper-functions.html#cb16-5879" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5880"><a href="5-1-helper-functions.html#cb16-5880" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-5881"><a href="5-1-helper-functions.html#cb16-5881" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income level changes</span></span>
<span id="cb16-5882"><a href="5-1-helper-functions.html#cb16-5882" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-5883"><a href="5-1-helper-functions.html#cb16-5883" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ##</span></span>
<span id="cb16-5884"><a href="5-1-helper-functions.html#cb16-5884" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5885"><a href="5-1-helper-functions.html#cb16-5885" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-5886"><a href="5-1-helper-functions.html#cb16-5886" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-5887"><a href="5-1-helper-functions.html#cb16-5887" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-5888"><a href="5-1-helper-functions.html#cb16-5888" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5889"><a href="5-1-helper-functions.html#cb16-5889" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-5890"><a href="5-1-helper-functions.html#cb16-5890" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-5891"><a href="5-1-helper-functions.html#cb16-5891" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-5892"><a href="5-1-helper-functions.html#cb16-5892" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-5893"><a href="5-1-helper-functions.html#cb16-5893" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-5894"><a href="5-1-helper-functions.html#cb16-5894" aria-hidden="true" tabindex="-1"></a>          <span class="co">#   </span></span>
<span id="cb16-5895"><a href="5-1-helper-functions.html#cb16-5895" aria-hidden="true" tabindex="-1"></a>          <span class="co"># }</span></span>
<span id="cb16-5896"><a href="5-1-helper-functions.html#cb16-5896" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5897"><a href="5-1-helper-functions.html#cb16-5897" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Cigarette In</span></span>
<span id="cb16-5898"><a href="5-1-helper-functions.html#cb16-5898" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5899"><a href="5-1-helper-functions.html#cb16-5899" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5900"><a href="5-1-helper-functions.html#cb16-5900" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5901"><a href="5-1-helper-functions.html#cb16-5901" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-5902"><a href="5-1-helper-functions.html#cb16-5902" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5903"><a href="5-1-helper-functions.html#cb16-5903" aria-hidden="true" tabindex="-1"></a>          cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-5904"><a href="5-1-helper-functions.html#cb16-5904" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5905"><a href="5-1-helper-functions.html#cb16-5905" aria-hidden="true" tabindex="-1"></a>          <span class="do">## cigarette Out</span></span>
<span id="cb16-5906"><a href="5-1-helper-functions.html#cb16-5906" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5907"><a href="5-1-helper-functions.html#cb16-5907" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-5908"><a href="5-1-helper-functions.html#cb16-5908" aria-hidden="true" tabindex="-1"></a>          cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-5909"><a href="5-1-helper-functions.html#cb16-5909" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5910"><a href="5-1-helper-functions.html#cb16-5910" aria-hidden="true" tabindex="-1"></a>          <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-5911"><a href="5-1-helper-functions.html#cb16-5911" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5912"><a href="5-1-helper-functions.html#cb16-5912" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette in</span></span>
<span id="cb16-5913"><a href="5-1-helper-functions.html#cb16-5913" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5914"><a href="5-1-helper-functions.html#cb16-5914" aria-hidden="true" tabindex="-1"></a>          e_cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5915"><a href="5-1-helper-functions.html#cb16-5915" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5916"><a href="5-1-helper-functions.html#cb16-5916" aria-hidden="true" tabindex="-1"></a>          <span class="co"># for(from in cig_in[[e_cigarette]]){</span></span>
<span id="cb16-5917"><a href="5-1-helper-functions.html#cb16-5917" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5918"><a href="5-1-helper-functions.html#cb16-5918" aria-hidden="true" tabindex="-1"></a>          <span class="co">#  e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[from,e_cigarette]*rr_e_cigarette_transitions[from,sex,age,3,income])</span></span>
<span id="cb16-5919"><a href="5-1-helper-functions.html#cb16-5919" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5920"><a href="5-1-helper-functions.html#cb16-5920" aria-hidden="true" tabindex="-1"></a>          <span class="co">#}</span></span>
<span id="cb16-5921"><a href="5-1-helper-functions.html#cb16-5921" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5922"><a href="5-1-helper-functions.html#cb16-5922" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5923"><a href="5-1-helper-functions.html#cb16-5923" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5924"><a href="5-1-helper-functions.html#cb16-5924" aria-hidden="true" tabindex="-1"></a>            <span class="do">## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-5925"><a href="5-1-helper-functions.html#cb16-5925" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5926"><a href="5-1-helper-functions.html#cb16-5926" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5927"><a href="5-1-helper-functions.html#cb16-5927" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5928"><a href="5-1-helper-functions.html#cb16-5928" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation 1 - 2</span></span>
<span id="cb16-5929"><a href="5-1-helper-functions.html#cb16-5929" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5930"><a href="5-1-helper-functions.html#cb16-5930" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5931"><a href="5-1-helper-functions.html#cb16-5931" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5932"><a href="5-1-helper-functions.html#cb16-5932" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5933"><a href="5-1-helper-functions.html#cb16-5933" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5934"><a href="5-1-helper-functions.html#cb16-5934" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5935"><a href="5-1-helper-functions.html#cb16-5935" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5936"><a href="5-1-helper-functions.html#cb16-5936" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5937"><a href="5-1-helper-functions.html#cb16-5937" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5938"><a href="5-1-helper-functions.html#cb16-5938" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5939"><a href="5-1-helper-functions.html#cb16-5939" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5940"><a href="5-1-helper-functions.html#cb16-5940" aria-hidden="true" tabindex="-1"></a>            e_cigaretteIn <span class="ot">&lt;-</span> e_cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5941"><a href="5-1-helper-functions.html#cb16-5941" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5942"><a href="5-1-helper-functions.html#cb16-5942" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5943"><a href="5-1-helper-functions.html#cb16-5943" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5944"><a href="5-1-helper-functions.html#cb16-5944" aria-hidden="true" tabindex="-1"></a>          <span class="do">## e_cigarette out</span></span>
<span id="cb16-5945"><a href="5-1-helper-functions.html#cb16-5945" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5946"><a href="5-1-helper-functions.html#cb16-5946" aria-hidden="true" tabindex="-1"></a>          <span class="co">#e_cigaretteOut &lt;- states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]*rr_e_cigarette_transitions[e_cigarette,sex,age,3,income])</span></span>
<span id="cb16-5947"><a href="5-1-helper-functions.html#cb16-5947" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5948"><a href="5-1-helper-functions.html#cb16-5948" aria-hidden="true" tabindex="-1"></a>          e_cigaretteOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-5949"><a href="5-1-helper-functions.html#cb16-5949" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5950"><a href="5-1-helper-functions.html#cb16-5950" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb16-5951"><a href="5-1-helper-functions.html#cb16-5951" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5952"><a href="5-1-helper-functions.html#cb16-5952" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for initiation</span></span>
<span id="cb16-5953"><a href="5-1-helper-functions.html#cb16-5953" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5954"><a href="5-1-helper-functions.html#cb16-5954" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5955"><a href="5-1-helper-functions.html#cb16-5955" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5956"><a href="5-1-helper-functions.html#cb16-5956" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">2</span>){</span>
<span id="cb16-5957"><a href="5-1-helper-functions.html#cb16-5957" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5958"><a href="5-1-helper-functions.html#cb16-5958" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for cessation</span></span>
<span id="cb16-5959"><a href="5-1-helper-functions.html#cb16-5959" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5960"><a href="5-1-helper-functions.html#cb16-5960" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5961"><a href="5-1-helper-functions.html#cb16-5961" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5962"><a href="5-1-helper-functions.html#cb16-5962" aria-hidden="true" tabindex="-1"></a>          }<span class="cf">else</span> <span class="cf">if</span>(e_cigarette <span class="sc">==</span> <span class="dv">3</span>){</span>
<span id="cb16-5963"><a href="5-1-helper-functions.html#cb16-5963" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5964"><a href="5-1-helper-functions.html#cb16-5964" aria-hidden="true" tabindex="-1"></a>            <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-5965"><a href="5-1-helper-functions.html#cb16-5965" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5966"><a href="5-1-helper-functions.html#cb16-5966" aria-hidden="true" tabindex="-1"></a>            e_cigaretteOut <span class="ot">&lt;-</span> e_cigaretteOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-5967"><a href="5-1-helper-functions.html#cb16-5967" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb16-5968"><a href="5-1-helper-functions.html#cb16-5968" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb16-5969"><a href="5-1-helper-functions.html#cb16-5969" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5970"><a href="5-1-helper-functions.html#cb16-5970" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Death</span></span>
<span id="cb16-5971"><a href="5-1-helper-functions.html#cb16-5971" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5972"><a href="5-1-helper-functions.html#cb16-5972" aria-hidden="true" tabindex="-1"></a>          death <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="do">## not implemented yet</span></span>
<span id="cb16-5973"><a href="5-1-helper-functions.html#cb16-5973" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-5974"><a href="5-1-helper-functions.html#cb16-5974" aria-hidden="true" tabindex="-1"></a>          <span class="do">## ODE 3</span></span>
<span id="cb16-5975"><a href="5-1-helper-functions.html#cb16-5975" aria-hidden="true" tabindex="-1"></a>          ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-5976"><a href="5-1-helper-functions.html#cb16-5976" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-5977"><a href="5-1-helper-functions.html#cb16-5977" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-5978"><a href="5-1-helper-functions.html#cb16-5978" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-5979"><a href="5-1-helper-functions.html#cb16-5979" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-5980"><a href="5-1-helper-functions.html#cb16-5980" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5981"><a href="5-1-helper-functions.html#cb16-5981" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5982"><a href="5-1-helper-functions.html#cb16-5982" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5983"><a href="5-1-helper-functions.html#cb16-5983" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5984"><a href="5-1-helper-functions.html#cb16-5984" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-5985"><a href="5-1-helper-functions.html#cb16-5985" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-5986"><a href="5-1-helper-functions.html#cb16-5986" aria-hidden="true" tabindex="-1"></a>  <span class="co">#  })</span></span>
<span id="cb16-5987"><a href="5-1-helper-functions.html#cb16-5987" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-5988"><a href="5-1-helper-functions.html#cb16-5988" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5989"><a href="5-1-helper-functions.html#cb16-5989" aria-hidden="true" tabindex="-1"></a>de_fun_beta2_sex_w_death_and_entries <span class="ot">&lt;-</span> <span class="cf">function</span>(t, states, parameters){</span>
<span id="cb16-5990"><a href="5-1-helper-functions.html#cb16-5990" aria-hidden="true" tabindex="-1"></a>  <span class="co">#with(as.list(c(states,parameters)),</span></span>
<span id="cb16-5991"><a href="5-1-helper-functions.html#cb16-5991" aria-hidden="true" tabindex="-1"></a>  <span class="co">#    {</span></span>
<span id="cb16-5992"><a href="5-1-helper-functions.html#cb16-5992" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5993"><a href="5-1-helper-functions.html#cb16-5993" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5994"><a href="5-1-helper-functions.html#cb16-5994" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-5995"><a href="5-1-helper-functions.html#cb16-5995" aria-hidden="true" tabindex="-1"></a>  <span class="do">## AGE IFS COMPLETE</span></span>
<span id="cb16-5996"><a href="5-1-helper-functions.html#cb16-5996" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-5997"><a href="5-1-helper-functions.html#cb16-5997" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-5998"><a href="5-1-helper-functions.html#cb16-5998" aria-hidden="true" tabindex="-1"></a>  states <span class="ot">&lt;-</span> <span class="fu">toArray</span>(states)</span>
<span id="cb16-5999"><a href="5-1-helper-functions.html#cb16-5999" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6000"><a href="5-1-helper-functions.html#cb16-6000" aria-hidden="true" tabindex="-1"></a>  sex_types <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb16-6001"><a href="5-1-helper-functions.html#cb16-6001" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 == Male, 2 == Female</span></span>
<span id="cb16-6002"><a href="5-1-helper-functions.html#cb16-6002" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6003"><a href="5-1-helper-functions.html#cb16-6003" aria-hidden="true" tabindex="-1"></a>  age_types <span class="ot">&lt;-</span> <span class="dv">6</span></span>
<span id="cb16-6004"><a href="5-1-helper-functions.html#cb16-6004" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = 18-24, 2 = 25-34, 3 = 35-44, 4 = 45-54, 5 = 55-64, 6 = 65+</span></span>
<span id="cb16-6005"><a href="5-1-helper-functions.html#cb16-6005" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6006"><a href="5-1-helper-functions.html#cb16-6006" aria-hidden="true" tabindex="-1"></a>  cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-6007"><a href="5-1-helper-functions.html#cb16-6007" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = Never Smoker, 2 = Current Smoker, 3 = Former Smoker</span></span>
<span id="cb16-6008"><a href="5-1-helper-functions.html#cb16-6008" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6009"><a href="5-1-helper-functions.html#cb16-6009" aria-hidden="true" tabindex="-1"></a>  e_cigarette_types <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb16-6010"><a href="5-1-helper-functions.html#cb16-6010" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 =  Never ESmoker, 2 = Current ESmoker, 3 = Former ESmoker</span></span>
<span id="cb16-6011"><a href="5-1-helper-functions.html#cb16-6011" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6012"><a href="5-1-helper-functions.html#cb16-6012" aria-hidden="true" tabindex="-1"></a>  income_types <span class="ot">&lt;-</span> <span class="dv">13</span></span>
<span id="cb16-6013"><a href="5-1-helper-functions.html#cb16-6013" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 1 = &lt;10k annually,   6 = &lt;10, decreased from previous</span></span>
<span id="cb16-6014"><a href="5-1-helper-functions.html#cb16-6014" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 2 = 10-25k,          7 = 10-25k decreased from previous,     10 = 10-25k increased from previous</span></span>
<span id="cb16-6015"><a href="5-1-helper-functions.html#cb16-6015" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 3 = 25-50k,          8 = 25-50k decreased from previous,     11 = 25-50k increased from previous</span></span>
<span id="cb16-6016"><a href="5-1-helper-functions.html#cb16-6016" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 4 = 50-100k,         9 = 50-100k decreased from previous,    12 = increased from previous</span></span>
<span id="cb16-6017"><a href="5-1-helper-functions.html#cb16-6017" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 5 = &gt;100k,                                                   13 = &gt;100k increased from previous</span></span>
<span id="cb16-6018"><a href="5-1-helper-functions.html#cb16-6018" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6019"><a href="5-1-helper-functions.html#cb16-6019" aria-hidden="true" tabindex="-1"></a>  age_transitions <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">7</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="dv">0</span>)</span>
<span id="cb16-6020"><a href="5-1-helper-functions.html#cb16-6020" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6021"><a href="5-1-helper-functions.html#cb16-6021" aria-hidden="true" tabindex="-1"></a>  income_transition_sources <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">6</span>), <span class="do">## 1</span></span>
<span id="cb16-6022"><a href="5-1-helper-functions.html#cb16-6022" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 2 </span></span>
<span id="cb16-6023"><a href="5-1-helper-functions.html#cb16-6023" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">8</span>,<span class="dv">11</span>), <span class="do">## 3</span></span>
<span id="cb16-6024"><a href="5-1-helper-functions.html#cb16-6024" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">9</span>,<span class="dv">12</span>), <span class="do">## 4</span></span>
<span id="cb16-6025"><a href="5-1-helper-functions.html#cb16-6025" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">13</span>),   <span class="do">## 5</span></span>
<span id="cb16-6026"><a href="5-1-helper-functions.html#cb16-6026" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-6027"><a href="5-1-helper-functions.html#cb16-6027" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-6028"><a href="5-1-helper-functions.html#cb16-6028" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-6029"><a href="5-1-helper-functions.html#cb16-6029" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-6030"><a href="5-1-helper-functions.html#cb16-6030" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">6</span>), <span class="do">## 10</span></span>
<span id="cb16-6031"><a href="5-1-helper-functions.html#cb16-6031" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">10</span>), <span class="do">## 11</span></span>
<span id="cb16-6032"><a href="5-1-helper-functions.html#cb16-6032" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">10</span>,<span class="dv">11</span>), <span class="do">## 12</span></span>
<span id="cb16-6033"><a href="5-1-helper-functions.html#cb16-6033" aria-hidden="true" tabindex="-1"></a>                                    <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>))<span class="do">## 13 </span></span>
<span id="cb16-6034"><a href="5-1-helper-functions.html#cb16-6034" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6035"><a href="5-1-helper-functions.html#cb16-6035" aria-hidden="true" tabindex="-1"></a>  income_transition_landings <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 1</span></span>
<span id="cb16-6036"><a href="5-1-helper-functions.html#cb16-6036" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 2 </span></span>
<span id="cb16-6037"><a href="5-1-helper-functions.html#cb16-6037" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 3</span></span>
<span id="cb16-6038"><a href="5-1-helper-functions.html#cb16-6038" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 4</span></span>
<span id="cb16-6039"><a href="5-1-helper-functions.html#cb16-6039" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>),   <span class="do">## 5</span></span>
<span id="cb16-6040"><a href="5-1-helper-functions.html#cb16-6040" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">10</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 6</span></span>
<span id="cb16-6041"><a href="5-1-helper-functions.html#cb16-6041" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 7</span></span>
<span id="cb16-6042"><a href="5-1-helper-functions.html#cb16-6042" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 8</span></span>
<span id="cb16-6043"><a href="5-1-helper-functions.html#cb16-6043" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">##9</span></span>
<span id="cb16-6044"><a href="5-1-helper-functions.html#cb16-6044" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">11</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 10</span></span>
<span id="cb16-6045"><a href="5-1-helper-functions.html#cb16-6045" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">12</span>,<span class="dv">13</span>), <span class="do">## 11</span></span>
<span id="cb16-6046"><a href="5-1-helper-functions.html#cb16-6046" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">13</span>), <span class="do">## 12</span></span>
<span id="cb16-6047"><a href="5-1-helper-functions.html#cb16-6047" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>,<span class="dv">9</span>))<span class="do">## 13 </span></span>
<span id="cb16-6048"><a href="5-1-helper-functions.html#cb16-6048" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6049"><a href="5-1-helper-functions.html#cb16-6049" aria-hidden="true" tabindex="-1"></a>  <span class="do">## inputting input_5_cat[income_category] will return the value of just the income </span></span>
<span id="cb16-6050"><a href="5-1-helper-functions.html#cb16-6050" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (i.e. 10-25, increased to 10-25k, and decreased to 10-25k will all map to 10-25k)</span></span>
<span id="cb16-6051"><a href="5-1-helper-functions.html#cb16-6051" aria-hidden="true" tabindex="-1"></a>  <span class="do">## (in other words income_5_cat[2] = income_5_cat[7] = income_5_cat = [10])</span></span>
<span id="cb16-6052"><a href="5-1-helper-functions.html#cb16-6052" aria-hidden="true" tabindex="-1"></a>  income_5_cat <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb16-6053"><a href="5-1-helper-functions.html#cb16-6053" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6054"><a href="5-1-helper-functions.html#cb16-6054" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Only calculating income transition levels from the income values</span></span>
<span id="cb16-6055"><a href="5-1-helper-functions.html#cb16-6055" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Not accounting for the income staging compartments</span></span>
<span id="cb16-6056"><a href="5-1-helper-functions.html#cb16-6056" aria-hidden="true" tabindex="-1"></a>  income_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1</span><span class="sc">:</span><span class="dv">150</span>],<span class="at">dim =</span> <span class="fu">c</span>(age_types, <span class="dv">5</span>, <span class="dv">5</span>))</span>
<span id="cb16-6057"><a href="5-1-helper-functions.html#cb16-6057" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6058"><a href="5-1-helper-functions.html#cb16-6058" aria-hidden="true" tabindex="-1"></a>  <span class="do">## the staging modifier controls how long individuals stay in the staging compartments assuming that they stay at the same income</span></span>
<span id="cb16-6059"><a href="5-1-helper-functions.html#cb16-6059" aria-hidden="true" tabindex="-1"></a>  staging_modifier <span class="ot">&lt;-</span> parameters[<span class="dv">151</span>]</span>
<span id="cb16-6060"><a href="5-1-helper-functions.html#cb16-6060" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6061"><a href="5-1-helper-functions.html#cb16-6061" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6062"><a href="5-1-helper-functions.html#cb16-6062" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Smoking Transitions are for the referent group (Male, Age X, Income Y)</span></span>
<span id="cb16-6063"><a href="5-1-helper-functions.html#cb16-6063" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">152</span><span class="sc">:</span><span class="dv">160</span>],<span class="at">dim =</span> <span class="fu">c</span>(cigarette_types,cigarette_types))</span>
<span id="cb16-6064"><a href="5-1-helper-functions.html#cb16-6064" aria-hidden="true" tabindex="-1"></a>  e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">161</span><span class="sc">:</span><span class="dv">169</span>],<span class="at">dim =</span> <span class="fu">c</span>(e_cigarette_types, e_cigarette_types))</span>
<span id="cb16-6065"><a href="5-1-helper-functions.html#cb16-6065" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6066"><a href="5-1-helper-functions.html#cb16-6066" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6067"><a href="5-1-helper-functions.html#cb16-6067" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6068"><a href="5-1-helper-functions.html#cb16-6068" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is for calibration</span></span>
<span id="cb16-6069"><a href="5-1-helper-functions.html#cb16-6069" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6070"><a href="5-1-helper-functions.html#cb16-6070" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6071"><a href="5-1-helper-functions.html#cb16-6071" aria-hidden="true" tabindex="-1"></a>  initiation_mod <span class="ot">&lt;-</span> parameters[<span class="dv">3061</span>]</span>
<span id="cb16-6072"><a href="5-1-helper-functions.html#cb16-6072" aria-hidden="true" tabindex="-1"></a>  cessation_mod <span class="ot">&lt;-</span> parameters[<span class="dv">3062</span>]</span>
<span id="cb16-6073"><a href="5-1-helper-functions.html#cb16-6073" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6074"><a href="5-1-helper-functions.html#cb16-6074" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>initiation_mod </span>
<span id="cb16-6075"><a href="5-1-helper-functions.html#cb16-6075" aria-hidden="true" tabindex="-1"></a>  <span class="co">#cigarette_transitions[1,2] &lt;- initiation_mod </span></span>
<span id="cb16-6076"><a href="5-1-helper-functions.html#cb16-6076" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6077"><a href="5-1-helper-functions.html#cb16-6077" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>] <span class="ot">&lt;-</span> cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>initiation_mod</span>
<span id="cb16-6078"><a href="5-1-helper-functions.html#cb16-6078" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6079"><a href="5-1-helper-functions.html#cb16-6079" aria-hidden="true" tabindex="-1"></a>  cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>] <span class="ot">&lt;-</span> cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>cessation_mod</span>
<span id="cb16-6080"><a href="5-1-helper-functions.html#cb16-6080" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6081"><a href="5-1-helper-functions.html#cb16-6081" aria-hidden="true" tabindex="-1"></a>  age_in <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb16-6082"><a href="5-1-helper-functions.html#cb16-6082" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6083"><a href="5-1-helper-functions.html#cb16-6083" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6084"><a href="5-1-helper-functions.html#cb16-6084" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The relative risks can be interpreted as follows: </span></span>
<span id="cb16-6085"><a href="5-1-helper-functions.html#cb16-6085" aria-hidden="true" tabindex="-1"></a>  <span class="do">## RR_income[income_level, X, Y] -&gt; the relative risk that a person at income level income_level transition from smoking level X to Y compared to referent income level</span></span>
<span id="cb16-6086"><a href="5-1-helper-functions.html#cb16-6086" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6087"><a href="5-1-helper-functions.html#cb16-6087" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">170</span><span class="sc">:</span><span class="dv">637</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6088"><a href="5-1-helper-functions.html#cb16-6088" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">638</span><span class="sc">:</span><span class="dv">1105</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6089"><a href="5-1-helper-functions.html#cb16-6089" aria-hidden="true" tabindex="-1"></a>  rr_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1106</span><span class="sc">:</span><span class="dv">1573</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6090"><a href="5-1-helper-functions.html#cb16-6090" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6091"><a href="5-1-helper-functions.html#cb16-6091" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_initiation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">1574</span><span class="sc">:</span><span class="dv">2041</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6092"><a href="5-1-helper-functions.html#cb16-6092" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_cessation <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2042</span><span class="sc">:</span><span class="dv">2509</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6093"><a href="5-1-helper-functions.html#cb16-6093" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_reinstatement <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2510</span><span class="sc">:</span><span class="dv">2977</span>], <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6094"><a href="5-1-helper-functions.html#cb16-6094" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6095"><a href="5-1-helper-functions.html#cb16-6095" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">3</span><span class="sc">*</span>sex_types,age_types,e_cigarette_types, income_types), <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">3</span>,sex_types,age_types,e_cigarette_types,income_types))</span>
<span id="cb16-6096"><a href="5-1-helper-functions.html#cb16-6096" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">1</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_initiation</span>
<span id="cb16-6097"><a href="5-1-helper-functions.html#cb16-6097" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">2</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_cessation</span>
<span id="cb16-6098"><a href="5-1-helper-functions.html#cb16-6098" aria-hidden="true" tabindex="-1"></a>  rr_e_cigarette_transitions[<span class="dv">3</span>,,,,] <span class="ot">&lt;-</span> rr_e_cigarette_reinstatement</span>
<span id="cb16-6099"><a href="5-1-helper-functions.html#cb16-6099" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6100"><a href="5-1-helper-functions.html#cb16-6100" aria-hidden="true" tabindex="-1"></a>  cig_out <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>)</span>
<span id="cb16-6101"><a href="5-1-helper-functions.html#cb16-6101" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6102"><a href="5-1-helper-functions.html#cb16-6102" aria-hidden="true" tabindex="-1"></a>  cig_in <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>), <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>), <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb16-6103"><a href="5-1-helper-functions.html#cb16-6103" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6104"><a href="5-1-helper-functions.html#cb16-6104" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6105"><a href="5-1-helper-functions.html#cb16-6105" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Finally need death parameters</span></span>
<span id="cb16-6106"><a href="5-1-helper-functions.html#cb16-6106" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Will use CDC life tables to get death https://www.cdc.gov/nchs/products/life_tables.htm</span></span>
<span id="cb16-6107"><a href="5-1-helper-functions.html#cb16-6107" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Will stratify death rates by age and sex</span></span>
<span id="cb16-6108"><a href="5-1-helper-functions.html#cb16-6108" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Death rate is computed as follows:</span></span>
<span id="cb16-6109"><a href="5-1-helper-functions.html#cb16-6109" aria-hidden="true" tabindex="-1"></a>  <span class="do">## First, the probability of death between ages X and X+1 were extracted from the lifetable</span></span>
<span id="cb16-6110"><a href="5-1-helper-functions.html#cb16-6110" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For each age range, the median probability was sampled</span></span>
<span id="cb16-6111"><a href="5-1-helper-functions.html#cb16-6111" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For the over 65 group, we exlcuded the &gt;100 category because the probability of death was 100%</span></span>
<span id="cb16-6112"><a href="5-1-helper-functions.html#cb16-6112" aria-hidden="true" tabindex="-1"></a>  <span class="do">## The probabilities were then converted into rates using the formula: rate = -ln(1 - probability)</span></span>
<span id="cb16-6113"><a href="5-1-helper-functions.html#cb16-6113" aria-hidden="true" tabindex="-1"></a>  <span class="do">## </span></span>
<span id="cb16-6114"><a href="5-1-helper-functions.html#cb16-6114" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6115"><a href="5-1-helper-functions.html#cb16-6115" aria-hidden="true" tabindex="-1"></a>  death_rates <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,sex_types<span class="sc">*</span>age_types), <span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types))</span>
<span id="cb16-6116"><a href="5-1-helper-functions.html#cb16-6116" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6117"><a href="5-1-helper-functions.html#cb16-6117" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For Men</span></span>
<span id="cb16-6118"><a href="5-1-helper-functions.html#cb16-6118" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6119"><a href="5-1-helper-functions.html#cb16-6119" aria-hidden="true" tabindex="-1"></a>  <span class="do">##-ln(1 - probability)</span></span>
<span id="cb16-6120"><a href="5-1-helper-functions.html#cb16-6120" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6121"><a href="5-1-helper-functions.html#cb16-6121" aria-hidden="true" tabindex="-1"></a>  death_rates[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.001286</span>, <span class="fl">0.001835</span>, <span class="fl">0.002426</span>, <span class="fl">0.004763</span>, <span class="fl">0.011045</span>, <span class="fl">0.069452</span>))</span>
<span id="cb16-6122"><a href="5-1-helper-functions.html#cb16-6122" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6123"><a href="5-1-helper-functions.html#cb16-6123" aria-hidden="true" tabindex="-1"></a>  <span class="do">## For Women</span></span>
<span id="cb16-6124"><a href="5-1-helper-functions.html#cb16-6124" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6125"><a href="5-1-helper-functions.html#cb16-6125" aria-hidden="true" tabindex="-1"></a>  death_rates[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span> <span class="sc">-</span> <span class="fu">c</span>(<span class="fl">0.000471</span>, <span class="fl">0.000801</span>, <span class="fl">0.001373</span>, <span class="fl">0.002971</span>, <span class="fl">0.006655</span>, <span class="fl">0.051681</span>))</span>
<span id="cb16-6126"><a href="5-1-helper-functions.html#cb16-6126" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6127"><a href="5-1-helper-functions.html#cb16-6127" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Entries Multiplier</span></span>
<span id="cb16-6128"><a href="5-1-helper-functions.html#cb16-6128" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6129"><a href="5-1-helper-functions.html#cb16-6129" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We only want entries to occur for the 18-24 group</span></span>
<span id="cb16-6130"><a href="5-1-helper-functions.html#cb16-6130" aria-hidden="true" tabindex="-1"></a>  <span class="do">## so we use entries[age] to get the appropriate multiplier</span></span>
<span id="cb16-6131"><a href="5-1-helper-functions.html#cb16-6131" aria-hidden="true" tabindex="-1"></a>  <span class="do">## we return 1 for 18-24 and 0 for all other ages</span></span>
<span id="cb16-6132"><a href="5-1-helper-functions.html#cb16-6132" aria-hidden="true" tabindex="-1"></a>  entries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>)</span>
<span id="cb16-6133"><a href="5-1-helper-functions.html#cb16-6133" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6134"><a href="5-1-helper-functions.html#cb16-6134" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6135"><a href="5-1-helper-functions.html#cb16-6135" aria-hidden="true" tabindex="-1"></a>  <span class="do">## We also need excess mortality related to cigarette use</span></span>
<span id="cb16-6136"><a href="5-1-helper-functions.html#cb16-6136" aria-hidden="true" tabindex="-1"></a>  <span class="do">##</span></span>
<span id="cb16-6137"><a href="5-1-helper-functions.html#cb16-6137" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6138"><a href="5-1-helper-functions.html#cb16-6138" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR <span class="ot">&lt;-</span> <span class="fu">toArray</span>(<span class="fu">rep</span>(<span class="cn">NA</span>,sex_types<span class="sc">*</span>cigarette_types), <span class="at">dim =</span> <span class="fu">c</span>(sex_types,cigarette_types))</span>
<span id="cb16-6139"><a href="5-1-helper-functions.html#cb16-6139" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6140"><a href="5-1-helper-functions.html#cb16-6140" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR[<span class="dv">1</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.24</span>,<span class="fl">1.30</span>) </span>
<span id="cb16-6141"><a href="5-1-helper-functions.html#cb16-6141" aria-hidden="true" tabindex="-1"></a>  excess_cigarette_death_RR[<span class="dv">2</span>,] <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="fl">2.29</span>,<span class="fl">1.35</span>)</span>
<span id="cb16-6142"><a href="5-1-helper-functions.html#cb16-6142" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6143"><a href="5-1-helper-functions.html#cb16-6143" aria-hidden="true" tabindex="-1"></a>  <span class="do">## This is the object which will contain all of the ODEs</span></span>
<span id="cb16-6144"><a href="5-1-helper-functions.html#cb16-6144" aria-hidden="true" tabindex="-1"></a>  <span class="do">## It is the same size as the states matrix</span></span>
<span id="cb16-6145"><a href="5-1-helper-functions.html#cb16-6145" aria-hidden="true" tabindex="-1"></a>  ODEs <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="at">dim =</span> <span class="fu">c</span>(sex_types,age_types,cigarette_types,e_cigarette_types,income_types))</span>
<span id="cb16-6146"><a href="5-1-helper-functions.html#cb16-6146" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6147"><a href="5-1-helper-functions.html#cb16-6147" aria-hidden="true" tabindex="-1"></a>  sex <span class="ot">&lt;-</span> parameters[<span class="dv">2978</span>]</span>
<span id="cb16-6148"><a href="5-1-helper-functions.html#cb16-6148" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6149"><a href="5-1-helper-functions.html#cb16-6149" aria-hidden="true" tabindex="-1"></a>  <span class="do">## for entries we first need the total birth number</span></span>
<span id="cb16-6150"><a href="5-1-helper-functions.html#cb16-6150" aria-hidden="true" tabindex="-1"></a>  growth_rate <span class="ot">&lt;-</span> parameters[<span class="dv">3060</span>]</span>
<span id="cb16-6151"><a href="5-1-helper-functions.html#cb16-6151" aria-hidden="true" tabindex="-1"></a>  entry_population_total <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">toVector</span>(states))<span class="sc">*</span>growth_rate</span>
<span id="cb16-6152"><a href="5-1-helper-functions.html#cb16-6152" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6153"><a href="5-1-helper-functions.html#cb16-6153" aria-hidden="true" tabindex="-1"></a>  younglings <span class="ot">&lt;-</span> <span class="fu">toArray</span>(parameters[<span class="dv">2979</span><span class="sc">:</span><span class="dv">3056</span>], <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">13</span>))</span>
<span id="cb16-6154"><a href="5-1-helper-functions.html#cb16-6154" aria-hidden="true" tabindex="-1"></a>  younglings <span class="ot">&lt;-</span> younglings<span class="sc">*</span>entry_population_total</span>
<span id="cb16-6155"><a href="5-1-helper-functions.html#cb16-6155" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6156"><a href="5-1-helper-functions.html#cb16-6156" aria-hidden="true" tabindex="-1"></a>  youngling_mult <span class="ot">&lt;-</span> parameters[<span class="dv">3057</span><span class="sc">:</span><span class="dv">3059</span>]</span>
<span id="cb16-6157"><a href="5-1-helper-functions.html#cb16-6157" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6158"><a href="5-1-helper-functions.html#cb16-6158" aria-hidden="true" tabindex="-1"></a>  not_sex <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6159"><a href="5-1-helper-functions.html#cb16-6159" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(sex <span class="sc">==</span> <span class="dv">1</span>){not_sex <span class="ot">&lt;-</span> <span class="dv">2</span>}</span>
<span id="cb16-6160"><a href="5-1-helper-functions.html#cb16-6160" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6161"><a href="5-1-helper-functions.html#cb16-6161" aria-hidden="true" tabindex="-1"></a>  ODEs[not_sex,,,,] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6162"><a href="5-1-helper-functions.html#cb16-6162" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6163"><a href="5-1-helper-functions.html#cb16-6163" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6164"><a href="5-1-helper-functions.html#cb16-6164" aria-hidden="true" tabindex="-1"></a>  <span class="co">#e_cigarette &lt;- 1</span></span>
<span id="cb16-6165"><a href="5-1-helper-functions.html#cb16-6165" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(income <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>income_types){</span>
<span id="cb16-6166"><a href="5-1-helper-functions.html#cb16-6166" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6167"><a href="5-1-helper-functions.html#cb16-6167" aria-hidden="true" tabindex="-1"></a>    sources <span class="ot">&lt;-</span> income_transition_sources[[income]]</span>
<span id="cb16-6168"><a href="5-1-helper-functions.html#cb16-6168" aria-hidden="true" tabindex="-1"></a>    landings <span class="ot">&lt;-</span> income_transition_landings[[income]]</span>
<span id="cb16-6169"><a href="5-1-helper-functions.html#cb16-6169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6170"><a href="5-1-helper-functions.html#cb16-6170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6171"><a href="5-1-helper-functions.html#cb16-6171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(e_cigarette <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>e_cigarette_types){</span>
<span id="cb16-6172"><a href="5-1-helper-functions.html#cb16-6172" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-6173"><a href="5-1-helper-functions.html#cb16-6173" aria-hidden="true" tabindex="-1"></a>      e_cig_in <span class="ot">&lt;-</span> cig_in[[e_cigarette]]</span>
<span id="cb16-6174"><a href="5-1-helper-functions.html#cb16-6174" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-6175"><a href="5-1-helper-functions.html#cb16-6175" aria-hidden="true" tabindex="-1"></a>      <span class="co"># for(sex in 1:sex_types){</span></span>
<span id="cb16-6176"><a href="5-1-helper-functions.html#cb16-6176" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span>(age <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>age_types){</span>
<span id="cb16-6177"><a href="5-1-helper-functions.html#cb16-6177" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6178"><a href="5-1-helper-functions.html#cb16-6178" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6179"><a href="5-1-helper-functions.html#cb16-6179" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6180"><a href="5-1-helper-functions.html#cb16-6180" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6181"><a href="5-1-helper-functions.html#cb16-6181" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6182"><a href="5-1-helper-functions.html#cb16-6182" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6183"><a href="5-1-helper-functions.html#cb16-6183" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 1: Never Smoker</span></span>
<span id="cb16-6184"><a href="5-1-helper-functions.html#cb16-6184" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6185"><a href="5-1-helper-functions.html#cb16-6185" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6186"><a href="5-1-helper-functions.html#cb16-6186" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6187"><a href="5-1-helper-functions.html#cb16-6187" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-6188"><a href="5-1-helper-functions.html#cb16-6188" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6189"><a href="5-1-helper-functions.html#cb16-6189" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6190"><a href="5-1-helper-functions.html#cb16-6190" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-6191"><a href="5-1-helper-functions.html#cb16-6191" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-6192"><a href="5-1-helper-functions.html#cb16-6192" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-6193"><a href="5-1-helper-functions.html#cb16-6193" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6194"><a href="5-1-helper-functions.html#cb16-6194" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-6195"><a href="5-1-helper-functions.html#cb16-6195" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6196"><a href="5-1-helper-functions.html#cb16-6196" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-6197"><a href="5-1-helper-functions.html#cb16-6197" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-6198"><a href="5-1-helper-functions.html#cb16-6198" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-6199"><a href="5-1-helper-functions.html#cb16-6199" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1,1,e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-6200"><a href="5-1-helper-functions.html#cb16-6200" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-6201"><a href="5-1-helper-functions.html#cb16-6201" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6202"><a href="5-1-helper-functions.html#cb16-6202" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6203"><a href="5-1-helper-functions.html#cb16-6203" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-6204"><a href="5-1-helper-functions.html#cb16-6204" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6205"><a href="5-1-helper-functions.html#cb16-6205" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6206"><a href="5-1-helper-functions.html#cb16-6206" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6207"><a href="5-1-helper-functions.html#cb16-6207" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6208"><a href="5-1-helper-functions.html#cb16-6208" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">1</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age] <span class="sc">+</span> entries[age]<span class="sc">*</span>younglings[sex,e_cigarette,income]<span class="sc">*</span>youngling_mult[<span class="dv">1</span>]</span>
<span id="cb16-6209"><a href="5-1-helper-functions.html#cb16-6209" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6210"><a href="5-1-helper-functions.html#cb16-6210" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-6211"><a href="5-1-helper-functions.html#cb16-6211" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6212"><a href="5-1-helper-functions.html#cb16-6212" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6213"><a href="5-1-helper-functions.html#cb16-6213" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-6214"><a href="5-1-helper-functions.html#cb16-6214" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-6215"><a href="5-1-helper-functions.html#cb16-6215" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6216"><a href="5-1-helper-functions.html#cb16-6216" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-6217"><a href="5-1-helper-functions.html#cb16-6217" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-6218"><a href="5-1-helper-functions.html#cb16-6218" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-6219"><a href="5-1-helper-functions.html#cb16-6219" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-6220"><a href="5-1-helper-functions.html#cb16-6220" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-6221"><a href="5-1-helper-functions.html#cb16-6221" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-6222"><a href="5-1-helper-functions.html#cb16-6222" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-6223"><a href="5-1-helper-functions.html#cb16-6223" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6224"><a href="5-1-helper-functions.html#cb16-6224" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-6225"><a href="5-1-helper-functions.html#cb16-6225" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6226"><a href="5-1-helper-functions.html#cb16-6226" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-6227"><a href="5-1-helper-functions.html#cb16-6227" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-6228"><a href="5-1-helper-functions.html#cb16-6228" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-6229"><a href="5-1-helper-functions.html#cb16-6229" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-6230"><a href="5-1-helper-functions.html#cb16-6230" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-6231"><a href="5-1-helper-functions.html#cb16-6231" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6232"><a href="5-1-helper-functions.html#cb16-6232" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6233"><a href="5-1-helper-functions.html#cb16-6233" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6234"><a href="5-1-helper-functions.html#cb16-6234" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6235"><a href="5-1-helper-functions.html#cb16-6235" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-6236"><a href="5-1-helper-functions.html#cb16-6236" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-6237"><a href="5-1-helper-functions.html#cb16-6237" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-6238"><a href="5-1-helper-functions.html#cb16-6238" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-6239"><a href="5-1-helper-functions.html#cb16-6239" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6240"><a href="5-1-helper-functions.html#cb16-6240" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-6241"><a href="5-1-helper-functions.html#cb16-6241" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-6242"><a href="5-1-helper-functions.html#cb16-6242" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-6243"><a href="5-1-helper-functions.html#cb16-6243" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6244"><a href="5-1-helper-functions.html#cb16-6244" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-6245"><a href="5-1-helper-functions.html#cb16-6245" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-6246"><a href="5-1-helper-functions.html#cb16-6246" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-6247"><a href="5-1-helper-functions.html#cb16-6247" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6248"><a href="5-1-helper-functions.html#cb16-6248" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-6249"><a href="5-1-helper-functions.html#cb16-6249" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-6250"><a href="5-1-helper-functions.html#cb16-6250" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-6251"><a href="5-1-helper-functions.html#cb16-6251" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6252"><a href="5-1-helper-functions.html#cb16-6252" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-6253"><a href="5-1-helper-functions.html#cb16-6253" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-6254"><a href="5-1-helper-functions.html#cb16-6254" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-6255"><a href="5-1-helper-functions.html#cb16-6255" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-6256"><a href="5-1-helper-functions.html#cb16-6256" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6257"><a href="5-1-helper-functions.html#cb16-6257" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-6258"><a href="5-1-helper-functions.html#cb16-6258" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6259"><a href="5-1-helper-functions.html#cb16-6259" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-6260"><a href="5-1-helper-functions.html#cb16-6260" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6261"><a href="5-1-helper-functions.html#cb16-6261" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-6262"><a href="5-1-helper-functions.html#cb16-6262" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-6263"><a href="5-1-helper-functions.html#cb16-6263" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6264"><a href="5-1-helper-functions.html#cb16-6264" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-6265"><a href="5-1-helper-functions.html#cb16-6265" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6266"><a href="5-1-helper-functions.html#cb16-6266" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6267"><a href="5-1-helper-functions.html#cb16-6267" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6268"><a href="5-1-helper-functions.html#cb16-6268" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-6269"><a href="5-1-helper-functions.html#cb16-6269" aria-hidden="true" tabindex="-1"></a>          <span class="do">##   mod &lt;- staging_modifier</span></span>
<span id="cb16-6270"><a href="5-1-helper-functions.html#cb16-6270" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-6271"><a href="5-1-helper-functions.html#cb16-6271" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6272"><a href="5-1-helper-functions.html#cb16-6272" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-6273"><a href="5-1-helper-functions.html#cb16-6273" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6274"><a href="5-1-helper-functions.html#cb16-6274" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-6275"><a href="5-1-helper-functions.html#cb16-6275" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6276"><a href="5-1-helper-functions.html#cb16-6276" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-6277"><a href="5-1-helper-functions.html#cb16-6277" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-6278"><a href="5-1-helper-functions.html#cb16-6278" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-6279"><a href="5-1-helper-functions.html#cb16-6279" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-6280"><a href="5-1-helper-functions.html#cb16-6280" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-6281"><a href="5-1-helper-functions.html#cb16-6281" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-6282"><a href="5-1-helper-functions.html#cb16-6282" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6283"><a href="5-1-helper-functions.html#cb16-6283" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-6284"><a href="5-1-helper-functions.html#cb16-6284" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-6285"><a href="5-1-helper-functions.html#cb16-6285" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-6286"><a href="5-1-helper-functions.html#cb16-6286" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6287"><a href="5-1-helper-functions.html#cb16-6287" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6288"><a href="5-1-helper-functions.html#cb16-6288" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6289"><a href="5-1-helper-functions.html#cb16-6289" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-6290"><a href="5-1-helper-functions.html#cb16-6290" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-6291"><a href="5-1-helper-functions.html#cb16-6291" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-6292"><a href="5-1-helper-functions.html#cb16-6292" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6293"><a href="5-1-helper-functions.html#cb16-6293" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6294"><a href="5-1-helper-functions.html#cb16-6294" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-6295"><a href="5-1-helper-functions.html#cb16-6295" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-6296"><a href="5-1-helper-functions.html#cb16-6296" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,1,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-6297"><a href="5-1-helper-functions.html#cb16-6297" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6298"><a href="5-1-helper-functions.html#cb16-6298" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-6299"><a href="5-1-helper-functions.html#cb16-6299" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-6300"><a href="5-1-helper-functions.html#cb16-6300" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-6301"><a href="5-1-helper-functions.html#cb16-6301" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-6302"><a href="5-1-helper-functions.html#cb16-6302" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,1,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-6303"><a href="5-1-helper-functions.html#cb16-6303" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6304"><a href="5-1-helper-functions.html#cb16-6304" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6305"><a href="5-1-helper-functions.html#cb16-6305" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6306"><a href="5-1-helper-functions.html#cb16-6306" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-6307"><a href="5-1-helper-functions.html#cb16-6307" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6308"><a href="5-1-helper-functions.html#cb16-6308" aria-hidden="true" tabindex="-1"></a>        <span class="do">## There is no cigarette in transition for Never Smokers</span></span>
<span id="cb16-6309"><a href="5-1-helper-functions.html#cb16-6309" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6310"><a href="5-1-helper-functions.html#cb16-6310" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-6311"><a href="5-1-helper-functions.html#cb16-6311" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6312"><a href="5-1-helper-functions.html#cb16-6312" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Never to Cigarette Smoker -- Initiation</span></span>
<span id="cb16-6313"><a href="5-1-helper-functions.html#cb16-6313" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-6314"><a href="5-1-helper-functions.html#cb16-6314" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6315"><a href="5-1-helper-functions.html#cb16-6315" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-6316"><a href="5-1-helper-functions.html#cb16-6316" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6317"><a href="5-1-helper-functions.html#cb16-6317" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-6318"><a href="5-1-helper-functions.html#cb16-6318" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6319"><a href="5-1-helper-functions.html#cb16-6319" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-6320"><a href="5-1-helper-functions.html#cb16-6320" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-6321"><a href="5-1-helper-functions.html#cb16-6321" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">1</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">1</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-6322"><a href="5-1-helper-functions.html#cb16-6322" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6323"><a href="5-1-helper-functions.html#cb16-6323" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-6324"><a href="5-1-helper-functions.html#cb16-6324" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6325"><a href="5-1-helper-functions.html#cb16-6325" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-6326"><a href="5-1-helper-functions.html#cb16-6326" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6327"><a href="5-1-helper-functions.html#cb16-6327" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else </span></span>
<span id="cb16-6328"><a href="5-1-helper-functions.html#cb16-6328" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6329"><a href="5-1-helper-functions.html#cb16-6329" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-6330"><a href="5-1-helper-functions.html#cb16-6330" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6331"><a href="5-1-helper-functions.html#cb16-6331" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-6332"><a href="5-1-helper-functions.html#cb16-6332" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6333"><a href="5-1-helper-functions.html#cb16-6333" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-6334"><a href="5-1-helper-functions.html#cb16-6334" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6335"><a href="5-1-helper-functions.html#cb16-6335" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-6336"><a href="5-1-helper-functions.html#cb16-6336" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6337"><a href="5-1-helper-functions.html#cb16-6337" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-6338"><a href="5-1-helper-functions.html#cb16-6338" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6339"><a href="5-1-helper-functions.html#cb16-6339" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-6340"><a href="5-1-helper-functions.html#cb16-6340" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6341"><a href="5-1-helper-functions.html#cb16-6341" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-6342"><a href="5-1-helper-functions.html#cb16-6342" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6343"><a href="5-1-helper-functions.html#cb16-6343" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,1,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-6344"><a href="5-1-helper-functions.html#cb16-6344" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6345"><a href="5-1-helper-functions.html#cb16-6345" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6346"><a href="5-1-helper-functions.html#cb16-6346" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6347"><a href="5-1-helper-functions.html#cb16-6347" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-6348"><a href="5-1-helper-functions.html#cb16-6348" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6349"><a href="5-1-helper-functions.html#cb16-6349" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">1</span>,income])</span>
<span id="cb16-6350"><a href="5-1-helper-functions.html#cb16-6350" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6351"><a href="5-1-helper-functions.html#cb16-6351" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-6352"><a href="5-1-helper-functions.html#cb16-6352" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6353"><a href="5-1-helper-functions.html#cb16-6353" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-6354"><a href="5-1-helper-functions.html#cb16-6354" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6355"><a href="5-1-helper-functions.html#cb16-6355" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-6356"><a href="5-1-helper-functions.html#cb16-6356" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6357"><a href="5-1-helper-functions.html#cb16-6357" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,1,income])</span></span>
<span id="cb16-6358"><a href="5-1-helper-functions.html#cb16-6358" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6359"><a href="5-1-helper-functions.html#cb16-6359" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-6360"><a href="5-1-helper-functions.html#cb16-6360" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6361"><a href="5-1-helper-functions.html#cb16-6361" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-6362"><a href="5-1-helper-functions.html#cb16-6362" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6363"><a href="5-1-helper-functions.html#cb16-6363" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,1,income])</span></span>
<span id="cb16-6364"><a href="5-1-helper-functions.html#cb16-6364" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6365"><a href="5-1-helper-functions.html#cb16-6365" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-6366"><a href="5-1-helper-functions.html#cb16-6366" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6367"><a href="5-1-helper-functions.html#cb16-6367" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-6368"><a href="5-1-helper-functions.html#cb16-6368" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6369"><a href="5-1-helper-functions.html#cb16-6369" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,1,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,1,income])</span></span>
<span id="cb16-6370"><a href="5-1-helper-functions.html#cb16-6370" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6371"><a href="5-1-helper-functions.html#cb16-6371" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6372"><a href="5-1-helper-functions.html#cb16-6372" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6373"><a href="5-1-helper-functions.html#cb16-6373" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-6374"><a href="5-1-helper-functions.html#cb16-6374" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6375"><a href="5-1-helper-functions.html#cb16-6375" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">1</span>] <span class="do">## not implemented yet</span></span>
<span id="cb16-6376"><a href="5-1-helper-functions.html#cb16-6376" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6377"><a href="5-1-helper-functions.html#cb16-6377" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 1</span></span>
<span id="cb16-6378"><a href="5-1-helper-functions.html#cb16-6378" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">1</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-6379"><a href="5-1-helper-functions.html#cb16-6379" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6380"><a href="5-1-helper-functions.html#cb16-6380" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6381"><a href="5-1-helper-functions.html#cb16-6381" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6382"><a href="5-1-helper-functions.html#cb16-6382" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 2: Current Smoker</span></span>
<span id="cb16-6383"><a href="5-1-helper-functions.html#cb16-6383" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6384"><a href="5-1-helper-functions.html#cb16-6384" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6385"><a href="5-1-helper-functions.html#cb16-6385" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6386"><a href="5-1-helper-functions.html#cb16-6386" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-6387"><a href="5-1-helper-functions.html#cb16-6387" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6388"><a href="5-1-helper-functions.html#cb16-6388" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6389"><a href="5-1-helper-functions.html#cb16-6389" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-6390"><a href="5-1-helper-functions.html#cb16-6390" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-6391"><a href="5-1-helper-functions.html#cb16-6391" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-6392"><a href="5-1-helper-functions.html#cb16-6392" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6393"><a href="5-1-helper-functions.html#cb16-6393" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-6394"><a href="5-1-helper-functions.html#cb16-6394" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6395"><a href="5-1-helper-functions.html#cb16-6395" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-6396"><a href="5-1-helper-functions.html#cb16-6396" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-6397"><a href="5-1-helper-functions.html#cb16-6397" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-6398"><a href="5-1-helper-functions.html#cb16-6398" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 2 , e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-6399"><a href="5-1-helper-functions.html#cb16-6399" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-6400"><a href="5-1-helper-functions.html#cb16-6400" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6401"><a href="5-1-helper-functions.html#cb16-6401" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6402"><a href="5-1-helper-functions.html#cb16-6402" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-6403"><a href="5-1-helper-functions.html#cb16-6403" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6404"><a href="5-1-helper-functions.html#cb16-6404" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6405"><a href="5-1-helper-functions.html#cb16-6405" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6406"><a href="5-1-helper-functions.html#cb16-6406" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6407"><a href="5-1-helper-functions.html#cb16-6407" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">2</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age] <span class="sc">+</span> entries[age]<span class="sc">*</span>younglings[sex,e_cigarette,income]<span class="sc">*</span>youngling_mult[<span class="dv">2</span>]</span>
<span id="cb16-6408"><a href="5-1-helper-functions.html#cb16-6408" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6409"><a href="5-1-helper-functions.html#cb16-6409" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-6410"><a href="5-1-helper-functions.html#cb16-6410" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6411"><a href="5-1-helper-functions.html#cb16-6411" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6412"><a href="5-1-helper-functions.html#cb16-6412" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-6413"><a href="5-1-helper-functions.html#cb16-6413" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-6414"><a href="5-1-helper-functions.html#cb16-6414" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-6415"><a href="5-1-helper-functions.html#cb16-6415" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-6416"><a href="5-1-helper-functions.html#cb16-6416" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-6417"><a href="5-1-helper-functions.html#cb16-6417" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-6418"><a href="5-1-helper-functions.html#cb16-6418" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-6419"><a href="5-1-helper-functions.html#cb16-6419" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-6420"><a href="5-1-helper-functions.html#cb16-6420" aria-hidden="true" tabindex="-1"></a>        <span class="co">#}</span></span>
<span id="cb16-6421"><a href="5-1-helper-functions.html#cb16-6421" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6422"><a href="5-1-helper-functions.html#cb16-6422" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-6423"><a href="5-1-helper-functions.html#cb16-6423" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6424"><a href="5-1-helper-functions.html#cb16-6424" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-6425"><a href="5-1-helper-functions.html#cb16-6425" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-6426"><a href="5-1-helper-functions.html#cb16-6426" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-6427"><a href="5-1-helper-functions.html#cb16-6427" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-6428"><a href="5-1-helper-functions.html#cb16-6428" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-6429"><a href="5-1-helper-functions.html#cb16-6429" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6430"><a href="5-1-helper-functions.html#cb16-6430" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6431"><a href="5-1-helper-functions.html#cb16-6431" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6432"><a href="5-1-helper-functions.html#cb16-6432" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6433"><a href="5-1-helper-functions.html#cb16-6433" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-6434"><a href="5-1-helper-functions.html#cb16-6434" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-6435"><a href="5-1-helper-functions.html#cb16-6435" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-6436"><a href="5-1-helper-functions.html#cb16-6436" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-6437"><a href="5-1-helper-functions.html#cb16-6437" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6438"><a href="5-1-helper-functions.html#cb16-6438" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-6439"><a href="5-1-helper-functions.html#cb16-6439" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-6440"><a href="5-1-helper-functions.html#cb16-6440" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-6441"><a href="5-1-helper-functions.html#cb16-6441" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6442"><a href="5-1-helper-functions.html#cb16-6442" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-6443"><a href="5-1-helper-functions.html#cb16-6443" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-6444"><a href="5-1-helper-functions.html#cb16-6444" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-6445"><a href="5-1-helper-functions.html#cb16-6445" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-6446"><a href="5-1-helper-functions.html#cb16-6446" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-6447"><a href="5-1-helper-functions.html#cb16-6447" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-6448"><a href="5-1-helper-functions.html#cb16-6448" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6449"><a href="5-1-helper-functions.html#cb16-6449" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-6450"><a href="5-1-helper-functions.html#cb16-6450" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-6451"><a href="5-1-helper-functions.html#cb16-6451" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-6452"><a href="5-1-helper-functions.html#cb16-6452" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-6453"><a href="5-1-helper-functions.html#cb16-6453" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6454"><a href="5-1-helper-functions.html#cb16-6454" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-6455"><a href="5-1-helper-functions.html#cb16-6455" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6456"><a href="5-1-helper-functions.html#cb16-6456" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-6457"><a href="5-1-helper-functions.html#cb16-6457" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6458"><a href="5-1-helper-functions.html#cb16-6458" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-6459"><a href="5-1-helper-functions.html#cb16-6459" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-6460"><a href="5-1-helper-functions.html#cb16-6460" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6461"><a href="5-1-helper-functions.html#cb16-6461" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-6462"><a href="5-1-helper-functions.html#cb16-6462" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6463"><a href="5-1-helper-functions.html#cb16-6463" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6464"><a href="5-1-helper-functions.html#cb16-6464" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6465"><a href="5-1-helper-functions.html#cb16-6465" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-6466"><a href="5-1-helper-functions.html#cb16-6466" aria-hidden="true" tabindex="-1"></a>          <span class="do">##  mod &lt;- staging_modifier</span></span>
<span id="cb16-6467"><a href="5-1-helper-functions.html#cb16-6467" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-6468"><a href="5-1-helper-functions.html#cb16-6468" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6469"><a href="5-1-helper-functions.html#cb16-6469" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-6470"><a href="5-1-helper-functions.html#cb16-6470" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6471"><a href="5-1-helper-functions.html#cb16-6471" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-6472"><a href="5-1-helper-functions.html#cb16-6472" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6473"><a href="5-1-helper-functions.html#cb16-6473" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-6474"><a href="5-1-helper-functions.html#cb16-6474" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-6475"><a href="5-1-helper-functions.html#cb16-6475" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-6476"><a href="5-1-helper-functions.html#cb16-6476" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-6477"><a href="5-1-helper-functions.html#cb16-6477" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6478"><a href="5-1-helper-functions.html#cb16-6478" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-6479"><a href="5-1-helper-functions.html#cb16-6479" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-6480"><a href="5-1-helper-functions.html#cb16-6480" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-6481"><a href="5-1-helper-functions.html#cb16-6481" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-6482"><a href="5-1-helper-functions.html#cb16-6482" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income,income])</span></span>
<span id="cb16-6483"><a href="5-1-helper-functions.html#cb16-6483" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-6484"><a href="5-1-helper-functions.html#cb16-6484" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6485"><a href="5-1-helper-functions.html#cb16-6485" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-6486"><a href="5-1-helper-functions.html#cb16-6486" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-6487"><a href="5-1-helper-functions.html#cb16-6487" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-6488"><a href="5-1-helper-functions.html#cb16-6488" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6489"><a href="5-1-helper-functions.html#cb16-6489" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6490"><a href="5-1-helper-functions.html#cb16-6490" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6491"><a href="5-1-helper-functions.html#cb16-6491" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-6492"><a href="5-1-helper-functions.html#cb16-6492" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-6493"><a href="5-1-helper-functions.html#cb16-6493" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-6494"><a href="5-1-helper-functions.html#cb16-6494" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6495"><a href="5-1-helper-functions.html#cb16-6495" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6496"><a href="5-1-helper-functions.html#cb16-6496" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-6497"><a href="5-1-helper-functions.html#cb16-6497" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-6498"><a href="5-1-helper-functions.html#cb16-6498" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,2,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-6499"><a href="5-1-helper-functions.html#cb16-6499" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6500"><a href="5-1-helper-functions.html#cb16-6500" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-6501"><a href="5-1-helper-functions.html#cb16-6501" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-6502"><a href="5-1-helper-functions.html#cb16-6502" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-6503"><a href="5-1-helper-functions.html#cb16-6503" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-6504"><a href="5-1-helper-functions.html#cb16-6504" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,2,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-6505"><a href="5-1-helper-functions.html#cb16-6505" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6506"><a href="5-1-helper-functions.html#cb16-6506" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6507"><a href="5-1-helper-functions.html#cb16-6507" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6508"><a href="5-1-helper-functions.html#cb16-6508" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-6509"><a href="5-1-helper-functions.html#cb16-6509" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6510"><a href="5-1-helper-functions.html#cb16-6510" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6511"><a href="5-1-helper-functions.html#cb16-6511" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6512"><a href="5-1-helper-functions.html#cb16-6512" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for initiation</span></span>
<span id="cb16-6513"><a href="5-1-helper-functions.html#cb16-6513" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6514"><a href="5-1-helper-functions.html#cb16-6514" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">1</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_initiation[sex,age,e_cigarette,income])</span>
<span id="cb16-6515"><a href="5-1-helper-functions.html#cb16-6515" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6516"><a href="5-1-helper-functions.html#cb16-6516" aria-hidden="true" tabindex="-1"></a>        <span class="do">## need a flow for reinstatement</span></span>
<span id="cb16-6517"><a href="5-1-helper-functions.html#cb16-6517" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6518"><a href="5-1-helper-functions.html#cb16-6518" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-6519"><a href="5-1-helper-functions.html#cb16-6519" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6520"><a href="5-1-helper-functions.html#cb16-6520" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-6521"><a href="5-1-helper-functions.html#cb16-6521" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6522"><a href="5-1-helper-functions.html#cb16-6522" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette Smoker to Former Smoker</span></span>
<span id="cb16-6523"><a href="5-1-helper-functions.html#cb16-6523" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-6524"><a href="5-1-helper-functions.html#cb16-6524" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6525"><a href="5-1-helper-functions.html#cb16-6525" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-6526"><a href="5-1-helper-functions.html#cb16-6526" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6527"><a href="5-1-helper-functions.html#cb16-6527" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-6528"><a href="5-1-helper-functions.html#cb16-6528" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6529"><a href="5-1-helper-functions.html#cb16-6529" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-6530"><a href="5-1-helper-functions.html#cb16-6530" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-6531"><a href="5-1-helper-functions.html#cb16-6531" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">2</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">2</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-6532"><a href="5-1-helper-functions.html#cb16-6532" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6533"><a href="5-1-helper-functions.html#cb16-6533" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-6534"><a href="5-1-helper-functions.html#cb16-6534" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6535"><a href="5-1-helper-functions.html#cb16-6535" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-6536"><a href="5-1-helper-functions.html#cb16-6536" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-6537"><a href="5-1-helper-functions.html#cb16-6537" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-6538"><a href="5-1-helper-functions.html#cb16-6538" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-6539"><a href="5-1-helper-functions.html#cb16-6539" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-6540"><a href="5-1-helper-functions.html#cb16-6540" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6541"><a href="5-1-helper-functions.html#cb16-6541" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   if(e_cigarette == 2){</span></span>
<span id="cb16-6542"><a href="5-1-helper-functions.html#cb16-6542" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6543"><a href="5-1-helper-functions.html#cb16-6543" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-6544"><a href="5-1-helper-functions.html#cb16-6544" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6545"><a href="5-1-helper-functions.html#cb16-6545" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-6546"><a href="5-1-helper-functions.html#cb16-6546" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6547"><a href="5-1-helper-functions.html#cb16-6547" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-6548"><a href="5-1-helper-functions.html#cb16-6548" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6549"><a href="5-1-helper-functions.html#cb16-6549" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-6550"><a href="5-1-helper-functions.html#cb16-6550" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6551"><a href="5-1-helper-functions.html#cb16-6551" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-6552"><a href="5-1-helper-functions.html#cb16-6552" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6553"><a href="5-1-helper-functions.html#cb16-6553" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-6554"><a href="5-1-helper-functions.html#cb16-6554" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6555"><a href="5-1-helper-functions.html#cb16-6555" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,2,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-6556"><a href="5-1-helper-functions.html#cb16-6556" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6557"><a href="5-1-helper-functions.html#cb16-6557" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6558"><a href="5-1-helper-functions.html#cb16-6558" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6559"><a href="5-1-helper-functions.html#cb16-6559" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-6560"><a href="5-1-helper-functions.html#cb16-6560" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6561"><a href="5-1-helper-functions.html#cb16-6561" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">2</span>,income])</span>
<span id="cb16-6562"><a href="5-1-helper-functions.html#cb16-6562" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6563"><a href="5-1-helper-functions.html#cb16-6563" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-6564"><a href="5-1-helper-functions.html#cb16-6564" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6565"><a href="5-1-helper-functions.html#cb16-6565" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-6566"><a href="5-1-helper-functions.html#cb16-6566" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6567"><a href="5-1-helper-functions.html#cb16-6567" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-6568"><a href="5-1-helper-functions.html#cb16-6568" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6569"><a href="5-1-helper-functions.html#cb16-6569" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,2,income])</span></span>
<span id="cb16-6570"><a href="5-1-helper-functions.html#cb16-6570" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6571"><a href="5-1-helper-functions.html#cb16-6571" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-6572"><a href="5-1-helper-functions.html#cb16-6572" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6573"><a href="5-1-helper-functions.html#cb16-6573" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-6574"><a href="5-1-helper-functions.html#cb16-6574" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6575"><a href="5-1-helper-functions.html#cb16-6575" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,2,income])</span></span>
<span id="cb16-6576"><a href="5-1-helper-functions.html#cb16-6576" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6577"><a href="5-1-helper-functions.html#cb16-6577" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-6578"><a href="5-1-helper-functions.html#cb16-6578" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6579"><a href="5-1-helper-functions.html#cb16-6579" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-6580"><a href="5-1-helper-functions.html#cb16-6580" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6581"><a href="5-1-helper-functions.html#cb16-6581" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,2,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,2,income])</span></span>
<span id="cb16-6582"><a href="5-1-helper-functions.html#cb16-6582" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6583"><a href="5-1-helper-functions.html#cb16-6583" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6584"><a href="5-1-helper-functions.html#cb16-6584" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6585"><a href="5-1-helper-functions.html#cb16-6585" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-6586"><a href="5-1-helper-functions.html#cb16-6586" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6587"><a href="5-1-helper-functions.html#cb16-6587" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">2</span>]</span>
<span id="cb16-6588"><a href="5-1-helper-functions.html#cb16-6588" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6589"><a href="5-1-helper-functions.html#cb16-6589" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 2</span></span>
<span id="cb16-6590"><a href="5-1-helper-functions.html#cb16-6590" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">2</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-6591"><a href="5-1-helper-functions.html#cb16-6591" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6592"><a href="5-1-helper-functions.html#cb16-6592" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6593"><a href="5-1-helper-functions.html#cb16-6593" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette State 3: Former Smoker</span></span>
<span id="cb16-6594"><a href="5-1-helper-functions.html#cb16-6594" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6595"><a href="5-1-helper-functions.html#cb16-6595" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6596"><a href="5-1-helper-functions.html#cb16-6596" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6597"><a href="5-1-helper-functions.html#cb16-6597" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age In</span></span>
<span id="cb16-6598"><a href="5-1-helper-functions.html#cb16-6598" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6599"><a href="5-1-helper-functions.html#cb16-6599" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6600"><a href="5-1-helper-functions.html#cb16-6600" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need to capture two cases: </span></span>
<span id="cb16-6601"><a href="5-1-helper-functions.html#cb16-6601" aria-hidden="true" tabindex="-1"></a>        <span class="do">## For the youngest age group (age == 1), in which people can&#39;t age in</span></span>
<span id="cb16-6602"><a href="5-1-helper-functions.html#cb16-6602" aria-hidden="true" tabindex="-1"></a>        <span class="do">## All other age groups</span></span>
<span id="cb16-6603"><a href="5-1-helper-functions.html#cb16-6603" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6604"><a href="5-1-helper-functions.html#cb16-6604" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ageIn &lt;- 0</span></span>
<span id="cb16-6605"><a href="5-1-helper-functions.html#cb16-6605" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6606"><a href="5-1-helper-functions.html#cb16-6606" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(age &gt; 1){</span></span>
<span id="cb16-6607"><a href="5-1-helper-functions.html#cb16-6607" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## the number of people who transition in are those in the younger age group</span></span>
<span id="cb16-6608"><a href="5-1-helper-functions.html#cb16-6608" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## times the proportion of people who will age out</span></span>
<span id="cb16-6609"><a href="5-1-helper-functions.html#cb16-6609" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ageIn &lt;- states[sex,age - 1, 3, e_cigarette,income]*age_transitions[age - 1]</span></span>
<span id="cb16-6610"><a href="5-1-helper-functions.html#cb16-6610" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(age == 1){</span></span>
<span id="cb16-6611"><a href="5-1-helper-functions.html#cb16-6611" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6612"><a href="5-1-helper-functions.html#cb16-6612" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6613"><a href="5-1-helper-functions.html#cb16-6613" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## This is where we can include &quot;births&quot; into the model</span></span>
<span id="cb16-6614"><a href="5-1-helper-functions.html#cb16-6614" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6615"><a href="5-1-helper-functions.html#cb16-6615" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6616"><a href="5-1-helper-functions.html#cb16-6616" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6617"><a href="5-1-helper-functions.html#cb16-6617" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6618"><a href="5-1-helper-functions.html#cb16-6618" aria-hidden="true" tabindex="-1"></a>        ageIn <span class="ot">&lt;-</span> states[sex,age_in[age] <span class="sc">-</span> <span class="dv">1</span>, <span class="dv">3</span> , e_cigarette,income]<span class="sc">*</span><span class="fu">c</span>(<span class="dv">0</span>,age_transitions)[age] <span class="sc">+</span> entries[age]<span class="sc">*</span>younglings[sex,e_cigarette,income]<span class="sc">*</span>youngling_mult[<span class="dv">3</span>]</span>
<span id="cb16-6619"><a href="5-1-helper-functions.html#cb16-6619" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6620"><a href="5-1-helper-functions.html#cb16-6620" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Age Out</span></span>
<span id="cb16-6621"><a href="5-1-helper-functions.html#cb16-6621" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6622"><a href="5-1-helper-functions.html#cb16-6622" aria-hidden="true" tabindex="-1"></a>        <span class="do">##</span></span>
<span id="cb16-6623"><a href="5-1-helper-functions.html#cb16-6623" aria-hidden="true" tabindex="-1"></a>        <span class="do">## SImilarly with aging out, we must consider an edge case</span></span>
<span id="cb16-6624"><a href="5-1-helper-functions.html#cb16-6624" aria-hidden="true" tabindex="-1"></a>        <span class="do">## People in the oldest age group (age == 6) can&#39;t age out</span></span>
<span id="cb16-6625"><a href="5-1-helper-functions.html#cb16-6625" aria-hidden="true" tabindex="-1"></a>        <span class="co">#ageOut &lt;- 0</span></span>
<span id="cb16-6626"><a href="5-1-helper-functions.html#cb16-6626" aria-hidden="true" tabindex="-1"></a>        <span class="co">#if(age &lt; 6){</span></span>
<span id="cb16-6627"><a href="5-1-helper-functions.html#cb16-6627" aria-hidden="true" tabindex="-1"></a>        <span class="do">## The number of people who will leave is the </span></span>
<span id="cb16-6628"><a href="5-1-helper-functions.html#cb16-6628" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the number of people in the compartment times</span></span>
<span id="cb16-6629"><a href="5-1-helper-functions.html#cb16-6629" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the proportion of people who will age out of this group</span></span>
<span id="cb16-6630"><a href="5-1-helper-functions.html#cb16-6630" aria-hidden="true" tabindex="-1"></a>        ageOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>age_transitions[age]</span>
<span id="cb16-6631"><a href="5-1-helper-functions.html#cb16-6631" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6632"><a href="5-1-helper-functions.html#cb16-6632" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6633"><a href="5-1-helper-functions.html#cb16-6633" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income In</span></span>
<span id="cb16-6634"><a href="5-1-helper-functions.html#cb16-6634" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6635"><a href="5-1-helper-functions.html#cb16-6635" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Because of the staging compartments in the model</span></span>
<span id="cb16-6636"><a href="5-1-helper-functions.html#cb16-6636" aria-hidden="true" tabindex="-1"></a>        <span class="do">## This leads to a rather complicated set of transitions</span></span>
<span id="cb16-6637"><a href="5-1-helper-functions.html#cb16-6637" aria-hidden="true" tabindex="-1"></a>        <span class="do">## FOr income_level X, the income_transition_sources object</span></span>
<span id="cb16-6638"><a href="5-1-helper-functions.html#cb16-6638" aria-hidden="true" tabindex="-1"></a>        <span class="do">## contains a vector of all the compartments from which someone</span></span>
<span id="cb16-6639"><a href="5-1-helper-functions.html#cb16-6639" aria-hidden="true" tabindex="-1"></a>        <span class="do">## can transition into X from</span></span>
<span id="cb16-6640"><a href="5-1-helper-functions.html#cb16-6640" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6641"><a href="5-1-helper-functions.html#cb16-6641" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6642"><a href="5-1-helper-functions.html#cb16-6642" aria-hidden="true" tabindex="-1"></a>        incomeIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6643"><a href="5-1-helper-functions.html#cb16-6643" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6644"><a href="5-1-helper-functions.html#cb16-6644" aria-hidden="true" tabindex="-1"></a>        <span class="do">## In order to calculate the number of people who transition into</span></span>
<span id="cb16-6645"><a href="5-1-helper-functions.html#cb16-6645" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the given compartment based on income, we loop through all</span></span>
<span id="cb16-6646"><a href="5-1-helper-functions.html#cb16-6646" aria-hidden="true" tabindex="-1"></a>        <span class="do">## the compartments that people can transition from</span></span>
<span id="cb16-6647"><a href="5-1-helper-functions.html#cb16-6647" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> sources){</span>
<span id="cb16-6648"><a href="5-1-helper-functions.html#cb16-6648" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6649"><a href="5-1-helper-functions.html#cb16-6649" aria-hidden="true" tabindex="-1"></a>          <span class="do">## First, we create a modifier variable</span></span>
<span id="cb16-6650"><a href="5-1-helper-functions.html#cb16-6650" aria-hidden="true" tabindex="-1"></a>          <span class="do">## It is set to one in case this is not a staging compartment</span></span>
<span id="cb16-6651"><a href="5-1-helper-functions.html#cb16-6651" aria-hidden="true" tabindex="-1"></a>          <span class="do">## If it is a staging compartment, then the modifier is set to the staging modifier</span></span>
<span id="cb16-6652"><a href="5-1-helper-functions.html#cb16-6652" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6653"><a href="5-1-helper-functions.html#cb16-6653" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Can check if it is a staging compartment by seeing if the income_level</span></span>
<span id="cb16-6654"><a href="5-1-helper-functions.html#cb16-6654" aria-hidden="true" tabindex="-1"></a>          <span class="do">## Matches up with income_5_cat[income_level] and if the income for the two compartments</span></span>
<span id="cb16-6655"><a href="5-1-helper-functions.html#cb16-6655" aria-hidden="true" tabindex="-1"></a>          <span class="do">## is the same</span></span>
<span id="cb16-6656"><a href="5-1-helper-functions.html#cb16-6656" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income_level != income_5_cat[income_level] &amp;&amp; income == income_5_cat[income_level]){</span></span>
<span id="cb16-6657"><a href="5-1-helper-functions.html#cb16-6657" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-6658"><a href="5-1-helper-functions.html#cb16-6658" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-6659"><a href="5-1-helper-functions.html#cb16-6659" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6660"><a href="5-1-helper-functions.html#cb16-6660" aria-hidden="true" tabindex="-1"></a>          <span class="do">## then the proportion of people who make the transition are the proportion of people</span></span>
<span id="cb16-6661"><a href="5-1-helper-functions.html#cb16-6661" aria-hidden="true" tabindex="-1"></a>          <span class="do">## in the prior compartment who make the income transition</span></span>
<span id="cb16-6662"><a href="5-1-helper-functions.html#cb16-6662" aria-hidden="true" tabindex="-1"></a>          <span class="do">## if it is from a staging compartment, the modifier impacts this rates</span></span>
<span id="cb16-6663"><a href="5-1-helper-functions.html#cb16-6663" aria-hidden="true" tabindex="-1"></a>          incomeIn <span class="ot">&lt;-</span> incomeIn <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income_level]<span class="sc">*</span>income_transitions[age,income_5_cat[income_level],income_5_cat[income]]<span class="sc">*</span>mod</span>
<span id="cb16-6664"><a href="5-1-helper-functions.html#cb16-6664" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6665"><a href="5-1-helper-functions.html#cb16-6665" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-6666"><a href="5-1-helper-functions.html#cb16-6666" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6667"><a href="5-1-helper-functions.html#cb16-6667" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Income Out</span></span>
<span id="cb16-6668"><a href="5-1-helper-functions.html#cb16-6668" aria-hidden="true" tabindex="-1"></a>        incomeOut <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6669"><a href="5-1-helper-functions.html#cb16-6669" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-6670"><a href="5-1-helper-functions.html#cb16-6670" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-6671"><a href="5-1-helper-functions.html#cb16-6671" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6672"><a href="5-1-helper-functions.html#cb16-6672" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span>(income_level <span class="cf">in</span> landings){</span>
<span id="cb16-6673"><a href="5-1-helper-functions.html#cb16-6673" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6674"><a href="5-1-helper-functions.html#cb16-6674" aria-hidden="true" tabindex="-1"></a>          mod <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb16-6675"><a href="5-1-helper-functions.html#cb16-6675" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6676"><a href="5-1-helper-functions.html#cb16-6676" aria-hidden="true" tabindex="-1"></a>          <span class="do">##if(income != income_5_cat[income] &amp;&amp; income_level == income_5_cat[income]){</span></span>
<span id="cb16-6677"><a href="5-1-helper-functions.html#cb16-6677" aria-hidden="true" tabindex="-1"></a>          <span class="do">## mod &lt;- staging_modifier</span></span>
<span id="cb16-6678"><a href="5-1-helper-functions.html#cb16-6678" aria-hidden="true" tabindex="-1"></a>          <span class="do">##}</span></span>
<span id="cb16-6679"><a href="5-1-helper-functions.html#cb16-6679" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6680"><a href="5-1-helper-functions.html#cb16-6680" aria-hidden="true" tabindex="-1"></a>          incomeOut <span class="ot">&lt;-</span> incomeOut <span class="sc">+</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>income_transitions[age,income_5_cat[income],income_5_cat[income_level]]<span class="sc">*</span>mod</span>
<span id="cb16-6681"><a href="5-1-helper-functions.html#cb16-6681" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb16-6682"><a href="5-1-helper-functions.html#cb16-6682" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb16-6683"><a href="5-1-helper-functions.html#cb16-6683" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6684"><a href="5-1-helper-functions.html#cb16-6684" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6685"><a href="5-1-helper-functions.html#cb16-6685" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Income Out</span></span>
<span id="cb16-6686"><a href="5-1-helper-functions.html#cb16-6686" aria-hidden="true" tabindex="-1"></a>        <span class="co"># incomeOut &lt;- 0</span></span>
<span id="cb16-6687"><a href="5-1-helper-functions.html#cb16-6687" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Two cases, either someone is in a non-staging compartment (income == 1-5)</span></span>
<span id="cb16-6688"><a href="5-1-helper-functions.html#cb16-6688" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## Or in a staging compartment (income = 6-13)</span></span>
<span id="cb16-6689"><a href="5-1-helper-functions.html#cb16-6689" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6690"><a href="5-1-helper-functions.html#cb16-6690" aria-hidden="true" tabindex="-1"></a>        <span class="co"># ## First we consider a non-staging compartment</span></span>
<span id="cb16-6691"><a href="5-1-helper-functions.html#cb16-6691" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(income == income_5_cat[income]){</span></span>
<span id="cb16-6692"><a href="5-1-helper-functions.html#cb16-6692" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The number of people who transition out is just the proportion of people</span></span>
<span id="cb16-6693"><a href="5-1-helper-functions.html#cb16-6693" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Whose income changes, which is 1 - the proportion of people whose income won&#39;t change</span></span>
<span id="cb16-6694"><a href="5-1-helper-functions.html#cb16-6694" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income,income]) </span></span>
<span id="cb16-6695"><a href="5-1-helper-functions.html#cb16-6695" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else{</span></span>
<span id="cb16-6696"><a href="5-1-helper-functions.html#cb16-6696" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6697"><a href="5-1-helper-functions.html#cb16-6697" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Question: How do we define the transitions out of the staging compartments</span></span>
<span id="cb16-6698"><a href="5-1-helper-functions.html#cb16-6698" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Is it just that everyone transitions out or is there a proportion that stays put</span></span>
<span id="cb16-6699"><a href="5-1-helper-functions.html#cb16-6699" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## It seems like we need to establish a value S which captures how long people stay in these compartments</span></span>
<span id="cb16-6700"><a href="5-1-helper-functions.html#cb16-6700" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6701"><a href="5-1-helper-functions.html#cb16-6701" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6702"><a href="5-1-helper-functions.html#cb16-6702" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6703"><a href="5-1-helper-functions.html#cb16-6703" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## There are two possible transitions</span></span>
<span id="cb16-6704"><a href="5-1-helper-functions.html#cb16-6704" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income level changes</span></span>
<span id="cb16-6705"><a href="5-1-helper-functions.html#cb16-6705" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Income stabilization</span></span>
<span id="cb16-6706"><a href="5-1-helper-functions.html#cb16-6706" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ##</span></span>
<span id="cb16-6707"><a href="5-1-helper-functions.html#cb16-6707" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6708"><a href="5-1-helper-functions.html#cb16-6708" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## First we account for income changes</span></span>
<span id="cb16-6709"><a href="5-1-helper-functions.html#cb16-6709" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Like in the first case, this is just the proportion of peoples whose income changes</span></span>
<span id="cb16-6710"><a href="5-1-helper-functions.html#cb16-6710" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- states[sex,age,3,e_cigarette,income]*(1 - income_transitions[age,income_5_cat[income],income_5_cat[income]])</span></span>
<span id="cb16-6711"><a href="5-1-helper-functions.html#cb16-6711" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6712"><a href="5-1-helper-functions.html#cb16-6712" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## Second we account for income stabilization</span></span>
<span id="cb16-6713"><a href="5-1-helper-functions.html#cb16-6713" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## The transition out is thus the proportion of people in the compartment whose income</span></span>
<span id="cb16-6714"><a href="5-1-helper-functions.html#cb16-6714" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## stays the same times the staging modifier. If the staging modifier is 0.5 then</span></span>
<span id="cb16-6715"><a href="5-1-helper-functions.html#cb16-6715" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## half of the people whose income is stabilized would leave and go to the non-staging comaprtment</span></span>
<span id="cb16-6716"><a href="5-1-helper-functions.html#cb16-6716" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   incomeOut &lt;- incomeOut + states[sex,age,3,e_cigarette,income]*income_transitions[age,income_5_cat[income],income_5_cat[income]]*staging_modifier</span></span>
<span id="cb16-6717"><a href="5-1-helper-functions.html#cb16-6717" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6718"><a href="5-1-helper-functions.html#cb16-6718" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6719"><a href="5-1-helper-functions.html#cb16-6719" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6720"><a href="5-1-helper-functions.html#cb16-6720" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Cigarette In</span></span>
<span id="cb16-6721"><a href="5-1-helper-functions.html#cb16-6721" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6722"><a href="5-1-helper-functions.html#cb16-6722" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb16-6723"><a href="5-1-helper-functions.html#cb16-6723" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6724"><a href="5-1-helper-functions.html#cb16-6724" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Need a flow for cessation</span></span>
<span id="cb16-6725"><a href="5-1-helper-functions.html#cb16-6725" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6726"><a href="5-1-helper-functions.html#cb16-6726" aria-hidden="true" tabindex="-1"></a>        cigaretteIn <span class="ot">&lt;-</span> cigaretteIn <span class="sc">+</span> states[sex,age,<span class="dv">2</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_cigarette_cessation[sex,age,e_cigarette,income])</span>
<span id="cb16-6727"><a href="5-1-helper-functions.html#cb16-6727" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6728"><a href="5-1-helper-functions.html#cb16-6728" aria-hidden="true" tabindex="-1"></a>        <span class="do">## cigarette Out</span></span>
<span id="cb16-6729"><a href="5-1-helper-functions.html#cb16-6729" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6730"><a href="5-1-helper-functions.html#cb16-6730" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Former Smoker to Current Smoker</span></span>
<span id="cb16-6731"><a href="5-1-helper-functions.html#cb16-6731" aria-hidden="true" tabindex="-1"></a>        cigaretteOut <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_cigarette_reinstatement[sex,age,e_cigarette,income])</span>
<span id="cb16-6732"><a href="5-1-helper-functions.html#cb16-6732" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6733"><a href="5-1-helper-functions.html#cb16-6733" aria-hidden="true" tabindex="-1"></a>        <span class="do">## E-Cigarette Transitions</span></span>
<span id="cb16-6734"><a href="5-1-helper-functions.html#cb16-6734" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6735"><a href="5-1-helper-functions.html#cb16-6735" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette in</span></span>
<span id="cb16-6736"><a href="5-1-helper-functions.html#cb16-6736" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6737"><a href="5-1-helper-functions.html#cb16-6737" aria-hidden="true" tabindex="-1"></a>        e_cigaretteIn <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,<span class="dv">1</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">1</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_initiation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">1</span>] <span class="sc">+</span></span>
<span id="cb16-6738"><a href="5-1-helper-functions.html#cb16-6738" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">2</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">2</span>,<span class="dv">3</span>]<span class="sc">*</span>rr_e_cigarette_cessation[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">2</span>] <span class="sc">+</span></span>
<span id="cb16-6739"><a href="5-1-helper-functions.html#cb16-6739" aria-hidden="true" tabindex="-1"></a>          states[sex,age,<span class="dv">3</span>,<span class="dv">3</span>,income]<span class="sc">*</span>(e_cigarette_transitions[<span class="dv">3</span>,<span class="dv">2</span>]<span class="sc">*</span>rr_e_cigarette_reinstatement[sex,age,<span class="dv">3</span>,income])<span class="sc">*</span>e_cig_in[<span class="dv">3</span>]</span>
<span id="cb16-6740"><a href="5-1-helper-functions.html#cb16-6740" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6741"><a href="5-1-helper-functions.html#cb16-6741" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteIn &lt;- 0</span></span>
<span id="cb16-6742"><a href="5-1-helper-functions.html#cb16-6742" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6743"><a href="5-1-helper-functions.html#cb16-6743" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # if(e_cigarette == 1){</span></span>
<span id="cb16-6744"><a href="5-1-helper-functions.html#cb16-6744" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-6745"><a href="5-1-helper-functions.html#cb16-6745" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   ## never e-cig smoker and therefore there is no in flow</span></span>
<span id="cb16-6746"><a href="5-1-helper-functions.html#cb16-6746" aria-hidden="true" tabindex="-1"></a>        <span class="co"># #   </span></span>
<span id="cb16-6747"><a href="5-1-helper-functions.html#cb16-6747" aria-hidden="true" tabindex="-1"></a>        <span class="co"># # }else </span></span>
<span id="cb16-6748"><a href="5-1-helper-functions.html#cb16-6748" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 2){</span></span>
<span id="cb16-6749"><a href="5-1-helper-functions.html#cb16-6749" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6750"><a href="5-1-helper-functions.html#cb16-6750" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation 1 - 2</span></span>
<span id="cb16-6751"><a href="5-1-helper-functions.html#cb16-6751" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6752"><a href="5-1-helper-functions.html#cb16-6752" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,1,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-6753"><a href="5-1-helper-functions.html#cb16-6753" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6754"><a href="5-1-helper-functions.html#cb16-6754" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-6755"><a href="5-1-helper-functions.html#cb16-6755" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6756"><a href="5-1-helper-functions.html#cb16-6756" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,3,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-6757"><a href="5-1-helper-functions.html#cb16-6757" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6758"><a href="5-1-helper-functions.html#cb16-6758" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-6759"><a href="5-1-helper-functions.html#cb16-6759" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6760"><a href="5-1-helper-functions.html#cb16-6760" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-6761"><a href="5-1-helper-functions.html#cb16-6761" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6762"><a href="5-1-helper-functions.html#cb16-6762" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteIn &lt;- e_cigaretteIn + states[sex,age,3,2,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-6763"><a href="5-1-helper-functions.html#cb16-6763" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6764"><a href="5-1-helper-functions.html#cb16-6764" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6765"><a href="5-1-helper-functions.html#cb16-6765" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6766"><a href="5-1-helper-functions.html#cb16-6766" aria-hidden="true" tabindex="-1"></a>        <span class="do">## e_cigarette out</span></span>
<span id="cb16-6767"><a href="5-1-helper-functions.html#cb16-6767" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6768"><a href="5-1-helper-functions.html#cb16-6768" aria-hidden="true" tabindex="-1"></a>        e_cigaretteOut <span class="ot">&lt;-</span>  states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>(e_cigarette_transitions[e_cigarette,cig_out[e_cigarette]]<span class="sc">*</span>rr_e_cigarette_transitions[e_cigarette,sex,age,<span class="dv">3</span>,income])</span>
<span id="cb16-6769"><a href="5-1-helper-functions.html#cb16-6769" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6770"><a href="5-1-helper-functions.html#cb16-6770" aria-hidden="true" tabindex="-1"></a>        <span class="co"># e_cigaretteOut &lt;- 0</span></span>
<span id="cb16-6771"><a href="5-1-helper-functions.html#cb16-6771" aria-hidden="true" tabindex="-1"></a>        <span class="co"># </span></span>
<span id="cb16-6772"><a href="5-1-helper-functions.html#cb16-6772" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if(e_cigarette == 1){</span></span>
<span id="cb16-6773"><a href="5-1-helper-functions.html#cb16-6773" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6774"><a href="5-1-helper-functions.html#cb16-6774" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for initiation</span></span>
<span id="cb16-6775"><a href="5-1-helper-functions.html#cb16-6775" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6776"><a href="5-1-helper-functions.html#cb16-6776" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[1,2]*rr_e_cigarette_initiation[sex,age,3,income])</span></span>
<span id="cb16-6777"><a href="5-1-helper-functions.html#cb16-6777" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6778"><a href="5-1-helper-functions.html#cb16-6778" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 2){</span></span>
<span id="cb16-6779"><a href="5-1-helper-functions.html#cb16-6779" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6780"><a href="5-1-helper-functions.html#cb16-6780" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for cessation</span></span>
<span id="cb16-6781"><a href="5-1-helper-functions.html#cb16-6781" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6782"><a href="5-1-helper-functions.html#cb16-6782" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[2,3]*rr_e_cigarette_cessation[sex,age,3,income])</span></span>
<span id="cb16-6783"><a href="5-1-helper-functions.html#cb16-6783" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6784"><a href="5-1-helper-functions.html#cb16-6784" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }else if(e_cigarette == 3){</span></span>
<span id="cb16-6785"><a href="5-1-helper-functions.html#cb16-6785" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6786"><a href="5-1-helper-functions.html#cb16-6786" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   ## need a flow for reinstatement</span></span>
<span id="cb16-6787"><a href="5-1-helper-functions.html#cb16-6787" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6788"><a href="5-1-helper-functions.html#cb16-6788" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   e_cigaretteOut &lt;- e_cigaretteOut + states[sex,age,3,e_cigarette,income]*(e_cigarette_transitions[3,2]*rr_e_cigarette_reinstatement[sex,age,3,income])</span></span>
<span id="cb16-6789"><a href="5-1-helper-functions.html#cb16-6789" aria-hidden="true" tabindex="-1"></a>        <span class="co">#   </span></span>
<span id="cb16-6790"><a href="5-1-helper-functions.html#cb16-6790" aria-hidden="true" tabindex="-1"></a>        <span class="co"># }</span></span>
<span id="cb16-6791"><a href="5-1-helper-functions.html#cb16-6791" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6792"><a href="5-1-helper-functions.html#cb16-6792" aria-hidden="true" tabindex="-1"></a>        <span class="do">## Death</span></span>
<span id="cb16-6793"><a href="5-1-helper-functions.html#cb16-6793" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6794"><a href="5-1-helper-functions.html#cb16-6794" aria-hidden="true" tabindex="-1"></a>        death <span class="ot">&lt;-</span> states[sex,age,<span class="dv">3</span>,e_cigarette,income]<span class="sc">*</span>death_rates[sex,age]<span class="sc">*</span>excess_cigarette_death_RR[sex,<span class="dv">3</span>]</span>
<span id="cb16-6795"><a href="5-1-helper-functions.html#cb16-6795" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb16-6796"><a href="5-1-helper-functions.html#cb16-6796" aria-hidden="true" tabindex="-1"></a>        <span class="do">## ODE 3</span></span>
<span id="cb16-6797"><a href="5-1-helper-functions.html#cb16-6797" aria-hidden="true" tabindex="-1"></a>        ODEs[sex,age, <span class="dv">3</span>, e_cigarette, income] <span class="ot">&lt;-</span> ageIn <span class="sc">-</span> ageOut <span class="sc">+</span> incomeIn <span class="sc">-</span> incomeOut <span class="sc">+</span> e_cigaretteIn <span class="sc">-</span> e_cigaretteOut <span class="sc">+</span> cigaretteIn <span class="sc">-</span> cigaretteOut <span class="sc">-</span> death</span>
<span id="cb16-6798"><a href="5-1-helper-functions.html#cb16-6798" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb16-6799"><a href="5-1-helper-functions.html#cb16-6799" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-6800"><a href="5-1-helper-functions.html#cb16-6800" aria-hidden="true" tabindex="-1"></a>    <span class="co"># }</span></span>
<span id="cb16-6801"><a href="5-1-helper-functions.html#cb16-6801" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-6802"><a href="5-1-helper-functions.html#cb16-6802" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6803"><a href="5-1-helper-functions.html#cb16-6803" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6804"><a href="5-1-helper-functions.html#cb16-6804" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6805"><a href="5-1-helper-functions.html#cb16-6805" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-6806"><a href="5-1-helper-functions.html#cb16-6806" aria-hidden="true" tabindex="-1"></a>  <span class="co">#return(list(c(dE,dV,dA,dB,dC,dD,dEx)))</span></span>
<span id="cb16-6807"><a href="5-1-helper-functions.html#cb16-6807" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="fu">toVector</span>(ODEs)))</span>
<span id="cb16-6808"><a href="5-1-helper-functions.html#cb16-6808" aria-hidden="true" tabindex="-1"></a>  <span class="co"># })</span></span>
<span id="cb16-6809"><a href="5-1-helper-functions.html#cb16-6809" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
<!-- </div> -->
<p style="text-align: center;">
<a href="5-ode.html"><button class="btn btn-default">Previous</button></a>
<a href="6-calibration.html"><button class="btn btn-default">Next</button></a>
</p>
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

</body>
</html>
